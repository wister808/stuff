<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 11. Web Scraping</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 11. Web Scraping"><div class="titlepage"><div><div><h1 class="title"><a id="web_scraping"/>Chapter 11. Web Scraping</h1></div></div></div><p><a id="iddle2676" class="indexterm"/>In those rare, terrifying moments when I’m without Wi-Fi, I realize just how much of what I do on the computer is really what I do on the Internet. Out of sheer habit I’ll find myself trying to check email, read friends’ Twitter feeds, or answer the question, “Did Kurtwood Smith have any major roles before he was in the original 1987 <span class="emphasis"><em>RoboCop</em></span>?”<sup>[<a id="ch11fn01" href="#ftn.ch11fn01" class="footnote">2</a>]</sup></p><p>Since so much work on a computer involves going on the Internet, it’d be great if your programs could get online. <span class="emphasis"><em>Web scraping</em></span> is the term for using a program to download and process content from the Web. For example, Google runs many web scraping programs to index web pages for its search engine. In this chapter, you will learn about several modules that make it easy to scrape web pages in Python.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="webbrowser"><span class="title"><strong><span class="strong"><strong><code class="literal">webbrowser</code></strong></span></strong></span>. <a id="iddle1137" class="indexterm"/><a id="iddle1610" class="indexterm"/><a id="iddle1898" class="indexterm"/><a id="iddle1899" class="indexterm"/><a id="iddle1903" class="indexterm"/><a id="iddle2019" class="indexterm"/><a id="iddle2188" class="indexterm"/><a id="iddle2659" class="indexterm"/><a id="iddle2669" class="indexterm"/>Comes with Python and opens a browser to a specific page.</p></li><li class="listitem"><p title="Requests"><span class="title"><strong><span class="strong"><strong>Requests</strong></span></strong></span>. Downloads files and web pages from the Internet.</p></li><li class="listitem"><p title="Beautiful Soup"><span class="title"><strong><span class="strong"><strong>Beautiful Soup</strong></span></strong></span>. Parses HTML, the format that web pages are written in.</p></li><li class="listitem"><p title="Selenium"><span class="title"><strong><span class="strong"><strong>Selenium</strong></span></strong></span>. Launches and controls a web browser. Selenium is able to fill in forms and simulate mouse clicks in this browser.</p></li></ul></div><div class="sect1" title="Project: mapit.py with the webbrowser Module"><div class="titlepage"><div><div><h1 class="title"><a id="project_mapitdotpy_with_the_webbrowser_m"/>Project: mapit.py with the webbrowser Module</h1></div></div></div><p>The <code class="literal">webbrowser</code> module’s <code class="literal">open()</code> function can launch a new browser to a specified URL. Enter the following into the interactive shell:</p><a id="pro_id00405"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import webbrowser</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>webbrowser.open('http://inventwithpython.com/')</strong></span></pre><p>A web browser tab will open to the URL <span class="emphasis"><em><a class="ulink" href="http://inventwithpython.com/">http://inventwithpython.com/</a></em></span>. This is about the only thing the <code class="literal">webbrowser</code> module can do. Even so, the <code class="literal">open()</code> function does make some interesting things possible. For example, it’s tedious to copy a street address to the clipboard and bring up a map of it on Google Maps. You could take a few steps out of this task by writing a simple script to automatically launch the map in your browser using the contents of your clipboard. This way, you only have to copy the address to a clipboard and run the script, and the map will be loaded for you.</p><p>This is what your program does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Gets a street address from the command line arguments or clipboard.</p></li><li class="listitem"><p>Opens the web browser to the Google Maps page for the address.</p></li></ul></div><p>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Read the command line arguments from <code class="literal">sys.argv</code>.</p></li><li class="listitem"><p>Read the clipboard contents.</p></li><li class="listitem"><p>Call the <code class="literal">webbrowser.open()</code> function to open the web browser.</p></li></ul></div><p>Open a new file editor window and save it as <span class="emphasis"><em>mapIt.py</em></span>.</p><div class="sect2" title="Step 1: Figure Out the URL"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_figure_out_the_url"/>Step 1: Figure Out the URL</h2></div></div></div><p>Based on the instructions in Appendix B, set up <span class="emphasis"><em>mapIt.py</em></span> so that when you run it from the command line, like so...</p><a id="pro_id00406"/><pre class="programlisting">C:\&gt; mapit 870 Valencia St, San Francisco, CA 94110</pre><p>... the script will use the command line arguments instead of the clipboard. If there are no command line arguments, then the program will know to use the contents of the clipboard.</p><p><a id="iddle1194" class="indexterm"/><a id="iddle1901" class="indexterm"/>First you need to figure out what URL to use for a given street address. When you load <span class="emphasis"><em><a class="ulink" href="http://maps.google.com/">http://maps.google.com/</a></em></span> in the browser and search for an address, the URL in the address bar looks something like this: <span class="emphasis"><em><a class="ulink" href="https://www.google.com/maps/place/870+Valencia+St/@37.7590311,-122.4215096,17z/data=!3m1!4b1!4m2!3m1!1s0x808f7e3dadc07a37:0xc86b0b2bb93b73d8">https://www.google.com/maps/place/870+Valencia+St/@37.7590311,-122.4215096,17z/data=!3m1!4b1!4m2!3m1!1s0x808f7e3dadc07a37:0xc86b0b2bb93b73d8</a></em></span>.</p><p>The address is in the URL, but there’s a lot of additional text there as well. Websites often add extra data to URLs to help track visitors or customize sites. But if you try just going to <span class="emphasis"><em><a class="ulink" href="https://www.google.com/maps/place/870+Valencia+St+San+Francisco+CA/">https://www.google.com/maps/place/870+Valencia+St+San+Francisco+CA/</a></em></span>, you’ll find that it still brings up the correct page. So your program can be set to open a web browser to <code class="literal">'https://www.google.com/maps/place/</code><span class="emphasis"><em><code class="literal">your_address_string'</code></em></span> (where <span class="emphasis"><em><code class="literal">your_address_string</code></em></span> is the address you want to map).</p></div><div class="sect2" title="Step 2: Handle the Command Line Arguments"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_handle_the_command_line_arguments"/>Step 2: Handle the Command Line Arguments</h2></div></div></div><p>Make your code look like this:</p><a id="pro_id00407"/><pre class="programlisting">#! python3
# mapIt.py - Launches a map in the browser using an address from the
# command line or clipboard.

import webbrowser, sys
if len(sys.argv) &gt; 1:
    # Get address from command line.
    address = ' '.join(sys.argv[1:])

# TODO: Get address from clipboard.</pre><p>After the program’s <code class="literal">#!</code> shebang line, you need to import the <code class="literal">webbrowser</code> module for launching the browser and import the <code class="literal">sys</code> module for reading the potential command line arguments. The <code class="literal">sys.argv</code> variable stores a list of the program’s filename and command line arguments. If this list has more than just the filename in it, then <code class="literal">len(sys.argv)</code> evaluates to an integer greater than <code class="literal">1</code>, meaning that command line arguments have indeed been provided.</p><p>Command line arguments are usually separated by spaces, but in this case, you want to interpret all of the arguments as a single string. Since <code class="literal">sys.argv</code> is a list of strings, you can pass it to the <code class="literal">join()</code> method, which returns a single string value. You don’t want the program name in this string, so instead of <code class="literal">sys.argv</code>, you should pass <code class="literal">sys.argv[1:]</code> to chop off the first element of the array. The final string that this expression evaluates to is stored in the <code class="literal">address</code> variable.</p><p>If you run the program by entering this into the command line...</p><a id="pro_id00408"/><pre class="programlisting">mapit 870 Valencia St, San Francisco, CA 94110</pre><p>... the <code class="literal">sys.argv</code> variable will contain this list value:</p><a id="pro_id00409"/><pre class="programlisting">['mapIt.py', '870', 'Valencia', 'St, ', 'San', 'Francisco, ', 'CA', '94110']</pre><p>The <code class="literal">address</code> variable will contain the string <code class="literal">'870 Valencia St, San Francisco, CA 94110'</code>.</p></div><div class="sect2" title="Step 3: Handle the Clipboard Content and Launch the Browser"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_handle_the_clipboard_content_and"/>Step 3: Handle the Clipboard Content and Launch the Browser</h2></div></div></div><p><a id="iddle1179" class="indexterm"/><a id="iddle1900" class="indexterm"/><a id="iddle1902" class="indexterm"/>Make your code look like the following:</p><a id="pro_id00410"/><pre class="programlisting">#! python3
# mapIt.py - Launches a map in the browser using an address from the
# command line or clipboard.

import webbrowser, sys, <span class="strong"><strong>pyperclip</strong></span>
if len(sys.argv) &gt; 1:
    # Get address from command line.
    address = ' '.join(sys.argv[1:])
<span class="strong"><strong>else:</strong></span>
    <span class="strong"><strong># Get address from clipboard.</strong></span>
    <span class="strong"><strong>address = pyperclip.paste()</strong></span>

<span class="strong"><strong>webbrowser.open('https://www.google.com/maps/place/' + address)</strong></span></pre><p>If there are no command line arguments, the program will assume the address is stored on the clipboard. You can get the clipboard content with <code class="literal">pyperclip.paste()</code> and store it in a variable named <code class="literal">address</code>. Finally, to launch a web browser with the Google Maps URL, call <code class="literal">webbrowser.open()</code>.</p><p>While some of the programs you write will perform huge tasks that save you hours, it can be just as satisfying to use a program that conveniently saves you a few seconds each time you perform a common task, such as getting a map of an address. <a class="xref" href="ch11.html#getting_a_map_with_and_without_mapitdotp" title="Table 11-1. Getting a Map with and Without mapIt.py">Table 11-1</a> compares the steps needed to display a map with and without <span class="emphasis"><em>mapIt.py</em></span>.</p><div class="table"><a id="getting_a_map_with_and_without_mapitdotp"/><p class="title">Table 11-1. Getting a Map with and Without <span class="emphasis"><em>mapIt.py</em></span></p><div class="table-contents"><table summary="Getting a Map with and Without mapIt.py" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Manually getting a map</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Using <span class="emphasis"><em>mapIt.py</em></span></p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Highlight the address.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Highlight the address.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Copy the address.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Copy the address.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Open the web browser.</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Run <span class="emphasis"><em>mapIt.py</em></span>.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Go to <span class="emphasis"><em><a class="ulink" href="http://maps.google.com/">http://maps.google.com/</a></em></span>.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Click the address text field.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Paste the address.</p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>Press <span class="smaller">ENTER</span>.</p></td><td style=""> </td></tr></tbody></table></div></div><p>See how <span class="emphasis"><em>mapIt.py</em></span> makes this task less tedious?</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00034"/>Ideas for Similar Programs</h2></div></div></div><p>As long as you have a URL, the <code class="literal">webbrowser</code> module lets users cut out the step of opening the browser and directing themselves to a website. Other programs could use this functionality to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open all links on a page in separate browser tabs.</p></li><li class="listitem"><p>Open the browser to the URL for your local weather.</p></li><li class="listitem"><p>Open several social network sites that you regularly check.</p></li></ul></div></div></div><div class="sect1" title="Downloading Files from the Web with the requests Module"><div class="titlepage"><div><div><h1 class="title"><a id="downloading_files_from_the_web_with_the"/>Downloading Files from the Web with the requests Module</h1></div></div></div><p><a id="iddle1354" class="indexterm"/><a id="iddle1591" class="indexterm"/><a id="iddle2342" class="indexterm"/><a id="iddle2344" class="indexterm"/><a id="iddle2668" class="indexterm"/><a id="iddle2677" class="indexterm"/>The <code class="literal">requests</code> module lets you easily download files from the Web without having to worry about complicated issues such as network errors, connection problems, and data compression. The <code class="literal">requests</code> module doesn’t come with Python, so you’ll have to install it first. From the command line, run <span class="strong"><strong><code class="literal">pip install requests</code></strong></span>. (Appendix A has additional details on how to install third-party modules.)</p><p>The <code class="literal">requests</code> module was written because Python’s <code class="literal">urllib2</code> module is too complicated to use. In fact, take a permanent marker and black out this entire paragraph. Forget I ever mentioned <code class="literal">urllib2</code>. If you need to download things from the Web, just use the <code class="literal">requests</code> module.</p><p>Next, do a simple test to make sure the <code class="literal">requests</code> module installed itself correctly. Enter the following into the interactive shell:</p><a id="pro_id00411"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import requests</strong></span></pre><p>If no error messages show up, then the <code class="literal">requests</code> module has been successfully installed.</p><div class="sect2" title="Downloading a Web Page with the requests.get() Function"><div class="titlepage"><div><div><h2 class="title"><a id="downloading_a_web_page_with_the_requests"/>Downloading a Web Page with the requests.get() Function</h2></div></div></div><p>The <code class="literal">requests.get()</code> function takes a string of a URL to download. By calling <code class="literal">type()</code> on <code class="literal">requests.get()</code>’s return value, you can see that it returns a <code class="literal">Response</code> object, which contains the response that the web server gave for your request. I’ll explain the <code class="literal">Response</code> object in more detail later, but for now, enter the following into the interactive shell while your computer is connected to the Internet:</p><a id="pro_id00412"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import requests</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>res = requests.get('https://automatetheboringstuff.com/files/rj.txt')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>type(res)</strong></span>
   &lt;class 'requests.models.Response'&gt;
➋ &gt;&gt;&gt; <span class="strong"><strong>res.status_code == requests.codes.ok</strong></span>
   True
   &gt;&gt;&gt; <span class="strong"><strong>len(res.text)</strong></span>
   178981
   &gt;&gt;&gt; <span class="strong"><strong>print(res.text[:250])</strong></span>
   The Project Gutenberg EBook of Romeo and Juliet, by William Shakespeare

   This eBook is for the use of anyone anywhere at no cost and with
   almost no restrictions whatsoever. You may copy it, give it away or
   re-use it under the terms of the Proje</pre><p>The URL goes to a text web page for the entire play of <span class="emphasis"><em>Romeo and Juliet</em></span>, provided on this book’s site ➊. You can tell that the request for this web page succeeded by checking the <code class="literal">status_code</code> attribute of the <code class="literal">Response</code> object. <a id="iddle2283" class="indexterm"/>If it is equal to the value of <code class="literal">requests.codes.ok</code>, then everything went fine ➋. (Incidentally, the status code for “OK” in the HTTP protocol is 200. You may already be familiar with the 404 status code for “Not Found.”)</p><p>If the request succeeded, the downloaded web page is stored as a string in the <code class="literal">Response</code> object’s <code class="literal">text</code> variable. This variable holds a large string of the entire play; the call to <code class="literal">len(res.text)</code> shows you that it is more than 178,000 characters long. Finally, calling <code class="literal">print(res.text[:250])</code> displays only the first 250 characters.</p></div><div class="sect2" title="Checking for Errors"><div class="titlepage"><div><div><h2 class="title"><a id="checking_for_errors"/>Checking for Errors</h2></div></div></div><p>As you’ve seen, the <code class="literal">Response</code> object has a <code class="literal">status_code</code> attribute that can be checked against <code class="literal">requests.codes.ok</code> to see whether the download succeeded. A simpler way to check for success is to call the <code class="literal">raise_for_status()</code> method on the <code class="literal">Response</code> object. This will raise an exception if there was an error downloading the file and will do nothing if the download succeeded. Enter the following into the interactive shell:</p><a id="pro_id00413"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>res = requests.get('http://inventwithpython.com/page_that_does_not_exist')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>res.raise_for_status()</strong></span>
Traceback (most recent call last):
  File "&lt;pyshell#138&gt;", line 1, in &lt;module&gt;
    res.raise_for_status()
  File "C:\Python34\lib\site-packages\requests\models.py", line 773, in raise_for_status
    raise HTTPError(http_error_msg, response=self)
requests.exceptions.HTTPError: 404 Client Error: Not Found</pre><p>The <code class="literal">raise_for_status()</code> method is a good way to ensure that a program halts if a bad download occurs. This is a good thing: You want your program to stop as soon as some unexpected error happens. If a failed download <span class="emphasis"><em>isn’t</em></span> a deal breaker for your program, you can wrap the <code class="literal">raise_for_status()</code> line with <code class="literal">try</code> and <code class="literal">except</code> statements to handle this error case without crashing.</p><a id="pro_id00414"/><pre class="programlisting">import requests
res = requests.get('http://inventwithpython.com/page_that_does_not_exist')
try:
    res.raise_for_status()
except Exception as exc:
    print('There was a problem: %s' % (exc))</pre><p>This <code class="literal">raise_for_status()</code> method call causes the program to output the following:</p><a id="pro_id00415"/><pre class="programlisting">There was a problem: 404 Client Error: Not Found</pre><p>Always call <code class="literal">raise_for_status()</code> after calling <code class="literal">requests.get()</code>. You want to be sure that the download has actually worked before your program continues.</p></div></div><div class="sect1" title="Saving Downloaded Files to the Hard Drive"><div class="titlepage"><div><div><h1 class="title"><a id="saving_downloaded_files_to_the_hard_driv"/>Saving Downloaded Files to the Hard Drive</h1></div></div></div><p><a id="iddle1353" class="indexterm"/><a id="iddle1762" class="indexterm"/><a id="iddle2341" class="indexterm"/><a id="iddle2618" class="indexterm"/><a id="iddle2666" class="indexterm"/>From here, you can save the web page to a file on your hard drive with the standard <code class="literal">open()</code> function and <code class="literal">write()</code> method. There are some slight differences, though. First, you must open the file in <span class="emphasis"><em>write binary</em></span> mode by passing the string <code class="literal">'wb'</code> as the second argument to <code class="literal">open()</code>. Even if the page is in plaintext (such as the <span class="emphasis"><em>Romeo and Juliet</em></span> text you downloaded earlier), you need to write binary data instead of text data in order to maintain the <span class="emphasis"><em>Unicode encoding</em></span> of the text.</p><div class="sidebar"><a id="unicode_encodings"/><p class="title">Unicode Encodings</p><p>Unicode encodings are beyond the scope of this book, but you can learn more about them from these web pages:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Joel on Software: The Absolute Minimum Every Software Developer Absolutely, Positively Must Know About Unicode and Character Sets (No Excuses!): <span class="emphasis"><em><a class="ulink" href="http://www.joelonsoftware.com/articles/Unicode.html">http://www.joelonsoftware.com/articles/Unicode.html</a></em></span></p></li><li class="listitem"><p>Pragmatic Unicode: <span class="emphasis"><em><a class="ulink" href="http://nedbatchelder.com/text/unipain.html">http://nedbatchelder.com/text/unipain.html</a></em></span></p></li></ul></div></div><p>To write the web page to a file, you can use a <code class="literal">for</code> loop with the <code class="literal">Response</code> object’s <code class="literal">iter_content()</code> method.</p><a id="pro_id00416"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import requests</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>res = requests.get('https://automatetheboringstuff.com/files/rj.txt')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>res.raise_for_status()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>playFile = open('RomeoAndJuliet.txt', 'wb')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>for chunk in res.iter_content(100000):</strong></span>
        <span class="strong"><strong>playFile.write(chunk)</strong></span>

100000
78981
&gt;&gt;&gt; <span class="strong"><strong>playFile.close()</strong></span></pre><p>The <code class="literal">iter_content()</code> method returns “chunks” of the content on each iteration through the loop. Each chunk is of the <span class="emphasis"><em>bytes</em></span> data type, and you get to specify how many bytes each chunk will contain. One hundred thousand bytes is generally a good size, so pass <code class="literal">100000</code> as the argument to <code class="literal">iter_content()</code>.</p><p>The file <span class="emphasis"><em>RomeoAndJuliet.txt</em></span> will now exist in the current working directory. Note that while the filename on the website was <span class="emphasis"><em>rj.txt</em></span>, the file on your hard drive has a different filename. The <code class="literal">requests</code> module simply handles downloading the contents of web pages. Once the page is downloaded, it is simply data in your program. Even if you were to lose your Internet connection after downloading the web page, all the page data would still be on your computer.</p><p><a id="iddle1376" class="indexterm"/><a id="iddle1657" class="indexterm"/><a id="iddle1658" class="indexterm"/><a id="iddle2545" class="indexterm"/><a id="iddle2673" class="indexterm"/><a id="iddle2674" class="indexterm"/>The <code class="literal">write()</code> method returns the number of bytes written to the file. In the previous example, there were 100,000 bytes in the first chunk, and the remaining part of the file needed only 78,981 bytes.</p><p>To review, here’s the complete process for downloading and saving a file:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Call <code class="literal">requests.get()</code> to download the file.</p></li><li class="listitem"><p>Call <code class="literal">open()</code> with <code class="literal">'wb'</code> to create a new file in write binary mode.</p></li><li class="listitem"><p>Loop over the <code class="literal">Response</code> object’s <code class="literal">iter_content()</code> method.</p></li><li class="listitem"><p>Call <code class="literal">write()</code> on each iteration to write the content to the file.</p></li><li class="listitem"><p>Call <code class="literal">close()</code> to close the file.</p></li></ol></div><p>That’s all there is to the <code class="literal">requests</code> module! The <code class="literal">for</code> loop and <code class="literal">iter_content()</code> stuff may seem complicated compared to the <code class="literal">open()</code>/<code class="literal">write()</code>/<code class="literal">close()</code> workflow you’ve been using to write text files, but it’s to ensure that the <code class="literal">requests</code> module doesn’t eat up too much memory even if you download massive files. You can learn about the <code class="literal">requests</code> module’s other features from <span class="emphasis"><em><a class="ulink" href="http://requests.readthedocs.org/">http://requests.readthedocs.org/</a></em></span>.</p></div><div class="sect1" title="HTML"><div class="titlepage"><div><div><h1 class="title"><a id="html"/>HTML</h1></div></div></div><p>Before you pick apart web pages, you’ll learn some HTML basics. You’ll also see how to access your web browser’s powerful developer tools, which will make scraping information from the Web much easier.</p><div class="sect2" title="Resources for Learning HTML"><div class="titlepage"><div><div><h2 class="title"><a id="resources_for_learning_html"/>Resources for Learning HTML</h2></div></div></div><p><span class="emphasis"><em>Hypertext Markup Language (HTML)</em></span> is the format that web pages are written in. This chapter assumes you have some basic experience with HTML, but if you need a beginner tutorial, I suggest one of the following sites:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://htmldog.com/guides/html/beginner/">http://htmldog.com/guides/html/beginner/</a></em></span></p></li><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="http://www.codecademy.com/tracks/web/">http://www.codecademy.com/tracks/web/</a></em></span></p></li><li class="listitem"><p><span class="emphasis"><em><a class="ulink" href="https://developer.mozilla.org/en-US/learn/html/">https://developer.mozilla.org/en-US/learn/html/</a></em></span></p></li></ul></div></div><div class="sect2" title="A Quick Refresher"><div class="titlepage"><div><div><h2 class="title"><a id="quick_refresher"/>A Quick Refresher</h2></div></div></div><p>In case it’s been a while since you’ve looked at any HTML, here’s a quick overview of the basics. An HTML file is a plaintext file with the <span class="emphasis"><em>.html</em></span> file extension. The text in these files is surrounded by <span class="emphasis"><em>tags</em></span>, which are words enclosed in angle brackets. The tags tell the browser how to format the web page. A starting tag and closing tag can enclose some text to form an <span class="emphasis"><em>element</em></span>. The <span class="emphasis"><em>text</em></span> (or <span class="emphasis"><em>inner HTML</em></span>) is the content between the starting and closing tags. For example, the following HTML will display <span class="emphasis"><em>Hello world!</em></span> in the browser, with <span class="emphasis"><em>Hello</em></span> in bold:</p><a id="pro_id00417"/><pre class="programlisting">&lt;strong&gt;Hello&lt;/strong&gt; world!</pre><p><a id="iddle1101" class="indexterm"/><a id="iddle1659" class="indexterm"/><a id="iddle1661" class="indexterm"/><a id="iddle2675" class="indexterm"/>This HTML will look like <a class="xref" href="ch11.html#hello_worldexclamation_mark_rendered_in" title="Figure 11-1. Hello world! rendered in the browser">Figure 11-1</a> in a browser.</p><div class="figure"><a id="hello_worldexclamation_mark_rendered_in"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00045"/><img src="figs/web/11fig01.png.jpg" alt="Hello world! rendered in the browser"/></div></div><p class="title">Figure 11-1. <span class="emphasis"><em>Hello world!</em></span> rendered in the browser</p></div><p>The opening <code class="literal">&lt;strong&gt;</code> tag says that the enclosed text will appear in bold. The closing <code class="literal">&lt;/strong&gt;</code> tags tells the browser where the end of the bold text is.</p><p>There are many different tags in HTML. Some of these tags have extra properties in the form of <span class="emphasis"><em>attributes</em></span> within the angle brackets. For example, the <code class="literal">&lt;a&gt;</code> tag encloses text that should be a link. The URL that the text links to is determined by the <code class="literal">href</code> attribute. Here’s an example:</p><a id="pro_id00418"/><pre class="programlisting">Al's free &lt;a href="http://inventwithpython.com"&gt;Python books&lt;/a&gt;.</pre><p>This HTML will look like <a class="xref" href="ch11.html#link_rendered_in_the_browser" title="Figure 11-2. The link rendered in the browser">Figure 11-2</a> in a browser.</p><div class="figure"><a id="link_rendered_in_the_browser"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00046"/><img src="figs/web/11fig02.png.jpg" alt="The link rendered in the browser"/></div></div><p class="title">Figure 11-2. The link rendered in the browser</p></div><p>Some elements have an <code class="literal">id</code> attribute that is used to uniquely identify the element in the page. You will often instruct your programs to seek out an element by its <code class="literal">id</code> attribute, so figuring out an element’s <code class="literal">id</code> attribute using the browser’s developer tools is a common task in writing web scraping programs.</p></div><div class="sect2" title="Viewing the Source HTML of a Web Page"><div class="titlepage"><div><div><h2 class="title"><a id="viewing_the_source_html_of_a_web_page"/>Viewing the Source HTML of a Web Page</h2></div></div></div><p>You’ll need to look at the HTML source of the web pages that your programs will work with. To do this, right-click (or <span class="smaller">CTRL</span>-click on OS X) any web page in your web browser, and select <span class="strong"><strong>View Source</strong></span> or <span class="strong"><strong>View page source</strong></span> to see the HTML text of the page (see <a class="xref" href="ch11.html#viewing_the_source_of_a_web_page" title="Figure 11-3. Viewing the source of a web page">Figure 11-3</a>). This is the text your browser actually receives. The browser knows how to display, or <span class="emphasis"><em>render</em></span>, the web page from this HTML.</p><div class="figure"><a id="viewing_the_source_of_a_web_page"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00047"/><img src="figs/web/11fig03.png.jpg" alt="Viewing the source of a web page"/></div></div><p class="title">Figure 11-3. Viewing the source of a web page</p></div><p><a id="iddle1172" class="indexterm"/><a id="iddle1655" class="indexterm"/><a id="iddle1743" class="indexterm"/><a id="iddle2671" class="indexterm"/>I highly recommend viewing the source HTML of some of your favorite sites. It’s fine if you don’t fully understand what you are seeing when you look at the source. You won’t need HTML mastery to write simple web scraping programs—after all, you won’t be writing your own websites. You just need enough knowledge to pick out data from an existing site.</p></div><div class="sect2" title="Opening Your Browser’s Developer Tools"><div class="titlepage"><div><div><h2 class="title"><a id="opening_your_browserapostrophes_develope"/>Opening Your Browser’s Developer Tools</h2></div></div></div><p>In addition to viewing a web page’s source, you can look through a page’s HTML using your browser’s developer tools. In Chrome and Internet Explorer for Windows, the developer tools are already installed, and you can press F12 to make them appear (see <a class="xref" href="ch11.html#developer_tools_window_in_the_chrome_bro" title="Figure 11-4. The Developer Tools window in the Chrome browser">Figure 11-4</a>). Pressing F12 again will make the developer tools disappear. In Chrome, you can also bring up the developer tools by selecting View▸Developer▸Developer Tools. In OS X, pressing <span class="inlinemediaobject"><a id="inline_id00001"/><img src="figs/web/common-01.png.jpg" alt=""/></span>-<span class="smaller">OPTION</span>-I will open Chrome’s Developer Tools.</p><div class="figure"><a id="developer_tools_window_in_the_chrome_bro"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00048"/><img src="figs/web/11fig04.png.jpg" alt="The Developer Tools window in the Chrome browser"/></div></div><p class="title">Figure 11-4. The Developer Tools window in the Chrome browser</p></div><p><a id="iddle1508" class="indexterm"/><a id="iddle2317" class="indexterm"/><a id="iddle2373" class="indexterm"/>In Firefox, you can bring up the Web Developer Tools Inspector by pressing <span class="smaller">CTRL</span>-<span class="smaller">SHIFT</span>-C on Windows and Linux or by pressing ⌘-<span class="smaller">OPTION</span>-C on OS X. The layout is almost identical to Chrome’s developer tools.</p><p>In Safari, open the Preferences window, and on the Advanced pane check the <span class="strong"><strong>Show Develop menu in the menu bar</strong></span> option. After it has been enabled, you can bring up the developer tools by pressing <span class="inlinemediaobject"><a id="inline_id00002"/><img src="figs/web/common-01.png.jpg" alt=""/></span>-<span class="smaller">OPTION</span>-I.</p><p>After enabling or installing the developer tools in your browser, you can right-click any part of the web page and select <span class="strong"><strong>Inspect Element</strong></span> from the context menu to bring up the HTML responsible for that part of the page. This will be helpful when you begin to parse HTML for your web scraping programs.</p><div class="sidebar"><a id="donapostrophet_use_regular_expressions_t"/><p class="title">Don’t Use Regular Expressions to Parse HTML</p><p>Locating a specific piece of HTML in a string seems like a perfect case for regular expressions. However, I advise you against it. There are many different ways that HTML can be formatted and still be considered valid HTML, but trying to capture all these possible variations in a regular expression can be tedious and error prone. A module developed specifically for parsing HTML, such as Beautiful Soup, will be less likely to result in bugs.</p><p>You can find an extended argument for why you shouldn’t to parse HTML with regular expressions at <span class="emphasis"><em><a class="ulink" href="http://stackoverflow.com/a/1732454/1893164/">http://stackoverflow.com/a/1732454/1893164/</a></em></span>.</p></div></div><div class="sect2" title="Using the Developer Tools to Find HTML Elements"><div class="titlepage"><div><div><h2 class="title"><a id="using_the_developer_tools_to_find_html_e"/>Using the Developer Tools to Find HTML Elements</h2></div></div></div><p><a id="iddle1656" class="indexterm"/><a id="iddle2672" class="indexterm"/>Once your program has downloaded a web page using the <code class="literal">requests</code> module, you will have the page’s HTML content as a single string value. Now you need to figure out which part of the HTML corresponds to the information on the web page you’re interested in.</p><p>This is where the browser’s developer tools can help. Say you want to write a program to pull weather forecast data from <span class="emphasis"><em><a class="ulink" href="http://weather.gov/">http://weather.gov/</a></em></span>. Before writing any code, do a little research. If you visit the site and search for the 94105 ZIP code, the site will take you to a page showing the forecast for that area.</p><p>What if you’re interested in scraping the temperature information for that ZIP code? Right-click where it is on the page (or <span class="smaller">CONTROL</span>-click on OS X) and select <span class="strong"><strong>Inspect Element</strong></span> from the context menu that appears. This will bring up the Developer Tools window, which shows you the HTML that produces this particular part of the web page. <a class="xref" href="ch11.html#inspecting_the_element_that_holds_the_te" title="Figure 11-5. Inspecting the element that holds the temperature text with the developer tools">Figure 11-5</a> shows the developer tools open to the HTML of the temperature.</p><div class="figure"><a id="inspecting_the_element_that_holds_the_te"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00049"/><img src="figs/web/11fig05.png.jpg" alt="Inspecting the element that holds the temperature text with the developer tools"/></div></div><p class="title">Figure 11-5. Inspecting the element that holds the temperature text with the developer tools</p></div><p>From the developer tools, you can see that the HTML responsible for the temperature part of the web page is <code class="literal">&lt;p class="myforecast-current -lrg"&gt;59°F&lt;/p&gt;</code>. This is exactly what you were looking for! It seems that the temperature information is contained inside a <code class="literal">&lt;p&gt;</code> element with the <code class="literal">myforecast-current-lrg</code> class. Now that you know what you’re looking for, the <code class="literal">BeautifulSoup</code> module will help you find it in the string.</p></div></div><div class="sect1" title="Parsing HTML with the BeautifulSoup Module"><div class="titlepage"><div><div><h1 class="title"><a id="parsing_html_with_the_beautifulsoup_modu"/>Parsing HTML with the BeautifulSoup Module</h1></div></div></div><p><a id="iddle1115" class="indexterm"/><a id="iddle1116" class="indexterm"/><a id="iddle1138" class="indexterm"/><a id="iddle1141" class="indexterm"/><a id="iddle2059" class="indexterm"/><a id="iddle2662" class="indexterm"/><a id="iddle2665" class="indexterm"/>Beautiful Soup is a module for extracting information from an HTML page (and is much better for this purpose than regular expressions). The <code class="literal">BeautifulSoup</code> module’s name is <code class="literal">bs4</code> (for Beautiful Soup, version 4). To install it, you will need to run <code class="literal">pip install beautifulsoup4</code> from the command line. (Check out Appendix A for instructions on installing third-party modules.) While <code class="literal">beautifulsoup4</code> is the name used for installation, to import Beautiful Soup you run <code class="literal">import bs4</code>.</p><p>For this chapter, the Beautiful Soup examples will <span class="emphasis"><em>parse</em></span> (that is, analyze and identify the parts of) an HTML file on the hard drive. Open a new file editor window in IDLE, enter the following, and save it as <span class="emphasis"><em>example.html</em></span>. Alternatively, download it from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><a id="pro_id00419"/><pre class="programlisting">&lt;!-- This is the example.html example file. --&gt;

&lt;html&gt;&lt;head&gt;&lt;title&gt;The Website Title&lt;/title&gt;&lt;/head&gt;
&lt;body&gt;
&lt;p&gt;Download my &lt;strong&gt;Python&lt;/strong&gt; book from &lt;a href="http://
inventwithpython.com"&gt;my website&lt;/a&gt;.&lt;/p&gt;
&lt;p class="slogan"&gt;Learn Python the easy way!&lt;/p&gt;
&lt;p&gt;By &lt;span id="author"&gt;Al Sweigart&lt;/span&gt;&lt;/p&gt;
&lt;/body&gt;&lt;/html&gt;</pre><p>As you can see, even a simple HTML file involves many different tags and attributes, and matters quickly get confusing with complex websites. Thankfully, Beautiful Soup makes working with HTML much easier.</p><div class="sect2" title="Creating a BeautifulSoup Object from HTML"><div class="titlepage"><div><div><h2 class="title"><a id="creating_a_beautifulsoup_object_from_htm"/>Creating a BeautifulSoup Object from HTML</h2></div></div></div><p>The <code class="literal">bs4.BeautifulSoup()</code> function needs to be called with a string containing the HTML it will parse. The <code class="literal">bs4.BeautifulSoup()</code> function returns is a <code class="literal">BeautifulSoup</code> object. Enter the following into the interactive shell while your computer is connected to the Internet:</p><a id="pro_id00420"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import requests, bs4</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>res = requests.get('http://nostarch.com')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>res.raise_for_status()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>noStarchSoup = bs4.BeautifulSoup(res.text)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(noStarchSoup)</strong></span>
&lt;class 'bs4.BeautifulSoup'&gt;</pre><p>This code uses <code class="literal">requests.get()</code> to download the main page from the No Starch Press website and then passes the <code class="literal">text</code> attribute of the response to <code class="literal">bs4.BeautifulSoup()</code>. The <code class="literal">BeautifulSoup</code> object that it returns is stored in a variable named <code class="literal">noStarchSoup</code>.</p><p><a id="iddle1139" class="indexterm"/><a id="iddle1155" class="indexterm"/><a id="iddle1235" class="indexterm"/><a id="iddle2399" class="indexterm"/><a id="iddle2400" class="indexterm"/><a id="iddle2544" class="indexterm"/><a id="iddle2663" class="indexterm"/>You can also load an HTML file from your hard drive by passing a <code class="literal">File</code> object to <code class="literal">bs4.BeautifulSoup()</code>. Enter the following into the interactive shell (make sure the <span class="emphasis"><em>example.html</em></span> file is in the working directory):</p><a id="pro_id00421"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>exampleFile = open('example.html')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>exampleSoup = bs4.BeautifulSoup(exampleFile)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(exampleSoup)</strong></span>
&lt;class 'bs4.BeautifulSoup'&gt;</pre><p>Once you have a <code class="literal">BeautifulSoup</code> object, you can use its methods to locate specific parts of an HTML document.</p></div><div class="sect2" title="Finding an Element with the select() Method"><div class="titlepage"><div><div><h2 class="title"><a id="finding_an_element_with_the_selectleft_p"/>Finding an Element with the select() Method</h2></div></div></div><p>You can retrieve a web page element from a <code class="literal">BeautifulSoup</code> object by calling the <code class="literal">select()</code>method and passing a string of a CSS <span class="emphasis"><em>selector</em></span> for the element you are looking for. Selectors are like regular expressions: They specify a pattern to look for, in this case, in HTML pages instead of general text strings.</p><p>A full discussion of CSS selector syntax is beyond the scope of this book (there’s a good selector tutorial in the resources at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>), but here’s a short introduction to selectors. <a class="xref" href="ch11.html#examples_of_css_selectors" title="Table 11-2. Examples of CSS Selectors">Table 11-2</a> shows examples of the most common CSS selector patterns.</p><div class="table"><a id="examples_of_css_selectors"/><p class="title">Table 11-2. Examples of CSS Selectors</p><div class="table-contents"><table summary="Examples of CSS Selectors" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Selector passed to the <code class="literal">select()</code> method</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Will match...</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('div')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>All elements named <code class="literal">&lt;div&gt;</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('#author')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The element with an <code class="literal">id</code> attribute of <code class="literal">author</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('.notice')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>All elements that use a CSS <code class="literal">class</code> attribute named <code class="literal">notice</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('div span')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>All elements named <code class="literal">&lt;span&gt;</code> that are within an element named <code class="literal">&lt;div&gt;</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('div &gt; span')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>All elements named <code class="literal">&lt;span&gt;</code> that are <span class="emphasis"><em>directly</em></span> within an element named <code class="literal">&lt;div&gt;</code>, with no other element in between</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('input[name]')</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>All elements named <code class="literal">&lt;input&gt;</code> that have a <code class="literal">name</code> attribute with any value</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">soup.select('input[type="button"]')</code></p></td><td style="" valign="top"><p>All elements named <code class="literal">&lt;input&gt;</code> that have an attribute named <code class="literal">type</code> with value <code class="literal">button</code></p></td></tr></tbody></table></div></div><p>The various selector patterns can be combined to make sophisticated matches. For example, <code class="literal">soup.select('p #author')</code> will match any element that has an <code class="literal">id</code> attribute of <code class="literal">author</code>, as long as it is also inside a <code class="literal">&lt;p&gt;</code> element.</p><p>The <code class="literal">select()</code> method will return a list of <code class="literal">Tag</code> objects, which is how Beautiful Soup represents an HTML element. The list will contain one <code class="literal">Tag</code> object for every match in the <code class="literal">BeautifulSoup</code> object’s HTML. Tag values can be passed to the <code class="literal">str()</code> function to show the HTML tags they represent. Tag values also have an <code class="literal">attrs</code> attribute that shows all the HTML attributes of the tag as a dictionary. Using the <span class="emphasis"><em>example.html</em></span> file from earlier, enter the following into the interactive shell:</p><a id="pro_id00422"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import bs4</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>exampleFile = open('example.html')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>exampleSoup = bs4.BeautifulSoup(exampleFile.read())</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>elems = exampleSoup.select('#author')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(elems)</strong></span>
&lt;class 'list'&gt;
&gt;&gt;&gt; <span class="strong"><strong>len(elems)</strong></span>
1
&gt;&gt;&gt; <span class="strong"><strong>type(elems[0])</strong></span>
&lt;class 'bs4.element.Tag'&gt;
&gt;&gt;&gt; <span class="strong"><strong>elems[0].getText()</strong></span>
'Al Sweigart'
&gt;&gt;&gt; <span class="strong"><strong>str(elems[0])</strong></span>
'&lt;span id="author"&gt;Al Sweigart&lt;/span&gt;'
&gt;&gt;&gt; <span class="strong"><strong>elems[0].attrs</strong></span>
{'id': 'author'}</pre><p>This code will pull the element with <code class="literal">id="author"</code> out of our example HTML. We use <code class="literal">select('#author')</code> to return a list of all the elements with <code class="literal">id="author"</code>. We store this list of <span class="strong"><strong><code class="literal">Tag</code></strong></span> objects in the variable <code class="literal">elems</code>, and <code class="literal">len(elems)</code> tells us there is one <span class="strong"><strong><code class="literal">Tag</code></strong></span> object in the list; there was one match. Calling <code class="literal">getText()</code> on the element returns the element’s text, or inner HTML. The text of an element is the content between the opening and closing tags: in this case, <code class="literal">'Al Sweigart'</code>.</p><p>Passing the element to <code class="literal">str()</code> returns a string with the starting and closing tags and the element’s text. Finally, <code class="literal">attrs</code> gives us a dictionary with the element’s attribute, <code class="literal">'id'</code>, and the value of the <code class="literal">id</code> attribute, <code class="literal">'author'</code>.</p><p>You can also pull all the <code class="literal">&lt;p&gt;</code> elements from the <code class="literal">BeautifulSoup</code> object. Enter this into the interactive shell:</p><a id="pro_id00423"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>pElems = exampleSoup.select('p')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>str(pElems[0])</strong></span>
'&lt;p&gt;Download my &lt;strong&gt;Python&lt;/strong&gt; book from &lt;a href="http://
inventwithpython.com"&gt;my website&lt;/a&gt;.&lt;/p&gt;'
&gt;&gt;&gt; <span class="strong"><strong>pElems[0].getText()</strong></span>
'Download my Python book from my website.'
&gt;&gt;&gt; <span class="strong"><strong>str(pElems[1])</strong></span>
'&lt;p class="slogan"&gt;Learn Python the easy way!&lt;/p&gt;'
&gt;&gt;&gt; <span class="strong"><strong>pElems[1].getText()</strong></span>
'Learn Python the easy way!'
&gt;&gt;&gt; <span class="strong"><strong>str(pElems[2])</strong></span>
'&lt;p&gt;By &lt;span id="author"&gt;Al Sweigart&lt;/span&gt;&lt;/p&gt;'
&gt;&gt;&gt; <span class="strong"><strong>pElems[2].getText()</strong></span>
'By Al Sweigart'</pre><p>This time, <code class="literal">select()</code> gives us a list of three matches, which we store in <code class="literal">pElems</code>. Using <code class="literal">str()</code> on <code class="literal">pElems[0]</code>, <code class="literal">pElems[1]</code>, and <code class="literal">pElems[2]</code> shows you each element as a string, and using <code class="literal">getText()</code> on each element shows you its text.</p></div><div class="sect2" title="Getting Data from an Element’s Attributes"><div class="titlepage"><div><div><h2 class="title"><a id="getting_data_from_an_elementapostrophes"/>Getting Data from an Element’s Attributes</h2></div></div></div><p><a id="iddle1102" class="indexterm"/><a id="iddle1140" class="indexterm"/><a id="iddle2186" class="indexterm"/><a id="iddle2388" class="indexterm"/><a id="iddle2392" class="indexterm"/><a id="iddle2664" class="indexterm"/><a id="iddle2670" class="indexterm"/>The <code class="literal">get()</code> method for <code class="literal">Tag</code> objects makes it simple to access attribute values from an element. The method is passed a string of an attribute name and returns that attribute’s value. Using <span class="emphasis"><em>example.html</em></span>, enter the following into the interactive shell:</p><a id="pro_id00424"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import bs4</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>soup = bs4.BeautifulSoup(open('example.html'))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>spanElem = soup.select('span')[0]</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>str(spanElem)</strong></span>
'&lt;span id="author"&gt;Al Sweigart&lt;/span&gt;'
&gt;&gt;&gt; <span class="strong"><strong>spanElem.get('id')</strong></span>
'author'
&gt;&gt;&gt; <span class="strong"><strong>spanElem.get('some_nonexistent_addr') == None</strong></span>
True
&gt;&gt;&gt; <span class="strong"><strong>spanElem.attrs</strong></span>
{'id': 'author'}</pre><p>Here we use <code class="literal">select()</code> to find any <code class="literal">&lt;span&gt;</code> elements and then store the first matched element in <code class="literal">spanElem</code>. Passing the attribute name <code class="literal">'id'</code> to <code class="literal">get()</code> returns the attribute’s value, <code class="literal">'author'</code>.</p></div></div><div class="sect1" title="Project: “I’m Feeling Lucky” Google Search"><div class="titlepage"><div><div><h1 class="title"><a id="project_quotation_markiapostrophem_feeli"/>Project: “I’m Feeling Lucky” Google Search</h1></div></div></div><p>Whenever I search a topic on Google, I don’t look at just one search result at a time. By middle-clicking a search result link (or clicking while holding <span class="smaller">CTRL</span>), I open the first several links in a bunch of new tabs to read later. I search Google often enough that this workflow—opening my browser, searching for a topic, and middle-clicking several links one by one—is tedious. It would be nice if I could simply type a search term on the command line and have my computer automatically open a browser with all the top search results in new tabs. Let’s write a script to do this.</p><p>This is what your program does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Gets search keywords from the command line arguments.</p></li><li class="listitem"><p>Retrieves the search results page.</p></li><li class="listitem"><p>Opens a browser tab for each result.</p></li></ul></div><p>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Read the command line arguments from <code class="literal">sys.argv</code>.</p></li><li class="listitem"><p>Fetch the search result page with the <code class="literal">requests</code> module.</p></li><li class="listitem"><p>Find the links to each search result.</p></li><li class="listitem"><p>Call the <code class="literal">webbrowser.open()</code> function to open the web browser.</p></li></ul></div><p>Open a new file editor window and save it as <span class="emphasis"><em>lucky.py</em></span>.</p><div class="sect2" title="Step 1: Get the Command Line Arguments and Request the Search Page"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_get_the_command_line_arguments_an"/>Step 1: Get the Command Line Arguments and Request the Search Page</h2></div></div></div><p><a id="iddle2389" class="indexterm"/><a id="iddle2390" class="indexterm"/><a id="iddle2393" class="indexterm"/>Before coding anything, you first need to know the URL of the search result page. By looking at the browser’s address bar after doing a Google search, you can see that the result page has a URL like <span class="emphasis"><em><a class="ulink" href="https://www.google.com/search?q=SEARCH_TERM_HERE">https://www.google.com/search?q=SEARCH_TERM_HERE</a></em></span>. The <code class="literal">requests</code> module can download this page and then you can use Beautiful Soup to find the search result links in the HTML. Finally, you’ll use the <code class="literal">webbrowser</code> module to open those links in browser tabs.</p><p>Make your code look like the following:</p><a id="pro_id00425"/><pre class="programlisting">#! python3
# lucky.py - Opens several Google search results.

import requests, sys, webbrowser, bs4

print('Googling...') # display text while downloading the Google page
res = requests.get('http://google.com/search?q=' + ' '.join(sys.argv[1:]))
res.raise_for_status()

# TODO: Retrieve top search result links.

# TODO: Open a browser tab for each result.</pre><p>The user will specify the search terms using command line arguments when they launch the program. These arguments will be stored as strings in a list in <code class="literal">sys.argv</code>.</p></div><div class="sect2" title="Step 2: Find All the Results"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_find_all_the_results"/>Step 2: Find All the Results</h2></div></div></div><p>Now you need to use Beautiful Soup to extract the top search result links from your downloaded HTML. But how do you figure out the right selector for the job? For example, you can’t just search for all <code class="literal">&lt;a&gt;</code> tags, because there are lots of links you don’t care about in the HTML. Instead, you must inspect the search result page with the browser’s developer tools to try to find a selector that will pick out only the links you want.</p><p>After doing a Google search for <span class="emphasis"><em>Beautiful Soup</em></span>, you can open the browser’s developer tools and inspect some of the link elements on the page. They look incredibly complicated, something like this: <code class="literal">&lt;a href="/url?sa =t&amp;amp;rct=j&amp;amp;q=&amp;amp;esrc=s&amp;amp;source=web&amp;amp;cd=1&amp;amp;cad=rja&amp;amp;uact=8&amp; amp;ved=0CCgQFjAA&amp;amp;url=http%3A%2F%2Fwww.crummy.com%2Fsoftware%2FBeautifulSoup %2F&amp;amp;ei=LHBVU_XDD9KVyAShmYDwCw&amp;amp;usg=AFQjCNHAxwplurFOBqg5cehWQEVKi-TuLQ&amp;a mp;sig2=sdZu6WVlBlVSDrwhtworMA" onmousedown="return rwt(this,'','','','1','AFQ jCNHAxwplurFOBqg5cehWQEVKi-TuLQ','sdZu6WVlBlVSDrwhtworMA','0CCgQFjAA','','',ev ent)" data-href="http://www.crummy.com/software/BeautifulSoup/"&gt;&lt;em&gt;Beautiful Soup&lt;/em&gt;: We called him Tortoise because he taught us.&lt;/a&gt;</code>.</p><p>It doesn’t matter that the element looks incredibly complicated. You just need to find the pattern that all the search result links have. But this <code class="literal">&lt;a&gt;</code> element doesn’t have anything that easily distinguishes it from the nonsearch result <code class="literal">&lt;a&gt;</code> elements on the page.</p><p><a id="iddle2391" class="indexterm"/>Make your code look like the following:</p><a id="pro_id00426"/><pre class="programlisting">#! python3
# lucky.py - Opens several google search results.

import requests, sys, webbrowser, bs4

<span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># Retrieve top search result links.</strong></span>
<span class="strong"><strong>soup = bs4.BeautifulSoup(res.text)</strong></span>

<span class="strong"><strong># Open a browser tab for each result.</strong></span>
<span class="strong"><strong>linkElems = soup.select('.r a')</strong></span></pre><p>If you look up a little from the <code class="literal">&lt;a&gt;</code> element, though, there is an element like this: <code class="literal">&lt;h3 class="r"&gt;</code>. Looking through the rest of the HTML source, it looks like the <code class="literal">r</code> class is used only for search result links. You don’t have to know what the CSS class <code class="literal">r</code> is or what it does. You’re just going to use it as a marker for the <code class="literal">&lt;a&gt;</code> element you are looking for. You can create a <code class="literal">BeautifulSoup</code> object from the downloaded page’s HTML text and then use the selector <code class="literal">'.r a'</code> to find all <code class="literal">&lt;a&gt;</code> elements that are within an element that has the <code class="literal">r</code> CSS class.</p></div><div class="sect2" title="Step 3: Open Web Browsers for Each Result"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_open_web_browsers_for_each_result"/>Step 3: Open Web Browsers for Each Result</h2></div></div></div><p>Finally, we’ll tell the program to open web browser tabs for our results. Add the following to the end of your program:</p><a id="pro_id00427"/><pre class="programlisting">#! python3
# lucky.py - Opens several google search results.

import requests, sys, webbrowser, bs4

<span class="emphasis"><em>--snip--</em></span>

# Open a browser tab for each result.
linkElems = soup.select('.r a')
<span class="strong"><strong>numOpen = min(5, len(linkElems))</strong></span>
<span class="strong"><strong>for i in range(numOpen):</strong></span>
    <span class="strong"><strong>webbrowser.open('http://google.com' + linkElems[i].get('href'))</strong></span></pre><p>By default, you open the first five search results in new tabs using the <code class="literal">webbrowser</code> module. However, the user may have searched for something that turned up fewer than five results. The <code class="literal">soup.select()</code> call returns a list of all the elements that matched your <code class="literal">'.r a'</code> selector, so the number of tabs you want to open is either <code class="literal">5</code> or the length of this list (whichever is smaller).</p><p>The built-in Python function <code class="literal">min()</code> returns the smallest of the integer or float arguments it is passed. (There is also a built-in <code class="literal">max()</code> function that <a id="iddle1355" class="indexterm"/><a id="iddle2182" class="indexterm"/><a id="iddle2667" class="indexterm"/><a id="iddle2723" class="indexterm"/><a id="iddle2726" class="indexterm"/>returns the largest argument it is passed.) You can use <code class="literal">min()</code> to find out whether there are fewer than five links in the list and store the number of links to open in a variable named <code class="literal">numOpen</code>. Then you can run through a <code class="literal">for</code> loop by calling <code class="literal">range(numOpen)</code>.</p><p>On each iteration of the loop, you use <code class="literal">webbrowser.open()</code> to open a new tab in the web browser. Note that the <code class="literal">href</code> attribute’s value in the returned <code class="literal">&lt;a&gt;</code> elements do not have the initial <code class="literal">http://google.com</code> part, so you have to concatenate that to the <code class="literal">href</code> attribute’s string value.</p><p>Now you can instantly open the first five Google results for, say, <span class="emphasis"><em>Python programming tutorials</em></span> by running <code class="literal">lucky python programming tutorials</code> on the command line! (See Appendix B for how to easily run programs on your operating system.)</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00035"/>Ideas for Similar Programs</h2></div></div></div><p>The benefit of tabbed browsing is that you can easily open links in new tabs to peruse later. A program that automatically opens several links at once can be a nice shortcut to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open all the product pages after searching a shopping site such as Amazon</p></li><li class="listitem"><p>Open all the links to reviews for a single product</p></li><li class="listitem"><p>Open the result links to photos after performing a search on a photo site such as Flickr or Imgur</p></li></ul></div></div></div><div class="sect1" title="Project: Downloading All XKCD Comics"><div class="titlepage"><div><div><h1 class="title"><a id="project_downloading_all_xkcd_comics"/>Project: Downloading All XKCD Comics</h1></div></div></div><p>Blogs and other regularly updating websites usually have a front page with the most recent post as well as a Previous button on the page that takes you to the previous post. Then that post will also have a Previous button, and so on, creating a trail from the most recent page to the first post on the site. If you wanted a copy of the site’s content to read when you’re not online, you could manually navigate over every page and save each one. But this is pretty boring work, so let’s write a program to do it instead.</p><p>XKCD is a popular geek webcomic with a website that fits this structure (see <a class="xref" href="ch11.html#xkcdcomma_quotation_marka_webcomic_of_ro" title="Figure 11-6. XKCD, “a webcomic of romance, sarcasm, math, and language”">Figure 11-6</a>). The front page at <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/">http://xkcd.com/</a></em></span> has a Prev button that guides the user back through prior comics. Downloading each comic by hand would take forever, but you can write a script to do this in a couple of minutes.</p><p>Here’s what your program does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Loads the XKCD home page.</p></li><li class="listitem"><p>Saves the comic image on that page.</p></li><li class="listitem"><p>Follows the Previous Comic link.</p></li><li class="listitem"><p>Repeats until it reaches the first comic.</p></li></ul></div><div class="figure"><a id="xkcdcomma_quotation_marka_webcomic_of_ro"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00050"/><img src="figs/web/11fig06.png.jpg" alt="XKCD, “a webcomic of romance, sarcasm, math, and language”"/></div></div><p class="title">Figure 11-6. XKCD, “a webcomic of romance, sarcasm, math, and language”</p></div><p><a id="iddle2724" class="indexterm"/>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Download pages with the <code class="literal">requests</code> module.</p></li><li class="listitem"><p>Find the URL of the comic image for a page using Beautiful Soup.</p></li><li class="listitem"><p>Download and save the comic image to the hard drive with <code class="literal">iter_content()</code>.</p></li><li class="listitem"><p>Find the URL of the Previous Comic link, and repeat.</p></li></ul></div><p>Open a new file editor window and save it as <span class="emphasis"><em>downloadXkcd.py</em></span>.</p><div class="sect2" title="Step 1: Design the Program"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_design_the_program"/>Step 1: Design the Program</h2></div></div></div><p>If you open the browser’s developer tools and inspect the elements on the page, you’ll find the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The URL of the comic’s image file is given by the <code class="literal">href</code> attribute of an <code class="literal">&lt;img&gt;</code> element.</p></li><li class="listitem"><p>The <code class="literal">&lt;img&gt;</code> element is inside a <code class="literal">&lt;div id="comic"&gt;</code> element.</p></li><li class="listitem"><p>The Prev button has a <code class="literal">rel</code> HTML attribute with the value <code class="literal">prev</code>.</p></li><li class="listitem"><p>The first comic’s Prev button links to the <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/#">http://xkcd.com/#</a></em></span> URL, indicating that there are no more previous pages.</p></li></ul></div><p>Make your code look like the following:</p><a id="pro_id00428"/><pre class="programlisting">#! python3
# downloadXkcd.py - Downloads every single XKCD comic.

import requests, os, bs4

url = 'http://xkcd.com'              # starting url
os.makedirs('xkcd', exist_ok=True)   # store comics in ./xkcd
while not url.endswith('#'):
    # TODO: Download the page.

    # TODO: Find the URL of the comic image.

    # TODO: Download the image.

    # TODO: Save the image to ./xkcd.

    # TODO: Get the Prev button's url.

print('Done.')</pre><p><a id="iddle2725" class="indexterm"/>You’ll have a <code class="literal">url</code> variable that starts with the value <code class="literal">'http://xkcd.com'</code> and repeatedly update it (in a <code class="literal">for</code> loop) with the URL of the current page’s Prev link. At every step in the loop, you’ll download the comic at <code class="literal">url</code>. You’ll know to end the loop when <code class="literal">url</code> ends with <code class="literal">'#'</code>.</p><p>You will download the image files to a folder in the current working directory named <span class="emphasis"><em>xkcd</em></span>. The call <code class="literal">os.makedirs()</code> ensures that this folder exists, and the <code class="literal">exist_ok=True</code> keyword argument prevents the function from throwing an exception if this folder already exists. The rest of the code is just comments that outline the rest of your program.</p></div><div class="sect2" title="Step 2: Download the Web Page"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_download_the_web_page"/>Step 2: Download the Web Page</h2></div></div></div><p>Let’s implement the code for downloading the page. Make your code look like the following:</p><a id="pro_id00429"/><pre class="programlisting">#! python3
# downloadXkcd.py - Downloads every single XKCD comic.

import requests, os, bs4

url = 'http://xkcd.com'              # starting url
os.makedirs('xkcd', exist_ok=True)   # store comics in ./xkcd
while not url.endswith('#'):
    <span class="strong"><strong># Download the page.</strong></span>
    <span class="strong"><strong>print('Downloading page %s...' % url)</strong></span>
    <span class="strong"><strong>res = requests.get(url)</strong></span>
    <span class="strong"><strong>res.raise_for_status()</strong></span>

    <span class="strong"><strong>soup = bs4.BeautifulSoup(res.text)</strong></span>

    # TODO: Find the URL of the comic image.

    # TODO: Download the image.

    # TODO: Save the image to ./xkcd.

    # TODO: Get the Prev button's url.

print('Done.')</pre><p>First, print <code class="literal">url</code> so that the user knows which URL the program is about to download; then use the <code class="literal">requests</code> module’s <code class="literal">request.get()</code> function to download it. As always, you immediately call the <code class="literal">Response</code> object’s <code class="literal">raise_for_status()</code> method to throw an exception and end the program if something went wrong with the download. Otherwise, you create a <code class="literal">BeautifulSoup</code> object from the text of the downloaded page.</p></div><div class="sect2" title="Step 3: Find and Download the Comic Image"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_find_and_download_the_comic_image"/>Step 3: Find and Download the Comic Image</h2></div></div></div><p>Make your code look like the following:</p><a id="pro_id00430"/><pre class="programlisting">#! python3
# downloadXkcd.py - Downloads every single XKCD comic.

import requests, os, bs4

<span class="emphasis"><em>--snip--</em></span>

    <span class="strong"><strong># Find the URL of the comic image.</strong></span>
    <span class="strong"><strong>comicElem = soup.select('#comic img')</strong></span>
    <span class="strong"><strong>if comicElem == []:</strong></span>
         <span class="strong"><strong>print('Could not find comic image.')</strong></span>
    <span class="strong"><strong>else:</strong></span>
         <span class="strong"><strong>comicUrl = 'http:' + comicElem[0].get('src')</strong></span>
         <span class="strong"><strong># Download the image.</strong></span>
         <span class="strong"><strong>print('Downloading image %s...' % (comicUrl))</strong></span>
         <span class="strong"><strong>res = requests.get(comicUrl)</strong></span>
         <span class="strong"><strong>res.raise_for_status()</strong></span>

    # TODO: Save the image to ./xkcd.

    # TODO: Get the Prev button's url.

print('Done.')</pre><p>From inspecting the XKCD home page with your developer tools, you know that the <code class="literal">&lt;img&gt;</code> element for the comic image is inside a <code class="literal">&lt;div&gt;</code> element with the <code class="literal">id</code> attribute set to <code class="literal">comic</code>, so the selector <code class="literal">'#comic img'</code> will get you the correct <code class="literal">&lt;img&gt;</code> element from the <code class="literal">BeautifulSoup</code> object.</p><p>A few XKCD pages have special content that isn’t a simple image file. That’s fine; you’ll just skip those. If your selector doesn’t find any elements, then <code class="literal">soup.select('#comic img')</code> will return a blank list. When that happens, the program can just print an error message and move on without downloading the image.</p><p>Otherwise, the selector will return a list containing one <code class="literal">&lt;img&gt;</code> element. You can get the <code class="literal">src</code> attribute from this <code class="literal">&lt;img&gt;</code> element and pass it to <code class="literal">requests.get()</code> to download the comic’s image file.</p></div><div class="sect2" title="Step 4: Save the Image and Find the Previous Comic"><div class="titlepage"><div><div><h2 class="title"><a id="step_4_save_the_image_and_find_the_previ"/>Step 4: Save the Image and Find the Previous Comic</h2></div></div></div><p><a id="iddle2727" class="indexterm"/>Make your code look like the following:</p><a id="pro_id00431"/><pre class="programlisting">#! python3
# downloadXkcd.py - Downloads every single XKCD comic.

import requests, os, bs4

<span class="emphasis"><em>--snip--</em></span>

        <span class="strong"><strong># Save the image to ./xkcd.</strong></span>
        <span class="strong"><strong>imageFile = open(os.path.join('xkcd', os.path.basename(comicUrl)), 'wb')</strong></span>
        <span class="strong"><strong>for chunk in res.iter_content(100000):</strong></span>
            <span class="strong"><strong>imageFile.write(chunk)</strong></span>
        <span class="strong"><strong>imageFile.close()</strong></span>

    <span class="strong"><strong># Get the Prev button's url.</strong></span>
    <span class="strong"><strong>prevLink = soup.select('a[rel="prev"]')[0]</strong></span>
    <span class="strong"><strong>url = 'http://xkcd.com' + prevLink.get('href')</strong></span>

print('Done.')</pre><p>At this point, the image file of the comic is stored in the <code class="literal">res</code> variable. You need to write this image data to a file on the hard drive.</p><p>You’ll need a filename for the local image file to pass to <code class="literal">open()</code>. The <code class="literal">comicUrl</code> will have a value like <code class="literal">'http://imgs.xkcd.com/comics/heartbleed_explanation.png'</code>—which you might have noticed looks a lot like a file path. And in fact, you can call <code class="literal">os.path.basename()</code> with <code class="literal">comicUrl</code>, and it will return just the last part of the URL, <code class="literal">'heartbleed_explanation.png'</code>. You can use this as the filename when saving the image to your hard drive. You join this name with the name of your <code class="literal">xkcd</code> folder using <code class="literal">os.path.join()</code> so that your program uses backslashes (<code class="literal">\</code>) on Windows and forward slashes (<code class="literal">/</code>) on OS X and Linux. Now that you finally have the filename, you can call <code class="literal">open()</code> to open a new file in <code class="literal">'wb'</code> “write binary” mode.</p><p>Remember from earlier in this chapter that to save files you’ve downloaded using Requests, you need to loop over the return value of the <code class="literal">iter_content()</code> method. The code in the <code class="literal">for</code> loop writes out chunks of the image data (at most 100,000 bytes each) to the file and then you close the file. The image is now saved to your hard drive.</p><p>Afterward, the selector <code class="literal">'a[rel="prev"]'</code> identifies the <code class="literal">&lt;a&gt;</code> element with the <code class="literal">rel</code> attribute set to <code class="literal">prev</code>, and you can use this <code class="literal">&lt;a&gt;</code> element’s <code class="literal">href</code> attribute to get the previous comic’s URL, which gets stored in <code class="literal">url</code>. Then the <code class="literal">while</code> loop begins the entire download process again for this comic.</p><p>The output of this program will look like this:</p><a id="pro_id00432"/><pre class="programlisting">Downloading page http://xkcd.com...
Downloading image http://imgs.xkcd.com/comics/phone_alarm.png...
Downloading page http://xkcd.com/1358/...
Downloading image http://imgs.xkcd.com/comics/nro.png...
Downloading page http://xkcd.com/1357/...
Downloading image http://imgs.xkcd.com/comics/free_speech.png...
Downloading page http://xkcd.com/1356/...
Downloading image http://imgs.xkcd.com/comics/orbital_mechanics.png...
Downloading page http://xkcd.com/1355/...
Downloading image http://imgs.xkcd.com/comics/airplane_message.png...
Downloading page http://xkcd.com/1354/...
Downloading image http://imgs.xkcd.com/comics/heartbleed_explanation.png...
<span class="emphasis"><em>--snip--</em></span></pre><p><a id="iddle1735" class="indexterm"/><a id="iddle2405" class="indexterm"/><a id="iddle2408" class="indexterm"/><a id="iddle2681" class="indexterm"/><a id="iddle2684" class="indexterm"/>This project is a good example of a program that can automatically follow links in order to scrape large amounts of data from the Web. You can learn about Beautiful Soup’s other features from its documentation at <span class="emphasis"><em><a class="ulink" href="http://www.crummy.com/software/BeautifulSoup/bs4/doc/">http://www.crummy.com/software/BeautifulSoup/bs4/doc/</a>.</em></span></p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00036"/>Ideas for Similar Programs</h2></div></div></div><p>Downloading pages and following links are the basis of many web crawling programs. Similar programs could also do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Back up an entire site by following all of its links.</p></li><li class="listitem"><p>Copy all the messages off a web forum.</p></li><li class="listitem"><p>Duplicate the catalog of items for sale on an online store.</p></li></ul></div><p>The <code class="literal">requests</code> and <code class="literal">BeautifulSoup</code> modules are great as long as you can figure out the URL you need to pass to <code class="literal">requests.get()</code>. However, sometimes this isn’t so easy to find. Or perhaps the website you want your program to navigate requires you to log in first. The <code class="literal">selenium</code> module will give your programs the power to perform such sophisticated tasks.</p></div></div><div class="sect1" title="Controlling the Browser with the selenium Module"><div class="titlepage"><div><div><h1 class="title"><a id="controlling_the_browser_with_the_seleniu"/>Controlling the Browser with the selenium Module</h1></div></div></div><p>The <code class="literal">selenium</code> module lets Python directly control the browser by programmatically clicking links and filling in login information, almost as though there is a human user interacting with the page. Selenium allows you to interact with web pages in a much more advanced way than Requests and Beautiful Soup; but because it launches a web browser, it is a bit slower and hard to run in the background if, say, you just need to download some files from the Web.</p><p>Appendix A has more detailed steps on installing third-party modules.</p><div class="sect2" title="Starting a Selenium-Controlled Browser"><div class="titlepage"><div><div><h2 class="title"><a id="starting_a_selenium-controlled_browser"/>Starting a Selenium-Controlled Browser</h2></div></div></div><p>For these examples, you’ll need the Firefox web browser. This will be the browser that you control. If you don’t already have Firefox, you can download it for free from <span class="emphasis"><em><a class="ulink" href="http://getfirefox.com/">http://getfirefox.com/</a></em></span>.</p><p><a id="iddle1506" class="indexterm"/><a id="iddle1507" class="indexterm"/><a id="iddle2403" class="indexterm"/><a id="iddle2660" class="indexterm"/><a id="iddle2661" class="indexterm"/><a id="iddle2679" class="indexterm"/>Importing the modules for Selenium is slightly tricky. Instead of <code class="literal">import selenium</code>, you need to run <code class="literal">from selenium import webdriver</code>. (The exact reason why the <code class="literal">selenium</code> module is set up this way is beyond the scope of this book.) After that, you can launch the Firefox browser with Selenium. Enter the following into the interactive shell:</p><a id="pro_id00433"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from selenium import webdriver</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser = webdriver.Firefox()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(browser)</strong></span>
&lt;class 'selenium.webdriver.firefox.webdriver.WebDriver'&gt;
&gt;&gt;&gt; <span class="strong"><strong>browser.get('http://inventwithpython.com')</strong></span></pre><p>You’ll notice when <code class="literal">webdriver.Firefox()</code> is called, the Firefox web browser starts up. Calling <code class="literal">type()</code> on the value <code class="literal">webdriver.Firefox()</code> reveals it’s of the <code class="literal">WebDriver</code> data type. And calling <code class="literal">browser.get('http://inventwithpython.com')</code> directs the browser to <span class="emphasis"><em><a class="ulink" href="http://inventwithpython.com/">http://inventwithpython.com/</a></em></span>. Your browser should look something like <a class="xref" href="ch11.html#after_calling_webdriverdotfirefoxleft_pa" title="Figure 11-7. After calling webdriver.Firefox() and get() in IDLE, the Firefox browser appears.">Figure 11-7</a>.</p><div class="figure"><a id="after_calling_webdriverdotfirefoxleft_pa"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00051"/><img src="figs/web/11fig07.png.jpg" alt="After calling webdriver.Firefox() and get() in IDLE, the Firefox browser appears."/></div></div><p class="title">Figure 11-7. After calling <code class="literal">webdriver.Firefox()</code> and <code class="literal">get()</code> in IDLE, the Firefox browser appears.</p></div></div><div class="sect2" title="Finding Elements on the Page"><div class="titlepage"><div><div><h2 class="title"><a id="finding_elements_on_the_page"/>Finding Elements on the Page</h2></div></div></div><p><code class="literal">WebDriver</code> objects have quite a few methods for finding elements on a page. They are divided into the <code class="literal">find_element_*</code> and <code class="literal">find_elements_*</code> methods. The <code class="literal">find_element_*</code> methods return a single <code class="literal">WebElement</code> object, representing the first element on the page that matches your query. The <code class="literal">find_elements_*</code> methods return a list of <code class="literal">WebElement_*</code> objects for <span class="emphasis"><em>every</em></span> matching element on the page.</p><p><a class="xref" href="ch11.html#seleniumapostrophes_webdriver_methods_fo" title="Table 11-3. Selenium’s WebDriver Methods for Finding Elements">Table 11-3</a> shows several examples of <code class="literal">find_element_*</code> and <code class="literal">find_elements_*</code> methods being called on a <code class="literal">WebDriver</code> object that’s stored in the variable <code class="literal">browser</code>.</p><div class="table"><a id="seleniumapostrophes_webdriver_methods_fo"/><p class="title">Table 11-3. Selenium’s <code class="literal">WebDriver</code> Methods for Finding Elements</p><div class="table-contents"><table summary="Selenium’s WebDriver Methods for Finding Elements" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><a id="iddle1154" class="indexterm"/><a id="iddle1173" class="indexterm"/><a id="iddle1234" class="indexterm"/><a id="iddle1585" class="indexterm"/><a id="iddle1752" class="indexterm"/><a id="iddle1753" class="indexterm"/><a id="iddle1756" class="indexterm"/><a id="iddle1866" class="indexterm"/><a id="iddle2401" class="indexterm"/><a id="iddle2543" class="indexterm"/>Method name</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>WebElement object/list returned</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00434"/><pre class="programlisting">browser.find_element_by_class_name(<span class="emphasis"><em>name</em></span>)
browser.find_elements_by_class_name(<span class="emphasis"><em>name</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Elements that use the CSS class <span class="emphasis"><em><code class="literal">name</code></em></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00435"/><pre class="programlisting">browser.find_element_by_css_selector(<span class="emphasis"><em>selector</em></span>)
browser.find_elements_by_css_selector(<span class="emphasis"><em>selector</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Elements that match the CSS <span class="emphasis"><em><code class="literal">selector</code></em></span></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00436"/><pre class="programlisting">browser.find_element_by_id(<span class="emphasis"><em>id</em></span>)
browser.find_elements_by_id(<span class="emphasis"><em>id</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Elements with a matching <span class="emphasis"><em><code class="literal">id</code></em></span> attribute value</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00437"/><pre class="programlisting">browser.find_element_by_link_text(<span class="emphasis"><em>text</em></span>)
browser.find_elements_by_link_text(<span class="emphasis"><em>text</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">&lt;a&gt;</code> elements that completely match the <span class="emphasis"><em><code class="literal">text</code></em></span> provided</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00438"/><pre class="programlisting">browser.find_element_by_partial_link_text(<span class="emphasis"><em>text</em></span>)
browser.find_elements_by_partial_link_text(<span class="emphasis"><em>text</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">&lt;a&gt;</code> elements that contain the <span class="emphasis"><em><code class="literal">text</code></em></span> provided</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><a id="pro_id00439"/><pre class="programlisting">browser.find_element_by_name(<span class="emphasis"><em>name</em></span>)
browser.find_elements_by_name(<span class="emphasis"><em>name</em></span>)</pre></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Elements with a matching <span class="emphasis"><em><code class="literal">name</code></em></span> attribute value</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><a id="pro_id00440"/><pre class="programlisting">browser.find_element_by_tag_name(<span class="emphasis"><em>name</em></span>)
browser.find_elements_by_tag_name(<span class="emphasis"><em>name</em></span>)</pre></td><td style="" valign="top"><p>Elements with a matching tag <span class="emphasis"><em><code class="literal">name</code></em></span> (case insensitive; an <code class="literal">&lt;a&gt;</code> element is matched by <code class="literal">'a'</code> and <code class="literal">'A'</code>)</p></td></tr></tbody></table></div></div><p>Except for the <code class="literal">*_by_tag_name()</code> methods, the arguments to all the methods are case sensitive. If no elements exist on the page that match what the method is looking for, the <code class="literal">selenium</code> module raises a <code class="literal">NoSuchElement</code> exception. If you do not want this exception to crash your program, add <code class="literal">try</code> and <code class="literal">except</code> statements to your code.</p><p>Once you have the <code class="literal">WebElement</code> object, you can find out more about it by reading the attributes or calling the methods in <a class="xref" href="ch11.html#webelement_attributes_and_methods" title="Table 11-4. WebElement Attributes and Methods">Table 11-4</a>.</p><div class="table"><a id="webelement_attributes_and_methods"/><p class="title">Table 11-4. WebElement Attributes and Methods</p><div class="table-contents"><table summary="WebElement Attributes and Methods" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Attribute or method</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">tag_name</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The tag name, such as <code class="literal">'a'</code> for an <code class="literal">&lt;a&gt;</code> element</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">get_attribute(</code><span class="emphasis"><em><code class="literal">name</code></em></span><code class="literal">)</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The value for the element’s <code class="literal">name</code> attribute</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">text</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text within the element, such as <code class="literal">'hello'</code> in <code class="literal">&lt;span&gt;hello&lt;/span&gt;</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">clear()</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>For text field or text area elements, clears the text typed into it</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">is_displayed()</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Returns <code class="literal">True</code> if the element is visible; otherwise returns <code class="literal">False</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">is_enabled()</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>For input elements, returns <code class="literal">True</code> if the element is enabled; otherwise returns <code class="literal">False</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">is_selected()</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>For checkbox or radio button elements, returns <code class="literal">True</code> if the element is selected; otherwise returns <code class="literal">False</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">location</code></p></td><td style="" valign="top"><p>A dictionary with keys <code class="literal">'x'</code> and <code class="literal">'y'</code> for the position of the element in the page</p></td></tr></tbody></table></div></div><p>For example, open a new file editor and enter the following program:</p><a id="pro_id00441"/><pre class="programlisting">from selenium import webdriver
browser = webdriver.Firefox()
browser.get('http://inventwithpython.com')
try:
    elem = browser.find_element_by_class_name('bookcover')
    print('Found &lt;%s&gt; element with that class name!' % (elem.tag_name))
except:
    print('Was not able to find an element with that name.')</pre><p><a id="iddle1178" class="indexterm"/><a id="iddle2404" class="indexterm"/><a id="iddle2407" class="indexterm"/><a id="iddle2415" class="indexterm"/><a id="iddle2680" class="indexterm"/><a id="iddle2683" class="indexterm"/>Here we open Firefox and direct it to a URL. On this page, we try to find elements with the class name <code class="literal">'bookcover'</code>, and if such an element is found, we print its tag name using the <code class="literal">tag_name</code> attribute. If no such element was found, we print a different message.</p><p>This program will output the following:</p><a id="pro_id00442"/><pre class="programlisting">Found &lt;img&gt; element with that class name!</pre><p>We found an element with the class name <code class="literal">'bookcover'</code> and the tag name <code class="literal">'img'</code>.</p></div><div class="sect2" title="Clicking the Page"><div class="titlepage"><div><div><h2 class="title"><a id="clicking_the_page"/>Clicking the Page</h2></div></div></div><p><code class="literal">WebElement</code> objects returned from the <code class="literal">find_element_*</code> and <code class="literal">find_elements_*</code> methods have a <code class="literal">click()</code> method that simulates a mouse click on that element. This method can be used to follow a link, make a selection on a radio button, click a Submit button, or trigger whatever else might happen when the element is clicked by the mouse. For example, enter the following into the interactive shell:</p><a id="pro_id00443"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from selenium import webdriver</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser = webdriver.Firefox()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser.get('http://inventwithpython.com')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>linkElem = browser.find_element_by_link_text('Read It Online')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(linkElem)</strong></span>
&lt;class 'selenium.webdriver.remote.webelement.WebElement'&gt;
&gt;&gt;&gt; <span class="strong"><strong>linkElem.click() # follows the "Read It Online" link</strong></span></pre><p>This opens Firefox to <span class="emphasis"><em><a class="ulink" href="http://inventwithpython.com/">http://inventwithpython.com/</a></em></span>, gets the <code class="literal">WebElement</code> object for the <code class="literal">&lt;a&gt;</code> element with the text <span class="emphasis"><em>Read It Online</em></span>, and then simulates clicking that <code class="literal">&lt;a&gt;</code> element. It’s just like if you clicked the link yourself; the browser then follows that link.</p></div><div class="sect2" title="Filling Out and Submitting Forms"><div class="titlepage"><div><div><h2 class="title"><a id="filling_out_and_submitting_forms"/>Filling Out and Submitting Forms</h2></div></div></div><p>Sending keystrokes to text fields on a web page is a matter of finding the <code class="literal">&lt;input&gt;</code> or <code class="literal">&lt;textarea&gt;</code> element for that text field and then calling the <code class="literal">send_keys()</code> method. For example, enter the following into the interactive shell:</p><a id="pro_id00444"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from selenium import webdriver</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser = webdriver.Firefox()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser.get('https://mail.yahoo.com')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>emailElem = browser.find_element_by_id('login-username')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>emailElem.send_keys('not_my_real_email')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>passwordElem = browser.find_element_by_id('login-passwd')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>passwordElem.send_keys('12345')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>passwordElem.submit()</strong></span></pre><p><a id="iddle2406" class="indexterm"/><a id="iddle2535" class="indexterm"/><a id="iddle2682" class="indexterm"/>As long as Gmail hasn’t changed the <code class="literal">id</code> of the Username and Password text fields since this book was published, the previous code will fill in those text fields with the provided text. (You can always use the browser’s inspector to verify the <code class="literal">id</code>.) Calling the <code class="literal">submit()</code> method on any element will have the same result as clicking the Submit button for the form that element is in. (You could have just as easily called <code class="literal">emailElem.submit()</code>, and the code would have done the same thing.)</p></div><div class="sect2" title="Sending Special Keys"><div class="titlepage"><div><div><h2 class="title"><a id="sending_special_keys"/>Sending Special Keys</h2></div></div></div><p>Selenium has a module for keyboard keys that are impossible to type into a string value, which function much like escape characters. These values are stored in attributes in the <code class="literal">selenium.webdriver.common.keys</code> module. Since that is such a long module name, it’s much easier to run <code class="literal">from selenium.webdriver.common.keys import Keys</code> at the top of your program; if you do, then you can simply write <code class="literal">Keys</code> anywhere you’d normally have to write <code class="literal">selenium.webdriver.common.keys</code>. <a class="xref" href="ch11.html#commonly_used_variables_in_the_seleniumd" title="Table 11-5. Commonly Used Variables in the selenium.webdriver.common.keys Module">Table 11-5</a> lists the commonly used <code class="literal">Keys</code> variables.</p><div class="table"><a id="commonly_used_variables_in_the_seleniumd"/><p class="title">Table 11-5. Commonly Used Variables in the <code class="literal">selenium.webdriver.common.keys</code> Module</p><div class="table-contents"><table summary="Commonly Used Variables in the selenium.webdriver.common.keys Module" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Attributes</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Meanings</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.DOWN</code>, <code class="literal">Keys.UP</code>, <code class="literal">Keys.LEFT</code>, <code class="literal">Keys.RIGHT</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The keyboard arrow keys</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.ENTER</code>, <code class="literal">Keys.RETURN</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The <span class="smaller">ENTER</span> and <span class="smaller">RETURN</span> keys</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.HOME</code>, <code class="literal">Keys.END</code>, <code class="literal">Keys.PAGE_DOWN</code>, <code class="literal">Keys.PAGE_UP</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The <code class="literal">home</code>, <code class="literal">end</code>, <code class="literal">pagedown</code>, and <code class="literal">pageup</code> keys</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.ESCAPE</code>, <code class="literal">Keys.BACK_SPACE</code>, <code class="literal">Keys.DELETE</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The <span class="smaller">ESC</span>, <span class="smaller">BACKSPACE</span>, and <span class="smaller">DELETE</span> keys</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.F1</code>, <code class="literal">Keys.F2</code>,..., <code class="literal">Keys.F12</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The F1 to F12 keys at the top of the keyboard</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">Keys.TAB</code></p></td><td style="" valign="top"><p>The <span class="smaller">TAB</span> key</p></td></tr></tbody></table></div></div><p>For example, if the cursor is not currently in a text field, pressing the <span class="smaller">HOME</span> and <span class="smaller">END</span> keys will scroll the browser to the top and bottom of the page, respectively. Enter the following into the interactive shell, and notice how the <code class="literal">send_keys()</code> calls scroll the page:</p><a id="pro_id00445"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from selenium import webdriver</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>from selenium.webdriver.common.keys import Keys</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser = webdriver.Firefox()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>browser.get('http://nostarch.com')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>htmlElem = browser.find_element_by_tag_name('html')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>htmlElem.send_keys(Keys.END)     # scrolls to bottom</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>htmlElem.send_keys(Keys.HOME)    # scrolls to top</strong></span></pre><p><a id="iddle1107" class="indexterm"/><a id="iddle1566" class="indexterm"/><a id="iddle2272" class="indexterm"/><a id="iddle2298" class="indexterm"/><a id="iddle2402" class="indexterm"/><a id="iddle2678" class="indexterm"/>The <code class="literal">&lt;html</code>&gt; tag is the base tag in HTML files: The full content of the HTML file is enclosed within the <code class="literal">&lt;html&gt;</code> and <code class="literal">&lt;/html&gt;</code> tags. Calling <code class="literal">browser.find_element_by_tag_name('html')</code> is a good place to send keys to the general web page. This would be useful if, for example, new content is loaded once you’ve scrolled to the bottom of the page.</p></div><div class="sect2" title="Clicking Browser Buttons"><div class="titlepage"><div><div><h2 class="title"><a id="clicking_browser_buttons"/>Clicking Browser Buttons</h2></div></div></div><p>Selenium can simulate clicks on various browser buttons as well through the following methods:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="browser.back()"><span class="title"><strong><span class="strong"><strong><code class="literal">browser.back()</code></strong></span></strong></span>. Clicks the Back button.</p></li><li class="listitem"><p title="browser.forward()"><span class="title"><strong><span class="strong"><strong><code class="literal">browser.forward()</code></strong></span></strong></span>. Clicks the Forward button.</p></li><li class="listitem"><p title="browser.refresh()"><span class="title"><strong><span class="strong"><strong><code class="literal">browser.refresh()</code></strong></span></strong></span>. Clicks the Refresh/Reload button.</p></li><li class="listitem"><p title="browser.quit()"><span class="title"><strong><span class="strong"><strong><code class="literal">browser.quit()</code></strong></span></strong></span>. Clicks the Close Window button.</p></li></ul></div></div><div class="sect2" title="More Information on Selenium"><div class="titlepage"><div><div><h2 class="title"><a id="more_information_on_selenium"/>More Information on Selenium</h2></div></div></div><p>Selenium can do much more beyond the functions described here. It can modify your browser’s cookies, take screenshots of web pages, and run custom JavaScript. To learn more about these features, you can visit the Selenium documentation at <span class="emphasis"><em><a class="ulink" href="http://selenium-python.readthedocs.org/">http://selenium-python.readthedocs.org/</a></em></span>.</p></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00037"/>Summary</h1></div></div></div><p>Most boring tasks aren’t limited to the files on your computer. Being able to programmatically download web pages will extend your programs to the Internet. The <code class="literal">requests</code> module makes downloading straightforward, and with some basic knowledge of HTML concepts and selectors, you can utilize the <code class="literal">BeautifulSoup</code> module to parse the pages you download.</p><p>But to fully automate any web-based tasks, you need direct control of your web browser through the <code class="literal">selenium</code> module. The <code class="literal">selenium</code> module will allow you to log in to websites and fill out forms automatically. Since a web browser is the most common way to send and receive information over the Internet, this is a great ability to have in your programmer toolkit.</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00038"/>Practice Questions</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch11qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe1"/><a id="ch11qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. Briefly describe the differences between the <code class="literal">webbrowser</code>, <code class="literal">requests</code>, <code class="literal">BeautifulSoup</code>, and <code class="literal">selenium</code> modules.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe2"/><a id="ch11qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. What type of object is returned by <code class="literal">requests.get()</code>? How can you access the downloaded content as a string value?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe3"/><a id="ch11qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. What Requests method checks that the download worked?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe4"/><a id="ch11qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. How can you get the HTTP status code of a Requests response?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe5"/><a id="ch11qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. How do you save a Requests response to a file?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe6"/><a id="ch11qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. What is the keyboard shortcut for opening a browser’s developer tools?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe7"/><a id="ch11qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. How can you view (in the developer tools) the HTML of a specific element on a web page?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe8"/><a id="ch11qa1q8"/><p>Q:</p></td><td align="left" valign="top"><p>8. What is the CSS selector string that would find the element with an <code class="literal">id</code> attribute of <code class="literal">main</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe9"/><a id="ch11qa1q9"/><p>Q:</p></td><td align="left" valign="top"><p>9. What is the CSS selector string that would find the elements with a CSS class of <code class="literal">highlight</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe10"/><a id="ch11qa1q10"/><p>Q:</p></td><td align="left" valign="top"><p>10. What is the CSS selector string that would find all the <code class="literal">&lt;div&gt;</code> elements inside another <code class="literal">&lt;div&gt;</code> element?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe11"/><a id="ch11qa1q11"/><p>Q:</p></td><td align="left" valign="top"><p>11. What is the CSS selector string that would find the <code class="literal">&lt;button&gt;</code> element with a <code class="literal">value</code> attribute set to <code class="literal">favorite</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe12"/><a id="ch11qa1q12"/><p>Q:</p></td><td align="left" valign="top"><p>12. Say you have a Beautiful Soup <code class="literal">Tag</code> object stored in the variable <code class="literal">spam</code> for the element <code class="literal">&lt;div&gt;Hello world!&lt;/div&gt;</code>. How could you get a string <code class="literal">'Hello world!'</code> from the <code class="literal">Tag</code> object?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe13"/><a id="ch11qa1q13"/><p>Q:</p></td><td align="left" valign="top"><p>13. How would you store all the attributes of a Beautiful Soup <code class="literal">Tag</code> object in a variable named <code class="literal">linkElem</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe14"/><a id="ch11qa1q14"/><p>Q:</p></td><td align="left" valign="top"><p>14. Running <code class="literal">import selenium</code> doesn’t work. How do you properly import the <code class="literal">selenium</code> module?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe15"/><a id="ch11qa1q15"/><p>Q:</p></td><td align="left" valign="top"><p>15. What’s the difference between the <code class="literal">find_element_*</code> and <code class="literal">find_elements_*</code> methods?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe16"/><a id="ch11qa1q16"/><p>Q:</p></td><td align="left" valign="top"><p>16. What methods do Selenium’s <code class="literal">WebElement</code> objects have for simulating mouse clicks and keyboard keys?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe17"/><a id="ch11qa1q17"/><p>Q:</p></td><td align="left" valign="top"><p>17. You could call <code class="literal">send_keys(Keys.ENTER)</code> on the Submit button’s <code class="literal">WebElement</code> object, but what is an easier way to submit a form with Selenium?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch11qa1qe18"/><a id="ch11qa1q18"/><p>Q:</p></td><td align="left" valign="top"><p>18. How can you simulate clicking a browser’s Forward, Back, and Refresh buttons with Selenium?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Projects"><div class="titlepage"><div><div><h1 class="title"><a id="practice_projects-id00039"/>Practice Projects</h1></div></div></div><p>For practice, write programs to do the following tasks.</p><div class="sect2" title="Command Line Emailer"><div class="titlepage"><div><div><h2 class="title"><a id="command_line_emailer"/>Command Line Emailer</h2></div></div></div><p>Write a program that takes an email address and string of text on the command line and then, using Selenium, logs into your email account and sends an email of the string to the provided address. (You might want to set up a separate email account for this program.)</p><p>This would be a nice way to add a notification feature to your programs. You could also write a similar program to send messages from a Facebook or Twitter account.</p></div><div class="sect2" title="Image Site Downloader"><div class="titlepage"><div><div><h2 class="title"><a id="image_site_downloader"/>Image Site Downloader</h2></div></div></div><p>Write a program that goes to a photo-sharing site like Flickr or Imgur, searches for a category of photos, and then downloads all the resulting images. You could write a program that works with any photo site that has a search feature.</p></div><div class="sect2" title="2048"><div class="titlepage"><div><div><h2 class="title"><a id="two048"/>2048</h2></div></div></div><p>2048 is a simple game where you combine tiles by sliding them up, down, left, or right with the arrow keys. You can actually get a fairly high score by repeatedly sliding in an up, right, down, and left pattern over and over again. Write a program that will open the game at <span class="emphasis"><em><a class="ulink" href="https://gabrielecirulli.github.io/2048/">https://gabrielecirulli.github.io/2048/</a></em></span> and keep sending up, right, down, and left keystrokes to automatically play the game.</p></div><div class="sect2" title="Link Verification"><div class="titlepage"><div><div><h2 class="title"><a id="link_verification"/>Link Verification</h2></div></div></div><p>Write a program that, given the URL of a web page, will attempt to download every linked page on the page. The program should flag any pages that have a 404 “Not Found” status code and print them out as broken links.</p></div></div><div class="footnotes"><br/><hr/><div class="footnote"><p><sup>[<a id="ftn.ch11fn01" href="#ch11fn01" class="para">2</a>] </sup>The answer is no.</p></div></div></div></body></html>
