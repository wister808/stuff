<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 17. Manipulating Images</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 17. Manipulating Images"><div class="titlepage"><div><div><h1 class="title"><a id="manipulating_images"/>Chapter 17. Manipulating Images</h1></div></div></div><p>If you have a digital camera or even if you just upload photos from your phone to Facebook, you probably cross paths with digital image files all the time. You may know how to use basic graphics software, such as Microsoft Paint or Paintbrush, or even more advanced applications such as Adobe Photoshop. But if you need to edit a massive number of images, editing them by hand can be a lengthy, boring job.</p><p>Enter Python. Pillow is a third-party Python module for interacting with image files. The module has several functions that make it easy to crop, resize, and edit the content of an image. With the power to manipulate images the same way you would with software such as Microsoft Paint or Adobe Photoshop, Python can automatically edit hundreds or thousands of images with ease.</p><div class="sect1" title="Computer Image Fundamentals"><div class="titlepage"><div><div><h1 class="title"><a id="computer_image_fundamentals"/>Computer Image Fundamentals</h1></div></div></div><p><a id="iddle1084" class="indexterm"/><a id="iddle1187" class="indexterm"/><a id="iddle1586" class="indexterm"/><a id="iddle1679" class="indexterm"/><a id="iddle1696" class="indexterm"/><a id="iddle2119" class="indexterm"/><a id="iddle2130" class="indexterm"/><a id="iddle2347" class="indexterm"/><a id="iddle2584" class="indexterm"/>In order to manipulate an image, you need to understand the basics of how computers deal with colors and coordinates in images and how you can work with colors and coordinates in Pillow. But before you continue, install the <code class="literal">pillow</code> module. See Appendix A for help installing third-party modules.</p><div class="sect2" title="Colors and RGBA Values"><div class="titlepage"><div><div><h2 class="title"><a id="colors_and_rgba_values"/>Colors and RGBA Values</h2></div></div></div><p>Computer programs often represent a color in an image as an <span class="emphasis"><em>RGBA value</em></span>. An RGBA value is a group of numbers that specify the amount of red, green, blue, and <span class="emphasis"><em>alpha</em></span> (or transparency) in a color. Each of these component values is an integer from <code class="literal">0</code> (none at all) to <code class="literal">255</code> (the maximum). These RGBA values are assigned to individual <span class="emphasis"><em>pixels</em></span>; a pixel is the smallest dot of a single color the computer screen can show (as you can imagine, there are millions of pixels on a screen). A pixel’s RGB setting tells it precisely what shade of color it should display. Images also have an alpha value to create RGBA values. If an image is displayed on the screen over a background image or desktop wallpaper, the alpha value determines how much of the background you can “see through” the image’s pixel.</p><p>In Pillow, RGBA values are represented by a tuple of four integer values. For example, the color red is represented by <code class="literal">(255, 0, 0, 255)</code>. This color has the maximum amount of red, no green or blue, and the maximum alpha value, meaning it is fully opaque. Green is represented by <code class="literal">(0, 255, 0, 255)</code>, and blue is <code class="literal">(0, 0, 255, 255)</code>. White, the combination of all colors, is <code class="literal">(255, 255, 255, 255)</code>, while black, which has no color at all, is <code class="literal">(0, 0, 0, 255)</code>.</p><p>If a color has an alpha value of <code class="literal">0</code>, it is invisible, and it doesn’t really matter what the RGB values are. After all, invisible red looks the same as invisible black.</p><p>Pillow uses the standard color names that HTML uses. <a class="xref" href="ch17.html#standard_color_names_and_their_rgba_valu" title="Table 17-1. Standard Color Names and Their RGBA Values">Table 17-1</a> lists a selection of standard color names and their values.</p><div class="table"><a id="standard_color_names_and_their_rgba_valu"/><p class="title">Table 17-1. Standard Color Names and Their RGBA Values</p><div class="table-contents"><table summary="Standard Color Names and Their RGBA Values" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Name</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>RGBA Value</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Name</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>RGBA Value</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>White</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(255, 255, 255, 255)</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Red</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(255, 0, 0, 255)</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Green</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(0, 128, 0, 255)</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Blue</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(0, 0, 255, 255)</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Gray</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(128, 128, 128, 255)</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Yellow</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">(255, 255, 0, 255)</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>Black</p></td><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">(0, 0, 0, 255)</code></p></td><td style="border-right: 0.5pt solid ; " valign="top"><p>Purple</p></td><td style="" valign="top"><p><code class="literal">(128, 0, 128, 255)</code></p></td></tr></tbody></table></div></div><p>Pillow offers the <code class="literal">ImageColor.getcolor()</code> function so you don’t have to memorize RGBA values for the colors you want to use. This function takes a color name string as its first argument, and the string <code class="literal">'RGBA'</code> as its second argument, and it returns an RGBA tuple.</p><div class="sidebar"><a id="cmyk_and_rgb_coloring"/><p class="title">CMYK and RGB Coloring</p><p><a id="iddle1075" class="indexterm"/><a id="iddle1180" class="indexterm"/><a id="iddle1186" class="indexterm"/><a id="iddle1218" class="indexterm"/><a id="iddle1680" class="indexterm"/><a id="iddle2348" class="indexterm"/><a id="iddle2540" class="indexterm"/>In grade school you learned that mixing red, yellow, and blue paints can form other colors; for example, you can mix blue and yellow to make green paint. This is known as the <span class="emphasis"><em>subtractive color model</em></span>, and it applies to dyes, inks, and pigments. This is why color printers have <span class="emphasis"><em>CMYK</em></span> ink cartridges: the <span class="emphasis"><em>Cyan</em></span> (blue), <span class="emphasis"><em>Magenta</em></span> (red), <span class="emphasis"><em>Yellow</em></span>, and <span class="emphasis"><em>blacK</em></span> ink can be mixed together to form any color.</p><p>However, the physics of light uses what’s called an <span class="emphasis"><em>additive color model</em></span>. When combining light (such as the light given off by your computer screen), red, green, and blue light can be combined to form any other color. This is why <span class="emphasis"><em>RGB</em></span> values represent color in computer programs.</p></div><p>To see how this function works, enter the following into the interactive shell:</p><a id="pro_id00601"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>from PIL import ImageColor</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>ImageColor.getcolor('red', 'RGBA')</strong></span>
   (255, 0, 0, 255)
➌ &gt;&gt;&gt; <span class="strong"><strong>ImageColor.getcolor('RED', 'RGBA')</strong></span>
   (255, 0, 0, 255)
   &gt;&gt;&gt; <span class="strong"><strong>ImageColor.getcolor('Black', 'RGBA')</strong></span>
   (0, 0, 0, 255)
   &gt;&gt;&gt; <span class="strong"><strong>ImageColor.getcolor('chocolate', 'RGBA')</strong></span>
   (210, 105, 30, 255)
   &gt;&gt;&gt; <span class="strong"><strong>ImageColor.getcolor('CornflowerBlue', 'RGBA')</strong></span>
   (100, 149, 237, 255)</pre><p>First, you need to import the <code class="literal">ImageColor</code> module from PIL ➊ (not from Pillow; you’ll see why in a moment). The color name string you pass to <code class="literal">ImageColor.getcolor()</code> is case insensitive, so passing <code class="literal">'red'</code> ➋ and passing <code class="literal">'RED'</code> ➌ give you the same RGBA tuple. You can also pass more unusual color names, like <code class="literal">'chocolate'</code> and <code class="literal">'Cornflower Blue'</code>.</p><p>Pillow supports a huge number of color names, from <code class="literal">'aliceblue'</code> to <code class="literal">'whitesmoke'</code>. You can find the full list of more than 100 standard color names in the resources at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p></div><div class="sect2" title="Coordinates and Box Tuples"><div class="titlepage"><div><div><h2 class="title"><a id="coordinates_and_box_tuples"/>Coordinates and Box Tuples</h2></div></div></div><p>Image pixels are addressed with x- and y-coordinates, which respectively specify a pixel’s horizontal and vertical location in an image. The <span class="emphasis"><em>origin</em></span> is the pixel at the top-left corner of the image and is specified with the notation (0, 0). The first zero represents the x-coordinate, which starts at zero at the origin and increases going from left to right. The second zero represents the y-coordinate, which starts at zero at the origin and increases going <a id="iddle1133" class="indexterm"/><a id="iddle1678" class="indexterm"/><a id="iddle1692" class="indexterm"/><a id="iddle2120" class="indexterm"/>down the image. This bears repeating: y-coordinates increase going downward, which is the opposite of how you may remember y-coordinates being used in math class. <a class="xref" href="ch17.html#x-_and_y-coordinates_of_a_27times26_imag" title="Figure 17-1. The x- and y-coordinates of a 27×26 image of some sort of ancient data storage device">Figure 17-1</a> demonstrates how this coordinate system works.</p><p>Many of Pillow’s functions and methods take a <span class="emphasis"><em>box tuple</em></span> argument. This means Pillow is expecting a tuple of four integer coordinates that represent a rectangular region in an image. The four integers are, in order, as follows:</p><div class="figure"><a id="x-_and_y-coordinates_of_a_27times26_imag"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00081"/><img src="figs/web/17fig01.png.jpg" alt="The x- and y-coordinates of a 27×26 image of some sort of ancient data storage device"/></div></div><p class="title">Figure 17-1. The x- and y-coordinates of a 27×26 image of some sort of ancient data storage device</p></div><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p title="Left:"><span class="title"><strong><span class="emphasis"><em>Left:</em></span></strong></span> The x-coordinate of the leftmost edge of the box.</p></li><li class="listitem"><p title="Top:"><span class="title"><strong><span class="emphasis"><em>Top:</em></span></strong></span> The y-coordinate of the top edge of the box.</p></li><li class="listitem"><p title="Right:"><span class="title"><strong><span class="emphasis"><em>Right:</em></span></strong></span> The x-coordinate of one pixel to the right of the rightmost edge of the box. This integer must be greater than the left integer.</p></li><li class="listitem"><p title="Bottom:"><span class="title"><strong><span class="emphasis"><em>Bottom:</em></span></strong></span> The y-coordinate of one pixel lower than the bottom edge of the box. This integer must be greater than the top integer.</p></li></ul></div><div class="figure"><a id="area_represented_by_the_box_tuple_left_p"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00082"/><img src="figs/web/17fig02.png.jpg" alt="The area represented by the box tuple (3, 1, 9, 6)"/></div></div><p class="title">Figure 17-2. The area represented by the box tuple <code class="literal">(3, 1, 9, 6)</code></p></div><p>Note that the box includes the left and top coordinates and goes up to but does not include the right and bottom coordinates. For example, the box tuple <code class="literal">(3, 1, 9, 6)</code> represents all the pixels in the black box in <a class="xref" href="ch17.html#area_represented_by_the_box_tuple_left_p" title="Figure 17-2. The area represented by the box tuple (3, 1, 9, 6)">Figure 17-2</a>.</p></div></div><div class="sect1" title="Manipulating Images with Pillow"><div class="titlepage"><div><div><h1 class="title"><a id="manipulating_images_with_pillow"/>Manipulating Images with Pillow</h1></div></div></div><p>Now that you know how colors and coordinates work in Pillow, let’s use Pillow to manipulate an image. <a class="xref" href="ch17.html#my_cat_zophiedot_the_camera_adds_10_poun" title="Figure 17-3. My cat Zophie. The camera adds 10 pounds (which is a lot for a cat).">Figure 17-3</a> is the image that will be used for all the interactive shell examples in this chapter. You can download it from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><p>Once you have the image file <span class="emphasis"><em>Zophie.png</em></span> in your current working directory, you’ll be ready to load the image of Zophie into Python, like so:</p><a id="pro_id00602"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from PIL import Image</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catIm = Image.open('zophie.png')</strong></span></pre><div class="figure"><a id="my_cat_zophiedot_the_camera_adds_10_poun"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00083"/><img src="figs/web/17fig03.png.jpg" alt="My cat Zophie. The camera adds 10 pounds (which is a lot for a cat)."/></div></div><p class="title">Figure 17-3. My cat Zophie. The camera adds 10 pounds (which is a lot for a cat).</p></div><p><a id="iddle1675" class="indexterm"/><a id="iddle2021" class="indexterm"/><a id="iddle2374" class="indexterm"/>To load the image, you import the <code class="literal">Image</code> module from Pillow and call <code class="literal">Image.open()</code>, passing it the image’s filename. You can then store the loaded image in a variable like <code class="literal">CatIm</code>. The module name of Pillow is <code class="literal">PIL</code> to make it backward compatible with an older module called Python Imaging Library, which is why you must run <code class="literal">from PIL import Image</code> instead of <code class="literal">from Pillow import Image</code>. Because of the way Pillow’s creators set up the <code class="literal">pillow</code> module, you must use the <code class="literal">from PIL import Image</code> form of <code class="literal">import</code> statement, rather than simply <code class="literal">import PIL</code>.</p><p>If the image file isn’t in the current working directory, change the working directory to the folder that contains the image file by calling the <code class="literal">os.chdir()</code> function.</p><a id="pro_id00603"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import os</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>os.chdir('C:\\folder_with_image_file')</strong></span></pre><p>The <code class="literal">Image.open()</code> function returns a value of the <code class="literal">Image</code> object data type, which is how Pillow represents an image as a Python value. You can load an <code class="literal">Image</code> object from an image file (of any format) by passing the <code class="literal">Image.open()</code> function a string of the filename. Any changes you make to the <code class="literal">Image</code> object can be saved to an image file (also of any format) with the <code class="literal">save()</code> method. All the rotations, resizing, cropping, drawing, and other image manipulations will be done through method calls on this <code class="literal">Image</code> object.</p><p>To shorten the examples in this chapter, I’ll assume you’ve imported Pillow’s <code class="literal">Image</code> module and that you have the Zophie image stored in a variable named <code class="literal">catIm</code>. Be sure that the <span class="emphasis"><em>zophie.png</em></span> file is in the current working directory so that the <code class="literal">Image.open()</code> function can find it. Otherwise, you will also have to specify the full absolute path in the string argument to <code class="literal">Image.open()</code>.</p><div class="sect2" title="Working with the Image Data Type"><div class="titlepage"><div><div><h2 class="title"><a id="working_with_the_image_data_type"/>Working with the Image Data Type</h2></div></div></div><p><a id="iddle1554" class="indexterm"/><a id="iddle1555" class="indexterm"/><a id="iddle1604" class="indexterm"/><a id="iddle1677" class="indexterm"/><a id="iddle1768" class="indexterm"/><a id="iddle2118" class="indexterm"/><a id="iddle2135" class="indexterm"/>An <code class="literal">Image</code> object has several useful attributes that give you basic information about the image file it was loaded from: its width and height, the filename, and the graphics format (such as JPEG, GIF, or PNG).</p><p>For example, enter the following into the interactive shell:</p><a id="pro_id00604"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>from PIL import Image</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>catIm = Image.open('zophie.png')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>catIm.size</strong></span>
➊ (816, 1088)
➋ &gt;&gt;&gt; <span class="strong"><strong>width, height = catIm.size</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>width</strong></span>
   816
➍ &gt;&gt;&gt; <span class="strong"><strong>height</strong></span>
   1088
   &gt;&gt;&gt; <span class="strong"><strong>catIm.filename</strong></span>
   'zophie.png'
   &gt;&gt;&gt; <span class="strong"><strong>catIm.format</strong></span>
   'PNG'
   &gt;&gt;&gt; <span class="strong"><strong>catIm.format_description</strong></span>
   'Portable network graphics'
➎ &gt;&gt;&gt; <span class="strong"><strong>catIm.save('zophie.jpg')</strong></span></pre><p>After making an <code class="literal">Image</code> object from <span class="emphasis"><em>Zophie.png</em></span> and storing the <code class="literal">Image</code> object in <code class="literal">catIm</code>, we can see that the object’s <code class="literal">size</code> attribute contains a tuple of the image’s width and height in pixels ➊. We can assign the values in the tuple to <code class="literal">width</code> and <code class="literal">height</code> variables ➋ in order to access with width ➌ and height ➍ individually. The <code class="literal">filename</code> attribute describes the original file’s name. The <code class="literal">format</code> and <code class="literal">format_description</code> attributes are strings that describe the image format of the original file (with <code class="literal">format_description</code> being a bit more verbose).</p><p>Finally, calling the <code class="literal">save()</code> method and passing it <code class="literal">'zophie.jpg'</code> saves a new image with the filename <span class="emphasis"><em>zophie.jpg</em></span> to your hard drive ➎. Pillow sees that the file extension is <span class="emphasis"><em>.jpg</em></span> and automatically saves the image using the JPEG image format. Now you should have two images, <span class="emphasis"><em>zophie.png</em></span> and <span class="emphasis"><em>zophie.jpg</em></span>, on your hard drive. While these files are based on the same image, they are not identical because of their different formats.</p><p>Pillow also provides the <code class="literal">Image.new()</code> function, which returns an <code class="literal">Image</code> object—much like <code class="literal">Image.open()</code>, except the image represented by <code class="literal">Image.new()</code>’s object will be blank. The arguments to <code class="literal">Image.new()</code> are as follows:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The string <code class="literal">'RGBA'</code>, which sets the color mode to RGBA. (There are other modes that this book doesn’t go into.)</p></li><li class="listitem"><p>The size, as a two-integer tuple of the new image’s width and height.</p></li><li class="listitem"><p><a id="iddle1233" class="indexterm"/><a id="iddle1587" class="indexterm"/><a id="iddle1682" class="indexterm"/><a id="iddle2108" class="indexterm"/>The background color that the image should start with, as a four-integer tuple of an RGBA value. You can use the return value of the <code class="literal">ImageColor.getcolor()</code> function for this argument. Alternatively, <code class="literal">Image.new()</code> also supports just passing the string of the standard color name.</p></li></ul></div><p>For example, enter the following into the interactive shell:</p><a id="pro_id00605"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>from PIL import Image</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>im = Image.new('RGBA', (100, 200), 'purple')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>im.save('purpleImage.png')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>im2 = Image.new('RGBA', (20, 20))</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>im2.save('transparentImage.png')</strong></span></pre><p>Here we create an <code class="literal">Image</code> object for an image that’s 100 pixels wide and 200 pixels tall, with a purple background ➊. This image is then saved to the file <span class="emphasis"><em>purpleImage.png</em></span>. We call <code class="literal">Image.new()</code> again to create another <code class="literal">Image</code> object, this time passing (20, 20) for the dimensions and nothing for the background color ➋. Invisible black, <code class="literal">(0, 0, 0, 0)</code>, is the default color used if no color argument is specified, so the second image has a transparent background; we save this 20×20 transparent square in <span class="emphasis"><em>transparentImage.png</em></span>.</p></div><div class="sect2" title="Cropping Images"><div class="titlepage"><div><div><h2 class="title"><a id="cropping_images"/>Cropping Images</h2></div></div></div><p><span class="emphasis"><em>Cropping</em></span> an image means selecting a rectangular region inside an image and removing everything outside the rectangle. The <code class="literal">crop()</code> method on <code class="literal">Image</code> objects takes a box tuple and returns an <code class="literal">Image</code> object representing the cropped image. The cropping does not happen in place—that is, the original <code class="literal">Image</code> object is left untouched, and the <code class="literal">crop()</code> method returns a new <code class="literal">Image</code> object. Remeber that a boxed tuple—in this case, the cropped section—includes the left column and top row of pixels but only goes up to and does <span class="emphasis"><em>not</em></span> include the right column and bottom row of pixels.</p><p>Enter the following into the interactive shell:</p><a id="pro_id00606"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>croppedIm = catIm.crop((335, 345, 565, 560))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>croppedIm.save('cropped.png')</strong></span></pre><p>This makes a new <code class="literal">Image</code> object for the cropped image, stores the object in <code class="literal">croppedIm</code>, and then calls <code class="literal">save()</code> on <code class="literal">croppedIm</code> to save the cropped image in <span class="emphasis"><em>cropped.png</em></span>. The new file <span class="emphasis"><em>cropped.png</em></span> will be created from the original image, like in <a class="xref" href="ch17.html#new_image_will_be_just_the_cropped_secti" title="Figure 17-4. The new image will be just the cropped section of the original image.">Figure 17-4</a>.</p><div class="figure"><a id="new_image_will_be_just_the_cropped_secti"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00084"/><img src="figs/web/17fig04.png.jpg" alt="The new image will be just the cropped section of the original image."/></div></div><p class="title">Figure 17-4. The new image will be just the cropped section of the original image.</p></div></div><div class="sect2" title="Copying and Pasting Images onto Other Images"><div class="titlepage"><div><div><h2 class="title"><a id="copying_and_pasting_images_onto_other_im"/>Copying and Pasting Images onto Other Images</h2></div></div></div><p><a id="iddle1222" class="indexterm"/><a id="iddle1681" class="indexterm"/><a id="iddle2070" class="indexterm"/><a id="iddle2107" class="indexterm"/>The <code class="literal">copy()</code> method will return a new <code class="literal">Image</code> object with the same image as the <code class="literal">Image</code> object it was called on. This is useful if you need to make changes to an image but also want to keep an untouched version of the original. For example, enter the following into the interactive shell:</p><a id="pro_id00607"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>catIm = Image.open('zophie.png')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catCopyIm = catIm.copy()</strong></span></pre><p>The <code class="literal">catIm</code> and <code class="literal">catCopyIm</code> variables contain two separate <code class="literal">Image</code> objects, which both have the same image on them. Now that you have an <code class="literal">Image</code> object stored in <code class="literal">catCopyIm</code>, you can modify <code class="literal">catCopyIm</code> as you like and save it to a new filename, leaving <span class="emphasis"><em>zophie.png</em></span> untouched. For example, let’s try modifying <code class="literal">catCopyIm</code> with the <code class="literal">paste()</code> method.</p><p>The <code class="literal">paste()</code> method is called on an <code class="literal">Image</code> object and pastes another image on top of it. Let’s continue the shell example by pasting a smaller image onto <code class="literal">catCopyIm</code>.</p><a id="pro_id00608"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>faceIm = catIm.crop((335, 345, 565, 560))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>faceIm.size</strong></span>
(230, 215)
&gt;&gt;&gt; <span class="strong"><strong>catCopyIm.paste(faceIm, (0, 0))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catCopyIm.paste(faceIm, (400, 500))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catCopyIm.save('pasted.png')</strong></span></pre><p><a id="iddle2071" class="indexterm"/>First we pass <code class="literal">crop()</code> a box tuple for the rectangular area in <span class="emphasis"><em>zophie.png</em></span> that contains Zophie’s face. This creates an <code class="literal">Image</code> object representing a 230×215 crop, which we store in <code class="literal">faceIm</code>. Now we can paste <code class="literal">faceIm</code> onto <code class="literal">catCopyIm</code>. The <code class="literal">paste()</code> method takes two arguments: a “source” <code class="literal">Image</code> object and a tuple of the x- and y-coordinates where you want to paste the top-left corner of the source <code class="literal">Image</code> object onto the main <code class="literal">Image</code> object. Here we call <code class="literal">paste()</code> twice on <code class="literal">catCopyIm</code>, passing (0, 0) the first time and (400, 500) the second time. This pastes <code class="literal">faceIm</code> onto <code class="literal">catCopyIm</code> twice: once with the top-left corner of <code class="literal">faceIm</code> at (0, 0) on <code class="literal">catCopyIm</code>, and once with the top-left corner of <code class="literal">faceIm</code> at (400, 500). Finally, we save the modified <code class="literal">catCopyIm</code> to <span class="emphasis"><em>pasted.png</em></span>. The <span class="emphasis"><em>pasted.png</em></span> image looks like <a class="xref" href="ch17.html#zophie_the_catcomma_with_her_face_pasted" title="Figure 17-5. Zophie the cat, with her face pasted twice">Figure 17-5</a>.</p><div class="figure"><a id="zophie_the_catcomma_with_her_face_pasted"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00085"/><img src="figs/web/17fig05.png.jpg" alt="Zophie the cat, with her face pasted twice"/></div></div><p class="title">Figure 17-5. Zophie the cat, with her face pasted twice</p></div><div class="note" title="Note"><h3 class="title"><a id="ch17note01"/>Note</h3><p><span class="emphasis"><em>Despite their names, the <code class="literal">copy()</code> and <code class="literal">paste()</code> methods in Pillow do not use your computer’s clipboard.</em></span></p></div><p>Note that the <code class="literal">paste()</code> method modifies its <code class="literal">Image</code> object <span class="emphasis"><em>in place</em></span>; it does not return an <code class="literal">Image</code> object with the pasted image. If you want to call <code class="literal">paste()</code> but also keep an untouched version of the original image around, you’ll need to first copy the image and then call <code class="literal">paste()</code> on that copy.</p><p>Say you want to tile Zophie’s head across the entire image, as in <a class="xref" href="ch17.html#nested_for_loops_used_with_pasteleft_par" title="Figure 17-6. Nested for loops used with paste() to duplicate the cat’s face (a duplicat, if you will).">Figure 17-6</a>. You can achieve this effect with just a couple <code class="literal">for</code> loops. Continue the interactive shell example by entering the following:</p><a id="pro_id00609"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>catImWidth, catImHeight = catIm.size</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>faceImWidth, faceImHeight = faceIm.size</strong></span>
➊  &gt;&gt;&gt; <span class="strong"><strong>catCopyTwo = catIm.copy()</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>for left in range(0, catImWidth, faceImWidth):</strong></span>
➌         <span class="strong"><strong>for top in range(0, catImHeight, faceImHeight):</strong></span>
               <span class="strong"><strong>print(left, top)</strong></span>
               <span class="strong"><strong>catCopyTwo.paste(faceIm, (left, top))</strong></span>
   0 0
   0 215
   0 430
   0 645
   0 860
   0 1075
   230 0
   230 215
   <span class="emphasis"><em>--snip--</em></span>
   690 860
   690 1075
   &gt;&gt;&gt; <span class="strong"><strong>catCopyTwo.save('tiled.png')</strong></span></pre><p>Here we store the width of height of <code class="literal">catIm</code> in <code class="literal">catImWidth</code> and <code class="literal">catImHeight</code>. At ➊ we make a copy of <code class="literal">catIm</code> and store it in <code class="literal">catCopyTwo</code>. Now that we have a copy that we can paste onto, we start looping to paste <code class="literal">faceIm</code> onto <code class="literal">catCopyTwo</code>. The outer <code class="literal">for</code> loop’s <code class="literal">left</code> variable starts at 0 and increases by <code class="literal">faceImWidth(230)</code> ➋. The inner <code class="literal">for</code> loop’s <code class="literal">top</code> variable start at 0 and increases by <code class="literal">faceImHeight(215)</code> ➌. These nested <code class="literal">for</code> loops produce values for <code class="literal">left</code> and <code class="literal">top</code> to paste a grid of <code class="literal">faceIm</code> images over the <code class="literal">catCopyTwo Image</code> object, as in <a class="xref" href="ch17.html#nested_for_loops_used_with_pasteleft_par" title="Figure 17-6. Nested for loops used with paste() to duplicate the cat’s face (a duplicat, if you will).">Figure 17-6</a>. To see our nested loops working, we print <code class="literal">left</code> and <code class="literal">top</code>. After the pasting is complete, we save the modified <code class="literal">catCopyTwo</code> to <span class="emphasis"><em>tiled.png</em></span>.</p><div class="figure"><a id="nested_for_loops_used_with_pasteleft_par"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00086"/><img src="figs/web/17fig06.png.jpg" alt="Nested for loops used with paste() to duplicate the cat’s face (a duplicat, if you will)."/></div></div><p class="title">Figure 17-6. Nested <code class="literal">for</code> loops used with <code class="literal">paste()</code> to duplicate the cat’s face (a duplicat, if you will).</p></div><div class="sidebar"><a id="pasting_transparent_pixels"/><p class="title">Pasting Transparent Pixels</p><p><a id="iddle1695" class="indexterm"/><a id="iddle1698" class="indexterm"/><a id="iddle2122" class="indexterm"/><a id="iddle2124" class="indexterm"/><a id="iddle2585" class="indexterm"/>Normally transparent pixels are pasted as white pixels. If the image you want to paste has transparent pixels, pass the <code class="literal">Image</code> object as the third argument so that a solid rectangle isn’t pasted. This third argument is the “mask” <code class="literal">Image</code> object. A mask is an <code class="literal">Image</code> object where the alpha value is significant, but the red, green, and blue values are ignored. The mask tells the <code class="literal">paste()</code> function which pixels it should copy and which it should leave transparent. Advanced usage of masks is beyond this book, but if you want to paste an image that has transparent pixels, pass the <code class="literal">Image</code> object again as the third argument.</p></div></div><div class="sect2" title="Resizing an Image"><div class="titlepage"><div><div><h2 class="title"><a id="resizing_an_image"/>Resizing an Image</h2></div></div></div><p>The <code class="literal">resize()</code> method is called on an <code class="literal">Image</code> object and returns a new <code class="literal">Image</code> object of the specified width and height. It accepts a two-integer tuple argument, representing the new width and height of the returned image. Enter the following into the interactive shell:</p><a id="pro_id00610"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>width, height = catIm.size</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>quartersizedIm = catIm.resize((int(width / 2), int(height / 2)))</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>quartersizedIm.save('quartersized.png')</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>svelteIm = catIm.resize((width, height + 300))</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>svelteIm.save('svelte.png')</strong></span></pre><p>Here we assign the two values in the <code class="literal">catIm.size</code> tuple to the variables <code class="literal">width</code> and <code class="literal">height</code> ➊. Using <code class="literal">width</code> and <code class="literal">height</code> instead of <code class="literal">catIm.size[0]</code> and <code class="literal">catIm.size[1]</code> makes the rest of the code more readable.</p><p>The first <code class="literal">resize()</code> call passes <code class="literal">int(width / 2)</code> for the new width and <code class="literal">int(height / 2)</code> for the new height ➋, so the <code class="literal">Image</code> object returned from <code class="literal">resize()</code> will be half the length and width of the original image, or one-quarter of the original image size overall. The <code class="literal">resize()</code> method accepts only integers in its tuple argument, which is why you needed to wrap both divisions by <code class="literal">2</code> in an <code class="literal">int()</code> call.</p><p>This resizing keeps the same proportions for the width and height. But the new width and height passed to <code class="literal">resize()</code> do not have to be proportional to the original image. The <code class="literal">svelteIm</code> variable contains an <code class="literal">Image</code> object that has the original width but a height that is 300 pixels taller ➌, giving Zophie a more slender look.</p><p>Note that the <code class="literal">resize()</code> method does not edit the <code class="literal">Image</code> object in place but instead returns a new <code class="literal">Image</code> object.</p></div><div class="sect2" title="Rotating and Flipping Images"><div class="titlepage"><div><div><h2 class="title"><a id="rotating_and_flipping_images"/>Rotating and Flipping Images</h2></div></div></div><p><a id="iddle1166" class="indexterm"/><a id="iddle1458" class="indexterm"/><a id="iddle1510" class="indexterm"/><a id="iddle1691" class="indexterm"/><a id="iddle1697" class="indexterm"/><a id="iddle1909" class="indexterm"/><a id="iddle2117" class="indexterm"/><a id="iddle2123" class="indexterm"/><a id="iddle2357" class="indexterm"/>Images can be rotated with the <code class="literal">rotate()</code> method, which returns a new <code class="literal">Image</code> object of the rotated image and leaves the original <code class="literal">Image</code> object unchanged. The argument to <code class="literal">rotate()</code> is a single integer or float representing the number of degrees to rotate the image counterclockwise. Enter the following into the interactive shell:</p><a id="pro_id00611"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>catIm.rotate(90).save('rotated90.png')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catIm.rotate(180).save('rotated180.png')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catIm.rotate(270).save('rotated270.png')</strong></span></pre><p>Note how you can <span class="emphasis"><em>chain</em></span> method calls by calling <code class="literal">save()</code> directly on the <code class="literal">Image</code> object returned from <code class="literal">rotate()</code>. The first <code class="literal">rotate()</code> and <code class="literal">save()</code> call makes a new <code class="literal">Image</code> object representing the image rotated counterclockwise by 90 degrees and saves the rotated image to <span class="emphasis"><em>rotated90.png</em></span>. The second and third calls do the same, but with 180 degress and 270 degress. The results look like <a class="xref" href="ch17.html#original_image_left_parenthesisleftright" title="Figure 17-7. The original image (left) and the image rotated counterclockwise by 90, 180, and 270 degrees">Figure 17-7</a>.</p><div class="figure"><a id="original_image_left_parenthesisleftright"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00087"/><img src="figs/web/17fig07.png.jpg" alt="The original image (left) and the image rotated counterclockwise by 90, 180, and 270 degrees"/></div></div><p class="title">Figure 17-7. The original image (left) and the image rotated counterclockwise by 90, 180, and 270 degrees</p></div><p>Notice that the width and height of the image change when the image is rotated 90 or 270 degrees. If you rotate an image by some other amount, the original dimensions of the image are maintained. On Windows, a black background is used to fill in any gaps made by the rotation, like in <a class="xref" href="ch17.html#image_rotated_6_degrees_normally_left_pa" title="Figure 17-8. The image rotated 6 degrees normally (left) and with expand=True (right)">Figure 17-8</a>. On OS X, transparent pixels are used for the gaps instead.</p><p>The <code class="literal">rotate()</code> method has an optional <code class="literal">expand</code> keyword argument that can be set to <code class="literal">True</code> to enlarge the dimensions of the image to fit the entire rotated new image. For example, enter the following into the interactive shell:</p><a id="pro_id00612"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>catIm.rotate(6).save('rotated6.png')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catIm.rotate(6, expand=True).save('rotated6_expanded.png')</strong></span></pre><p>The first call rotates the image 6 degrees and saves it to <span class="emphasis"><em>rotate6.png</em></span> (see the image on the left of <a class="xref" href="ch17.html#image_rotated_6_degrees_normally_left_pa" title="Figure 17-8. The image rotated 6 degrees normally (left) and with expand=True (right)">Figure 17-8</a>). The second call rotates the image 6 degrees with <code class="literal">expand</code> set to <code class="literal">True</code> and saves it to <span class="emphasis"><em>rotate6_expanded.png</em></span> (see the image on the right of <a class="xref" href="ch17.html#image_rotated_6_degrees_normally_left_pa" title="Figure 17-8. The image rotated 6 degrees normally (left) and with expand=True (right)">Figure 17-8</a>).</p><div class="figure"><a id="image_rotated_6_degrees_normally_left_pa"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00088"/><img src="figs/web/17fig08.png.jpg" alt="The image rotated 6 degrees normally (left) and with expand=True (right)"/></div></div><p class="title">Figure 17-8. The image rotated 6 degrees normally (left) and with <code class="literal">expand=True</code> (right)</p></div><p><a id="iddle2586" class="indexterm"/>You can also get a “mirror flip” of an image with the <code class="literal">transpose()</code> method. You must pass either <code class="literal">Image.FLIP_LEFT_RIGHT</code> or <code class="literal">Image.FLIP_TOP_BOTTOM</code> to the <code class="literal">transpose()</code> method. Enter the following into the interactive shell:</p><a id="pro_id00613"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>catIm.transpose(Image.FLIP_LEFT_RIGHT).save('horizontal_flip.png')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>catIm.transpose(Image.FLIP_TOP_BOTTOM).save('vertical_flip.png')</strong></span></pre><p>Like <code class="literal">rotate()</code>, <code class="literal">transpose()</code> creates a new <code class="literal">Image</code> object. Here was pass <code class="literal">Image.FLIP_LEFT_RIGHT</code> to flip the image horizontally and then save the result to <span class="emphasis"><em>horizontal_flip.png</em></span>. To flip the image vertically, we pass <code class="literal">Image.FLIP_TOP_BOTTOM</code> and save to <span class="emphasis"><em>vertical_flip.png</em></span>. The results look like <a class="xref" href="ch17.html#original_image_left_parenthesisl-id00062" title="Figure 17-9. The original image (left), horizontal flip (center), and vertical flip (right)">Figure 17-9</a>.</p><div class="figure"><a id="original_image_left_parenthesisl-id00062"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00089"/><img src="figs/web/17fig09.png.jpg" alt="The original image (left), horizontal flip (center), and vertical flip (right)"/></div></div><p class="title">Figure 17-9. The original image (left), horizontal flip (center), and vertical flip (right)</p></div></div><div class="sect2" title="Changing Individual Pixels"><div class="titlepage"><div><div><h2 class="title"><a id="changing_individual_pixels"/>Changing Individual Pixels</h2></div></div></div><p><a id="iddle1596" class="indexterm"/><a id="iddle1693" class="indexterm"/><a id="iddle2121" class="indexterm"/><a id="iddle2131" class="indexterm"/><a id="iddle2201" class="indexterm"/>The color of an individual pixel can be retrieved or set with the <code class="literal">getpixel()</code> and <code class="literal">putpixel()</code> methods. These methods both take a tuple representing the x- and y-coordinates of the pixel. The <code class="literal">putpixel()</code> method also takes an additional tuple argument for the color of the pixel. This color argument is a four-integer RGBA tuple or a three-integer RGB tuple. Enter the following into the interactive shell:</p><a id="pro_id00614"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>im = Image.new('RGBA', (100, 100))</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>im.getpixel((0, 0))</strong></span>
   (0, 0, 0, 0)
➌ &gt;&gt;&gt; <span class="strong"><strong>for x in range(100):</strong></span>
           <span class="strong"><strong>for y in range(50):</strong></span>
➍             <span class="strong"><strong>im.putpixel((x, y), (210, 210, 210))</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>from PIL import ImageColor</strong></span>
➎ &gt;&gt;&gt; <span class="strong"><strong>for x in range(100):</strong></span>
           <span class="strong"><strong>for y in range(50, 100):</strong></span>
➏             <span class="strong"><strong>im.putpixel((x, y), ImageColor.getcolor('darkgray', 'RGBA'))</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>im.getpixel((0, 0))</strong></span>
   (210, 210, 210, 255)
   &gt;&gt;&gt; <span class="strong"><strong>im.getpixel((0, 50))</strong></span>
   (169, 169, 169, 255)
   &gt;&gt;&gt; <span class="strong"><strong>im.save('putPixel.png')</strong></span></pre><p>At ➊ we make a new image that is a 100×100 transparent square. Calling <code class="literal">getpixel()</code> on some coordinates in this image returns <code class="literal">(0, 0, 0, 0)</code> because the image is transparent ➋. To color pixels in this image, we can use nested <code class="literal">for</code> loops to go through all the pixels in the top half of the image ➌ and color each pixel using <code class="literal">putpixel()</code> ➍. Here we pass <code class="literal">putpixel()</code> the RGB tuple <code class="literal">(210, 210, 210)</code>, a light gray.</p><p>Say we want to color the bottom half of the image dark gray but don’t know the RGB tuple for dark gray. The <code class="literal">putpixel()</code> method doesn’t accept a standard color name like <code class="literal">'darkgray'</code>, so you have to use <code class="literal">ImageColor.getcolor()</code> to get a color tuple from <code class="literal">'darkgray'</code>. Loop through the pixels in the bottom half of the image ➎ and pass <code class="literal">putpixel()</code> the return value of <code class="literal">ImageColor.getcolor()</code> ➏, and you should now have an image that is light gray in its top half and dark gray in the bottom half, as shown in <a class="xref" href="ch17.html#putpixeldotpng_image" title="Figure 17-10. The putPixel.png image">Figure 17-10</a>. You can call <code class="literal">getpixel()</code> on some coordinates to confirm that the color at any given pixel is what you expect. Finally, save the image to <span class="emphasis"><em>putPixel.png</em></span>.</p><div class="figure"><a id="putpixeldotpng_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00090"/><img src="figs/web/17fig10.png.jpg" alt="The putPixel.png image"/></div></div><p class="title">Figure 17-10. The <span class="emphasis"><em>putPixel.png</em></span> image</p></div><p>Of course, drawing one pixel at a time onto an image isn’t very convenient. If you need to draw shapes, use the <code class="literal">ImageDraw</code> functions explained later in this chapter.</p></div></div><div class="sect1" title="Project: Adding a Logo"><div class="titlepage"><div><div><h1 class="title"><a id="project_adding_a_logo"/>Project: Adding a Logo</h1></div></div></div><p><a id="iddle1676" class="indexterm"/><a id="iddle1876" class="indexterm"/><a id="iddle1878" class="indexterm"/><a id="iddle2178" class="indexterm"/>Say you have the boring job of resizing thousands of images and adding a small logo watermark to the corner of each. Doing this with a basic graphics program such as Paintbrush or Paint would take forever. A fancier graphics application such as Photoshop can do batch processing, but that software costs hundreds of dollars. Let’s write a script to do it instead.</p><p>Say that <a class="xref" href="ch17.html#logo_to_be_added_to_the_image" title="Figure 17-11. The logo to be added to the image.">Figure 17-11</a> is the logo you want to add to the bottom-right corner of each image: a black cat icon with a white border, with the rest of the image transparent.</p><div class="figure"><a id="logo_to_be_added_to_the_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00091"/><img src="figs/web/17fig11.png.jpg" alt="The logo to be added to the image."/></div></div><p class="title">Figure 17-11. The logo to be added to the image.</p></div><p>At a high level, here’s what the program should do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Load the logo image.</p></li><li class="listitem"><p>Loop over all <span class="emphasis"><em>.png</em></span> and<span class="emphasis"><em>.jpg</em></span> files in the working directory.</p></li><li class="listitem"><p>Check whether the image is wider or taller than 300 pixels.</p></li><li class="listitem"><p>If so, reduce the width or height (whichever is larger) to 300 pixels and scale down the other dimension proportionally.</p></li><li class="listitem"><p>Paste the logo image into the corner.</p></li><li class="listitem"><p>Save the altered images to another folder.</p></li></ul></div><p>This means the code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open the <span class="emphasis"><em>catlogo.png</em></span> file as an <code class="literal">Image</code> object.</p></li><li class="listitem"><p>Loop over the strings returned from <code class="literal">os.listdir('.')</code>.</p></li><li class="listitem"><p>Get the width and height of the image from the <code class="literal">size</code> attribute.</p></li><li class="listitem"><p>Calculate the new width and height of the resized image.</p></li><li class="listitem"><p>Call the <code class="literal">resize()</code> method to resize the image.</p></li><li class="listitem"><p>Call the <code class="literal">paste()</code> method to paste the logo.</p></li><li class="listitem"><p>Call the <code class="literal">save()</code> method to save the changes, using the original filename.</p></li></ul></div><div class="sect2" title="Step 1: Open the Logo Image"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_open_the_logo_image"/>Step 1: Open the Logo Image</h2></div></div></div><p>For this project, open a new file editor window, enter the following code, and save it as <span class="emphasis"><em>resizeAndAddLogo.py</em></span>:</p><a id="pro_id00615"/><pre class="programlisting">   #! python3
   # resizeAndAddLogo.py - Resizes all images in current working directory to fit
   # in a 300x300 square, and adds catlogo.png to the lower-right corner.
   import os
   from PIL import Image

➊ SQUARE_FIT_SIZE = 300
➋ LOGO_FILENAME = 'catlogo.png'

➌ logoIm = Image.open(LOGO_FILENAME)
➍ logoWidth, logoHeight = logoIm.size

   # TODO: Loop over all files in the working directory.

   # TODO: Check if image needs to be resized.

   # TODO: Calculate the new width and height to resize to.

   # TODO: Resize the image.

   # TODO: Add the logo.

   # TODO: Save changes.</pre><p><a id="iddle1877" class="indexterm"/>By setting up the <code class="literal">SQUARE_FIT_SIZE</code> ➊ and <code class="literal">LOGO_FILENAME</code> ➋ constants at the start of the program, we’ve made it easy to change the program later. Say the logo that you’re adding isn’t the cat icon, or say you’re reducing the output images’ largest dimension to something other than 300 pixels. With these constants at the start of the program, you can just open the code, change those values once, and you’re done. (Or you can make it so that the values for these constants are taken from the command line arguments.) Without these constants, you’d instead have to search the code for all instances of <code class="literal">300</code> and <code class="literal">'catlogo.png'</code> and replace them with the values for your new project. In short, using constants makes your program more generalized.</p><p>The logo <code class="literal">Image</code> object is returned from <code class="literal">Image.open()</code> ➌. For readability, <code class="literal">logoWidth</code> and <code class="literal">logoHeight</code> are assigned to the values from <code class="literal">logoIm.size</code> ➍.</p><p>The rest of the program is a skeleton of <code class="literal">TODO</code> comments for now.</p></div><div class="sect2" title="Step 2: Loop Over All Files and Open Images"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_loop_over_all_files_and_open_imag"/>Step 2: Loop Over All Files and Open Images</h2></div></div></div><p>Now you need to find every <span class="emphasis"><em>.png</em></span> file and <span class="emphasis"><em>.jpg</em></span> file in the current working directory. Note that you don’t want to add the logo image to the logo image itself, so the program should skip any image with a filename that’s the same as <code class="literal">LOGO_FILENAME</code>. Add the following to your code:</p><a id="pro_id00616"/><pre class="programlisting">   #! python3
   # resizeAndAddLogo.py - Resizes all images in current working directory to fit
   # in a 300x300 square, and adds catlogo.png to the lower-right corner.

   import os
   from PIL import Image

   <span class="emphasis"><em>--snip--</em></span>

   os.makedirs('withLogo', exist_ok=True)
   <span class="strong"><strong># Loop over all files in the working directory.</strong></span>
➊ <span class="strong"><strong>for filename in os.listdir('.'):</strong></span>
➋     <span class="strong"><strong>if not (filename.endswith('.png') or filename.endswith('.jpg')) \</strong></span>
          <span class="strong"><strong>or filename == LOGO_FILENAME:</strong></span>
➌         <span class="strong"><strong>continue # skip non-image files and the logo file itself</strong></span>

➍     <span class="strong"><strong>im = Image.open(filename)</strong></span>
       <span class="strong"><strong>width, height = im.size</strong></span>
   <span class="emphasis"><em>--snip--</em></span></pre><p><a id="iddle1880" class="indexterm"/><a id="iddle1897" class="indexterm"/>First, the <code class="literal">os.makedirs()</code> call creates a <span class="emphasis"><em>withLogo</em></span> folder to store the finished images with logos, instead of overwriting the original image files. The <code class="literal">exist_ok=True</code> keyword argument will keep <code class="literal">os.makedirs()</code> from raising an exception if <span class="emphasis"><em>withLogo</em></span> already exists. While looping through all the files in the working directory with <code class="literal">os.listdir('.')</code> ➊, the long <code class="literal">if</code> statement ➋ checks whether each filename doesn’t end with <span class="emphasis"><em>.png</em></span> or <span class="emphasis"><em>.jpg</em></span>. If so—or if the file is the logo image itself—then the loop should skip it and use <code class="literal">continue</code> ➌ to go to the next file. If <code class="literal">filename</code> <span class="emphasis"><em>does</em></span> end with <code class="literal">'.png'</code> or <code class="literal">'.jpg'</code> (and isn’t the logo file), you can open it as an <code class="literal">Image</code> object ➍ and set <code class="literal">width</code> and <code class="literal">height</code>.</p></div><div class="sect2" title="Step 3: Resize the Images"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_resize_the_images"/>Step 3: Resize the Images</h2></div></div></div><p>The program should resize the image only if the width or height is larger than <code class="literal">SQUARE_FIT_SIZE</code> (300 pixels, in this case), so put all of the resizing code inside an <code class="literal">if</code> statement that checks the <code class="literal">width</code> and <code class="literal">height</code> variables. Add the following code to your program:</p><a id="pro_id00617"/><pre class="programlisting">   #! python3
   # resizeAndAddLogo.py - Resizes all images in current working directory to fit
   # in a 300x300 square, and adds catlogo.png to the lower-right corner.

   import os
   from PIL import Image

   <span class="emphasis"><em>--snip--</em></span>

      <span class="strong"><strong># Check if image needs to be resized.</strong></span>
      <span class="strong"><strong>if width &gt; SQUARE_FIT_SIZE and height &gt; SQUARE_FIT_SIZE:</strong></span>
          <span class="strong"><strong># Calculate the new width and height to resize to.</strong></span>
          <span class="strong"><strong>if width &gt; height:</strong></span>
➊            <span class="strong"><strong>height = int((SQUARE_FIT_SIZE / width) * height)</strong></span>
              <span class="strong"><strong>width = SQUARE_FIT_SIZE</strong></span>
          <span class="strong"><strong>else:</strong></span>
➋            <span class="strong"><strong>width = int((SQUARE_FIT_SIZE / height) * width)</strong></span>
              <span class="strong"><strong>height = SQUARE_FIT_SIZE</strong></span>

          <span class="strong"><strong># Resize the image.</strong></span>
          <span class="strong"><strong>print('Resizing %s...' % (filename))</strong></span>
     ➌     <span class="strong"><strong>im = im.resize((width, height))</strong></span>

<span class="emphasis"><em>--snip--</em></span></pre><p><a id="iddle1879" class="indexterm"/>If the image does need to be resized, you need to find out whether it is a wide or tall image. If <code class="literal">width</code> is greater than <code class="literal">height</code>, then the height should be reduced by the same proportion that the width would be reduced ➊. This proportion is the <code class="literal">SQUARE_FIT_SIZE</code> value divided by the current width. The new <code class="literal">height</code> value is this proportion multiplied by the current <code class="literal">height</code> value. Since the division operator returns a float value and <code class="literal">resize()</code> requires the dimensions to be integers, remember to convert the result to an integer with the <code class="literal">int()</code> function. Finally, the new <code class="literal">width</code> value will simply be set to <code class="literal">SQUARE_FIT_SIZE</code>.</p><p>If the <code class="literal">height</code> is greater than or equal to the <code class="literal">width</code> (both cases are handled in the <code class="literal">else</code> clause), then the same calculation is done, except with the <code class="literal">height</code> and <code class="literal">width</code> variables swapped ➋.</p><p>Once <code class="literal">width</code> and <code class="literal">height</code> contain the new image dimensions, pass them to the <code class="literal">resize()</code> method and store the returned <code class="literal">Image</code> object in <code class="literal">im</code> ➌.</p></div><div class="sect2" title="Step 4: Add the Logo and Save the Changes"><div class="titlepage"><div><div><h2 class="title"><a id="step_4_add_the_logo_and_save_the_changes"/>Step 4: Add the Logo and Save the Changes</h2></div></div></div><p>Whether or not the image was resized, the logo should still be pasted to the bottom-right corner. Where exactly the logo should be pasted depends on both the size of the image and the size of the logo. <a class="xref" href="ch17.html#left_and_top_coordinates_for_placing_the" title="Figure 17-12. The left and top coordinates for placing the logo in the bottom-right corner should be the image width/height minus the logo width/height.">Figure 17-12</a> shows how to calculate the pasting position. The left coordinate for where to paste the logo will be the image width minus the logo width; the top coordinate for where to paste the logo will be the image height minus the logo height.</p><div class="figure"><a id="left_and_top_coordinates_for_placing_the"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00092"/><img src="figs/web/17fig12.png.jpg" alt="The left and top coordinates for placing the logo in the bottom-right corner should be the image width/height minus the logo width/height."/></div></div><p class="title">Figure 17-12. The left and top coordinates for placing the logo in the bottom-right corner should be the image width/height minus the logo width/height.</p></div><p>After your code pastes the logo into the image, it should save the modified <code class="literal">Image</code> object. Add the following to your program:</p><a id="pro_id00618"/><pre class="programlisting">   #! python3
   # resizeAndAddLogo.py - Resizes all images in current working directory to fit
   # in a 300x300 square, and adds catlogo.png to the lower-right corner.

   import os
   from PIL import Image

<span class="emphasis"><em>--snip--</em></span>

    # Check if image needs to be resized.
    <span class="emphasis"><em>--snip--</em></span>

    <span class="strong"><strong># Add the logo.</strong></span>
➊  <span class="strong"><strong>print('Adding logo to %s...' % (filename))</strong></span>
➋  <span class="strong"><strong>im.paste(logoIm, (width - logoWidth, height - logoHeight), logoIm)</strong></span>

    <span class="strong"><strong># Save changes.</strong></span>
➌  <span class="strong"><strong>im.save(os.path.join('withLogo', filename))</strong></span></pre><p>The new code prints a message telling the user that the logo is being added ➊, pastes <code class="literal">logoIm</code> onto <code class="literal">im</code> at the calculated coordinates ➋, and saves the changes to a filename in the <span class="emphasis"><em>withLogo</em></span> directory ➌. When you run this program with the <span class="emphasis"><em>zophie.png</em></span> file as the only image in the working directory, the output will look like this:</p><a id="pro_id00619"/><pre class="programlisting">Resizing zophie.png...
Adding logo to zophie.png...</pre><p>The image <span class="emphasis"><em>zophie.png</em></span> will be changed to a 225×300-pixel image that looks like <a class="xref" href="ch17.html#image_zophie_dotpng_resized_and_the_logo" title="Figure 17-13. The image zophie.png resized and the logo added (left). If you forget the third argument, the transparent pixels in the logo will be copied as solid white pixels (right).">Figure 17-13</a>. Remember that the <code class="literal">paste()</code> method will not paste the transparency pixels if you do not pass the <code class="literal">logoIm</code> for the third argument as well. This program can automatically resize and “logo-ify” hundreds of images in just a couple minutes.</p><div class="figure"><a id="image_zophie_dotpng_resized_and_the_logo"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00093"/><img src="figs/web/17fig13.png.jpg" alt="The image zophie.png resized and the logo added (left). If you forget the third argument, the transparent pixels in the logo will be copied as solid white pixels (right)."/></div></div><p class="title">Figure 17-13. The image <span class="emphasis"><em>zophie.png</em></span> resized and the logo added (left). If you forget the third argument, the transparent pixels in the logo will be copied as solid white pixels (right).</p></div></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00063"/>Ideas for Similar Programs</h2></div></div></div><p><a id="iddle1366" class="indexterm"/><a id="iddle1367" class="indexterm"/><a id="iddle1368" class="indexterm"/><a id="iddle1672" class="indexterm"/><a id="iddle1673" class="indexterm"/><a id="iddle1685" class="indexterm"/><a id="iddle1686" class="indexterm"/><a id="iddle1687" class="indexterm"/><a id="iddle1814" class="indexterm"/><a id="iddle2111" class="indexterm"/><a id="iddle2112" class="indexterm"/><a id="iddle2113" class="indexterm"/><a id="iddle2136" class="indexterm"/>Being able to composite images or modify image sizes in a batch can be useful in many applications. You could write similar programs to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Add text or a website URL to images.</p></li><li class="listitem"><p>Add timestamps to images.</p></li><li class="listitem"><p>Copy or move images into different folders based on their sizes.</p></li><li class="listitem"><p>Add a mostly transparent watermark to an image to prevent others from copying it.</p></li></ul></div></div></div><div class="sect1" title="Drawing on Images"><div class="titlepage"><div><div><h1 class="title"><a id="drawing_on_images"/>Drawing on Images</h1></div></div></div><p>If you need to draw lines, rectangles, circles, or other simple shapes on an image, use Pillow’s <code class="literal">ImageDraw</code> module. Enter the following into the interactive shell:</p><a id="pro_id00620"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from PIL import Image, ImageDraw</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>im = Image.new('RGBA', (200, 200), 'white')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>draw = ImageDraw.Draw(im)</strong></span></pre><p>First, we import <code class="literal">Image</code> and <code class="literal">ImageDraw</code>. Then we create a new image, in this case, a 200×200 white image, and store the <code class="literal">Image</code> object in <code class="literal">im</code>. We pass the <code class="literal">Image</code> object to the <code class="literal">ImageDraw.Draw()</code> function to receive an <code class="literal">ImageDraw</code> object. This object has several methods for drawing shapes and text onto an <code class="literal">Image</code> object. Store the <code class="literal">ImageDraw</code> object in a variable like <code class="literal">draw</code> so you can use it easily in the following example.</p><div class="sect2" title="Drawing Shapes"><div class="titlepage"><div><div><h2 class="title"><a id="drawing_shapes"/>Drawing Shapes</h2></div></div></div><p>The following ImageDraw methods draw various kinds of shapes on the image. The <code class="literal">fill</code> and <code class="literal">outline</code> parameters for these methods are optional and will default to white if left unspecified.</p><div class="sect3" title="Points"><div class="titlepage"><div><div><h3 class="title"><a id="points"/>Points</h3></div></div></div><p>The <code class="literal">point(</code><span class="emphasis"><em><code class="literal">xy, fill</code></em></span><code class="literal">)</code> method draws individual pixels. The <span class="emphasis"><em><code class="literal">xy</code></em></span> argument represents a list of the points you want to draw. The list can be a list of x- and y-coordinate tuples, such as <code class="literal">[(x, y), (x, y), ...]</code>, or a list of x- and y-coordinates without tuples, such as <code class="literal">[x1, y1, x2, y2, ...]</code>. The <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color of the points and is either an RGBA tuple or a string of a color name, such as <code class="literal">'red'</code>. The <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is optional.</p></div><div class="sect3" title="Lines"><div class="titlepage"><div><div><h3 class="title"><a id="lines"/>Lines</h3></div></div></div><p>The <code class="literal">line(</code><span class="emphasis"><em><code class="literal">xy, fill, width</code></em></span><code class="literal">)</code> method draws a line or series of lines. <span class="emphasis"><em><code class="literal">xy</code></em></span> is either a list of tuples, such as <code class="literal">[(x, y), (x, y), ...]</code>, or a list of integers, such as <code class="literal">[x1, y1, x2, y2, ...]</code>. Each point is one of the connecting points on the <a id="iddle1364" class="indexterm"/><a id="iddle1365" class="indexterm"/><a id="iddle1369" class="indexterm"/><a id="iddle1370" class="indexterm"/><a id="iddle1378" class="indexterm"/><a id="iddle1683" class="indexterm"/><a id="iddle1684" class="indexterm"/><a id="iddle1688" class="indexterm"/><a id="iddle1689" class="indexterm"/><a id="iddle2109" class="indexterm"/><a id="iddle2110" class="indexterm"/><a id="iddle2114" class="indexterm"/><a id="iddle2115" class="indexterm"/><a id="iddle2138" class="indexterm"/><a id="iddle2293" class="indexterm"/>lines you’re drawing. The optional <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color of the lines, as an RGBA tuple or color name. The optional <span class="emphasis"><em><code class="literal">width</code></em></span> argument is the width of the lines and defaults to 1 if left unspecified.</p></div><div class="sect3" title="Rectangles"><div class="titlepage"><div><div><h3 class="title"><a id="rectangles"/>Rectangles</h3></div></div></div><p>The <code class="literal">rectangle(</code><span class="emphasis"><em><code class="literal">xy, fill, outline</code></em></span><code class="literal">)</code> method draws a rectangle. The <span class="emphasis"><em><code class="literal">xy</code></em></span> argument is a box tuple of the form <code class="literal">(</code><span class="emphasis"><em><code class="literal">left, top, right, bottom</code></em></span><code class="literal">)</code>. The <span class="emphasis"><em><code class="literal">left</code></em></span> and <span class="emphasis"><em><code class="literal">top</code></em></span> values specify the x- and y-coordinates of the upper-left corner of the rectangle, while <span class="emphasis"><em><code class="literal">right</code></em></span> and <span class="emphasis"><em><code class="literal">bottom</code></em></span> specify the lower-right corner. The optional <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color that will fill the inside of the rectangle. The optional <span class="emphasis"><em><code class="literal">outline</code></em></span> argument is the color of the rectangle’s outline.</p></div><div class="sect3" title="Ellipses"><div class="titlepage"><div><div><h3 class="title"><a id="ellipses"/>Ellipses</h3></div></div></div><p>The <code class="literal">ellipse(</code><span class="emphasis"><em><code class="literal">xy, fill, outline</code></em></span><code class="literal">)</code> method draws an ellipse. If the width and height of the ellipse are identical, this method will draw a circle. The <span class="emphasis"><em><code class="literal">xy</code></em></span> argument is a box tuple (<span class="emphasis"><em><code class="literal">left</code></em></span>, <span class="emphasis"><em><code class="literal">top</code></em></span>, <span class="emphasis"><em><code class="literal">right</code></em></span>, <span class="emphasis"><em><code class="literal">bottom</code></em></span>) that represents a box that precisely contains the ellipse. The optional <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color of the inside of the ellipse, and the optional <span class="emphasis"><em><code class="literal">outline</code></em></span> argument is the color of the ellipse’s outline.</p></div><div class="sect3" title="Polygons"><div class="titlepage"><div><div><h3 class="title"><a id="polygons"/>Polygons</h3></div></div></div><p>The <code class="literal">polygon(</code><span class="emphasis"><em><code class="literal">xy, fill, outline</code></em></span><code class="literal">)</code> method draws an arbitrary polygon. The <span class="emphasis"><em><code class="literal">xy</code></em></span> argument is a list of tuples, such as <code class="literal">[(x, y), (x, y), ...]</code>, or integers, such as <code class="literal">[x1, y1, x2, y2, ...]</code>, representing the connecting points of the polygon’s sides. The last pair of coordinates will be automatically connected to the first pair. The optional <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color of the inside of the polygon, and the optional <span class="emphasis"><em><code class="literal">outline</code></em></span> argument is the color of the polygon’s outline.</p></div><div class="sect3" title="Drawing Example"><div class="titlepage"><div><div><h3 class="title"><a id="drawing_example"/>Drawing Example</h3></div></div></div><p>Enter the following into the interactive shell:</p><a id="pro_id00621"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>from PIL import Image, ImageDraw</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>im = Image.new('RGBA', (200, 200), 'white')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>draw = ImageDraw.Draw(im)</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>draw.line([(0, 0), (199, 0), (199, 199), (0, 199), (0, 0)], fill='black')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>draw.rectangle((20, 30, 60, 60), fill='blue')</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>draw.ellipse((120, 30, 160, 60), fill='red')</strong></span>
➍ &gt;&gt;&gt; <span class="strong"><strong>draw.polygon(((57, 87), (79, 62), (94, 85), (120, 90), (103, 113)),</strong></span>
   <span class="strong"><strong>fill='brown')</strong></span>
➎ &gt;&gt;&gt; <span class="strong"><strong>for i in range(100, 200, 10):</strong></span>
           <span class="strong"><strong>draw.line([(i, 0), (200, i - 100)], fill='green')</strong></span>

   &gt;&gt;&gt; <span class="strong"><strong>im.save('drawing.png')</strong></span></pre><p>After making an <code class="literal">Image</code> object for a 200×200 white image, passing it to <code class="literal">ImageDraw.Draw()</code> to get an <code class="literal">ImageDraw</code> object, and storing the <code class="literal">ImageDraw</code> object in <code class="literal">draw</code>, you can call drawing methods on <code class="literal">draw</code>. Here we make a thin, black <a id="iddle1371" class="indexterm"/><a id="iddle1674" class="indexterm"/><a id="iddle1690" class="indexterm"/><a id="iddle2116" class="indexterm"/><a id="iddle2554" class="indexterm"/>outline at the edges of the image ➊, a blue rectangle with its top-left corner at (20, 30) and bottom-right corner at (60, 60) ➋, a red ellipse defined by a box from (120, 30) to (160, 60) ➌, a brown polygon with five points ➍, and a pattern of green lines drawn with a <code class="literal">for</code> loop ➎. The resulting <span class="emphasis"><em>drawing.png</em></span> file will look like <a class="xref" href="ch17.html#resulting_drawing_dotpng_image" title="Figure 17-14. The resulting drawing.png image">Figure 17-14</a>.</p><div class="figure"><a id="resulting_drawing_dotpng_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00094"/><img src="figs/web/17fig14.png.jpg" alt="The resulting drawing.png image"/></div></div><p class="title">Figure 17-14. The resulting <span class="emphasis"><em>drawing.png</em></span> image</p></div><p>There are several other shape-drawing methods for <code class="literal">ImageDraw</code> objects. The full documentation is available at <span class="emphasis"><em><a class="ulink" href="http://pillow.readthedocs.org/en/latest/reference/ImageDraw.html">http://pillow.readthedocs.org/en/latest/reference/ImageDraw.html</a></em></span>.</p></div></div><div class="sect2" title="Drawing Text"><div class="titlepage"><div><div><h2 class="title"><a id="drawing_text"/>Drawing Text</h2></div></div></div><p>The <code class="literal">ImageDraw</code> object also has a <code class="literal">text()</code> method for drawing text onto an image. The <code class="literal">text()</code> method takes four arguments: <span class="emphasis"><em><code class="literal">xy</code></em></span>, <span class="emphasis"><em><code class="literal">text</code></em></span>, <span class="emphasis"><em><code class="literal">fill</code></em></span>, and <span class="emphasis"><em><code class="literal">font</code></em></span>.</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <span class="emphasis"><em><code class="literal">xy</code></em></span> argument is a two-integer tuple specifying the upper-left corner of the text box.</p></li><li class="listitem"><p>The <span class="emphasis"><em><code class="literal">text</code></em></span> argument is the string of text you want to write.</p></li><li class="listitem"><p>The optional <span class="emphasis"><em><code class="literal">fill</code></em></span> argument is the color of the text.</p></li><li class="listitem"><p>The optional <span class="emphasis"><em><code class="literal">font</code></em></span> argument is an <code class="literal">ImageFont</code> object, used to set the type-face and size of the text. This is described in more detail in the next section.</p></li></ul></div><p>Since it’s often hard to know in advance what size a block of text will be in a given font, the <code class="literal">ImageDraw</code> module also offers a <code class="literal">textsize()</code> method. Its first argument is the string of text you want to measure, and its second argument is an optional <code class="literal">ImageFont</code> object. The <code class="literal">textsize()</code> method will then return a two-integer tuple of the width and height that the text in the given <a id="iddle2556" class="indexterm"/><a id="iddle2589" class="indexterm"/>font would be if it were written onto the image. You can use this width and height to help you calculate exactly where you want to put the text on your image.</p><p>The first three arguments for <code class="literal">text()</code> are straightforward. Before we use <code class="literal">text()</code> to draw text onto an image, let’s look at the optional fourth argument, the <code class="literal">ImageFont</code> object.</p><p>Both <code class="literal">text()</code> and <code class="literal">textsize()</code> take an optional <code class="literal">ImageFont</code> object as their final arguments. To create one of these objects, first run the following:</p><a id="pro_id00622"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>from PIL import ImageFont</strong></span></pre><p>Now that you’ve imported Pillow’s <code class="literal">ImageFont</code> module, you can call the <code class="literal">ImageFont.truetype()</code> function, which takes two arguments. The first argument is a string for the font’s <span class="emphasis"><em>TrueType file</em></span>—this is the actual font file that lives on your hard drive. A TrueType file has the <span class="emphasis"><em>.ttf</em></span> file extension and can usually be found in the following folders:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>On Windows: <span class="emphasis"><em>C:\Windows\Fonts</em></span></p></li><li class="listitem"><p>On OS X: <span class="emphasis"><em>/Library/Fonts</em></span> and <span class="emphasis"><em>/System/Library/Fonts</em></span></p></li><li class="listitem"><p>On Linux: <span class="emphasis"><em>/usr/share/fonts/truetype</em></span></p></li></ul></div><p>You don’t actually need to enter these paths as part of the TrueType file string because Python knows to automatically search for fonts in these directories. But Python will display an error if it is unable to find the font you specified.</p><p>The second argument to <code class="literal">ImageFont.truetype()</code> is an integer for the font size in <span class="emphasis"><em>points</em></span> (rather than, say, pixels). Keep in mind that Pillow creates PNG images that are 72 pixels per inch by default, and a point is 1/72 of an inch.</p><p>Enter the following into the interactive shell, replacing <code class="literal">FONT_FOLDER</code> with the actual folder name your operating system uses:</p><a id="pro_id00623"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>from PIL import Image, ImageDraw, ImageFont</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>import os</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>im = Image.new('RGBA', (200, 200), 'white')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>draw = ImageDraw.Draw(im)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>draw.text((20, 150), 'Hello', fill='purple')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>fontsFolder = 'FONT_FOLDER' # e.g. 'Library/Fonts'</strong></span>
➍ &gt;&gt;&gt; <span class="strong"><strong>arialFont = ImageFont.truetype(os.path.join(fontsFolder, 'arial.ttf'), 32)</strong></span>
➎ &gt;&gt;&gt; <span class="strong"><strong>draw.text((100, 150), 'Howdy', fill='gray', font=arialFont)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>im.save('text.png')</strong></span></pre><p>After importing <code class="literal">Image</code>, <code class="literal">ImageDraw</code>, <code class="literal">ImageFont</code>, and <code class="literal">os</code>, we make an <code class="literal">Image</code> object for a new 200×200 white image ➊ and make an <code class="literal">ImageDraw</code> object from the <code class="literal">Image</code> object ➋. We use <code class="literal">text()</code> to draw <span class="emphasis"><em>Hello</em></span> at (20, 150) in purple ➌. We didn’t pass the optional fourth argument in this <code class="literal">text()</code> call, so the typeface and size of this text aren’t customized.</p><p>To set a typeface and size, we first store the folder name (like <span class="emphasis"><em>/Library/Fonts</em></span>) in <code class="literal">fontsFolder</code>. Then we call <code class="literal">ImageFont.truetype()</code>, passing it the <span class="emphasis"><em>.ttf</em></span> file for the font we want, followed by an integer font size ➍. Store the <code class="literal">Font</code> object you get from <code class="literal">ImageFont.truetype()</code> in a variable like <code class="literal">arialFont</code>, and then pass the variable to <code class="literal">text()</code> in the final keyword argument. The <code class="literal">text()</code> call at ➎ draws <span class="emphasis"><em>Howdy</em></span> at (100, 150) in gray in 32-point Arial.</p><p>The resulting <span class="emphasis"><em>text.png</em></span> file will look like <a class="xref" href="ch17.html#resulting_text_dotpng_image" title="Figure 17-15. The resulting text.png image">Figure 17-15</a>.</p><div class="figure"><a id="resulting_text_dotpng_image"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00095"/><img src="figs/web/17fig15.png.jpg" alt="The resulting text.png image"/></div></div><p class="title">Figure 17-15. The resulting <span class="emphasis"><em>text.png</em></span> image</p></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00064"/>Summary</h1></div></div></div><p>Images consist of a collection of pixels, and each pixel has an RGBA value for its color and its addressable by x- and y-coordinates. Two common image formats are JPEG and PNG. The <code class="literal">pillow</code> module can handle both of these image formats and others.</p><p>When an image is loaded into an <code class="literal">Image</code> object, its width and height dimensions are stored as a two-integer tuple in the <code class="literal">size</code> attribute. Objects of the <code class="literal">Image</code> data type also have methods for common image manipulations: <code class="literal">crop()</code>, <code class="literal">copy()</code>, <code class="literal">paste()</code>, <code class="literal">resize()</code>, <code class="literal">rotate()</code>, and <code class="literal">transpose()</code>. To save the <code class="literal">Image</code> object to an image file, call the <code class="literal">save()</code> method.</p><p>If you want your program to draw shapes onto an image, use <code class="literal">ImageDraw</code> methods to draw points, lines, rectangles, ellipses, and polygons. The module also provides methods for drawing text in a typeface and font size of your choosing.</p><p>Although advanced (and expensive) applications such as Photoshop provide automatic batch processing features, you can use Python scripts to do many of the same modifications for free. In the previous chapters, you wrote Python programs to deal with plaintext files, spreadsheets, PDFs, and other formats. With the <code class="literal">pillow</code> module, you’ve extended your programming powers to processing images as well!</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00065"/>Practice Questions</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch17qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe1"/><a id="ch17qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. What is an RGBA value?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe2"/><a id="ch17qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. How can you get the RGBA value of <code class="literal">'CornflowerBlue'</code> from the <code class="literal">Pillow</code> module?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe3"/><a id="ch17qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. What is a box tuple?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe4"/><a id="ch17qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. What function returns an <code class="literal">Image</code> object for, say, an image file named <span class="emphasis"><em>zophie.png</em></span>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe5"/><a id="ch17qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. How can you find out the width and height of an <code class="literal">Image</code> object’s image?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe6"/><a id="ch17qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. What method would you call to get <code class="literal">Image</code> object for a 100×100 image, excluding the lower left quarter of it?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe7"/><a id="ch17qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. After making changes to an <code class="literal">Image</code> object, how could you save it as an image file?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe8"/><a id="ch17qa1q8"/><p>Q:</p></td><td align="left" valign="top"><p>8. What module contains Pillow’s shape-drawing code?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch17qa1qe9"/><a id="ch17qa1q9"/><p>Q:</p></td><td align="left" valign="top"><p>9. <code class="literal">Image</code> objects do not have drawing methods. What kind of object does? How do you get this kind of object?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Projects"><div class="titlepage"><div><div><h1 class="title"><a id="practice_projects-id00066"/>Practice Projects</h1></div></div></div><p>For practice, write programs that do the following.</p><div class="sect2" title="Extending and Fixing the Chapter Project Programs"><div class="titlepage"><div><div><h2 class="title"><a id="extending_and_fixing_the_chapter_project"/>Extending and Fixing the Chapter Project Programs</h2></div></div></div><p>The <span class="emphasis"><em>resizeAndAddLogo.py</em></span> program in this chapter works with PNG and JPEG files, but Pillow supports many more formats than just these two. Extend <span class="emphasis"><em>resizeAndAddLogo.py</em></span> to process GIF and BMP images as well.</p><p>Another small issue is that the program modifies PNG and JPEG files only if their file extensions are set in lowercase. For example, it will process <span class="emphasis"><em>zophie.png</em></span> but not <span class="emphasis"><em>zophie.PNG</em></span>. Change the code so that the file extension check is case insensitive.</p><div class="figure"><a id="when_the_image_isnapostrophet_much_large"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00096"/><img src="figs/web/17fig16.png.jpg" alt="When the image isn’t much larger than the logo, the results look ugly."/></div></div><p class="title">Figure 17-16. When the image isn’t much larger than the logo, the results look ugly.</p></div><p>Finally, the logo added to the bottom-right corner is meant to be just a small mark, but if the image is about the same size as the logo itself, the result will look like <a class="xref" href="ch17.html#when_the_image_isnapostrophet_much_large" title="Figure 17-16. When the image isn’t much larger than the logo, the results look ugly.">Figure 17-16</a>. Modify <span class="emphasis"><em>resizeAndAddLogo.py</em></span> so that the image must be at least twice the width and height of the logo image before the logo is pasted. Other wise, it should skip adding the logo.</p></div><div class="sect2" title="Identifying Photo Folders on the Hard Drive"><div class="titlepage"><div><div><h2 class="title"><a id="identifying_photo_folders_on_the_hard_dr"/>Identifying Photo Folders on the Hard Drive</h2></div></div></div><p>I have a bad habit of transferring files from my digital camera to temporary folders somewhere on the hard drive and then forgetting about these folders. It would be nice to write a program that could scan the entire hard drive and find these leftover “photo folders.”</p><p>Write a program that goes through every folder on your hard drive and finds potential photo folders. Of course, first you’ll have to define what you consider a “photo folder” to be; let’s say that it’s any folder where more than half of the files are photos. And how do you define what files are photos?</p><p>First, a photo file must have the file extension <span class="emphasis"><em>.png</em></span> or <span class="emphasis"><em>.jpg</em></span>. Also, photos are large images; a photo file’s width and height must both be larger than 500 pixels. This is a safe bet, since most digital camera photos are several thousand pixels in width and height.</p><p>As a hint, here’s a rough skeleton of what this program might look like:</p><a id="pro_id00624"/><pre class="programlisting">#! python3 #
Import modules and write comments to describe this program.

for foldername, subfolders, filenames in os.walk('C:\\'):
    numPhotoFiles = 0
    numNonPhotoFiles = 0
    for filename in filenames:
        # Check if file extension isn't .png or .jpg.
        if TODO:
            numNonPhotoFiles += 1
            continue    # skip to next filename

        # Open image file using Pillow.

        # Check if width &amp; height are larger than 500.
        if TODO:
            # Image is large enough to be considered a photo.
            numPhotoFiles += 1
        else:
            # Image is too small to be a photo.
            numNonPhotoFiles += 1

    # If more than half of files were photos,
    # print the absolute path of the folder.
    if TODO:
        print(TODO)</pre><p>When the program runs, it should print the absolute path of any photo folders to the screen.</p></div><div class="sect2" title="Custom Seating Cards"><div class="titlepage"><div><div><h2 class="title"><a id="custom_seating_cards"/>Custom Seating Cards</h2></div></div></div><p><a class="xref" href="ch13.html" title="Chapter 13. Working with PDF and word Documents">Chapter 13</a> included a practice project to create custom invitations from a list of guests in a plaintext file. As an additional project, use the <code class="literal">pillow</code> module to create images for custom seating cards for your guests. For each of the guests listed in the <span class="emphasis"><em>guests.txt</em></span> file from the resources at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>, generate an image file with the guest name and some flowery decoration. A public domain flower image is available in the resources at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><p>To ensure that each seating card is the same size, add a black rectangle on the edges of the invitation image so that when the image is printed out, there will be a guideline for cutting. The PNG files that Pillow produces are set to 72 pixels per inch, so a 4×5-inch card would require a 288×360-pixel image.</p></div></div></div></body></html>
