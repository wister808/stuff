<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 15. Keeping Time, Scheduling Tasks, and Launching Programs</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 15. Keeping Time, Scheduling Tasks, and Launching Programs"><div class="titlepage"><div><div><h1 class="title"><a id="keeping_timecomma_scheduling_taskscomma"/>Chapter 15. Keeping Time, Scheduling Tasks, and Launching Programs</h1></div></div></div><p><a id="iddle2536" class="indexterm"/><a id="iddle2560" class="indexterm"/>Running programs while you’re sitting at your computer is fine, but it’s also useful to have programs run without your direct supervision. Your computer’s clock can schedule programs to run code at some specified time and date or at regular intervals. For example, your program could scrape a website every hour to check for changes or do a CPU-intensive task at 4 <span class="smaller">AM</span> while you sleep. Python’s <code class="literal">time</code> and <code class="literal">datetime</code> modules provide these functions.</p><p>You can also write programs that launch other programs on a schedule by using the <code class="literal">subprocess</code> and <code class="literal">threading</code> modules. Often, the fastest way to program is to take advantage of applications that other people have already written.</p><div class="sect1" title="The time Module"><div class="titlepage"><div><div><h1 class="title"><a id="time_module"/>The time Module</h1></div></div></div><p><a id="iddle1216" class="indexterm"/><a id="iddle1408" class="indexterm"/><a id="iddle2162" class="indexterm"/><a id="iddle2577" class="indexterm"/><a id="iddle2619" class="indexterm"/><a id="iddle2626" class="indexterm"/>Your computer’s system clock is set to a specific date, time, and time zone. The built-in <code class="literal">time</code> module allows your Python programs to read the system clock for the current time. The <code class="literal">time.time()</code> and <code class="literal">time.sleep()</code> functions are the most useful in the <code class="literal">time</code> module.</p><div class="sect2" title="The time.time() Function"><div class="titlepage"><div><div><h2 class="title"><a id="timedottimeleft_parenthesisright_parenth"/>The time.time() Function</h2></div></div></div><p>The <span class="emphasis"><em>Unix epoch</em></span> is a time reference commonly used in programming: 12 <span class="smaller">AM</span> on January 1, 1970, Coordinated Universal Time (UTC). The <code class="literal">time.time()</code> function returns the number of seconds since that moment as a float value. (Recall that a float is just a number with a decimal point.) This number is called an <span class="emphasis"><em>epoch timestamp</em></span>. For example, enter the following into the interactive shell:</p><a id="pro_id00527"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import time</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>time.time()</strong></span>
1425063955.068649</pre><p>Here I’m calling <code class="literal">time.time()</code> on February 27, 2015, at 11:05 Pacific Standard Time, or 7:05 <span class="smaller">PM</span> UTC. The return value is how many seconds have passed between the Unix epoch and the moment <code class="literal">time.time()</code> was called.</p><div class="note" title="Note"><h3 class="title"><a id="ch15note01"/>Note</h3><p><span class="emphasis"><em>The interactive shell examples will yield dates and times for when I wrote this chapter in February 2015. Unless you’re a time traveler, your dates and times will be different.</em></span></p></div><p>Epoch timestamps can be used to <span class="emphasis"><em>profile</em></span> code, that is, measure how long a piece of code takes to run. If you call <code class="literal">time.time()</code> at the beginning of the code block you want to measure and again at the end, you can subtract the first timestamp from the second to find the elapsed time between those two calls. For example, open a new file editor window and enter the following program:</p><a id="pro_id00528"/><pre class="programlisting">   import time
➊ def calcProd():
       # Calculate the product of the first 100,000 numbers.
       product = 1
       for i in range(1, 100000):
           product = product * i
       return product

➋ startTime = time.time()
   prod = calcProd()
➌ endTime = time.time()
➍ print('The result is %s digits long.' % (len(str(prod))))
➎ print('Took %s seconds to calculate.' % (endTime - startTime))</pre><p><a id="iddle1123" class="indexterm"/><a id="iddle1228" class="indexterm"/><a id="iddle2435" class="indexterm"/><a id="iddle2574" class="indexterm"/>At ➊, we define a function <code class="literal">calcProd()</code> to loop through the integers from 1 to 99,999 and return their product. At ➋, we call <code class="literal">time.time()</code> and store it in <code class="literal">startTime</code>. Right after calling <code class="literal">calcProd()</code>, we call <code class="literal">time.time()</code> again and store it in <code class="literal">endTime</code> ➌. We end by printing the length of the product returned by <code class="literal">calcProd()</code> ➍ and how long it took to run <code class="literal">calcProd()</code> ➎.</p><p>Save this program as <span class="emphasis"><em>calcProd.py</em></span> and run it. The output will look something like this:</p><a id="pro_id00529"/><pre class="programlisting">The result is 456569 digits long.
Took 2.844162940979004 seconds to calculate.</pre><div class="note" title="Note"><h3 class="title"><a id="ch15note02"/>Note</h3><p><span class="emphasis"><em>Another way to profile your code is to use the <code class="literal">cProfile.run()</code> function, which provides a much more informative level of detail than the simple <code class="literal">time.time()</code> technique. The <code class="literal">cProfile.run()</code> function is explained at</em></span> <a class="ulink" href="https://docs.python.org/3/library/profile.html">https://docs.python.org/3/library/profile.html</a>.</p></div></div><div class="sect2" title="The time.sleep() Function"><div class="titlepage"><div><div><h2 class="title"><a id="timedotsleepleft_parenthesisright_parent"/>The time.sleep() Function</h2></div></div></div><p>If you need to pause your program for a while, call the <code class="literal">time.sleep()</code> function and pass it the number of seconds you want your program to stay paused. Enter the following into the interactive shell:</p><a id="pro_id00530"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import time</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>for i in range(3):</strong></span>
➊         <span class="strong"><strong>print('Tick')</strong></span>
➋         <span class="strong"><strong>time.sleep(1)</strong></span>
➌         <span class="strong"><strong>print('Tock')</strong></span>
➍         <span class="strong"><strong>time.sleep(1)</strong></span>
   Tick
   Tock
   Tick
   Tock
   Tick
   Tock
➎ &gt;&gt;&gt; <span class="strong"><strong>time.sleep(5)</strong></span></pre><p>The <code class="literal">for</code> loop will print <code class="literal">Tick</code> ➊, pause for one second ➋, print <code class="literal">Tock</code> ➌, pause for one second ➍, print <code class="literal">Tick</code>, pause, and so on until <code class="literal">Tick</code> and <code class="literal">Tock</code> have each been printed three times.</p><p>The <code class="literal">time.sleep()</code> function will <span class="emphasis"><em>block</em></span>—that is, it will not return and release your program to execute other code—until after the number of seconds you passed to <code class="literal">time.sleep()</code> has elapsed. For example, if you enter <code class="literal">time.sleep(5)</code> ➎, you’ll see that the next prompt (<code class="literal">&gt;&gt;&gt;</code>) doesn’t appear until five seconds have passed.</p><p>Be aware that pressing <span class="smaller">CTRL</span>-C will not interrupt <code class="literal">time.sleep()</code> calls in IDLE. IDLE waits until the entire pause is over before raising the <code class="literal">KeyboardInterrupt</code> exception. To work around this problem, instead of having a single <code class="literal">time.sleep(30)</code> call to pause for 30 seconds, use a <code class="literal">for</code> loop to make 30 calls to <code class="literal">time.sleep(1)</code>.</p><a id="pro_id00531"/><pre class="programlisting">&gt;&gt;&gt; for i in range(30):
    time.sleep(1)</pre><p><a id="iddle1514" class="indexterm"/><a id="iddle2198" class="indexterm"/><a id="iddle2358" class="indexterm"/><a id="iddle2475" class="indexterm"/><a id="iddle2476" class="indexterm"/><a id="iddle2576" class="indexterm"/>If you press <span class="smaller">CTRL</span>-C sometime during these 30 seconds, you should see the <code class="literal">KeyboardInterrupt</code> exception thrown right away.</p></div></div><div class="sect1" title="Rounding Numbers"><div class="titlepage"><div><div><h1 class="title"><a id="rounding_numbers"/>Rounding Numbers</h1></div></div></div><p>When working with times, you’ll often encounter float values with many digits after the decimal. To make these values easier to work with, you can shorten them with Python’s built-in <code class="literal">round()</code> function, which rounds a float to the precision you specify. Just pass in the number you want to round, plus an optional second argument representing how many digits after the decimal point you want to round it to. If you omit the second argument, <code class="literal">round()</code> rounds your number to the nearest whole integer. Enter the following into the interactive shell:</p><a id="pro_id00532"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import time</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>now = time.time()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>now</strong></span>
1425064108.017826
&gt;&gt;&gt; <span class="strong"><strong>round(now, 2)</strong></span>
1425064108.02
&gt;&gt;&gt; <span class="strong"><strong>round(now, 4)</strong></span>
1425064108.0178
&gt;&gt;&gt; <span class="strong"><strong>round(now)</strong></span>
1425064108</pre><p>After importing <code class="literal">time</code> and storing <code class="literal">time.time()</code> in <code class="literal">now</code>, we call <code class="literal">round(now, 2)</code> to round <code class="literal">now</code> to two digits after the decimal, <code class="literal">round(now, 4)</code> to round to four digits after the decimal, and <code class="literal">round(now)</code> to round to the nearest integer.</p></div><div class="sect1" title="Project: Super Stopwatch"><div class="titlepage"><div><div><h1 class="title"><a id="project_super_stopwatch"/>Project: Super Stopwatch</h1></div></div></div><p>Say you want to track how much time you spend on boring tasks you haven’t automated yet. You don’t have a physical stopwatch, and it’s surprisingly difficult to find a free stopwatch app for your laptop or smartphone that isn’t covered in ads and doesn’t send a copy of your browser history to marketers. (It says it can do this in the license agreement you agreed to. You did read the license agreement, didn’t you?) You can write a simple stopwatch program yourself in Python.</p><p>At a high level, here’s what your program will do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Track the amount of time elapsed between presses of the <span class="smaller">ENTER</span> key, with each key press starting a new “lap” on the timer.</p></li><li class="listitem"><p>Print the lap number, total time, and lap time.</p><p><a id="iddle2477" class="indexterm"/><a id="iddle2478" class="indexterm"/>This means your code will need to do the following:</p></li><li class="listitem"><p>Find the current time by calling <code class="literal">time.time()</code> and store it as a timestamp at the start of the program, as well as at the start of each lap.</p></li><li class="listitem"><p>Keep a lap counter and increment it every time the user presses <span class="smaller">ENTER</span>.</p></li><li class="listitem"><p>Calculate the elapsed time by subtracting timestamps.</p></li><li class="listitem"><p>Handle the <code class="literal">KeyboardInterrupt</code> exception so the user can press <span class="smaller">CTRL</span>-C to quit.</p></li></ul></div><p>Open a new file editor window and save it as <span class="emphasis"><em>stopwatch.py</em></span>.</p><div class="sect2" title="Step 1: Set Up the Program to Track Times"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_set_up_the_program_to_track_times"/>Step 1: Set Up the Program to Track Times</h2></div></div></div><p>The stopwatch program will need to use the current time, so you’ll want to import the <code class="literal">time</code> module. Your program should also print some brief instructions to the user before calling <code class="literal">input()</code>, so the timer can begin after the user presses <span class="smaller">ENTER</span>. Then the code will start tracking lap times.</p><p>Enter the following code into the file editor, writing a <code class="literal">TODO</code> comment as a placeholder for the rest of the code:</p><a id="pro_id00533"/><pre class="programlisting">#! python3
# stopwatch.py - A simple stopwatch program.

import time

# Display the program's instructions.
print('Press ENTER to begin. Afterwards, press ENTER to "click" the stopwatch.
Press Ctrl-C to quit.')
input()                    # press Enter to begin
print('Started.')
startTime = time.time()    # get the first lap's start time
lastTime = startTime
lapNum = 1

# TODO: Start tracking the lap times.</pre><p>Now that we’ve written the code to display the instructions, start the first lap, note the time, and set our lap count to 1.</p></div><div class="sect2" title="Step 2: Track and Print Lap Times"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_track_and_print_lap_times"/>Step 2: Track and Print Lap Times</h2></div></div></div><p>Now let’s write the code to start each new lap, calculate how long the previous lap took, and calculate the total time elapsed since starting the stopwatch. We’ll display the lap time and total time and increase the lap count for each new lap. Add the following code to your program:</p><a id="pro_id00534"/><pre class="programlisting">   #! python3
   # stopwatch.py - A simple stopwatch program.

   import time

   <span class="emphasis"><em>--snip--</em></span>

   <span class="strong"><strong># Start tracking the lap times.</strong></span>
➊ <span class="strong"><strong>try:</strong></span>
➋    <span class="strong"><strong>while True:</strong></span>
           <span class="strong"><strong>input()</strong></span>
➌         <span class="strong"><strong>lapTime = round(time.time() - lastTime, 2)</strong></span>
➍         <span class="strong"><strong>totalTime = round(time.time() - startTime, 2)</strong></span>
➎         <span class="strong"><strong>print('Lap #%s: %s (%s)' % (lapNum, totalTime, lapTime), end='')</strong></span>
           <span class="strong"><strong>lapNum += 1</strong></span>
           <span class="strong"><strong>lastTime = time.time() # reset the last lap time</strong></span>
➏ <span class="strong"><strong>except KeyboardInterrupt:</strong></span>
       <span class="strong"><strong># Handle the Ctrl-C exception to keep its error message from displaying.</strong></span>
       <span class="strong"><strong>print('\nDone.')</strong></span></pre><p><a id="iddle1780" class="indexterm"/>If the user presses <span class="smaller">CTRL</span>-C to stop the stopwatch, the <code class="literal">KeyboardInterrupt</code> exception will be raised, and the program will crash if its execution is not a <code class="literal">try</code> statement. To prevent crashing, we wrap this part of the program in a <code class="literal">try</code> statement ➊. We’ll handle the exception in the <code class="literal">except</code> clause ➏, so when <span class="smaller">CTRL</span>-C is pressed and the exception is raised, the program execution moves to the except clause to print <code class="literal">Done</code>, instead of the <code class="literal">KeyboardInterrupt</code> error message. Until this happens, the execution is inside an infinite loop ➋ that calls <code class="literal">input()</code> and waits until the user presses <span class="smaller">ENTER</span> to end a lap. When a lap ends, we calculate how long the lap took by subtracting the start time of the lap, <code class="literal">lastTime</code>, from the current time, <code class="literal">time.time()</code> ➌. We calculate the total time elapsed by subtracting the overall start time of the stopwatch, <code class="literal">startTime</code>, from the current time ➍.</p><p>Since the results of these time calculations will have many digits after the decimal point (such as <code class="literal">4.766272783279419</code>), we use the <code class="literal">round()</code> function to round the float value to two digits at ➌ and ➍.</p><p>At ➎, we print the lap number, total time elapsed, and the lap time. Since the user pressing <span class="smaller">ENTER</span> for the <code class="literal">input()</code> call will print a newline to the screen, pass <code class="literal">end=''</code> to the <code class="literal">print()</code> function to avoid double-spacing the output. After printing the lap information, we get ready for the next lap by adding 1 to the count <code class="literal">lapNum</code> and setting <code class="literal">lastTime</code> to the current time, which is the start time of the next lap.</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00054"/>Ideas for Similar Programs</h2></div></div></div><p>Time tracking opens up several possibilities for your programs. Although you can download apps to do some of these things, the benefit of writing programs yourself is that they will be free and not bloated with ads and useless features. You could write similar programs to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Create a simple timesheet app that records when you type a person’s name and uses the current time to clock them in or out.</p></li><li class="listitem"><p>Add a feature to your program to display the elapsed time since a process started, such as a download that uses the <code class="literal">requests</code> module. (See <a class="xref" href="ch11.html" title="Chapter 11. Web Scraping">Chapter 11</a>.)</p></li><li class="listitem"><p>Intermittently check how long a program has been running and offer the user a chance to cancel tasks that are taking too long.</p></li></ul></div></div></div><div class="sect1" title="The datetime Module"><div class="titlepage"><div><div><h1 class="title"><a id="datetime_module"/>The datetime Module</h1></div></div></div><p><a id="iddle1273" class="indexterm"/><a id="iddle1274" class="indexterm"/><a id="iddle1275" class="indexterm"/><a id="iddle1280" class="indexterm"/><a id="iddle1409" class="indexterm"/><a id="iddle1569" class="indexterm"/><a id="iddle2015" class="indexterm"/><a id="iddle2620" class="indexterm"/>The <code class="literal">time</code> module is useful for getting a Unix epoch timestamp to work with. But if you want to display a date in a more convenient format, or do arithmetic with dates (for example, figuring out what date was 205 days ago or what date is 123 days from now), you should use the <code class="literal">datetime</code> module.</p><p>The <code class="literal">datetime</code> module has its own <code class="literal">datetime</code> data type. <code class="literal">datetime</code> values represent a specific moment in time. Enter the following into the interactive shell:</p><a id="pro_id00535"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import datetime</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.now()</strong></span>
➋ datetime.datetime(2015, 2, 27, 11, 10, 49, 55, 53)
➌ &gt;&gt;&gt; <span class="strong"><strong>dt = datetime.datetime(2015, 10, 21, 16, 29, 0)</strong></span>
➍ &gt;&gt;&gt; <span class="strong"><strong>dt.year, dt.month, dt.day</strong></span>
   (2015, 10, 21)
➎ &gt;&gt;&gt; <span class="strong"><strong>dt.hour, dt.minute, dt.second</strong></span>
   (16, 29, 0)</pre><p>Calling <code class="literal">datetime.datetime.now()</code> ➊ returns a <code class="literal">datetime</code> object ➋ for the current date and time, according to your computer’s clock. This object includes the year, month, day, hour, minute, second, and microsecond of the current moment. You can also retrieve a <code class="literal">datetime</code> object for a specific moment by using the <code class="literal">datetime.datetime()</code> function ➌, passing it integers representing the year, month, day, hour, and second of the moment you want. These integers will be stored in the <code class="literal">datetime</code> object’s <code class="literal">year</code>, <code class="literal">month</code>, <code class="literal">day</code> ➍, <code class="literal">hour</code>, <code class="literal">minute</code>, and <code class="literal">second</code> ➎ attributes.</p><p>A Unix epoch timestamp can be converted to a <code class="literal">datetime</code> object with the <code class="literal">datetime.datetime.fromtimestamp()</code> function. The date and time of the <code class="literal">datetime</code> object will be converted for the local time zone. Enter the following into the interactive shell:</p><a id="pro_id00536"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.fromtimestamp(1000000)</strong></span>
datetime.datetime(1970, 1, 12, 5, 46, 40)
&gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.fromtimestamp(time.time())</strong></span>
datetime.datetime(2015, 2, 27, 11, 13, 0, 604980)</pre><p>Calling <code class="literal">datetime.datetime.fromtimestamp()</code> and passing it <code class="literal">1000000</code> returns a <code class="literal">datetime</code> object for the moment 1,000,000 seconds after the Unix epoch. Passing <code class="literal">time.time()</code>, the Unix epoch timestamp for the current moment, returns a <code class="literal">datetime</code> object for the current moment. So the expressions <code class="literal">datetime.datetime.now()</code> and <code class="literal">datetime.datetime.fromtimestamp(time.time())</code> do the same thing; they both give you a <code class="literal">datetime</code> object for the present moment.</p><div class="note" title="Note"><h3 class="title"><a id="ch15note03"/>Note</h3><p><span class="emphasis"><em>These examples were entered on a computer set to Pacific Standard Time. If you’re in another time zone, your results will look different.</em></span></p></div><p><a id="iddle1278" class="indexterm"/><a id="iddle1279" class="indexterm"/><a id="iddle2570" class="indexterm"/><a id="iddle2572" class="indexterm"/><a id="iddle2581" class="indexterm"/><code class="literal">datetime</code> objects can be compared with each other using comparison operators to find out which one precedes the other. The later <code class="literal">datetime</code> object is the “greater” value. Enter the following into the interactive shell:</p><a id="pro_id00537"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>halloween2015 = datetime.datetime(2015, 10, 31, 0, 0, 0)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>newyears2016 = datetime.datetime(2016, 1, 1, 0, 0, 0)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>oct31_2015 = datetime.datetime(2015, 10, 31, 0, 0, 0)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>halloween2015 == oct31_2015</strong></span>
   True
➍ &gt;&gt;&gt; <span class="strong"><strong>halloween2015 &gt; newyears2016</strong></span>
   False
➎ &gt;&gt;&gt; <span class="strong"><strong>newyears2016 &gt; halloween2015</strong></span>
   True
   &gt;&gt;&gt; <span class="strong"><strong>newyears2016 != oct31_2015</strong></span>
   True</pre><p>Make a <code class="literal">datetime</code> object for the first moment (midnight) of October 31, 2015 and store it in <code class="literal">halloween2015</code> ➊. Make a <code class="literal">datetime</code> object for the first moment of January 1, 2016 and store it in <code class="literal">newyears2016</code> ➋. Then make another object for midnight on October 31, 2015 and store it in <code class="literal">oct31_2015</code>. Comparing <code class="literal">halloween2015</code> and <code class="literal">oct31_2015</code> shows that they’re equal ➌. Comparing newyears2016 and halloween2015 shows that <code class="literal">newyears2016</code> is greater (later) than <code class="literal">halloween2015</code> ➍ ➎.</p><div class="sect2" title="The timedelta Data Type"><div class="titlepage"><div><div><h2 class="title"><a id="timedelta_data_type"/>The timedelta Data Type</h2></div></div></div><p>The <code class="literal">datetime</code> module also provides a <code class="literal">timedelta</code> data type, which represents a <span class="emphasis"><em>duration</em></span> of time rather than a <span class="emphasis"><em>moment</em></span> in time. Enter the following into the interactive shell:</p><a id="pro_id00538"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>delta = datetime.timedelta(days=11, hours=10, minutes=9, seconds=8)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>delta.days, delta.seconds, delta.microseconds</strong></span>
   (11, 36548, 0)
   &gt;&gt;&gt; <span class="strong"><strong>delta.total_seconds()</strong></span>
   986948.0
   &gt;&gt;&gt; str(delta)
   '11 days, 10:09:08'</pre><p>To create a <code class="literal">timedelta</code> object, use the <code class="literal">datetime.timedelta()</code> function. The <code class="literal">datetime.timedelta()</code> function takes keyword arguments <code class="literal">weeks</code>, <code class="literal">days</code>, <code class="literal">hours</code>, <code class="literal">minutes</code>, <code class="literal">seconds</code>, <code class="literal">milliseconds</code>, and <code class="literal">microseconds</code>. There is no <code class="literal">month</code> or <code class="literal">year</code> keyword argument because “a month” or “a year” is a variable amount of time depending on the particular month or year. A <code class="literal">timedelta</code> object has the total duration represented in days, seconds, and microseconds. These numbers are stored in the <code class="literal">days</code>, <code class="literal">seconds</code>, and <code class="literal">microseconds</code> attributes, respectively. The <code class="literal">total_seconds()</code> method will return the duration in number of seconds alone. Passing a <code class="literal">timedelta</code> object to <code class="literal">str()</code> will return a nicely formatted, human-readable string representation of the object.</p><p><a id="iddle1270" class="indexterm"/>In this example, we pass keyword arguments to <code class="literal">datetime.delta()</code> to specify a duration of 11 days, 10 hours, 9 minutes, and 8 seconds, and store the returned <code class="literal">timedelta</code> object in <code class="literal">delta</code> ➊. This <code class="literal">timedelta</code> object’s <code class="literal">days</code> attributes stores <code class="literal">11</code>, and its <code class="literal">seconds</code> attribute stores <code class="literal">36548</code> (10 hours, 9 minutes, and 8 seconds, expressed in seconds) ➋. Calling <code class="literal">total_seconds()</code> tells us that 11 days, 10 hours, 9 minutes, and 8 seconds is 986,948 seconds. Finally, passing the <code class="literal">timedelta</code> object to <code class="literal">str()</code> returns a string clearly explaning the duration.</p><p>The arithmetic operators can be used to perform <span class="emphasis"><em>date arithmetic</em></span> on <code class="literal">datetime</code> values. For example, to calculate the date 1,000 days from now, enter the following into the interactive shell:</p><a id="pro_id00539"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>dt = datetime.datetime.now()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>dt</strong></span>
datetime.datetime(2015, 2, 27, 18, 38, 50, 636181)
&gt;&gt;&gt; <span class="strong"><strong>thousandDays = datetime.timedelta(days=1000)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>dt + thousandDays</strong></span>
datetime.datetime(2017, 11, 23, 18, 38, 50, 636181)</pre><p>First, make a <code class="literal">datetime</code> object for the current moment and store it in <code class="literal">dt</code>. Then make a <code class="literal">timedelta</code> object for a duration of 1,000 days and store it in <code class="literal">thousandDays</code>. Add <code class="literal">dt</code> and <code class="literal">thousandDays</code> together to get a <code class="literal">datetime</code> object for the date 1,000 days from now. Python will do the date arithmetic to figure out that 1,000 days after February 27, 2015, will be November 23, 2017. This is useful because when you calculate 1,000 days from a given date, you have to remember how many days are in each month and factor in leap years and other tricky details. The <code class="literal">datetime</code> module handles all of this for you.</p><p><code class="literal">timedelta</code> objects can be added or subtracted with <code class="literal">datetime</code> objects or other <code class="literal">timedelta</code> objects using the <code class="literal">+</code> and <code class="literal">-</code> operators. A <code class="literal">timedelta</code> object can be multiplied or divided by integer or float values with the <code class="literal">*</code> and <code class="literal">/</code> operators. Enter the following into the interactive shell:</p><a id="pro_id00540"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>oct21st = datetime.datetime(2015, 10, 21, 16, 29, 0)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>aboutThirtyYears = datetime.timedelta(days=365 * 30)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>oct21st</strong></span>
   datetime.datetime(2015, 10, 21, 16, 29)
   &gt;&gt;&gt; <span class="strong"><strong>oct21st - aboutThirtyYears</strong></span>
   datetime.datetime(1985, 10, 28, 16, 29)
   &gt;&gt;&gt; <span class="strong"><strong>oct21st - (2 * aboutThirtyYears)</strong></span>
   datetime.datetime(1955, 11, 5, 16, 29)</pre><p>Here we make a <code class="literal">datetime</code> object for October 21, 2015 ➊ and a <code class="literal">timedelta</code> object for a duration of about 30 years (we’re assuming 365 days for each of those years) ➋. Subtracting <code class="literal">aboutThirtyYears</code> from <code class="literal">oct21st</code> gives us a <code class="literal">datetime</code> object for the date 30 years before October 21, 2015. Subtracting <code class="literal">2 * aboutThirtyYears</code> from <code class="literal">oct21st</code> returns a <code class="literal">datetime</code> object for the date 60 years before October 21, 2015.</p></div><div class="sect2" title="Pausing Until a Specific Date"><div class="titlepage"><div><div><h2 class="title"><a id="pausing_until_a_specific_date"/>Pausing Until a Specific Date</h2></div></div></div><p><a id="iddle1067" class="indexterm"/><a id="iddle1068" class="indexterm"/><a id="iddle1105" class="indexterm"/><a id="iddle1106" class="indexterm"/><a id="iddle1255" class="indexterm"/><a id="iddle1271" class="indexterm"/><a id="iddle1277" class="indexterm"/><a id="iddle1281" class="indexterm"/><a id="iddle1454" class="indexterm"/><a id="iddle1645" class="indexterm"/><a id="iddle1660" class="indexterm"/><a id="iddle1763" class="indexterm"/><a id="iddle1892" class="indexterm"/><a id="iddle1893" class="indexterm"/><a id="iddle2051" class="indexterm"/><a id="iddle2372" class="indexterm"/><a id="iddle2436" class="indexterm"/><a id="iddle2479" class="indexterm"/><a id="iddle2488" class="indexterm"/><a id="iddle2575" class="indexterm"/><a id="iddle2649" class="indexterm"/><a id="iddle2732" class="indexterm"/><a id="iddle2733" class="indexterm"/>The <code class="literal">time.sleep()</code> method lets you pause a program for a certain number of seconds. By using a <code class="literal">while</code> loop, you can pause your programs until a specific date. For example, the following code will continue to loop until Halloween 2016:</p><a id="pro_id00541"/><pre class="programlisting">import datetime
import time
halloween2016 = datetime.datetime(2016, 10, 31, 0, 0, 0)
while datetime.datetime.now() &lt; halloween2016:
    time.sleep(1)</pre><p>The <code class="literal">time.sleep(1)</code> call will pause your Python program so that the computer doesn’t waste CPU processing cycles simply checking the time over and over. Rather, the <code class="literal">while</code> loop will just check the condition once per second and continue with the rest of the program after Halloween 2016 (or whenever you program it to stop).</p></div><div class="sect2" title="Converting datetime Objects into Strings"><div class="titlepage"><div><div><h2 class="title"><a id="converting_datetime_objects_into_strings"/>Converting datetime Objects into Strings</h2></div></div></div><p>Epoch timestamps and <code class="literal">datetime</code> objects aren’t very friendly to the human eye. Use the <code class="literal">strftime()</code> method to display a <code class="literal">datetime</code> object as a string. (The <span class="emphasis"><em>f</em></span> in the name of the <code class="literal">strftime()</code> function stands for <span class="emphasis"><em>format</em></span>.)</p><p>The <code class="literal">strftime()</code> method uses directives similar to Python’s string formatting. <a class="xref" href="ch15.html#strftimeleft_parenthesisright_parenthesi" title="Table 15-1. strftime() Directives">Table 15-1</a> has a full list of <code class="literal">strftime()</code> directives.</p><div class="table"><a id="strftimeleft_parenthesisright_parenthesi"/><p class="title">Table 15-1. <code class="literal">strftime()</code> Directives</p><div class="table-contents"><table summary="strftime() Directives" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>strftime directive</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Meaning</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%Y</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Year with century, as in <code class="literal">'2014'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%y</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Year without century, <code class="literal">'00'</code> to <code class="literal">'99'</code> (1970 to 2069)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%m</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Month as a decimal number, <code class="literal">'01'</code> to <code class="literal">'12'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%B</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Full month name, as in <code class="literal">'November'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%b</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Abbreviated month name, as in <code class="literal">'Nov'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%d</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Day of the month, <code class="literal">'01'</code> to <code class="literal">'31'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%j</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Day of the year, <code class="literal">'001'</code> to <code class="literal">'366'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%w</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Day of the week, <code class="literal">'0'</code> (Sunday) to <code class="literal">'6'</code> (Saturday)</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%A</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Full weekday name, as in <code class="literal">'Monday'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%a</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Abbreviated weekday name, as in <code class="literal">'Mon'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%H</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Hour (24-hour clock), <code class="literal">'00'</code> to <code class="literal">'23'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%I</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Hour (12-hour clock), <code class="literal">'01'</code> to <code class="literal">'12'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%M</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Minute, <code class="literal">'00'</code> to <code class="literal">'59'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%S</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Second, <code class="literal">'00'</code> to <code class="literal">'59'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">%p</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'AM'</code> or <code class="literal">'PM'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">%%</code></p></td><td style="" valign="top"><p>Literal <code class="literal">'%'</code> character</p></td></tr></tbody></table></div></div><p><a id="iddle1272" class="indexterm"/><a id="iddle1282" class="indexterm"/><a id="iddle2489" class="indexterm"/><a id="iddle2525" class="indexterm"/><a id="iddle2628" class="indexterm"/>Pass <code class="literal">strrftime()</code> a custom format string containing formatting directives (along with any desired slashes, colons, and so on), and <code class="literal">strftime()</code> will return the <code class="literal">datetime</code> object’s information as a formatted string. Enter the following into the interactive shell:</p><a id="pro_id00542"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>oct21st = datetime.datetime(2015, 10, 21, 16, 29, 0)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>oct21st.strftime('%Y/%m/%d %H:%M:%S')</strong></span>
'2015/10/21 16:29:00'
&gt;&gt;&gt; <span class="strong"><strong>oct21st.strftime('%I:%M %p')</strong></span>
'04:29 PM'
&gt;&gt;&gt; <span class="strong"><strong>oct21st.strftime("%B of '%y")</strong></span>
"October of '15"</pre><p>Here we have a <code class="literal">datetime</code> object for October 21, 2015 at 4:29 <span class="smaller">PM</span>, stored in <code class="literal">oct21st</code>. Passing <code class="literal">strftime()</code> the custom format string <code class="literal">'%Y/%m/%d %H:%M:%S'</code> returns a string containing 2015, 10, and 21 separated by slahes and 16, 29, and 00 separated by colons. Passing <code class="literal">'%I:%M% p'</code> returns <code class="literal">'04:29 PM'</code>, and passing <code class="literal">"%B of '%y"</code> returns <code class="literal">"October of '15"</code>. Note that <code class="literal">strftime()</code> doesn’t begin with <code class="literal">datetime.datetime</code>.</p></div><div class="sect2" title="Converting Strings into datetime Objects"><div class="titlepage"><div><div><h2 class="title"><a id="converting_strings_into_datetime_objects"/>Converting Strings into datetime Objects</h2></div></div></div><p>If you have a string of date information, such as <code class="literal">'2015/10/21 16:29:00'</code> or <code class="literal">'October 21, 2015'</code>, and need to convert it to a <code class="literal">datetime</code> object, use the <code class="literal">datetime.datetime.strptime()</code> function. The <code class="literal">strptime()</code> function is the inverse of the <code class="literal">strftime()</code> method. A custom format string using the same directives as <code class="literal">strftime()</code> must be passed so that <code class="literal">strptime()</code> knows how to parse and understand the string. (The <span class="emphasis"><em>p</em></span> in the name of the <code class="literal">strptime()</code> function stands for <span class="emphasis"><em>parse</em></span>.)</p><p>Enter the following into the interactive shell:</p><a id="pro_id00543"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.strptime('October 21, 2015', '%B %d, %Y')</strong></span>
   datetime.datetime(2015, 10, 21, 0, 0)
   &gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.strptime('2015/10/21 16:29:00', '%Y/%m/%d %H:%M:%S')</strong></span>
   datetime.datetime(2015, 10, 21, 16, 29)
   &gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.strptime("October of '15", "%B of '%y")</strong></span>
   datetime.datetime(2015, 10, 1, 0, 0)
   &gt;&gt;&gt; <span class="strong"><strong>datetime.datetime.strptime("November of '63", "%B of '%y")</strong></span>
   datetime.datetime(2063, 11, 1, 0, 0)</pre><p>To get a <code class="literal">datetime</code> object from the string <code class="literal">'October 21, 2015'</code>, pass <code class="literal">'October 21, 2015'</code> as the first argument to <code class="literal">strptime()</code> and the custom format string that corresponds to <code class="literal">'October 21, 2015'</code> as the second argument ➊. The string with the date information must match the custom format string exactly, or Python will raise a <code class="literal">ValueError</code> exception.</p></div></div><div class="sect1" title="Review of Python’s Time Functions"><div class="titlepage"><div><div><h1 class="title"><a id="review_of_pythonapostrophes_time_functio"/>Review of Python’s Time Functions</h1></div></div></div><p><a id="iddle1276" class="indexterm"/><a id="iddle1410" class="indexterm"/><a id="iddle1570" class="indexterm"/><a id="iddle2016" class="indexterm"/><a id="iddle2437" class="indexterm"/><a id="iddle2480" class="indexterm"/><a id="iddle2526" class="indexterm"/><a id="iddle2571" class="indexterm"/><a id="iddle2573" class="indexterm"/><a id="iddle2582" class="indexterm"/><a id="iddle2621" class="indexterm"/>Dates and times in Python can involve quite a few different data types and functions. Here’s a review of the three different types of values used to represent time:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>A Unix epoch timestamp (used by the <code class="literal">time</code> module) is a float or integer value of the number of seconds since 12 <span class="smaller">AM</span> on January 1, 1970, UTC.</p></li><li class="listitem"><p>A <code class="literal">datetime</code> object (of the <code class="literal">datetime</code> module) has integers stored in the attributes <code class="literal">year</code>, <code class="literal">month</code>, <code class="literal">day</code>, <code class="literal">hour</code>, <code class="literal">minute</code>, and <code class="literal">second</code>.</p></li><li class="listitem"><p>A <code class="literal">timedelta</code> object (of the <code class="literal">datetime</code> module) represents a time duration, rather than a specific moment.</p></li></ul></div><p>Here’s a review of time functions and their parameters and return values:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>The <code class="literal">time.time()</code> function returns an epoch timestamp float value of the current moment.</p></li><li class="listitem"><p>The <code class="literal">time.sleep(</code><span class="emphasis"><em><code class="literal">seconds</code></em></span><code class="literal">)</code> function stops the program for the amount of seconds specified by the <span class="emphasis"><em><code class="literal">seconds</code></em></span> argument.</p></li><li class="listitem"><p>The <code class="literal">datetime.datetime(</code><span class="emphasis"><em><code class="literal">year</code></em></span>, <span class="emphasis"><em><code class="literal">month</code></em></span>, <span class="emphasis"><em><code class="literal">day</code></em></span>, <span class="emphasis"><em><code class="literal">hour</code></em></span>, <span class="emphasis"><em><code class="literal">minute</code></em></span>, <span class="emphasis"><em><code class="literal">second</code></em></span><code class="literal">)</code> function returns a <code class="literal">datetime</code> object of the moment specified by the arguments. If <span class="emphasis"><em><code class="literal">hour</code></em></span>, <span class="emphasis"><em><code class="literal">minute</code></em></span>, or <span class="emphasis"><em><code class="literal">second</code></em></span> arguments are not provided, they default to <code class="literal">0</code>.</p></li><li class="listitem"><p>The <code class="literal">datetime.datetime.now()</code> function returns a <code class="literal">datetime</code> object of the current moment.</p></li><li class="listitem"><p>The <code class="literal">datetime.datetime.fromtimestamp(</code><span class="emphasis"><em><code class="literal">epoch</code></em></span><code class="literal">)</code> function returns a <code class="literal">datetime</code> object of the moment represented by the <span class="emphasis"><em><code class="literal">epoch</code></em></span> timestamp argument.</p></li><li class="listitem"><p>The <code class="literal">datetime.timedelta(</code><span class="emphasis"><em><code class="literal">weeks</code></em></span>, <span class="emphasis"><em><code class="literal">days</code></em></span>, <span class="emphasis"><em><code class="literal">hours</code></em></span>, <span class="emphasis"><em><code class="literal">minutes</code></em></span>, <span class="emphasis"><em><code class="literal">seconds</code></em></span>, <span class="emphasis"><em><code class="literal">milliseconds</code></em></span>, <span class="emphasis"><em><code class="literal">microseconds</code></em></span><code class="literal">)</code> function returns a <code class="literal">timedelta</code> object representing a duration of time. The function’s keyword arguments are all optional and do not include <span class="emphasis"><em><code class="literal">month</code></em></span> or <span class="emphasis"><em><code class="literal">year</code></em></span>.</p></li><li class="listitem"><p>The <code class="literal">total_seconds()</code> method for <code class="literal">timedelta</code> objects returns the number of seconds the <code class="literal">timedelta</code> object represents.</p></li><li class="listitem"><p>The <code class="literal">strftime(</code><span class="emphasis"><em><code class="literal">format</code></em></span><code class="literal">)</code> method returns a string of the time represented by the <code class="literal">datetime</code> object in a custom format that’s based on the <span class="emphasis"><em><code class="literal">format</code></em></span> string. See <a class="xref" href="ch15.html#strftimeleft_parenthesisright_parenthesi" title="Table 15-1. strftime() Directives">Table 15-1</a> for the format details.</p></li><li class="listitem"><p>The <code class="literal">datetime.datetime.strptime(</code><span class="emphasis"><em><code class="literal">time_string</code></em></span>, <span class="emphasis"><em><code class="literal">format</code></em></span><code class="literal">)</code> function returns a <code class="literal">datetime</code> object of the moment specified by <span class="emphasis"><em><code class="literal">time_string</code></em></span>, parsed using the <span class="emphasis"><em><code class="literal">format</code></em></span> string argument. See <a class="xref" href="ch15.html#strftimeleft_parenthesisright_parenthesi" title="Table 15-1. strftime() Directives">Table 15-1</a> for the format details.</p></li></ul></div></div><div class="sect1" title="Multithreading"><div class="titlepage"><div><div><h1 class="title"><a id="multithreading"/>Multithreading</h1></div></div></div><p><a id="iddle1994" class="indexterm"/><a id="iddle1998" class="indexterm"/><a id="iddle2433" class="indexterm"/><a id="iddle2558" class="indexterm"/><a id="iddle2561" class="indexterm"/><a id="iddle2562" class="indexterm"/><a id="iddle2565" class="indexterm"/>To introduce the concept of multithreading, let’s look at an example situation. Say you want to schedule some code to run after a delay or at a specific time. You could add code like the following at the start of your program:</p><a id="pro_id00544"/><pre class="programlisting">import time, datetime

startTime = datetime.datetime(2029, 10, 31, 0, 0, 0)
while datetime.datetime.now() &lt; startTime:
    time.sleep(1)

print('Program now starting on Halloween 2029')
<span class="emphasis"><em>--snip--</em></span></pre><p>This code designates a start time of October 31, 2029, and keeps calling <code class="literal">time.sleep(1)</code> until the start time arrives. Your program cannot do anything while waiting for the loop of <code class="literal">time.sleep()</code> calls to finish; it just sits around until Halloween 2029. This is because Python programs by default have a single <span class="emphasis"><em>thread</em></span> of execution.</p><p>To understand what a thread of execution is, remember the <a class="xref" href="ch02.html" title="Chapter 2. Flow Control">Chapter 2</a> discussion of flow control, when you imagined the execution of a program as placing your finger on a line of code in your program and moving to the next line or wherever it was sent by a flow control statement. A <span class="emphasis"><em>single-threaded</em></span> program has only one finger. But a <span class="emphasis"><em>multithreaded</em></span> program has multiple fingers. Each finger still moves to the next line of code as defined by the flow control statements, but the fingers can be at different places in the program, executing different lines of code at the same time. (All of the programs in this book so far have been single threaded.)</p><p>Rather than having all of your code wait until the <code class="literal">time.sleep()</code> function finishes, you can execute the delayed or scheduled code in a separate thread using Python’s <code class="literal">threading</code> module. The separate thread will pause for the <code class="literal">time.sleep</code> calls. Meanwhile, your program can do other work in the original thread.</p><p>To make a separate thread, you first need to make a <code class="literal">Thread</code> object by calling the <code class="literal">threading.Thread()</code> function. Enter the following code in a new file and save it as <span class="emphasis"><em>threadDemo.py</em></span>:</p><a id="pro_id00545"/><pre class="programlisting">   import threading, time
   print('Start of program.')

➊ def takeANap():
       time.sleep(5)
       print('Wake up!')

➋ threadObj = threading.Thread(target=takeANap)
➌ threadObj.start()

   print('End of program.')</pre><p><a id="iddle1095" class="indexterm"/><a id="iddle1995" class="indexterm"/><a id="iddle1996" class="indexterm"/><a id="iddle2467" class="indexterm"/><a id="iddle2567" class="indexterm"/>At ➊, we define a function that we want to use in a new thread. To create a <code class="literal">Thread</code> object, we call <code class="literal">threading.Thread()</code> and pass it the keyword argument <code class="literal">target=takeANap</code> ➋. This means the function we want to call in the new thread is <code class="literal">takeANap()</code>. Notice that the keyword argument is <code class="literal">target=takeANap</code>, not <code class="literal">target=takeANap()</code>. This is because you want to pass the <code class="literal">takeANap()</code> function itself as the argument, not call <code class="literal">takeANap()</code> and pass its return value.</p><p>After we store the <code class="literal">Thread</code> object created by <code class="literal">threading.Thread()</code> in <code class="literal">threadObj</code>, we call <code class="literal">threadObj.start()</code> ➌ to create the new thread and start executing the target function in the new thread. When this program is run, the output will look like this:</p><a id="pro_id00546"/><pre class="programlisting">Start of program.
End of program.
Wake up!</pre><p>This can be a bit confusing. If <code class="literal">print('End of program.')</code> is the last line of the program, you might think that it should be the last thing printed. The reason <code class="literal">Wake up!</code> comes after it is that when <code class="literal">threadObj.start()</code> is called, the target function for <code class="literal">threadObj</code> is run in a new thread of execution. Think of it as a second finger appearing at the start of the <code class="literal">takeANap()</code> function. The main thread continues to <code class="literal">print('End of program.')</code>. Meanwhile, the new thread that has been executing the <code class="literal">time.sleep(5)</code> call, pauses for 5 seconds. After it wakes from its 5-second nap, it prints <code class="literal">'Wake up!'</code> and then returns from the <code class="literal">takeANap()</code> function. Chronologically, <code class="literal">'Wake up!'</code> is the last thing printed by the program.</p><p>Normally a program terminates when the last line of code in the file has run (or the <code class="literal">sys.exit()</code> function is called). But <span class="emphasis"><em>threadDemo.py</em></span> has two threads. The first is the original thread that began at the start of the program and ends after <code class="literal">print('End of program.')</code>. The second thread is created when <code class="literal">threadObj.start()</code> is called, begins at the start of the <code class="literal">takeANap()</code> function, and ends after <code class="literal">takeANap()</code> returns.</p><p>A Python program will not terminate until all its threads have terminated. When you ran <span class="emphasis"><em>threadDemo.py</em></span>, even though the original thread had terminated, the second thread was still executing the <code class="literal">time.sleep(5)</code> call.</p><div class="sect2" title="Passing Arguments to the Thread’s Target Function"><div class="titlepage"><div><div><h2 class="title"><a id="passing_arguments_to_the_threadapostroph"/>Passing Arguments to the Thread’s Target Function</h2></div></div></div><p>If the target function you want to run in the new thread takes arguments, you can pass the target function’s arguments to <code class="literal">threading.Thread()</code>. For example, say you wanted to run this <code class="literal">print()</code> call in its own thread:</p><a id="pro_id00547"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>print('Cats', 'Dogs', 'Frogs', sep=' &amp; ')</strong></span>
Cats &amp; Dogs &amp; Frogs</pre><p>This <code class="literal">print()</code> call has three regular arguments, <code class="literal">'Cats'</code>, <code class="literal">'Dogs'</code>, and <code class="literal">'Frogs'</code>, and one keyword argument, <code class="literal">sep=' &amp; '</code>. The regular arguments can be passed <a id="iddle1090" class="indexterm"/><a id="iddle1212" class="indexterm"/><a id="iddle1988" class="indexterm"/><a id="iddle1997" class="indexterm"/><a id="iddle2468" class="indexterm"/><a id="iddle2563" class="indexterm"/>as a list to the <code class="literal">args</code> keyword argument in <code class="literal">threading.Thread()</code>. The keyword argument can be specified as a dictionary to the <code class="literal">kwargs</code> keyword argument in <code class="literal">threading.Thread()</code>.</p><p>Enter the following into the interactive shell:</p><a id="pro_id00548"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import threading</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>threadObj = threading.Thread(target=print, args=['Cats', 'Dogs', 'Frogs'],</strong></span>
<span class="strong"><strong>kwargs={'sep': ' &amp; '})</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>threadObj.start()</strong></span>
Cats &amp; Dogs &amp; Frogs</pre><p>To make sure the arguments <code class="literal">'Cats'</code>, <code class="literal">'Dogs'</code>, and <code class="literal">'Frogs'</code> get passed to <code class="literal">print()</code> in the new thread, we pass <code class="literal">args=['Cats', 'Dogs', 'Frogs']</code> to <code class="literal">threading.Thread()</code>. To make sure the keyword argument <code class="literal">sep=' &amp; '</code> gets passed to <code class="literal">print()</code> in the new thread, we pass <code class="literal">kwargs={'sep': '&amp; '}</code> to <code class="literal">threading.Thread()</code>.</p><p>The <code class="literal">threadObj.start()</code> call will create a new thread to call the <code class="literal">print()</code> function, and it will pass <code class="literal">'Cats'</code>, <code class="literal">'Dogs'</code>, and <code class="literal">'Frogs'</code> as arguments and <code class="literal">' &amp; '</code> for the <code class="literal">sep</code> keyword argument.</p><p>This is an incorrect way to create the new thread that calls <code class="literal">print()</code>:</p><a id="pro_id00549"/><pre class="programlisting">threadObj = threading.Thread(target=print('Cats', 'Dogs', 'Frogs', sep=' &amp; '))</pre><p>What this ends up doing is calling the <code class="literal">print()</code> function and passing its return value (<code class="literal">print()</code>’s return value is always <code class="literal">None</code>) as the <code class="literal">target</code> keyword argument. It <span class="emphasis"><em>doesn’t</em></span> pass the <code class="literal">print()</code> function itself. When passing arguments to a function in a new thread, use the <code class="literal">threading.Thread()</code> function’s <code class="literal">args</code> and <code class="literal">kwargs</code> keyword arguments.</p></div><div class="sect2" title="Concurrency Issues"><div class="titlepage"><div><div><h2 class="title"><a id="concurrency_issues"/>Concurrency Issues</h2></div></div></div><p>You can easily create several new threads and have them all running at the same time. But multiple threads can also cause problems called <span class="emphasis"><em>concurrency issues</em></span>. These issues happen when threads read and write variables at the same time, causing the threads to trip over each other. Concurrency issues can be hard to reproduce consistently, making them hard to debug.</p><p>Multithreaded programming is its own wide subject and beyond the scope of this book. What you have to keep in mind is this: To avoid concurrency issues, never let multiple threads read or write the same variables. When you create a new <code class="literal">Thread</code> object, make sure its target function uses only local variables in that function. This will avoid hard-to-debug concurrency issues in your programs.</p><div class="note" title="Note"><h3 class="title"><a id="ch15note04"/>Note</h3><p><span class="emphasis"><em>A beginner’s tutorial on multithreaded programming is available at</em></span> <a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a>.</p></div></div></div><div class="sect1" title="Project: Multithreaded XKCD Downloader"><div class="titlepage"><div><div><h1 class="title"><a id="project_multithreaded_xkcd_downloader"/>Project: Multithreaded XKCD Downloader</h1></div></div></div><p><a id="iddle1356" class="indexterm"/><a id="iddle1989" class="indexterm"/><a id="iddle1991" class="indexterm"/><a id="iddle2190" class="indexterm"/><a id="iddle2566" class="indexterm"/><a id="iddle2728" class="indexterm"/><a id="iddle2730" class="indexterm"/>In <a class="xref" href="ch11.html" title="Chapter 11. Web Scraping">Chapter 11</a>, you wrote a program that downloaded all of the XKCD comic strips from the XKCD website. This was a single-threaded program: It downloaded one comic at a time. Much of the program’s running time was spent establishing the network connection to begin the download and writing the downloaded images to the hard drive. If you have a broadband Internet connection, your single-threaded program wasn’t fully utilizing the available bandwidth.</p><p>A multithreaded program that has some threads downloading comics while others are establishing connections and writing the comic image files to disk uses your Internet connection more efficiently and downloads the collection of comics more quickly. Open a new file editor window and save it as <span class="emphasis"><em>multidownloadXkcd.py</em></span>. You will modify this program to add multithreading. The completely modified source code is available to download from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><div class="sect2" title="Step 1: Modify the Program to Use a Function"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_modify_the_program_to_use_a_funct"/>Step 1: Modify the Program to Use a Function</h2></div></div></div><p>This program will mostly be the same downloading code from <a class="xref" href="ch11.html" title="Chapter 11. Web Scraping">Chapter 11</a>, so I’ll skip the explanation for the Requests and BeautifulSoup code. The main changes you need to make are importing the <code class="literal">threading</code> module and making a <code class="literal">downloadXkcd()</code> function, which takes starting and ending comic numbers as parameters.</p><p>For example, calling <code class="literal">downloadXkcd(140, 280)</code> would loop over the downloading code to download the comics at <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/140">http://xkcd.com/140</a></em></span>, <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/141">http://xkcd.com/141</a></em></span>, <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/142">http://xkcd.com/142</a></em></span>, and so on, up to <span class="emphasis"><em><a class="ulink" href="http://xkcd.com/279">http://xkcd.com/279</a></em></span>. Each thread that you create will call <code class="literal">downloadXkcd()</code> and pass a different range of comics to download.</p><p>Add the following code to your <span class="emphasis"><em>multidownloadXkcd.py</em></span> program:</p><a id="pro_id00550"/><pre class="programlisting">   #! python3
   # multidownloadXkcd.py - Downloads XKCD comics using multiple threads.

   import requests, os, bs4, threading
➊ os.makedirs('xkcd', exist_ok=True) # store comics in ./xkcd

➋ def downloadXkcd(startComic, endComic):
➌     for urlNumber in range(startComic, endComic):
           # Download the page.
           print('Downloading page http://xkcd.com/%s...' % (urlNumber))
➍         res = requests.get('http://xkcd.com/%s' % (urlNumber))
           res.raise_for_status()

➎         soup = bs4.BeautifulSoup(res.text)

           # Find the URL of the comic image.
➏         comicElem = soup.select('#comic img')
           if comicElem == []:
               print('Could not find comic image.')
           else:
➐             comicUrl = comicElem[0].get('src')
               # Download the image.
               print('Downloading image %s...' % (comicUrl))
➑             res = requests.get(comicUrl)
               res.raise_for_status()

               # Save the image to ./xkcd.
               imageFile = open(os.path.join('xkcd', os.path.basename(comicUrl)), 'wb')
               for chunk in res.iter_content(100000):
                   imageFile.write(chunk)
               imageFile.close()

   # TODO: Create and start the Thread objects.
   # TODO: Wait for all threads to end.</pre><p><a id="iddle1990" class="indexterm"/><a id="iddle2469" class="indexterm"/><a id="iddle2559" class="indexterm"/><a id="iddle2729" class="indexterm"/>After importing the modules we need, we make a directory to store comics in ➊ and start defining <code class="literal">downloadxkcd()</code> ➋. We loop through all the numbers in the specified range ➌ and download each page ➍. We use Beautiful Soup to look through the HTML of each page ➎ and find the comic image ➏. If no comic image is found on a page, we print a message. Otherwise, we get the URL of the image ➐ and download the image ➑. Finally, we save the image to the directory we created.</p></div><div class="sect2" title="Step 2: Create and Start Threads"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_create_and_start_threads"/>Step 2: Create and Start Threads</h2></div></div></div><p>Now that we’ve defined <code class="literal">downloadXkcd()</code>, we’ll create the multiple threads that each call <code class="literal">downloadXkcd()</code> to download different ranges of comics from the XKCD website. Add the following code to <span class="emphasis"><em>multidownloadXkcd.py</em></span> after the <code class="literal">downloadXkcd()</code> function definition:</p><a id="pro_id00551"/><pre class="programlisting">#! python3
# multidownloadXkcd.py - Downloads XKCD comics using multiple threads.

<span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># Create and start the Thread objects.</strong></span>
<span class="strong"><strong>downloadThreads = []</strong></span>             <span class="strong"><strong># a list of all the Thread objects</strong></span>
<span class="strong"><strong>for i in range(0, 1400, 100):</strong></span>    <span class="strong"><strong># loops 14 times, creates 14 threads</strong></span>
    <span class="strong"><strong>downloadThread = threading.Thread(target=downloadXkcd, args=(i, i + 99))</strong></span>
    <span class="strong"><strong>downloadThreads.append(downloadThread)</strong></span>
    <span class="strong"><strong>downloadThread.start()</strong></span></pre><p>First we make an empy list <code class="literal">downloadThreads</code>; the list will help us keep track of the many <code class="literal">Thread</code> objects we’ll create. Then we start our <code class="literal">for</code> loop. Each time through the loop, we create a <code class="literal">Thread</code> object with <code class="literal">threading.Thread()</code>, append the <code class="literal">Thread</code> object to the list, and call <code class="literal">start()</code> to start running <code class="literal">downloadXkcd()</code> in the new thread. Since the <code class="literal">for</code> loop sets the <code class="literal">i</code> variable from <code class="literal">0</code> to <code class="literal">1400</code> at steps of <code class="literal">100</code>, <code class="literal">i</code> will be set to <code class="literal">0</code> on the first iteration, <code class="literal">100</code> on the second iteration, <code class="literal">200</code> on the third, and so on. Since we pass <code class="literal">args=(i, i + 99)</code> to <code class="literal">threading.Thread()</code>, the two arguments passed to <code class="literal">downloadXkcd()</code> will be <code class="literal">0</code> and <code class="literal">99</code> on the first iteration, <code class="literal">100</code> and <code class="literal">199</code> on the second iteration, <code class="literal">200</code> and <code class="literal">299</code> on the third, and so on.</p><p><a id="iddle1767" class="indexterm"/><a id="iddle1797" class="indexterm"/><a id="iddle1992" class="indexterm"/><a id="iddle1993" class="indexterm"/><a id="iddle2139" class="indexterm"/><a id="iddle2155" class="indexterm"/><a id="iddle2160" class="indexterm"/><a id="iddle2537" class="indexterm"/><a id="iddle2564" class="indexterm"/><a id="iddle2568" class="indexterm"/><a id="iddle2731" class="indexterm"/>As the <code class="literal">Thread</code> object’s <code class="literal">start()</code> method is called and the new thread begins to run the code inside <code class="literal">downloadXkcd()</code>, the main thread will continue to the next iteration of the <code class="literal">for</code> loop and create the next thread.</p></div><div class="sect2" title="Step 3: Wait for All Threads to End"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_wait_for_all_threads_to_end"/>Step 3: Wait for All Threads to End</h2></div></div></div><p>The main thread moves on as normal while the other threads we create download comics. But say there’s some code you don’t want to run in the main thread until all the threads have completed. Calling a <code class="literal">Thread</code> object’s <code class="literal">join()</code> method will block until that thread has finished. By using a <code class="literal">for</code> loop to iterate over all the <code class="literal">Thread</code> objects in the <code class="literal">downloadThreads</code> list, the main thread can call the <code class="literal">join()</code> method on each of the other threads. Add the following to the bottom of your program:</p><a id="pro_id00552"/><pre class="programlisting">#! python3
# multidownloadXkcd.py - Downloads XKCD comics using multiple threads.

<span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># Wait for all threads to end.</strong></span>
<span class="strong"><strong>for downloadThread in downloadThreads:</strong></span>
    <span class="strong"><strong>downloadThread.join()</strong></span>
<span class="strong"><strong>print('Done.')</strong></span></pre><p>The <code class="literal">'Done.'</code> string will not be printed until all of the <code class="literal">join()</code> calls have returned. If a <code class="literal">Thread</code> object has already completed when its <code class="literal">join()</code> method is called, then the method will simply return immediately. If you wanted to extend this program with code that runs only after all of the comics downloaded, you could replace the <code class="literal">print('Done.')</code> line with your new code.</p></div></div><div class="sect1" title="Launching Other Programs from Python"><div class="titlepage"><div><div><h1 class="title"><a id="launching_other_programs_from_python"/>Launching Other Programs from Python</h1></div></div></div><p>Your Python program can start other programs on your computer with the <code class="literal">Popen()</code> function in the built-in <code class="literal">subprocess</code> module. (The <span class="emphasis"><em>P</em></span> in the name of the <code class="literal">Popen()</code> function stands for <span class="emphasis"><em>process</em></span>.) If you have multiple instances of an application open, each of those instances is a separate process of the same program. For example, if you open multiple windows of your web browser at the same time, each of those windows is a different process of the web browser program. See <a class="xref" href="ch15.html#six_running_processes_of_the_same_calcul" title="Figure 15-1. Six running processes of the same calculator program">Figure 15-1</a> for an example of multiple calculator processes open at once.</p><p>Every process can have multiple threads. Unlike threads, a process cannot directly read and write another process’s variables. If you think of a multithreaded program as having multiple fingers following source code, then having multiple processes of the same program open is like having a friend with a separate copy of the program’s source code. You are both independently executing the same program.</p><p>If you want to start an external program from your Python script, pass the program’s filename to <code class="literal">subprocess.Popen()</code>. (On Windows, right-click the application’s <span class="strong"><strong>Start</strong></span> menu item and select <span class="strong"><strong>Properties</strong></span> to view the application’s <a id="iddle1457" class="indexterm"/><a id="iddle1799" class="indexterm"/><a id="iddle1820" class="indexterm"/><a id="iddle2137" class="indexterm"/><a id="iddle2159" class="indexterm"/><a id="iddle2609" class="indexterm"/><a id="iddle2694" class="indexterm"/>filename. On OS X, <span class="smaller">CTRL</span>-click the application and select <span class="strong"><strong>Show Package Contents</strong></span> to find the path to the executable file.) The <code class="literal">Popen()</code> function will then immediately return. Keep in mind that the launched program is not run in the same thread as your Python program.</p><div class="figure"><a id="six_running_processes_of_the_same_calcul"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00077"/><img src="figs/web/15fig01.png.jpg" alt="Six running processes of the same calculator program"/></div></div><p class="title">Figure 15-1. Six running processes of the same calculator program</p></div><p>On a Windows computer, enter the following into the interactive shell:</p><a id="pro_id00553"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import subprocess</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen('C:\\Windows\\System32\\calc.exe')</strong></span>
&lt;subprocess.Popen object at 0x0000000003055A58&gt;</pre><p>On Ubuntu Linux, you would enter the following:</p><a id="pro_id00554"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import subprocess</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen('/usr/bin/gnome-calculator')</strong></span>
&lt;subprocess.Popen object at 0x7f2bcf93b20&gt;</pre><p>On OS X, the process is slightly different. See <a class="xref" href="ch15.html#opening_files_with_default_applications" title="Opening Files with Default Applications">Opening Files with Default Applications</a>.</p><p>The return value is a <code class="literal">Popen</code> object, which has two useful methods: <code class="literal">poll()</code> and <code class="literal">wait()</code>.</p><p>You can think of the <code class="literal">poll()</code> method as asking your friend if she’s finished running the code you gave her. The <code class="literal">poll()</code> method will return <code class="literal">None</code> if the process is still running at the time <code class="literal">poll()</code> is called. If the program has terminated, it will return the process’s integer <span class="emphasis"><em>exit code</em></span>. An exit code is used <a id="iddle1094" class="indexterm"/><a id="iddle1232" class="indexterm"/><a id="iddle1793" class="indexterm"/><a id="iddle1798" class="indexterm"/><a id="iddle1801" class="indexterm"/><a id="iddle1803" class="indexterm"/><a id="iddle1817" class="indexterm"/><a id="iddle2039" class="indexterm"/><a id="iddle2141" class="indexterm"/><a id="iddle2158" class="indexterm"/><a id="iddle2161" class="indexterm"/><a id="iddle2546" class="indexterm"/><a id="iddle2608" class="indexterm"/><a id="iddle2651" class="indexterm"/><a id="iddle2701" class="indexterm"/>to indicate whether the process terminated without errors (an exit code of <code class="literal">0</code>) or whether an error caused the process to terminate (a nonzero exit code—generally <code class="literal">1</code>, but it may vary depending on the program).</p><p>The <code class="literal">wait()</code> method is like waiting for your friend to finish working on her code before you keep working on yours. The <code class="literal">wait()</code> method will block until the launched process has terminated. This is helpful if you want your program to pause until the user finishes with the other program. The return value of <code class="literal">wait()</code> is the process’s integer exit code.</p><p>On Windows, enter the following into the interactive shell. Note that the <code class="literal">wait()</code> call will block until you quit the launched calculator program.</p><a id="pro_id00555"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>calcProc = subprocess.Popen('c:\\Windows\\System32\\calc.exe')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>calcProc.poll() == None</strong></span>
   True
➌ &gt;&gt;&gt; <span class="strong"><strong>calcProc.wait()</strong></span>
   0
   &gt;&gt;&gt; <span class="strong"><strong>calcProc.poll()</strong></span>
   0</pre><p>Here we open a calculator process ➊. While it’s still running, we check if <code class="literal">poll()</code> returns <code class="literal">None</code> ➋. It should, as the process is still running. Then we close the calculator program and call <code class="literal">wait()</code> on the terminated process ➌. <code class="literal">wait()</code> and <code class="literal">poll()</code> now return <code class="literal">0</code>, indicating that the process terminated without errors.</p><div class="sect2" title="Passing Command Line Arguments to Popen()"><div class="titlepage"><div><div><h2 class="title"><a id="passing_command_line_arguments_to_popenl"/>Passing Command Line Arguments to Popen()</h2></div></div></div><p>You can pass command line arguments to processes you create with <code class="literal">Popen()</code>. To do so, you pass a list as the sole argument to <code class="literal">Popen()</code>. The first string in this list will be the executable filename of the program you want to launch; all the subsequent strings will be the command line arguments to pass to the program when it starts. In effect, this list will be the value of <code class="literal">sys.argv</code> for the launched program.</p><p>Most applications with a graphical user interface (GUI) don’t use command line arguments as extensively as command line–based or terminal-based programs do. But most GUI applications will accept a single argument for a file that the applications will immediately open when they start. For example, if you’re using Windows, create a simple text file called <span class="emphasis"><em>C:\hello.txt</em></span> and then enter the following into the interactive shell:</p><a id="pro_id00556"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen(['C:\\Windows\\notepad.exe', 'C:\\hello.txt'])</strong></span>
&lt;subprocess.Popen object at 0x00000000032DCEB8&gt;</pre><p>This will not only launch the Notepad application but also have it immediately open the <span class="emphasis"><em>C:\hello.txt</em></span> file.</p></div><div class="sect2" title="Task Scheduler, launchd, and cron"><div class="titlepage"><div><div><h2 class="title"><a id="task_schedulercomma_launchdcomma_and_cro"/>Task Scheduler, launchd, and cron</h2></div></div></div><p>If you are computer savvy, you may know about Task Scheduler on Windows, launchd on OS X, or the cron scheduler on Linux. These well-documented <a id="iddle1795" class="indexterm"/><a id="iddle1796" class="indexterm"/><a id="iddle1800" class="indexterm"/><a id="iddle1802" class="indexterm"/><a id="iddle1822" class="indexterm"/><a id="iddle2020" class="indexterm"/><a id="iddle2025" class="indexterm"/><a id="iddle2042" class="indexterm"/><a id="iddle2140" class="indexterm"/><a id="iddle2156" class="indexterm"/><a id="iddle2157" class="indexterm"/><a id="iddle2381" class="indexterm"/><a id="iddle2396" class="indexterm"/><a id="iddle2438" class="indexterm"/><a id="iddle2470" class="indexterm"/><a id="iddle2610" class="indexterm"/><a id="iddle2658" class="indexterm"/><a id="iddle2685" class="indexterm"/><a id="iddle2696" class="indexterm"/>and reliable tools all allow you to schedule applications to launch at specific times. If you’d like to learn more about them, you can find links to tutorials at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><p>Using your operating system’s built-in scheduler saves you from writing your own clock-checking code to schedule your programs. However, use the <code class="literal">time.sleep()</code> function if you just need your program to pause briefly. Or instead of using the operating system’s scheduler, your code can loop until a certain date and time, calling <code class="literal">time.sleep(1)</code> each time through the loop.</p></div><div class="sect2" title="Opening Websites with Python"><div class="titlepage"><div><div><h2 class="title"><a id="opening_websites_with_python"/>Opening Websites with Python</h2></div></div></div><p>The <code class="literal">webbrowser.open()</code> function can launch a web browser from your program to a specific website, rather than opening the browser application with <code class="literal">subprocess.Popen()</code>. See <a class="xref" href="ch11.html#project_mapitdotpy_with_the_webbrowser_m" title="Project: mapit.py with the webbrowser Module">Project: mapit.py with the webbrowser Module</a> for more details.</p></div><div class="sect2" title="Running Other Python Scripts"><div class="titlepage"><div><div><h2 class="title"><a id="running_other_python_scripts"/>Running Other Python Scripts</h2></div></div></div><p>You can launch a Python script from Python just like any other application. You just have to pass the <span class="emphasis"><em>python.exe</em></span> executable to <code class="literal">Popen()</code> and the filename of the <span class="emphasis"><em>.py</em></span> script you want to run as its argument. For example, the following would run the <span class="emphasis"><em>hello.py</em></span> script from <a class="xref" href="ch01.html" title="Chapter 1. Python Basics">Chapter 1</a>:</p><a id="pro_id00557"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen(['C:\\python34\\python.exe', 'hello.py'])</strong></span>
&lt;subprocess.Popen object at 0x000000000331CF28&gt;</pre><p>Pass <code class="literal">Popen()</code> a list containing a string of the Python executable’s path and a string of the script’s filename. If the script you’re launching needs command line arguments, add them to the list after the script’s filename. The location of the Python executable on Windows is <span class="emphasis"><em>C:\python34\python.exe</em></span>. On OS X, it is <span class="emphasis"><em>/Library/Frameworks/Python.framework/Versions/3.3/bin/python3</em></span>. On Linux, it is <span class="emphasis"><em>/usr/bin/python3</em></span>.</p><p>Unlike importing the Python program as a module, when your Python program launches another Python program, the two are run in separate processes and will not be able to share each other’s variables.</p></div><div class="sect2" title="Opening Files with Default Applications"><div class="titlepage"><div><div><h2 class="title"><a id="opening_files_with_default_applications"/>Opening Files with Default Applications</h2></div></div></div><p>Double-clicking a <span class="emphasis"><em>.txt</em></span> file on your computer will automatically launch the application associated with the <span class="emphasis"><em>.txt</em></span> file extension. Your computer will have several of these file extension associations set up already. Python can also open files this way with <code class="literal">Popen()</code>.</p><p>Each operating system has a program that performs the equivalent of double-clicking a document file to open it. On Windows, this is the <code class="literal">start</code> program. On OS X, this is the <code class="literal">open</code> program. On Ubuntu Linux, this is the <code class="literal">see</code> program. Enter the following into the interactive shell, passing <code class="literal">'start'</code>, <code class="literal">'open'</code>, or <code class="literal">'see'</code> to <code class="literal">Popen()</code> depending on your system:</p><a id="pro_id00558"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>fileObj = open('hello.txt', 'w')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>fileObj.write('Hello world!')</strong></span>
12
&gt;&gt;&gt; <span class="strong"><strong>fileObj.close()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>import subprocess</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen(['<span class="emphasis"><em>start</em></span>', 'hello.txt'], shell=True)</strong></span></pre><p><a id="iddle1827" class="indexterm"/><a id="iddle2040" class="indexterm"/><a id="iddle2047" class="indexterm"/><a id="iddle2611" class="indexterm"/><a id="iddle2622" class="indexterm"/>Here we write <code class="literal">Hello world!</code> to a new <span class="emphasis"><em>hello.txt</em></span> file. Then we call <code class="literal">Popen()</code>, passing it a list containing the program name (in this example, <code class="literal">'start'</code> for Windows) and the filename. We also pass the <code class="literal">shell=True</code> keyword argument, which is needed only on Windows. The operating system knows all of the file associations and can figure out that it should launch, say, <span class="emphasis"><em>Notepad.exe</em></span> to handle the <span class="emphasis"><em>hello.txt</em></span> file.</p><p>On OS X, the <code class="literal">open</code> program is used for opening both document files and programs. Enter the following into the interactive shell if you have a Mac:</p><a id="pro_id00559"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>subprocess.Popen(['open', '/Applications/Calculator.app/'])</strong></span>
&lt;subprocess.Popen object at 0x10202ff98&gt;</pre><p>The Calculator app should open.</p><div class="sidebar"><a id="unix_philosophy"/><p class="title">The UNIX Philosophy</p><p>Programs well designed to be launched by other programs become more powerful than their code alone. The <span class="emphasis"><em>Unix philosophy</em></span> is a set of software design principles established by the programmers of the Unix operating system (on which the modern Linux and OS X are built). It says that it’s better to write small, limited-purpose programs that can interoperate, rather than large, feature-rich applications. The smaller programs are easier to understand, and by being interoperable, they can be the building blocks of much more powerful applications.</p><p>Smartphone apps follow this approach as well. If your restaurant app needs to display directions to a café, the developers didn’t reinvent the wheel by writing their own map code. The restaurant app simply launches a map app while passing it the café’s address, just as your Python code would call a function and pass it arguments.</p><p>The Python programs you’ve been writing in this book mostly fit the Unix philosophy, especially in one important way: They use command line arguments rather than <code class="literal">input()</code> function calls. If all the information your program needs can be supplied up front, it is preferable to have this information passed as command line arguments rather than waiting for the user to type it in. This way, the command line arguments can be entered by a human user or supplied by another program. This interoperable approach will make your programs reusable as part of another program.</p><p>The sole exception is that you don’t want passwords passed as command line arguments, since the command line may record them as part of its command history feature. Instead, your program should call the <code class="literal">input()</code> function when it needs you to enter a password.</p><p>You can read more about Unix philosophy at <span class="emphasis"><em><a class="ulink" href="https://en.wikipedia.org/wiki/Unix_philosophy/">https://en.wikipedia.org/wiki/Unix_philosophy/</a></em></span>.</p></div></div></div><div class="sect1" title="Project: Simple Countdown Program"><div class="titlepage"><div><div><h1 class="title"><a id="project_simple_countdown_program"/>Project: Simple Countdown Program</h1></div></div></div><p><a id="iddle1224" class="indexterm"/><a id="iddle1225" class="indexterm"/><a id="iddle1226" class="indexterm"/><a id="iddle1227" class="indexterm"/><a id="iddle1794" class="indexterm"/><a id="iddle2154" class="indexterm"/><a id="iddle2197" class="indexterm"/><a id="iddle2454" class="indexterm"/>Just like it’s hard to find a simple stopwatch application, it can be hard to find a simple countdown application. Let’s write a countdown program that plays an alarm at the end of the countdown.</p><p>At a high level, here’s what your program will do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Count down from 60.</p></li><li class="listitem"><p>Play a sound file (<span class="emphasis"><em>alarm.wav</em></span>) when the countdown reaches zero.</p></li></ul></div><p>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Pause for one second in between displaying each number in the countdown by calling <code class="literal">time.sleep()</code>.</p></li><li class="listitem"><p>Call <code class="literal">subprocess.Popen()</code> to open the sound file with the default application.</p></li></ul></div><p>Open a new file editor window and save it as <span class="emphasis"><em>countdown.py</em></span>.</p><div class="sect2" title="Step 1: Count Down"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_count_down"/>Step 1: Count Down</h2></div></div></div><p>This program will require the <code class="literal">time</code> module for the <code class="literal">time.sleep()</code> function and the <code class="literal">subprocess</code> module for the <code class="literal">subprocess.Popen()</code> function. Enter the following code and save the file as <span class="emphasis"><em>countdown.py</em></span>:</p><a id="pro_id00560"/><pre class="programlisting">   #! python3
   # countdown.py - A simple countdown script.

   import time, subprocess

➊ timeLeft = 60
   while timeLeft &gt; 0:
➋     print(timeLeft, end='')
➌     time.sleep(1)
➍     timeLeft = timeLeft - 1

   # TODO: At the end of the countdown, play a sound file.</pre><p>After importing <code class="literal">time</code> and <code class="literal">subprocess</code>, make a variable called <code class="literal">timeLeft</code> to hold the number of seconds left in the countdown ➊. It can start at 60—or you can change the value here to whatever you need or even have it get set from a command line argument.</p><p>In a <code class="literal">while</code> loop, you display the remaining count ➋, pause for one second ➌, and then decrement the <code class="literal">timeLeft</code> variable ➍ before the loop starts over again. The loop will keep looping as long as <code class="literal">timeLeft</code> is greater than <code class="literal">0</code>. After that, the countdown will be over.</p></div><div class="sect2" title="Step 2: Play the Sound File"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_play_the_sound_file"/>Step 2: Play the Sound File</h2></div></div></div><p>While there are third-party modules to play sound files of various formats, the quick and easy way is to just launch whatever application the user already uses to play sound files. The operating system will figure out from the <span class="emphasis"><em>.wav</em></span> file extension which application it should launch to play the file. This <span class="emphasis"><em>.wav</em></span> file could easily be some other sound file format, such as <span class="emphasis"><em>.mp3</em></span> or <span class="emphasis"><em>.ogg</em></span>.</p><p>You can use any sound file that is on your computer to play at the end of the countdown, or you can download <span class="emphasis"><em>alarm.wav</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p><p>Add the following to your code:</p><a id="pro_id00561"/><pre class="programlisting">#! python3
# countdown.py - A simple countdown script.

import time, subprocess

<span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># At the end of the countdown, play a sound file.</strong></span>
<span class="strong"><strong>subprocess.Popen(['start', 'alarm.wav'], shell=True)</strong></span></pre><p>After the <code class="literal">while</code> loop finishes, <span class="emphasis"><em>alarm.wav</em></span> (or the sound file you choose) will play to notify the user that the countdown is over. On Windows, be sure to include <code class="literal">'start'</code> in the list you pass to <code class="literal">Popen()</code> and pass the keyword argument <code class="literal">shell=True</code>. On OS X, pass <code class="literal">'open'</code> instead of <code class="literal">'start'</code> and remove <code class="literal">shell=True</code>.</p><p>Instead of playing a sound file, you could save a text file somewhere with a message like <span class="emphasis"><em>Break time is over!</em></span> and use <code class="literal">Popen()</code> to open it at the end of the countdown. This will effectively create a pop-up window with a message. Or you could use the <code class="literal">webbrowser.open()</code> function to open a specific website at the end of the countdown. Unlike some free countdown application you’d find online, your own countdown program’s alarm can be anything you want!</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00055"/>Ideas for Similar Programs</h2></div></div></div><p>A countdown is a simple delay before continuing the program’s execution. This can also be used for other applications and features, such as the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Use <code class="literal">time.sleep()</code> to give the user a chance to press <span class="smaller">CTRL</span>-C to cancel an action, such as deleting files. Your program can print a “Press <span class="smaller">CTRL</span>-C to cancel” message and then handle any <code class="literal">KeyboardInterrupt</code> exceptions with <code class="literal">try</code> and <code class="literal">except</code> statements.</p></li><li class="listitem"><p>For a long-term countdown, you can use <code class="literal">timedelta</code> objects to measure the number of days, hours, minutes, and seconds until some point (a birthday? an anniversary?) in the future.</p></li></ul></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00056"/>Summary</h1></div></div></div><p>The Unix epoch (January 1, 1970, at midnight, UTC) is a standard reference time for many programming languages, including Python. While the <code class="literal">time.time()</code> function module returns an epoch timestamp (that is, a float value of the number of seconds since the Unix epoch), the <code class="literal">datetime</code> module is better for performing date arithmetic and formatting or parsing strings with date information.</p><p>The <code class="literal">time.sleep()</code> function will block (that is, not return) for a certain number of seconds. It can be used to add pauses to your program. But if you want to schedule your programs to start at a certain time, the instructions at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> can tell you how to use the scheduler already provided by your operating system.</p><p>The <code class="literal">threading</code> module is used to create multiple threads, which is useful when you need to download multiple files or do other tasks simultaneously. But make sure the thread reads and writes only local variables, or you might run into concurrency issues.</p><p>Finally, your Python programs can launch other applications with the <code class="literal">subprocess.Popen()</code> function. Command line arguments can be passed to the <code class="literal">Popen()</code> call to open specific documents with the application. Alternatively, you can use the <code class="literal">start</code>, <code class="literal">open</code>, or <code class="literal">see</code> program with <code class="literal">Popen()</code> to use your computer’s file associations to automatically figure out which application to use to open a document. By using the other applications on your computer, your Python programs can leverage their capabilities for your automation needs.</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00057"/>Practice Questions</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch15qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe1"/><a id="ch15qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. What is the Unix epoch?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe2"/><a id="ch15qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. What function returns the number of seconds since the Unix epoch?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe3"/><a id="ch15qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. How can you pause your program for exactly 5 seconds?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe4"/><a id="ch15qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. What does the <code class="literal">round()</code> function return?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe5"/><a id="ch15qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. What is the difference between a <code class="literal">datetime</code> object and a <code class="literal">timedelta</code> object?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe6"/><a id="ch15qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. Say you have a function named <code class="literal">spam()</code>. How can you call this function and run the code inside it in a separate thread?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe7"/><a id="ch15qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. What should you do to avoid concurrency issues with multiple threads?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch15qa1qe8"/><a id="ch15qa1q8"/><p>Q:</p></td><td align="left" valign="top"><p>8. How can you have your Python program run the <span class="emphasis"><em>calc.exe</em></span> program located in the <span class="emphasis"><em>C:\Windows\System32</em></span> folder?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Projects"><div class="titlepage"><div><div><h1 class="title"><a id="practice_projects-id00058"/>Practice Projects</h1></div></div></div><p>For practice, write programs that do the following.</p><div class="sect2" title="Prettified Stopwatch"><div class="titlepage"><div><div><h2 class="title"><a id="prettified_stopwatch"/>Prettified Stopwatch</h2></div></div></div><p>Expand the stopwatch project from this chapter so that it uses the <code class="literal">rjust()</code> and <code class="literal">ljust()</code> string methods to “prettify” the output. (These methods were covered in <a class="xref" href="ch06.html" title="Chapter 6. Manipulating Strings">Chapter 6</a>.) Instead of output such as this:</p><a id="pro_id00562"/><pre class="programlisting">Lap #1: 3.56 (3.56)
Lap #2: 8.63 (5.07)
Lap #3: 17.68 (9.05)
Lap #4: 19.11 (1.43)</pre><p>... the output will look like this:</p><a id="pro_id00563"/><pre class="programlisting">Lap # 1:  3.56 (  3.56)
Lap # 2:  8.63 (  5.07)
Lap # 3: 17.68 (  9.05)
Lap # 4: 19.11 (  1.43)</pre><p>Note that you will need string versions of the <code class="literal">lapNum</code>, <code class="literal">lapTime</code>, and <code class="literal">totalTime</code> integer and float variables in order to call the string methods on them.</p><p>Next, use the <code class="literal">pyperclip</code> module introduced in <a class="xref" href="ch06.html" title="Chapter 6. Manipulating Strings">Chapter 6</a> to copy the text output to the clipboard so the user can quickly paste the output to a text file or email.</p></div><div class="sect2" title="Scheduled Web Comic Downloader"><div class="titlepage"><div><div><h2 class="title"><a id="scheduled_web_comic_downloader"/>Scheduled Web Comic Downloader</h2></div></div></div><p>Write a program that checks the websites of several web comics and automatically downloads the images if the comic was updated since the program’s last visit. Your operating system’s scheduler (Scheduled Tasks on Windows, launchd on OS X, and cron on Linux) can run your Python program once a day. The Python program itself can download the comic and then copy it to your desktop so that it is easy to find. This will free you from having to check the website yourself to see whether it has updated. (A list of web comics is available at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.)</p></div></div></div></body></html>
