<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 13. Working with PDF and word Documents</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 13. Working with PDF and word Documents"><div class="titlepage"><div><div><h1 class="title"><a id="working_with_pdf_and_word_documents"/>Chapter 13. Working with PDF and word Documents</h1></div></div></div><p><a id="iddle2095" class="indexterm"/><a id="iddle2250" class="indexterm"/>PDF and Word documents are binary files, which makes them much more complex than plaintext files. In addition to text, they store lots of font, color, and layout information. If you want your programs to read or write to PDFs or Word documents, you’ll need to do more than simply pass their filenames to <code class="literal">open()</code>.</p><p>Fortunately, there are Python modules that make it easy for you to interact with PDFs and Word documents. This chapter will cover two such modules: PyPDF2 and Python-Docx.</p><div class="sect1" title="PDF Documents"><div class="titlepage"><div><div><h1 class="title"><a id="pdf_documents"/>PDF Documents</h1></div></div></div><p><span class="emphasis"><em>PDF</em></span> stands for <span class="emphasis"><em>Portable Document Format</em></span> and uses the <span class="emphasis"><em>.pdf</em></span> file extension. Although PDFs support many features, this chapter will focus on the two things you’ll be doing most often with them: reading text content from PDFs and crafting new PDFs from existing documents.</p><p><a id="iddle2094" class="indexterm"/><a id="iddle2249" class="indexterm"/><a id="iddle2494" class="indexterm"/>The module you’ll use to work with PDFs is PyPDF2. To install it, run <code class="literal">pip install PyPDF2</code> from the command line. This module name is case sensitive, so make sure the <span class="emphasis"><em>y</em></span> is lowercase and everything else is uppercase. (Check out Appendix A for full details about installing third-party modules.) If the module was installed correctly, running <code class="literal">import PyPDF2</code> in the interactive shell shouldn’t display any errors.</p><div class="sidebar"><a id="problematic_pdf_format"/><p class="title">The Problematic PDF Format</p><p>While PDF files are great for laying out text in a way that’s easy for people to print and read, they’re not straightforward for software to parse into plaintext. As such, PyPDF2 might make mistakes when extracting text from a PDF and may even be unable to open some PDFs at all. There isn’t much you can do about this, unfortunately. PyPDF2 may simply be unable to work with some of your particular PDF files. That said, I haven’t found any PDF files so far that can’t be opened with PyPDF2.</p></div><div class="sect2" title="Extracting Text from PDFs"><div class="titlepage"><div><div><h2 class="title"><a id="extracting_text_from_pdfs"/>Extracting Text from PDFs</h2></div></div></div><p>PyPDF2 does not have a way to extract images, charts, or other media from PDF documents, but it can extract text and return it as a Python string. To start learning how PyPDF2 works, we’ll use it on the example PDF shown in <a class="xref" href="ch13.html#pdf_page_that_we_will_be_extracting_text" title="Figure 13-1. The PDF page that we will be extracting text from">Figure 13-1</a>.</p><div class="figure"><a id="pdf_page_that_we_will_be_extracting_text"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00065"/><img src="figs/web/13fig01.png.jpg" alt="The PDF page that we will be extracting text from"/></div></div><p class="title">Figure 13-1. The PDF page that we will be extracting text from</p></div><p><a id="iddle1299" class="indexterm"/><a id="iddle2053" class="indexterm"/><a id="iddle2084" class="indexterm"/><a id="iddle2092" class="indexterm"/><a id="iddle2247" class="indexterm"/>Download this PDF from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>, and enter the following into the interactive shell:</p><a id="pro_id00483"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import PyPDF2</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfFileObj = open('meetingminutes.pdf', 'rb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfReader = PyPDF2.PdfFileReader(pdfFileObj)</strong></span>
➊ &gt;&gt;&gt; pdfReader.numPages
   19
➋ &gt;&gt;&gt; <span class="strong"><strong>pageObj = pdfReader.getPage(0)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>pageObj.extractText()</strong></span>
   'OOFFFFIICCIIAALL BBOOAARRDD MMIINNUUTTEESS Meeting of March 7, 2015
   \n     The Board of Elementary and Secondary Education shall provide leadership
   and create policies for education that expand opportunities for children,
   empower families and communities, and advance Louisiana in an increasingly
   competitive global market. BOARD of ELEMENTARY and SECONDARY EDUCATION '</pre><p>First, import the <code class="literal">PyPDF2</code> module. Then open <span class="emphasis"><em>meetingminutes.pdf</em></span> in read binary mode and store it in <code class="literal">pdfFileObj</code>. To get a <code class="literal">PdfFileReader</code> object that represents this PDF, call <code class="literal">PyPDF2.PdfFileReader()</code> and pass it <code class="literal">pdfFileObj</code>. Store this <code class="literal">PdfFileReader</code> object in <code class="literal">pdfReader</code>.</p><p>The total number of pages in the document is stored in the <code class="literal">numPages</code> attribute of a <code class="literal">PdfFileReader</code> object ➊. The example PDF has 19 pages, but let’s extract text from only the first page.</p><p>To extract text from a page, you need to get a <code class="literal">Page</code> object, which represents a single page of a PDF, from a <code class="literal">PdfFileReader</code> object. You can get a <code class="literal">Page</code> object by calling the <code class="literal">getPage()</code> method ➋ on a <code class="literal">PdfFileReader</code> object and passing it the page number of the page you’re interested in—in our case, 0.</p><p>PyPDF2 uses a <span class="emphasis"><em>zero-based index</em></span> for getting pages: The first page is page 0, the second is <a class="xref" href="pr05.html" title="Introduction">Introduction</a>, and so on. This is always the case, even if pages are numbered differently within the document. For example, say your PDF is a three-page excerpt from a longer report, and its pages are numbered 42, 43, and 44. To get the first page of this document, you would want to call <code class="literal">pdfReader.getPage(0)</code>, not <code class="literal">getPage(42)</code> or <code class="literal">getPage(1)</code>.</p><p>Once you have your <code class="literal">Page</code> object, call its <code class="literal">extractText()</code> method to return a string of the page’s text ➌. The text extraction isn’t perfect: The text <span class="emphasis"><em>Charles E. “Chas” Roemer, President</em></span> from the PDF is absent from the string returned by <code class="literal">extractText()</code>, and the spacing is sometimes off. Still, this approximation of the PDF text content may be good enough for your program.</p></div><div class="sect2" title="Decrypting PDFs"><div class="titlepage"><div><div><h2 class="title"><a id="decrypting_pdfs"/>Decrypting PDFs</h2></div></div></div><p>Some PDF documents have an encryption feature that will keep them from being read until whoever is opening the document provides a password. Enter the following into the interactive shell with the PDF you downloaded, which has been encrypted with the password <span class="emphasis"><em>rosebud</em></span>:</p><a id="pro_id00484"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import PyPDF2</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfReader = PyPDF2.PdfFileReader(open('encrypted.pdf', 'rb'))</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>pdfReader.isEncrypted</strong></span>
   True
   &gt;&gt;&gt; <span class="strong"><strong>pdfReader.getPage(0)</strong></span>
➋ Traceback (most recent call last):
     File "&lt;pyshell#173&gt;", line 1, in &lt;module&gt;
       pdfReader.getPage()
     <span class="emphasis"><em>--snip--</em></span>
     File "C:\Python34\lib\site-packages\PyPDF2\pdf.py", line 1173, in getObject
       raise utils.PdfReadError("file has not been decrypted")
   PyPDF2.utils.PdfReadError: file has not been decrypted
➌ &gt;&gt;&gt; <span class="strong"><strong>pdfReader.decrypt('rosebud')</strong></span>
   1
   &gt;&gt;&gt; <span class="strong"><strong>pageObj = pdfReader.getPage(0)</strong></span></pre><p><a id="iddle2091" class="indexterm"/><a id="iddle2099" class="indexterm"/><a id="iddle2246" class="indexterm"/>All <code class="literal">PdfFileReader</code> objects have an <code class="literal">isEncrypted</code> attribute that is <code class="literal">True</code> if the PDF is encrypted and <code class="literal">False</code> if it isn’t ➊. Any attempt to call a function that reads the file before it has been decrypted with the correct password will result in an error ➋.</p><p>To read an encrypted PDF, call the <code class="literal">decrypt()</code> function and pass the password as a string ➌. After you call <code class="literal">decrypt()</code> with the correct password, you’ll see that calling <code class="literal">getPage()</code> no longer causes an error. If given the wrong password, the <code class="literal">decrypt()</code> function will return <code class="literal">0</code> and <code class="literal">getPage()</code> will continue to fail. Note that the <code class="literal">decrypt()</code> method decrypts only the <code class="literal">PdfFileReader</code> object, not the actual PDF file. After your program terminates, the file on your hard drive remains encrypted. Your program will have to call <code class="literal">decrypt()</code> again the next time it is run.</p></div><div class="sect2" title="Creating PDFs"><div class="titlepage"><div><div><h2 class="title"><a id="creating_pdfs"/>Creating PDFs</h2></div></div></div><p>PyPDF2’s counterpart to <code class="literal">PdfFileReader</code> objects is <code class="literal">PdfFileWriter</code> objects, which can create new PDF files. But PyPDF2 cannot write arbitrary text to a PDF like Python can do with plaintext files. Instead, PyPDF2’s PDF-writing capabilities are limited to copying pages from other PDFs, rotating pages, overlaying pages, and encrypting files.</p><p>PyPDF2 doesn’t allow you to directly edit a PDF. Instead, you have to create a new PDF and then copy content over from an existing document. The examples in this section will follow this general approach:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Open one or more existing PDFs (the source PDFs) into <code class="literal">PdfFileReader</code> objects.</p></li><li class="listitem"><p>Create a new <code class="literal">PdfFileWriter</code> object.</p></li><li class="listitem"><p>Copy pages from the <code class="literal">PdfFileReader</code> objects into the <code class="literal">PdfFileWriter</code> object.</p></li><li class="listitem"><p>Finally, use the <code class="literal">PdfFileWriter</code> object to write the output PDF.</p></li></ol></div><p>Creating a <code class="literal">PdfFileWriter</code> object creates only a value that represents a PDF document in Python. It doesn’t create the actual PDF file. For that, you must call the PdfFileWriter’s <code class="literal">write()</code> method.</p><p><a id="iddle1077" class="indexterm"/><a id="iddle2096" class="indexterm"/><a id="iddle2251" class="indexterm"/>The <code class="literal">write()</code> method takes a regular <code class="literal">File</code> object that has been opened in <span class="emphasis"><em>write-binary</em></span> mode. You can get such a <code class="literal">File</code> object by calling Python’s <code class="literal">open()</code> function with two arguments: the string of what you want the PDF’s filename to be and <code class="literal">'wb'</code> to indicate the file should be opened in write-binary mode.</p><p>If this sounds a little confusing, don’t worry—you’ll see how this works in the following code examples.</p><div class="sect3" title="Copying Pages"><div class="titlepage"><div><div><h3 class="title"><a id="copying_pages"/>Copying Pages</h3></div></div></div><p>You can use PyPDF2 to copy pages from one PDF document to another. This allows you to combine multiple PDF files, cut unwanted pages, or reorder pages.</p><p>Download <span class="emphasis"><em>meetingminutes.pdf</em></span> and <span class="emphasis"><em>meetingminutes2.pdf</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> and place the PDFs in the current working directory. Enter the following into the interactive shell:</p><a id="pro_id00485"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import PyPDF2</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdf1File = open('meetingminutes.pdf', 'rb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdf2File = open('meetingminutes2.pdf', 'rb')</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>pdf1Reader = PyPDF2.PdfFileReader(pdf1File)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>pdf2Reader = PyPDF2.PdfFileReader(pdf2File)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>pdfWriter = PyPDF2.PdfFileWriter()</strong></span>

   &gt;&gt;&gt; <span class="strong"><strong>for pageNum in range(pdf1Reader.numPages):</strong></span>
➍         <span class="strong"><strong>pageObj = pdf1Reader.getPage(pageNum)</strong></span>
➎         <span class="strong"><strong>pdfWriter.addPage(pageObj)</strong></span>

   &gt;&gt;&gt; <span class="strong"><strong>for pageNum in range(pdf2Reader.numPages):</strong></span>
➏         <span class="strong"><strong>pageObj = pdf2Reader.getPage(pageNum)</strong></span>
➐         <span class="strong"><strong>pdfWriter.addPage(pageObj)</strong></span>

➑ &gt;&gt;&gt; <span class="strong"><strong>pdfOutputFile = open('combinedminutes.pdf', 'wb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter.write(pdfOutputFile)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfOutputFile.close()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdf1File.close()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdf2File.close()</strong></span></pre><p>Open both PDF files in read binary mode and store the two resulting <code class="literal">File</code> objects in <code class="literal">pdf1File</code> and <code class="literal">pdf2File</code>. Call <code class="literal">PyPDF2.PdfFileReader()</code> and pass it <code class="literal">pdf1File</code> to get a <code class="literal">PdfFileReader</code> object for <span class="emphasis"><em>meetingminutes.pdf</em></span> ➊. Call it again and pass it <code class="literal">pdf2File</code> to get a <code class="literal">PdfFileReader</code> object for <span class="emphasis"><em>meetingminutes2.pdf</em></span> ➋. Then create a new <code class="literal">PdfFileWriter</code> object, which represents a blank PDF document ➌.</p><p>Next, copy all the pages from the two source PDFs and add them to the <code class="literal">PdfFileWriter</code> object. Get the <code class="literal">Page</code> object by calling <code class="literal">getPage()</code> on a <code class="literal">PdfFileReader</code> object ➍. Then pass that <code class="literal">Page</code> object to your PdfFileWriter’s <code class="literal">addPage()</code> method ➎. These steps are done first for <code class="literal">pdf1Reader</code> and then <a id="iddle2098" class="indexterm"/><a id="iddle2253" class="indexterm"/><a id="iddle2355" class="indexterm"/><a id="iddle2356" class="indexterm"/>again for <code class="literal">pdf2Reader</code>. When you’re done copying pages, write a new PDF called <span class="emphasis"><em>combinedminutes.pdf</em></span> by passing a <code class="literal">File</code> object to the PdfFileWriter’s <code class="literal">write()</code> method ➏.</p><div class="note" title="Note"><h3 class="title"><a id="ch13note01"/>Note</h3><p><span class="emphasis"><em>PyPDF2 cannot insert pages in the middle of a</em></span> <span class="emphasis"><em><code class="literal">PdfFileWriter</code></em></span> <span class="emphasis"><em>object; the</em></span> <span class="emphasis"><em><code class="literal">addPage()</code></em></span> <span class="emphasis"><em>method will only add pages to the end.</em></span></p></div><p>You have now created a new PDF file that combines the pages from <span class="emphasis"><em>meetingminutes.pdf</em></span> and <span class="emphasis"><em>meetingminutes2.pdf</em></span> into a single document. Remember that the <code class="literal">File</code> object passed to <code class="literal">PyPDF2.PdfFileReader()</code> needs to be opened in read-binary mode by passing <code class="literal">'rb'</code> as the second argument to <code class="literal">open()</code>. Likewise, the <code class="literal">File</code> object passed to <code class="literal">PyPDF2.PdfFileWriter()</code> needs to be opened in write-binary mode with <code class="literal">'wb'</code>.</p></div><div class="sect3" title="Rotating Pages"><div class="titlepage"><div><div><h3 class="title"><a id="rotating_pages"/>Rotating Pages</h3></div></div></div><p>The pages of a PDF can also be rotated in 90-degree increments with the <code class="literal">rotateClockwise()</code> and <code class="literal">rotateCounterClockwise()</code> methods. Pass one of the integers <code class="literal">90</code>, <code class="literal">180</code>, or <code class="literal">270</code> to these methods. Enter the following into the interactive shell, with the <span class="emphasis"><em>meetingminutes.pdf</em></span> file in the current working directory:</p><a id="pro_id00486"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import PyPDF2</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>minutesFile = open('meetingminutes.pdf', 'rb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfReader = PyPDF2.PdfFileReader(minutesFile)</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>page = pdfReader.getPage(0)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>page.rotateClockwise(90)</strong></span>
   {'/Contents': [IndirectObject(961, 0), IndirectObject(962, 0),
   <span class="emphasis"><em>--snip--</em></span>
   }
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter = PyPDF2.PdfFileWriter()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter.addPage(page)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>resultPdfFile = open('rotatedPage.pdf', 'wb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter.write(resultPdfFile)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>resultPdfFile.close()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>minutesFile.close()</strong></span></pre><p>Here we use <code class="literal">getPage(0)</code> to select the first page of the PDF ➊, and then we call <code class="literal">rotateClockwise(90)</code> on that page ➋. We write a new PDF with the rotated page and save it as <span class="emphasis"><em>rotatedPage.pdf</em></span> ➌.</p><p>The resulting PDF will have one page, rotated 90 degrees clockwise, as in <a class="xref" href="ch13.html#rotatedpage_dotpdf_file_with_the_page_ro" title="Figure 13-2. The rotatedPage.pdf file with the page rotated 90 degrees clockwise">Figure 13-2</a>. The return values from <code class="literal">rotateClockwise()</code> and <code class="literal">rotateCounterClockwise()</code> contain a lot of information that you can ignore.</p><div class="figure"><a id="rotatedpage_dotpdf_file_with_the_page_ro"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00066"/><img src="figs/web/13fig02.png.jpg" alt="The rotatedPage.pdf file with the page rotated 90 degrees clockwise"/></div></div><p class="title">Figure 13-2. The <span class="emphasis"><em>rotatedPage.pdf</em></span> file with the page rotated 90 degrees clockwise</p></div></div><div class="sect3" title="Overlaying Pages"><div class="titlepage"><div><div><h3 class="title"><a id="overlaying_pages"/>Overlaying Pages</h3></div></div></div><p><a id="iddle2097" class="indexterm"/><a id="iddle2252" class="indexterm"/>PyPDF2 can also overlay the contents of one page over another, which is useful for adding a logo, timestamp, or watermark to a page. With Python, it’s easy to add watermarks to multiple files and only to pages your program specifies.</p><p>Download <span class="emphasis"><em>watermark.pdf</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> and place the PDF in the current working directory along with <span class="emphasis"><em>meetingminutes.pdf</em></span>. Then enter the following into the interactive shell:</p><a id="pro_id00487"/><pre class="programlisting">   &gt;&gt;&gt; import PyPDF2
   &gt;&gt;&gt; minutesFile = open('meetingminutes.pdf', 'rb')
➋ &gt;&gt;&gt; pdfReader = PyPDF2.PdfFileReader(minutesFile)
➋ &gt;&gt;&gt; minutesFirstPage = pdfReader.getPage(0)
➌ &gt;&gt;&gt; pdfWatermarkReader = PyPDF2.PdfFileReader(open('watermark.pdf', 'rb'))
➍ &gt;&gt;&gt; minutesFirstPage.mergePage(pdfWatermarkReader.getPage(0))
➎ &gt;&gt;&gt; pdfWriter = PyPDF2.PdfFileWriter()
➏ &gt;&gt;&gt; pdfWriter.addPage(minutesFirstPage)

➐ &gt;&gt;&gt; for pageNum in range(1, pdfReader.numPages):
           pageObj = pdfReader.getPage(pageNum)
           pdfWriter.addPage(pageObj)
   &gt;&gt;&gt; resultPdfFile = open('watermarkedCover.pdf', 'wb')
   &gt;&gt;&gt; pdfWriter.write(resultPdfFile)
   &gt;&gt;&gt; minutesFile.close()
   &gt;&gt;&gt; resultPdfFile.close()</pre><p><a id="iddle1406" class="indexterm"/><a id="iddle1907" class="indexterm"/><a id="iddle2093" class="indexterm"/><a id="iddle2248" class="indexterm"/>Here we make a <code class="literal">PdfFileReader</code> object of <span class="emphasis"><em>meetingminutes.pdf</em></span> ➊. We call <code class="literal">getPage(0)</code> to get a <code class="literal">Page</code> object for the first page and store this object in <code class="literal">minutesFirstPage</code> ➋. We then make a <code class="literal">PdfFileReader</code> object for <span class="emphasis"><em>watermark.pdf</em></span> ➌ and call <code class="literal">mergePage()</code> on <code class="literal">minutesFirstPage</code> ➍. The argument we pass to <code class="literal">mergePage()</code> is a <code class="literal">Page</code> object for the first page of <span class="emphasis"><em>watermark.pdf</em></span>.</p><p>Now that we’ve called <code class="literal">mergePage()</code> on <code class="literal">minutesFirstPage</code>, <code class="literal">minutesFirstPage</code> represents the watermarked first page. We make a <code class="literal">PdfFileWriter</code> object ➎ and add the watermarked first page ➏. Then we loop through the rest of the pages in <span class="emphasis"><em>meetingminutes.pdf</em></span> and add them to the <code class="literal">PdfFileWriter</code> object ➐. Finally, we open a new PDF called <span class="emphasis"><em>watermarkedCover.pdf</em></span> and write the contents of the PdfFileWriter to the new PDF.</p><p><a class="xref" href="ch13.html#original_pdf_left_parenthesisleftright_p" title="Figure 13-3. The original PDF (left), the watermark PDF (center), and the merged PDF (right)">Figure 13-3</a> shows the results. Our new PDF, <span class="emphasis"><em>watermarkedCover.pdf</em></span>, has all the contents of the <span class="emphasis"><em>meetingminutes.pdf</em></span>, and the first page is watermarked.</p><div class="figure"><a id="original_pdf_left_parenthesisleftright_p"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00067"/><img src="figs/web/13fig03.png.jpg" alt="The original PDF (left), the watermark PDF (center), and the merged PDF (right)"/></div></div><p class="title">Figure 13-3. The original PDF (left), the watermark PDF (center), and the merged PDF (right)</p></div></div><div class="sect3" title="Encrypting PDFs"><div class="titlepage"><div><div><h3 class="title"><a id="encrypting_pdfs"/>Encrypting PDFs</h3></div></div></div><p>A <code class="literal">PdfFileWriter</code> object can also add encryption to a PDF document. Enter the following into the interactive shell:</p><a id="pro_id00488"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import PyPDF2</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfFile = open('meetingminutes.pdf', 'rb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfReader = PyPDF2.PdfFileReader(pdfFile)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter = PyPDF2.PdfFileWriter()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>for pageNum in range(pdfReader.numPages):</strong></span>
           <span class="strong"><strong>pdfWriter.addPage(pdfReader.getPage(pageNum))</strong></span>

➊ &gt;&gt;&gt; <span class="strong"><strong>pdfWriter.encrypt('swordfish')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>resultPdf = open('encryptedminutes.pdf', 'wb')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>pdfWriter.write(resultPdf)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>resultPdf.close()</strong></span></pre><p><a id="iddle2085" class="indexterm"/><a id="iddle2086" class="indexterm"/><a id="iddle2089" class="indexterm"/><a id="iddle2181" class="indexterm"/><a id="iddle2245" class="indexterm"/>Before calling the <code class="literal">write()</code> method to save to a file, call the <code class="literal">encrypt()</code> method and pass it a password string ➊. PDFs can have a <span class="emphasis"><em>user password</em></span> (allowing you to view the PDF) and an <span class="emphasis"><em>owner password</em></span> (allowing you to set permissions for printing, commenting, extracting text, and other features). The user password and owner password are the first and second arguments to <code class="literal">encrypt()</code>, respectively. If only one string argument is passed to <code class="literal">encrypt()</code>, it will be used for both passwords.</p><p>In this example, we copied the pages of <span class="emphasis"><em>meetingminutes.pdf</em></span> to a <code class="literal">PdfFileWriter</code> object. We encrypted the PdfFileWriter with the password <span class="emphasis"><em>swordfish</em></span>, opened a new PDF called <span class="emphasis"><em>encryptedminutes.pdf</em></span>, and wrote the contents of the PdfFileWriter to the new PDF. Before anyone can view <span class="emphasis"><em>encryptedminutes.pdf</em></span>, they’ll have to enter this password. You may want to delete the original, unencrypted <span class="emphasis"><em>meetingminutes.pdf</em></span> file after ensuring its copy was correctly encrypted.</p></div></div></div><div class="sect1" title="Project: Combining Select Pages from Many PDFs"><div class="titlepage"><div><div><h1 class="title"><a id="project_combining_select_pages_from_many"/>Project: Combining Select Pages from Many PDFs</h1></div></div></div><p>Say you have the boring job of merging several dozen PDF documents into a single PDF file. Each of them has a cover sheet as the first page, but you don’t want the cover sheet repeated in the final result. Even though there are lots of free programs for combining PDFs, many of them simply merge entire files together. Let’s write a Python program to customize which pages you want in the combined PDF.</p><p>At a high level, here’s what the program will do:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Find all PDF files in the current working directory.</p></li><li class="listitem"><p>Sort the filenames so the PDFs are added in order.</p></li><li class="listitem"><p>Write each page, excluding the first page, of each PDF to the output file.</p><p>In terms of implementation, your code will need to do the following:</p></li><li class="listitem"><p>Call <code class="literal">os.listdir()</code> to find all the files in the working directory and remove any non-PDF files.</p></li><li class="listitem"><p>Call Python’s <code class="literal">sort()</code> list method to alphabetize the filenames.</p></li><li class="listitem"><p>Create a <code class="literal">PdfFileWriter</code> object for the output PDF.</p></li><li class="listitem"><p>Loop over each PDF file, creating a <code class="literal">PdfFileReader</code> object for it.</p></li><li class="listitem"><p>Loop over each page (except the first) in each PDF file.</p></li><li class="listitem"><p>Add the pages to the output PDF.</p></li><li class="listitem"><p>Write the output PDF to a file named <span class="emphasis"><em>allminutes.pdf</em></span>.</p></li></ul></div><p>For this project, open a new file editor window and save it as <span class="emphasis"><em>combinePdfs.py</em></span>.</p><div class="sect2" title="Step 1: Find All PDF Files"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_find_all_pdf_files"/>Step 1: Find All PDF Files</h2></div></div></div><p><a id="iddle2087" class="indexterm"/><a id="iddle2088" class="indexterm"/>First, your program needs to get a list of all files with the <span class="emphasis"><em>.pdf</em></span> extension in the current working directory and sort them. Make your code look like the following:</p><a id="pro_id00489"/><pre class="programlisting">   #! python3
   # combinePdfs.py - Combines all the PDFs in the current working directory into
   # into a single PDF.

➊ import PyPDF2, os

   # Get all the PDF filenames.
   pdfFiles = []
   for filename in os.listdir('.'):
       if filename.endswith('.pdf'):
➋         pdfFiles.append(filename)
➌ pdfFiles.sort(key = str.lower)

➍ pdfWriter = PyPDF2.PdfFileWriter()

   # TODO: Loop through all the PDF files.

   # TODO: Loop through all the pages (except the first) and add them.

   # TODO: Save the resulting PDF to a file.</pre><p>After the shebang line and the descriptive comment about what the program does, this code imports the <code class="literal">os</code> and <code class="literal">PyPDF2</code> modules ➊. The <code class="literal">os.listdir('.')</code> call will return a list of every file in the current working directory. The code loops over this list and adds only those files with the <span class="emphasis"><em>.pdf</em></span> extension to <code class="literal">pdfFiles</code> ➋. Afterward, this list is sorted in alphabetical order with the <code class="literal">key = str.lower</code> keyword argument to <code class="literal">sort()</code> ➌.</p><p>A <code class="literal">PdfFileWriter</code> object is created to hold the combined PDF pages ➍. Finally, a few comments outline the rest of the program.</p></div><div class="sect2" title="Step 2: Open Each PDF"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_open_each_pdf"/>Step 2: Open Each PDF</h2></div></div></div><p>Now the program must read each PDF file in <code class="literal">pdfFiles</code>. Add the following to your program:</p><a id="pro_id00490"/><pre class="programlisting">#! python3
# combinePdfs.py - Combines all the PDFs in the current working directory into
# a single PDF.

import PyPDF2, os

# Get all the PDF filenames.
pdfFiles = []
<span class="emphasis"><em>--snip--</em></span>
# <span class="strong"><strong>Loop through all the PDF files.</strong></span>
<span class="strong"><strong>for filename in pdfFiles:</strong></span>
    <span class="strong"><strong>pdfFileObj = open(filename, 'rb')</strong></span>
    <span class="strong"><strong>pdfReader = PyPDF2.PdfFileReader(pdfFileObj)</strong></span>
    # TODO: Loop through all the pages (except the first) and add them.

# TODO: Save the resulting PDF to a file.</pre><p><a id="iddle2090" class="indexterm"/>For each PDF, the loop opens a filename in read-binary mode by calling <code class="literal">open()</code> with <code class="literal">'rb'</code> as the second argument. The <code class="literal">open()</code> call returns a <code class="literal">File</code> object, which gets passed to <code class="literal">PyPDF2.PdfFileReader()</code> to create a <code class="literal">PdfFileReader</code> object for that PDF file.</p></div><div class="sect2" title="Step 3: Add Each Page"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_add_each_page"/>Step 3: Add Each Page</h2></div></div></div><p>For each PDF, you’ll want to loop over every page except the first. Add this code to your program:</p><a id="pro_id00491"/><pre class="programlisting">   #! python3
   # combinePdfs.py - Combines all the PDFs in the current working directory into
   # a single PDF.

   import PyPDF2, os

   <span class="emphasis"><em>--snip--</em></span>

   # Loop through all the PDF files.
   for filename in pdfFiles:
   <span class="emphasis"><em>--snip--</em></span>
       <span class="strong"><strong># Loop through all the pages (except the first) and add them.</strong></span>
➊     <span class="strong"><strong>for pageNum in range(1, pdfReader.numPages):</strong></span>
           <span class="strong"><strong>pageObj = pdfReader.getPage(pageNum)</strong></span>
           <span class="strong"><strong>pdfWriter.addPage(pageObj)</strong></span>

   # TODO: Save the resulting PDF to a file.</pre><p>The code inside the <code class="literal">for</code> loop copies each <code class="literal">Page</code> object individually to the <code class="literal">PdfFileWriter</code> object. Remember, you want to skip the first page. Since PyPDF2 considers <code class="literal">0</code> to be the first page, your loop should start at <code class="literal">1</code> ➊ and then go up to, but not include, the integer in <code class="literal">pdfReader.numPages</code>.</p></div><div class="sect2" title="Step 4: Save the Results"><div class="titlepage"><div><div><h2 class="title"><a id="step_4_save_the_results"/>Step 4: Save the Results</h2></div></div></div><p>After these nested <code class="literal">for</code> loops are done looping, the <code class="literal">pdfWriter</code> variable will contain a <code class="literal">PdfFileWriter</code> object with the pages for all the PDFs combined. The last step is to write this content to a file on the hard drive. Add this code to your program:</p><a id="pro_id00492"/><pre class="programlisting">#! python3
# combinePdfs.py - Combines all the PDFs in the current working directory into
# a single PDF.
import PyPDF2, os

<span class="emphasis"><em>--snip--</em></span>

# Loop through all the PDF files.
for filename in pdfFiles:
<span class="emphasis"><em>--snip--</em></span>
    # Loop through all the pages (except the first) and add them.
    for pageNum in range(1, pdfReader.numPages):
    <span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># Save the resulting PDF to a file.</strong></span>
<span class="strong"><strong>pdfOutput = open('allminutes.pdf', 'wb')</strong></span>
<span class="strong"><strong>pdfWriter.write(pdfOutput)</strong></span>
<span class="strong"><strong>pdfOutput.close()</strong></span></pre><p><a id="iddle1810" class="indexterm"/><a id="iddle2024" class="indexterm"/><a id="iddle2266" class="indexterm"/><a id="iddle2704" class="indexterm"/><a id="iddle2708" class="indexterm"/>Passing <code class="literal">'wb'</code> to <code class="literal">open()</code> opens the output PDF file, <span class="emphasis"><em>allminutes.pdf</em></span>, in write-binary mode. Then, passing the resulting <code class="literal">File</code> object to the <code class="literal">write()</code> method creates the actual PDF file. A call to the <code class="literal">close()</code> method finishes the program.</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00045"/>Ideas for Similar Programs</h2></div></div></div><p>Being able to create PDFs from the pages of other PDFs will let you make programs that can do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Cut out specific pages from PDFs.</p></li><li class="listitem"><p>Reorder pages in a PDF.</p></li><li class="listitem"><p>Create a PDF from only those pages that have some specific text, identified by <code class="literal">extractText()</code>.</p></li></ul></div></div></div><div class="sect1" title="Word Documents"><div class="titlepage"><div><div><h1 class="title"><a id="word_documents"/>Word Documents</h1></div></div></div><p>Python can create and modify Word documents, which have the <span class="emphasis"><em>.docx</em></span> file extension, with the <code class="literal">python-docx</code> module. You can install the module by running <code class="literal">pip install python-docx</code>. (Appendix A has full details on installing third-party modules.)</p><div class="note" title="Note"><h3 class="title"><a id="ch13note02"/>Note</h3><p><span class="emphasis"><em>When using pip to first install Python-Docx, be sure to install <code class="literal">python-docx</code>, not <code class="literal">docx</code>. The installation name <code class="literal">docx</code> is for a different module that this book does not cover. However, when you are going to import the <code class="literal">python-docx</code> module, you’ll need to run <code class="literal">import docx</code>, not <code class="literal">import python-docx</code>.</em></span></p></div><p>If you don’t have Word, LibreOffice Writer and OpenOffice Writer are both free alternative applications for Windows, OS X, and Linux that can be used to open <span class="emphasis"><em>.docx</em></span> files. You can download them from <span class="emphasis"><em><a class="ulink" href="https://www.libreoffice.org">https://www.libreoffice.org</a></em></span> and <span class="emphasis"><em><a class="ulink" href="http://openoffice.org">http://openoffice.org</a></em></span>, respectively. The full documentation for Python-Docx is available at <span class="emphasis"><em><a class="ulink" href="https://python-docx.readthedocs.org/">https://python-docx.readthedocs.org/</a></em></span>. Although there is a version of Word for OS X, this chapter will focus on Word for Windows.</p><p><a id="iddle1342" class="indexterm"/><a id="iddle1804" class="indexterm"/><a id="iddle2054" class="indexterm"/><a id="iddle2709" class="indexterm"/>Compared to plaintext, <span class="emphasis"><em>.docx</em></span> files have a lot of structure. This structure is represented by three different data types in Python-Docx. At the highest level, a <code class="literal">Document</code> object represents the entire document. The <code class="literal">Document</code> object contains a list of <code class="literal">Paragraph</code> objects for the paragraphs in the document. (A new paragraph begins whenever the user presses <span class="smaller">ENTER</span> or <span class="smaller">RETURN</span> while typing in a Word document.) Each of these <code class="literal">Paragraph</code> objects contains a list of one or more <code class="literal">Run</code> objects. The single-sentence paragraph in <a class="xref" href="ch13.html#run_objects_identified_in_a_paragraph_ob" title="Figure 13-4. The Run objects identified in a Paragraph object">Figure 13-4</a> has four runs.</p><div class="figure"><a id="run_objects_identified_in_a_paragraph_ob"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00068"/><img src="figs/web/13fig04.png" alt="The Run objects identified in a Paragraph object"/></div></div><p class="title">Figure 13-4. The <code class="literal">Run</code> objects identified in a <code class="literal">Paragraph</code> object</p></div><p>The text in a Word document is more than just a string. It has font, size, color, and other styling information associated with it. A <span class="emphasis"><em>style</em></span> in Word is a collection of these attributes. A <code class="literal">Run</code> object is a contiguous run of text with the same style. A new <code class="literal">Run</code> object is needed whenever the text style changes.</p><div class="sect2" title="Reading Word Documents"><div class="titlepage"><div><div><h2 class="title"><a id="reading_word_documents"/>Reading Word Documents</h2></div></div></div><p>Let’s experiment with the <code class="literal">python-docx</code> module. Download <span class="emphasis"><em>demo.docx</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> and save the document to the working directory. Then enter the following into the interactive shell:</p><a id="pro_id00493"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import docx</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document('demo.docx')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>len(doc.paragraphs)</strong></span>
   7
➌ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[0].text</strong></span>
   'Document Title'
➍ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].text</strong></span>
   'A plain paragraph with some bold and some italic'
➎ &gt;&gt;&gt; <span class="strong"><strong>len(doc.paragraphs[1].runs)</strong></span>
   4
➏ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[0].text</strong></span>
   'A plain paragraph with some '
➐ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[1].text</strong></span>
   'bold'
➑ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[2].text</strong></span>
   ' and some '
➒ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[3].text</strong></span>
   'italic'</pre><p>At ➊, we open a <span class="emphasis"><em>.docx</em></span> file in Python, call <code class="literal">docx.Document()</code>, and pass the filename <span class="emphasis"><em>demo.docx</em></span>. This will return a <code class="literal">Document</code> object, which has a <code class="literal">paragraphs</code> attribute that is a list of <code class="literal">Paragraph</code> objects. When we call <code class="literal">len()</code> on <code class="literal">doc.paragraphs</code>, it returns <code class="literal">7</code>, which tells us that there are seven <code class="literal">Paragraph</code> objects in this document ➋. Each of these <code class="literal">Paragraph</code> objects has a <code class="literal">text</code> <a id="iddle1603" class="indexterm"/><a id="iddle2549" class="indexterm"/><a id="iddle2705" class="indexterm"/>attribute that contains a string of the text in that paragraph (without the style information). Here, the first <code class="literal">text</code> attribute contains <code class="literal">'DocumentTitle'</code> ➌, and the second contains <code class="literal">'A plain paragraph with some bold and some italic'</code> ➍.</p><p>Each <code class="literal">Paragraph</code> object also has a <code class="literal">runs</code> attribute that is a list of <code class="literal">Run</code> objects. <code class="literal">Run</code> objects also have a <code class="literal">text</code> attribute, containing just the text in that particular run. Let’s look at the <code class="literal">text</code> attributes in the second <code class="literal">Paragraph</code> object, <code class="literal">'A plain paragraph with some bold and some italic'</code>. Calling <code class="literal">len()</code> on this <code class="literal">Paragraph</code> object tells us that there are four <code class="literal">Run</code> objects ➎. The first run object contains <code class="literal">'A plain paragraph with some '</code> ➏. Then, the text change to a bold style, so <code class="literal">'bold'</code> starts a new <code class="literal">Run</code> object ➐. The text returns to an unbolded style after that, which results in a third <code class="literal">Run</code> object, <code class="literal">' and some '</code> ➑. Finally, the fourth and last <code class="literal">Run</code> object contains <code class="literal">'italic'</code> in an italic style ➒.</p><p>With Python-Docx, your Python programs will now be able to read the text from a <span class="emphasis"><em>.docx</em></span> file and use it just like any other string value.</p></div><div class="sect2" title="Getting the Full Text from a .docx File"><div class="titlepage"><div><div><h2 class="title"><a id="getting_the_full_text_from_a_dotdocx_fil"/>Getting the Full Text from a .docx File</h2></div></div></div><p>If you care only about the text, not the styling information, in the Word document, you can use the <code class="literal">getText()</code> function. It accepts a filename of a <span class="emphasis"><em>.docx</em></span> file and returns a single string value of its text. Open a new file editor window and enter the following code, saving it as <span class="emphasis"><em>readDocx.py</em></span>:</p><a id="pro_id00494"/><pre class="programlisting">#! python3

import docx

def getText(filename):
    doc = docx.Document(filename)
    fullText = []
    for para in doc.paragraphs:
        fullText.append(para.text)
    return '\n'.join(fullText)</pre><p>The <code class="literal">getText()</code> function opens the Word document, loops over all the <code class="literal">Paragraph</code> objects in the <code class="literal">paragraphs</code> list, and then appends their text to the list in <code class="literal">fullText</code>. After the loop, the strings in <code class="literal">fullText</code> are joined together with newline characters.</p><p>The <span class="emphasis"><em>readDocx.py</em></span> program can be imported like any other module. Now if you just need the text from a Word document, you can enter the following:</p><a id="pro_id00495"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import readDocx</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>print(readDocx.getText('demo.docx'))</strong></span>
Document Title
A plain paragraph with some bold and some italic
Heading, level 1
Intense quote
first item in unordered list
first item in ordered list</pre><p><a id="iddle2055" class="indexterm"/><a id="iddle2711" class="indexterm"/>You can also adjust <code class="literal">getText()</code> to modify the string before returning it. For example, to indent each paragraph, replace the <code class="literal">append()</code> call in <span class="emphasis"><em>readDocx.py</em></span> with this:</p><a id="pro_id00496"/><pre class="programlisting">fullText.append(<span class="strong"><strong>' ' +</strong></span> para.text)</pre><p>To add a double space in between paragraphs, change the <code class="literal">join()</code> call code to this:</p><a id="pro_id00497"/><pre class="programlisting">return '\n<span class="strong"><strong>\n</strong></span>'.join(fullText)</pre><p>As you can see, it takes only a few lines of code to write functions that will read a <span class="emphasis"><em>.docx</em></span> file and return a string of its content to your liking.</p></div><div class="sect2" title="Styling Paragraph and Run Objects"><div class="titlepage"><div><div><h2 class="title"><a id="styling_paragraph_and_run_objects"/>Styling Paragraph and Run Objects</h2></div></div></div><p>In Word for Windows, you can see the styles by pressing <span class="smaller">CTRL</span>-<span class="smaller">ALT</span>-<span class="smaller">SHIFT</span>-S to display the Styles pane, which looks like <a class="xref" href="ch13.html#display_the_styles_pane_by_pressing_ctrl" title="Figure 13-5. Display the Styles pane by pressing CTRL-ALT-SHIFT-S on Windows.">Figure 13-5</a>. On OS X, you can view the Styles pane by clicking the <span class="strong"><strong>View</strong></span>▸<span class="strong"><strong>Styles</strong></span> menu item.</p><div class="figure"><a id="display_the_styles_pane_by_pressing_ctrl"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00069"/><img src="figs/web/13fig05.png.jpg" alt="Display the Styles pane by pressing CTRL-ALT-SHIFT-S on Windows."/></div></div><p class="title">Figure 13-5. Display the Styles pane by pressing <code class="literal">CTRL-ALT-SHIFT</code>-S on Windows.</p></div><p>Word and other word processors use styles to keep the visual presentation of similar types of text consistent and easy to change. For example, perhaps you want to set body paragraphs in 11-point, Times New Roman, left-justified, ragged-right text. You can create a style with these settings and <a id="iddle1169" class="indexterm"/><a id="iddle1815" class="indexterm"/><a id="iddle2363" class="indexterm"/><a id="iddle2703" class="indexterm"/>assign it to all body paragraphs. Then, if you later want to change the presentation of all body paragraphs in the document, you can just change the style, and all those paragraphs will be automatically updated.</p><p>For Word documents, there are three types of styles: <span class="emphasis"><em>Paragraph styles</em></span> can be applied to <code class="literal">Paragraph</code> objects, <span class="emphasis"><em>character styles</em></span> can be applied to <code class="literal">Run</code> objects, and <span class="emphasis"><em>linked styles</em></span> can be applied to both kinds of objects. You can give both <code class="literal">Paragraph</code> and <code class="literal">Run</code> objects styles by setting their <code class="literal">style</code> attribute to a string. This string should be the name of a style. If <code class="literal">style</code> is set to <code class="literal">None</code>, then there will be no style associated with the <code class="literal">Paragraph</code> or <code class="literal">Run</code> object.</p><p>The string values for the default Word styles are as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/><col/></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Normal'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading5'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListBullet'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListParagraph'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'BodyText'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading6'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListBullet2'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'MacroText'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'BodyText2'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading7'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListBullet3'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'NoSpacing'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'BodyText3'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading8'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListContinue'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Quote'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Caption'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading9'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListContinue2'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Subtitle'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading1'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'IntenseQuote'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListContinue3'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'TOCHeading'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading2'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'List'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListNumber'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Title'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading3'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'List2'</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">'ListNumber2'</code></p></td><td style="border-bottom: 0.5pt solid ; "> </td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">'Heading4'</code></p></td><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">'List3'</code></p></td><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">'ListNumber3'</code></p></td><td style=""> </td></tr></tbody></table></div><p>When setting the <code class="literal">style</code> attribute, do not use spaces in the style name. For example, while the style name may be Subtle Emphasis, you should set the <code class="literal">style</code> attribute to the string value <code class="literal">'SubtleEmphasis'</code> instead of <code class="literal">'Subtle Emphasis'</code>. Including spaces will cause Word to misread the style name and not apply it.</p><p>When using a linked style for a <code class="literal">Run</code> object, you will need to add <code class="literal">'Char'</code> to the end of its name. For example, to set the Quote linked style for a <code class="literal">Paragraph</code> object, you would use <code class="literal">paragraphObj.style = 'Quote'</code>, but for a <code class="literal">Run</code> object, you would use <code class="literal">runObj.style = 'QuoteChar'</code>.</p><p>In the current version of Python-Docx (0.7.4), the only styles that can be used are the default Word styles and the styles in the opened <span class="emphasis"><em>.docx</em></span>. New styles cannot be created—though this may change in future versions of Python-Docx.</p></div><div class="sect2" title="Creating Word Documents with Nondefault Styles"><div class="titlepage"><div><div><h2 class="title"><a id="creating_word_documents_with_nondefault"/>Creating Word Documents with Nondefault Styles</h2></div></div></div><p>If you want to create Word documents that use styles beyond the default ones, you will need to open Word to a blank Word document and create the styles yourself by clicking the <span class="strong"><strong>New Style</strong></span> button at the bottom of the Styles pane (<a class="xref" href="ch13.html#new_style_button_left_parenthesisleftrig" title="Figure 13-6. The New Style button (left) and the Create New Style from Formatting dialog (right)">Figure 13-6</a> shows this on Windows).</p><p>This will open the Create New Style from Formatting dialog, where you can enter the new style. Then, go back into the interactive shell and open this blank Word document with <code class="literal">docx.Document()</code>, using it as the base for your Word document. The name you gave this style will now be available to use with Python-Docx.</p><div class="figure"><a id="new_style_button_left_parenthesisleftrig"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00070"/><img src="figs/web/13fig06.png.jpg" alt="The New Style button (left) and the Create New Style from Formatting dialog (right)"/></div></div><p class="title">Figure 13-6. The New Style button (left) and the Create New Style from Formatting dialog (right)</p></div></div><div class="sect2" title="Run Attributes"><div class="titlepage"><div><div><h2 class="title"><a id="run_attributes"/>Run Attributes</h2></div></div></div><p><a id="iddle1082" class="indexterm"/><a id="iddle1126" class="indexterm"/><a id="iddle1352" class="indexterm"/><a id="iddle1405" class="indexterm"/><a id="iddle1711" class="indexterm"/><a id="iddle1760" class="indexterm"/><a id="iddle2048" class="indexterm"/><a id="iddle2362" class="indexterm"/><a id="iddle2364" class="indexterm"/><a id="iddle2421" class="indexterm"/><a id="iddle2441" class="indexterm"/><a id="iddle2484" class="indexterm"/><a id="iddle2550" class="indexterm"/><a id="iddle2614" class="indexterm"/><a id="iddle2710" class="indexterm"/>Runs can be further styled using <code class="literal">text</code> attributes. Each attribute can be set to one of three values: <code class="literal">True</code> (the attribute is always enabled, no matter what other styles are applied to the run), <code class="literal">False</code> (the attribute is always disabled), or <code class="literal">None</code> (defaults to whatever the run’s style is set to).</p><p><a class="xref" href="ch13.html#run_object_text_attributes" title="Table 13-1. Run Object text Attributes">Table 13-1</a> lists the <code class="literal">text</code> attributes that can be set on <code class="literal">Run</code> objects.</p><div class="table"><a id="run_object_text_attributes"/><p class="title">Table 13-1. <code class="literal">Run</code> Object <code class="literal">text</code> Attributes</p><div class="table-contents"><table summary="Run Object text Attributes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Attribute</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">bold</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears in bold.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">italic</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears in italic.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">underline</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text is underlined.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">strike</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears with strikethrough.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">double_strike</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears with double strikethrough.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">all_caps</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears in capital letters.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">small_caps</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears in capital letters, with lowercase letters two points smaller.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">shadow</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears with a shadow.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">outline</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears outlined rather than solid.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">rtl</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text is written right-to-left.</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">imprint</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The text appears pressed into the page.</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><span class="strong"><strong><code class="literal">emboss</code></strong></span></p></td><td style="" valign="top"><p>The text appears raised off the page in relief.</p></td></tr></tbody></table></div></div><p><a id="iddle2712" class="indexterm"/>For example, to change the styles of <span class="emphasis"><em>demo.docx</em></span>, enter the following into the interactive shell:</p><a id="pro_id00498"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document('demo.docx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[0].text</strong></span>
'Document Title'
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[0].style</strong></span>
'Title'
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[0].style = 'Normal'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].text</strong></span>
'A plain paragraph with some bold and some italic'
&gt;&gt;&gt; <span class="strong"><strong>(doc.paragraphs[1].runs[0].text, doc.paragraphs[1].runs[1].text, doc.</strong></span>
<span class="strong"><strong>paragraphs[1].runs[2].text, doc.paragraphs[1].runs[3].text)</strong></span>
('A plain paragraph with some ', 'bold', ' and some ', 'italic')
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[0].style = 'QuoteChar'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[1].underline = True</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[1].runs[3].underline = True</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.save('restyled.docx')</strong></span></pre><p>Here, we use the <code class="literal">text</code> and <code class="literal">style</code> attributes to easily see what’s in the paragraphs in our document. We can see that it’s simple to divide a paragraph into runs and access each run individiaully. So we get the first, second, and fourth runs in the second paragraph, style each run, and save the results to a new document.</p><p>The words <span class="emphasis"><em>Document Title</em></span> at the top of <span class="emphasis"><em>restyled.docx</em></span> will have the Normal style instead of the Title style, the <code class="literal">Run</code> object for the text <span class="emphasis"><em>A plain paragraph with some</em></span> will have the QuoteChar style, and the two <code class="literal">Run</code> objects for the words <span class="emphasis"><em>bold</em></span> and <span class="emphasis"><em>italic</em></span> will have their <code class="literal">underline</code> attributes set to <code class="literal">True</code>. <a class="xref" href="ch13.html#restyleddotdocx_file" title="Figure 13-7. The restyled.docx file">Figure 13-7</a> shows how the styles of paragraphs and runs look in <span class="emphasis"><em>restyled.docx</em></span>.</p><div class="figure"><a id="restyleddotdocx_file"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00071"/><img src="figs/web/13fig07.png.jpg" alt="The restyled.docx file"/></div></div><p class="title">Figure 13-7. The <span class="emphasis"><em>restyled.docx</em></span> file</p></div><p>You can find more complete documentation on Python-Docx’s use of styles at <span class="emphasis"><em><a class="ulink" href="https://python-docx.readthedocs.org/en/latest/user/styles.html">https://python-docx.readthedocs.org/en/latest/user/styles.html</a></em></span>.</p></div><div class="sect2" title="Writing Word Documents"><div class="titlepage"><div><div><h2 class="title"><a id="writing_word_documents"/>Writing Word Documents</h2></div></div></div><p>Enter the following into the interactive shell:</p><a id="pro_id00499"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import docx</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.add_paragraph('Hello world!')</strong></span>
&lt;docx.text.Paragraph object at 0x0000000003B56F60&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.save('helloworld.docx')</strong></span></pre><p><a id="iddle1078" class="indexterm"/><a id="iddle1080" class="indexterm"/>To create your own <span class="emphasis"><em>.docx</em></span> file, call <code class="literal">docx.Document()</code> to return a new, blank Word <code class="literal">Document</code> object. The <code class="literal">add_paragraph()</code> document method adds a new paragraph of text to the document and returns a reference to the <code class="literal">Paragraph</code> object that was added. When you’re done adding text, pass a filename string to the <code class="literal">save()</code> document method to save the <code class="literal">Document</code> object to a file.</p><p>This will create a file named <span class="emphasis"><em>helloworld.docx</em></span> in the current working directory that, when opened, looks like <a class="xref" href="ch13.html#word_document_created_using_addunderscor" title="Figure 13-8. The Word document created using add_paragraph('Hello world!')">Figure 13-8</a>.</p><div class="figure"><a id="word_document_created_using_addunderscor"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00072"/><img src="figs/web/13fig08.png.jpg" alt="The Word document created using add_paragraph('Hello world!')"/></div></div><p class="title">Figure 13-8. The Word document created using <code class="literal">add_paragraph('Hello world!')</code></p></div><p>You can add paragraphs by calling the <code class="literal">add_paragraph()</code> method again with the new paragraph’s text. Or to add text to the end of an existing paragraph, you can call the paragraph’s <code class="literal">add_run()</code> method and pass it a string. Enter the following into the interactive shell:</p><a id="pro_id00500"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import docx</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.add_paragraph('Hello world!')</strong></span>
&lt;docx.text.Paragraph object at 0x000000000366AD30&gt;
&gt;&gt;&gt; <span class="strong"><strong>paraObj1 = doc.add_paragraph('This is a second paragraph.')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>paraObj2 = doc.add_paragraph('This is a yet another paragraph.')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>paraObj1.add_run(' This text is being added to the second paragraph.')</strong></span>
&lt;docx.text.Run object at 0x0000000003A2C860&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.save('multipleParagraphs.docx')</strong></span></pre><p>The resulting document will look like <a class="xref" href="ch13.html#document_with_multiple_paragraph_and_run" title="Figure 13-9. The document with multiple Paragraph and Run objects added">Figure 13-9</a>. Note that the text <span class="emphasis"><em>This text is being added to the second paragraph.</em></span> was added to the <code class="literal">Paragraph</code> object in <code class="literal">paraObj1</code>, which was the second paragraph added to <code class="literal">doc</code>. The <code class="literal">add_paragraph()</code> and <code class="literal">add_run()</code> functions return paragraph and <code class="literal">Run</code> objects, respectively, to save you the trouble of extracting them as a separate step.</p><p>Keep in mind that as of Python-Docx version 0.5.3, new <code class="literal">Paragraph</code> objects can be added only to the end of the document, and new <code class="literal">Run</code> objects can be added only to the end of a <code class="literal">Paragraph</code> object.</p><p>The <code class="literal">save()</code> method can be called again to save the additional changes you’ve made.</p><div class="figure"><a id="document_with_multiple_paragraph_and_run"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00073"/><img src="figs/web/13fig09.png.jpg" alt="The document with multiple Paragraph and Run objects added"/></div></div><p class="title">Figure 13-9. The document with multiple <code class="literal">Paragraph</code> and <code class="literal">Run</code> objects added</p></div><p><a id="iddle1076" class="indexterm"/><a id="iddle1647" class="indexterm"/><a id="iddle2702" class="indexterm"/>Both <code class="literal">add_paragraph()</code> and <code class="literal">add_run()</code> accept an optional second argument that is a string of the <code class="literal">Paragraph</code> or <code class="literal">Run</code> object’s style. For example:</p><a id="pro_id00501"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>doc.add_paragraph('Hello world!', 'Title')</strong></span></pre><p>This line adds a paragraph with the text <span class="emphasis"><em>Hello world!</em></span> in the Title style.</p></div><div class="sect2" title="Adding Headings"><div class="titlepage"><div><div><h2 class="title"><a id="adding_headings"/>Adding Headings</h2></div></div></div><p>Calling <code class="literal">add_heading()</code> adds a paragraph with one of the heading styles. Enter the following into the interactive shell:</p><a id="pro_id00502"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>doc.add_heading('Header 0', 0)</strong></span>
&lt;docx.text.Paragraph object at 0x00000000036CB3C8&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.add_heading('Header 1', 1)</strong></span>
&lt;docx.text.Paragraph object at 0x00000000036CB630&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.add_heading('Header 2', 2)</strong></span>
&lt;docx.text.Paragraph object at 0x00000000036CB828&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.add_heading('Header 3', 3)</strong></span>
&lt;docx.text.Paragraph object at 0x00000000036CB2E8&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.add_heading('Header 4', 4)</strong></span>
&lt;docx.text.Paragraph object at 0x00000000036CB3C8&gt;
&gt;&gt;&gt; <span class="strong"><strong>doc.save('headings.docx')</strong></span></pre><p>The arguments to <code class="literal">add_heading()</code> are a string of the heading text and an integer from <code class="literal">0</code> to <code class="literal">4</code>. The integer <code class="literal">0</code> makes the heading the Title style, which is used for the top of the document. Integers <code class="literal">1</code> to <code class="literal">4</code> are for various heading levels, with <code class="literal">1</code> being the main heading and <code class="literal">4</code> the lowest subheading. The <code class="literal">add_heading()</code> function returns a <code class="literal">Paragraph</code> object to save you the step of extracting it from the <code class="literal">Document</code> object as a separate step.</p><p><a id="iddle1079" class="indexterm"/><a id="iddle1811" class="indexterm"/><a id="iddle2052" class="indexterm"/><a id="iddle2706" class="indexterm"/><a id="iddle2707" class="indexterm"/>The resulting <span class="emphasis"><em>headings.docx</em></span> file will look like <a class="xref" href="ch13.html#headingsdotdocx_document_with_headings_0" title="Figure 13-10. The headings.docx document with headings 0 to 4">Figure 13-10</a>.</p><div class="figure"><a id="headingsdotdocx_document_with_headings_0"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00074"/><img src="figs/web/13fig10.png.jpg" alt="The headings.docx document with headings 0 to 4"/></div></div><p class="title">Figure 13-10. The <span class="emphasis"><em>headings.docx</em></span> document with headings 0 to 4</p></div></div><div class="sect2" title="Adding Line and Page Breaks"><div class="titlepage"><div><div><h2 class="title"><a id="adding_line_and_page_breaks"/>Adding Line and Page Breaks</h2></div></div></div><p>To add a line break (rather than starting a whole new paragraph), you can call the <code class="literal">add_break()</code> method on the <code class="literal">Run</code> object you want to have the break appear after. If you want to add a page break instead, you need to pass the value <code class="literal">docx.text.WD_BREAK.PAGE</code> as a lone argument to <code class="literal">add_break()</code>, as is done in the middle of the following example:</p><a id="pro_id00503"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>doc = docx.Document()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>doc.add_paragraph('This is on the first page!')</strong></span>
   &lt;docx.text.Paragraph object at 0x0000000003785518&gt;
➊ &gt;&gt;&gt; <span class="strong"><strong>doc.paragraphs[0].runs[0].add_break(docx.text.WD_BREAK.PAGE)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>doc.add_paragraph('This is on the second page!')</strong></span>
   &lt;docx.text.Paragraph object at 0x00000000037855F8&gt;
   &gt;&gt;&gt; <span class="strong"><strong>doc.save('twoPage.docx')</strong></span></pre><p>This creates a two-page Word document with <span class="emphasis"><em>This is on the first page!</em></span> on the first page and <span class="emphasis"><em>This is on the second page!</em></span> on the second. Even though there was still plenty of space on the first page after the text <span class="emphasis"><em>This is on the first page!</em></span>, we forced the next paragraph to begin on a new page by inserting a page break after the first run of the first paragraph ➊.</p></div><div class="sect2" title="Adding Pictures"><div class="titlepage"><div><div><h2 class="title"><a id="adding_pictures"/>Adding Pictures</h2></div></div></div><p><code class="literal">Document</code> objects have an <code class="literal">add_picture()</code> method that will let you add an image to the end of the document. Say you have a file <span class="emphasis"><em>zophie.png</em></span> in the current working directory. You can add <span class="emphasis"><em>zophie.png</em></span> to the end of your document with a width of 1 inch and height of 4 centimeters (Word can use both imperial and metric units) by entering the following:</p><a id="pro_id00504"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>doc.add_picture('zophie.png', width=docx.shared.Inches(1),</strong></span>
<span class="strong"><strong>height=docx.shared.Cm(4))</strong></span>
&lt;docx.shape.InlineShape object at 0x00000000036C7D30&gt;</pre><p>The first argument is a string of the image’s filename. The optional <code class="literal">width</code> and <code class="literal">height</code> keyword arguments will set the width and height of the image in the document. If left out, the width and height will default to the normal size of the image.</p><p>You’ll probably prefer to specify an image’s height and width in familiar units such as inches and centimeters, so you can use the <code class="literal">docx.shared.Inches()</code> and <code class="literal">docx.shared.Cm()</code> functions when you’re specifying the <code class="literal">width</code> and <code class="literal">height</code> keyword arguments.</p></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00046"/>Summary</h1></div></div></div><p>Text information isn’t just for plaintext files; in fact, it’s pretty likely that you deal with PDFs and Word documents much more often. You can use the <code class="literal">PyPDF2</code> module to read and write PDF documents. Unfortunately, reading text from PDF documents might not always result in a perfect translation to a string because of the complicated PDF file format, and some PDFs might not be readable at all. In these cases, you’re out of luck unless future updates to PyPDF2 support additional PDF features.</p><p>Word documents are more reliable, and you can read them with the <code class="literal">python-docx</code> module. You can manipulate text in Word documents via <code class="literal">Paragraph</code> and <code class="literal">Run</code> objects. These objects can also be given styles, though they must be from the default set of styles or styles already in the document. You can add new paragraphs, headings, breaks, and pictures to the document, though only to the end.</p><p>Many of the limitations that come with working with PDFs and Word documents are because these formats are meant to be nicely displayed for human readers, rather than easy to parse by software. The next chapter takes a look at two other common formats for storing information: JSON and CSV files. These formats are designed to be used by computers, and you’ll see that Python can work with these formats much more easily.</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00047"/>Practice Questions</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch13qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe1"/><a id="ch13qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. A string value of the PDF filename is <span class="emphasis"><em>not</em></span> passed to the <code class="literal">PyPDF2.PdfFileReader()</code> function. What do you pass to the function instead?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe2"/><a id="ch13qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. What modes do the <code class="literal">File</code> objects for <code class="literal">PdfFileReader()</code> and <code class="literal">PdfFileWriter()</code> need to be opened in?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe3"/><a id="ch13qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. How do you acquire a <code class="literal">Page</code> object for <a class="xref" href="pr05.html#about_this_book" title="About This Book">About This Book</a> from a <code class="literal">PdfFileReader</code> object?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe4"/><a id="ch13qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. What <code class="literal">PdfFileReader</code> variable stores the number of pages in the PDF document?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe5"/><a id="ch13qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. If a <code class="literal">PdfFileReader</code> object’s PDF is encrypted with the password <code class="literal">swordfish</code>, what must you do before you can obtain <code class="literal">Page</code> objects from it?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe6"/><a id="ch13qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. What methods do you use to rotate a page?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe7"/><a id="ch13qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. What method returns a <code class="literal">Document</code> object for a file named <span class="emphasis"><em>demo.docx</em></span>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe8"/><a id="ch13qa1q8"/><p>Q:</p></td><td align="left" valign="top"><p>8. What is the difference between a <code class="literal">Paragraph</code> object and a <code class="literal">Run</code> object?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe9"/><a id="ch13qa1q9"/><p>Q:</p></td><td align="left" valign="top"><p>9. How do you obtain a list of <code class="literal">Paragraph</code> objects for a <code class="literal">Document</code> object that’s stored in a variable named <code class="literal">doc</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe10"/><a id="ch13qa1q10"/><p>Q:</p></td><td align="left" valign="top"><p>10. What type of object has <code class="literal">bold</code>, <code class="literal">underline</code>, <code class="literal">italic</code>, <code class="literal">strike</code>, and <code class="literal">outline</code> variables?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe11"/><a id="ch13qa1q11"/><p>Q:</p></td><td align="left" valign="top"><p>11. What is the difference between setting the <code class="literal">bold</code> variable to <code class="literal">True</code>, <code class="literal">False</code>, or <code class="literal">None</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe12"/><a id="ch13qa1q12"/><p>Q:</p></td><td align="left" valign="top"><p>12. How do you create a <code class="literal">Document</code> object for a new Word document?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe13"/><a id="ch13qa1q13"/><p>Q:</p></td><td align="left" valign="top"><p>13. How do you add a paragraph with the text <code class="literal">'Hello there!'</code> to a <code class="literal">Document</code> object stored in a variable named <code class="literal">doc</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch13qa1qe14"/><a id="ch13qa1q14"/><p>Q:</p></td><td align="left" valign="top"><p>14. What integers represent the levels of headings available in Word documents?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Projects"><div class="titlepage"><div><div><h1 class="title"><a id="practice_projects-id00048"/>Practice Projects</h1></div></div></div><p>For practice, write programs that do the following.</p><div class="sect2" title="PDF Paranoia"><div class="titlepage"><div><div><h2 class="title"><a id="pdf_paranoia"/>PDF Paranoia</h2></div></div></div><p>Using the <code class="literal">os.walk()</code> function from <a class="xref" href="ch09.html" title="Chapter 9. Organizing Files">Chapter 9</a>, write a script that will go through every PDF in a folder (and its subfolders) and encrypt the PDFs using a password provided on the command line. Save each encrypted PDF with an <span class="emphasis"><em>_encrypted.pdf</em></span> suffix added to the original filename. Before deleting the original file, have the program attempt to read and decrypt the file to ensure that it was encrypted correctly.</p><p>Then, write a program that finds all encrypted PDFs in a folder (and its subfolders) and creates a decrypted copy of the PDF using a provided password. If the password is incorrect, the program should print a message to the user and continue to the next PDF.</p></div><div class="sect2" title="Custom Invitations as Word Documents"><div class="titlepage"><div><div><h2 class="title"><a id="custom_invitations_as_word_documents"/>Custom Invitations as Word Documents</h2></div></div></div><p>Say you have a text file of guest names. This <span class="emphasis"><em>guests.txt</em></span> file has one name per line, as follows:</p><a id="pro_id00505"/><pre class="programlisting">Prof. Plum
Miss Scarlet
Col. Mustard
Al Sweigart
RoboCop</pre><p>Write a program that would generate a Word document with custom invitations that look like <a class="xref" href="ch13.html#word_document_generated_by_your_custom_i" title="Figure 13-11. The Word document generated by your custom invite script">Figure 13-11</a>.</p><p>Since Python-Docx can use only those styles that already exist in the Word document, you will have to first add these styles to a blank Word file and then open that file with Python-Docx. There should be one invitation per page in the resulting Word document, so call <code class="literal">add_break()</code> to add a page break after the last paragraph of each invitation. This way, you will need to open only one Word document to print all of the invitations at once.</p><div class="figure"><a id="word_document_generated_by_your_custom_i"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00075"/><img src="figs/web/13fig11.png.jpg" alt="The Word document generated by your custom invite script"/></div></div><p class="title">Figure 13-11. The Word document generated by your custom invite script</p></div><p>You can download a sample <span class="emphasis"><em>guests.txt</em></span> file from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p></div><div class="sect2" title="Brute-Force PDF Password Breaker"><div class="titlepage"><div><div><h2 class="title"><a id="brute-force_pdf_password_breaker"/>Brute-Force PDF Password Breaker</h2></div></div></div><p>Say you have an encrypted PDF that you have forgotten the password to, but you remember it was a single English word. Trying to guess your forgotten password is quite a boring task. Instead you can write a program that will decrypt the PDF by trying every possible English word until it finds one that works. This is called a <span class="emphasis"><em>brute-force password attack.</em></span> Download the text file <span class="emphasis"><em>dictionary.txt</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>. This <span class="emphasis"><em>dictionary file</em></span> contains over 44,000 English words with one word per line.</p><p>Using the file-reading skills you learned in <a class="xref" href="ch08.html" title="Chapter 8. Reading and Writing Files">Chapter 8</a>, create a list of word strings by reading this file. Then loop over each word in this list, passing it to the <code class="literal">decrypt()</code> method. If this method returns the integer <code class="literal">0</code>, the password was wrong and your program should continue to the next password. If <code class="literal">decrypt()</code> returns <code class="literal">1</code>, then your program should break out of the loop and print the hacked password. You should try both the uppercase and lower-case form of each word. (On my laptop, going through all 88,000 uppercase and lowercase words from the dictionary file takes a couple of minutes. This is why you shouldn’t use a simple English word for your passwords.)</p></div></div></div></body></html>
