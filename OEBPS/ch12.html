<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 12. Working with Excel Spreadsheets</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 12. Working with Excel Spreadsheets"><div class="titlepage"><div><div><h1 class="title"><a id="working_with_excel_spreadsheets"/>Chapter 12. Working with Excel Spreadsheets</h1></div></div></div><p><a id="iddle1418" class="indexterm"/><a id="iddle1809" class="indexterm"/><a id="iddle2023" class="indexterm"/><a id="iddle2459" class="indexterm"/>Excel is a popular and powerful spreadsheet application for Windows. The <code class="literal">openpyxl</code> module allows your Python programs to read and modify Excel spreadsheet files. For example, you might have the boring task of copying certain data from one spreadsheet and pasting it into another one. Or you might have to go through thousands of rows and pick out just a handful of them to make small edits based on some criteria. Or you might have to look through hundreds of spreadsheets of department budgets, searching for any that are in the red. These are exactly the sort of boring, mindless spreadsheet tasks that Python can do for you.</p><p>Although Excel is proprietary software from Microsoft, there are free alternatives that run on Windows, OS X, and Linux. Both LibreOffice Calc and OpenOffice Calc work with Excel’s <span class="emphasis"><em>.xlsx</em></span> file format for spreadsheets, which means the <code class="literal">openpyxl</code> module can work on spreadsheets from these applications as well. You can download the software from <span class="emphasis"><em><a class="ulink" href="https://www.libreoffice.org/">https://www.libreoffice.org/</a></em></span> and <span class="emphasis"><em><a class="ulink" href="http://www.openoffice.org/">http://www.openoffice.org/</a></em></span>, respectively. Even if you already have <a id="iddle1160" class="indexterm"/><a id="iddle1433" class="indexterm"/><a id="iddle1434" class="indexterm"/><a id="iddle1445" class="indexterm"/><a id="iddle1732" class="indexterm"/><a id="iddle2026" class="indexterm"/><a id="iddle2714" class="indexterm"/>Excel installed on your computer, you may find these programs easier to use. The screenshots in this chapter, however, are all from Excel 2010 on Windows 7.</p><div class="sect1" title="Excel Documents"><div class="titlepage"><div><div><h1 class="title"><a id="excel_documents"/>Excel Documents</h1></div></div></div><p>First, let’s go over some basic definitions: An Excel spreadsheet document is called a <span class="emphasis"><em>workbook</em></span>. A single workbook is saved in a file with the <span class="emphasis"><em>.xlsx</em></span> extension. Each workbook can contain multiple <span class="emphasis"><em>sheets</em></span> (also called <span class="emphasis"><em>worksheets</em></span>). The sheet the user is currently viewing (or last viewed before closing Excel) is called the <span class="emphasis"><em>active sheet</em></span>.</p><p>Each sheet has <span class="emphasis"><em>columns</em></span> (addressed by letters starting at <span class="emphasis"><em>A</em></span>) and <span class="emphasis"><em>rows</em></span> (addressed by numbers starting at 1). A box at a particular column and row is called a <span class="emphasis"><em>cell</em></span>. Each cell can contain a number or text value. The grid of cells with data makes up a sheet.</p></div><div class="sect1" title="Installing the openpyxl Module"><div class="titlepage"><div><div><h1 class="title"><a id="installing_the_openpyxl_module"/>Installing the openpyxl Module</h1></div></div></div><p>Python does not come with OpenPyXL, so you’ll have to install it. Follow the instructions for installing third-party modules in Appendix A; the name of the module is <code class="literal">openpyxl</code>. To test whether it is installed correctly, enter the following into the interactive shell:</p><a id="pro_id00446"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span></pre><p>If the module was correctly installed, this should produce no error messages. Remember to import the <code class="literal">openpyxl</code> module before running the interactive shell examples in this chapter, or you’ll get a <code class="literal">NameError: name 'openpyxl' is not defined</code> error.</p><p>This book covers version 2.1.4 of OpenPyXL, but new versions are regularly released by the OpenPyXL team. Don’t worry, though: New versions should stay backward compatible with the instructions in this book for quite some time. If you have a newer version and want to see what additional features may be available to you, you can check out the full documentation for OpenPyXL at <span class="emphasis"><em><a class="ulink" href="http://openpyxl.readthedocs.org/">http://openpyxl.readthedocs.org/</a></em></span>.</p></div><div class="sect1" title="Reading Excel Documents"><div class="titlepage"><div><div><h1 class="title"><a id="reading_excel_documents"/>Reading Excel Documents</h1></div></div></div><p>The examples in this chapter will use a spreadsheet named <span class="emphasis"><em>example.xlsx</em></span> stored in the root folder. You can either create the spreadsheet yourself or download it from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>. <a class="xref" href="ch12.html#tabs_for_a_workbookapostrophes_sheets_ar" title="Figure 12-1. The tabs for a workbook’s sheets are in the lower-left corner of Excel.">Figure 12-1</a> shows the tabs for the three default sheets named <span class="emphasis"><em>Sheet1</em></span>, <span class="emphasis"><em>Sheet2</em></span>, and <span class="emphasis"><em>Sheet3</em></span> that Excel automatically provides for new workbooks. (The number of default sheets created may vary between operating systems and spreadsheet programs.)</p><div class="figure"><a id="tabs_for_a_workbookapostrophes_sheets_ar"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00052"/><img src="figs/web/12fig01.png.jpg" alt="The tabs for a workbook’s sheets are in the lower-left corner of Excel."/></div></div><p class="title">Figure 12-1. The tabs for a workbook’s sheets are in the lower-left corner of Excel.</p></div><p><a id="iddle1432" class="indexterm"/><a id="iddle1860" class="indexterm"/><a id="iddle2713" class="indexterm"/><a id="iddle2717" class="indexterm"/>Sheet 1 in the example file should look like <a class="xref" href="ch12.html#exampledotxlsx_spreadsheet" title="Table 12-1. The example.xlsx Spreadsheet">Table 12-1</a>. (If you didn’t download <span class="emphasis"><em>example.xlsx</em></span> from the website, you should enter this data into the sheet yourself.)</p><div class="table"><a id="exampledotxlsx_spreadsheet"/><p class="title">Table 12-1. The <span class="emphasis"><em>example.xlsx</em></span> Spreadsheet</p><div class="table-contents"><table summary="The example.xlsx Spreadsheet" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; "> </th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>A</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>B</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>C</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>1</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/5/2015 1:34:02 PM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Apples</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>73</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>2</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/5/2015 3:41:23 AM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Cherries</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>85</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>3</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/6/2015 12:46:51 PM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Pears</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>14</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>4</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/8/2015 8:59:43 AM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Oranges</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>52</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>5</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/10/2015 2:07:00 AM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Apples</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>152</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>6</strong></span></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>4/10/2015 6:10:37 PM</p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Bananas</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>23</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><span class="strong"><strong>7</strong></span></p></td><td style="border-right: 0.5pt solid ; " valign="top"><p>4/10/2015 2:40:46 AM</p></td><td style="border-right: 0.5pt solid ; " valign="top"><p>Strawberries</p></td><td style="" valign="top"><p>98</p></td></tr></tbody></table></div></div><p>Now that we have our example spreadsheet, let’s see how we can manipulate it with the <code class="literal">openpyxl</code> module.</p><div class="sect2" title="Opening Excel Documents with OpenPyXL"><div class="titlepage"><div><div><h2 class="title"><a id="opening_excel_documents_with_openpyxl"/>Opening Excel Documents with OpenPyXL</h2></div></div></div><p>Once you’ve imported the <code class="literal">openpyxl</code> module, you’ll be able to use the <code class="literal">openpyxl.load_workbook()</code> function. Enter the following into the interactive shell:</p><a id="pro_id00447"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>type(wb)</strong></span>
&lt;class 'openpyxl.workbook.workbook.Workbook'&gt;</pre><p>The <code class="literal">openpyxl.load_workbook()</code> function takes in the filename and returns a value of the <code class="literal">workbook</code> data type. This <code class="literal">Workbook</code> object represents the Excel file, a bit like how a <code class="literal">File</code> object represents an opened text file.</p><p>Remember that <span class="emphasis"><em>example.xlsx</em></span> needs to be in the current working directory in order for you to work with it. You can find out what the current working directory is by importing <code class="literal">os</code> and using <code class="literal">os.getcwd()</code>, and you can change the current working directory using <code class="literal">os.chdir()</code>.</p></div><div class="sect2" title="Getting Sheets from the Workbook"><div class="titlepage"><div><div><h2 class="title"><a id="getting_sheets_from_the_workbook"/>Getting Sheets from the Workbook</h2></div></div></div><p><a id="iddle1159" class="indexterm"/><a id="iddle1161" class="indexterm"/><a id="iddle1428" class="indexterm"/><a id="iddle1430" class="indexterm"/><a id="iddle1583" class="indexterm"/><a id="iddle1599" class="indexterm"/><a id="iddle1600" class="indexterm"/><a id="iddle2719" class="indexterm"/>You can get a list of all the sheet names in the workbook by calling the <code class="literal">get_sheet_names()</code> method. Enter the following into the interactive shell:</p><a id="pro_id00448"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['Sheet1', 'Sheet2', 'Sheet3']
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet3')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet</strong></span>
&lt;Worksheet "Sheet3"&gt;
&gt;&gt;&gt; <span class="strong"><strong>type(sheet)</strong></span> &lt;class 'openpyxl.worksheet.worksheet.Worksheet'&gt;
&gt;&gt;&gt; <span class="strong"><strong>sheet.title</strong></span>
'Sheet3'
&gt;&gt;&gt; <span class="strong"><strong>anotherSheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>anotherSheet</strong></span>
&lt;Worksheet "Sheet1"&gt;</pre><p>Each sheet is represented by a <code class="literal">Worksheet</code> object, which you can obtain by passing the sheet name string to the <code class="literal">get_sheet_by_name()</code> workbook method. Finally, you can call the <code class="literal">get_active_sheet()</code> method of a <code class="literal">Workbook</code> object to get the workbook’s active sheet. The active sheet is the sheet that’s on top when the workbook is opened in Excel. Once you have the <code class="literal">Worksheet</code> object, you can get its name from the <code class="literal">title</code> attribute.</p></div><div class="sect2" title="Getting Cells from the Sheets"><div class="titlepage"><div><div><h2 class="title"><a id="getting_cells_from_the_sheets"/>Getting Cells from the Sheets</h2></div></div></div><p>Once you have a <code class="literal">Worksheet</code> object, you can access a <code class="literal">Cell</code> object by its name. Enter the following into the interactive shell:</p><a id="pro_id00449"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet1')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1']</strong></span>
&lt;Cell Sheet1.A1&gt;
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'].value</strong></span>
datetime.datetime(2015, 4, 5, 13, 34, 2)
&gt;&gt;&gt; <span class="strong"><strong>c = sheet['B1']</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>c.value</strong></span>
'Apples'
&gt;&gt;&gt; <span class="strong"><strong>'Row ' + str(c.row) + ', Column ' + c.column + ' is ' + c.value</strong></span>
'Row 1, Column B is Apples'
&gt;&gt;&gt; <span class="strong"><strong>'Cell ' + c.coordinate + ' is ' + c.value</strong></span>
'Cell B1 is Apples'
&gt;&gt;&gt; <span class="strong"><strong>sheet['C1'].value</strong></span>
73</pre><p>The <code class="literal">Cell</code> object has a <code class="literal">value</code> attribute that contains, unsurprisingly, the value stored in that cell. <code class="literal">Cell</code> objects also have <code class="literal">row</code>, <code class="literal">column</code>, and <code class="literal">coordinate</code> attributes that provide location information for the cell.</p><p><a id="iddle1592" class="indexterm"/><a id="iddle1594" class="indexterm"/>Here, accessing the <code class="literal">value</code> attribute of our <code class="literal">Cell</code> object for cell B1 gives us the string <code class="literal">'Apples'</code>. The <code class="literal">row</code> attribute gives us the integer <code class="literal">1</code>, the <code class="literal">column</code> attribute gives us <code class="literal">'B'</code>, and the <code class="literal">coordinate</code> attribute gives us <code class="literal">'B1'</code>.</p><p>OpenPyXL will automatically interpret the dates in column A and return them as <code class="literal">datetime</code> values rather than strings. The <code class="literal">datetime</code> data type is explained further in <a class="xref" href="ch16.html" title="Chapter 16. Sending Email and Text Messages">Chapter 16</a>.</p><p>Specifying a column by letter can be tricky to program, especially because after column Z, the columns start by using two letters: AA, AB, AC, and so on. As an alternative, you can also get a cell using the sheet’s <code class="literal">cell()</code> method and passing integers for its <code class="literal">row</code> and <code class="literal">column</code> keyword arguments. The first row or column integer is <code class="literal">1</code>, not <code class="literal">0</code>. Continue the interactive shell example by entering the following:</p><a id="pro_id00450"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>sheet.cell(row=1, column=2)</strong></span>
&lt;Cell Sheet1.B1&gt;
&gt;&gt;&gt; <span class="strong"><strong>sheet.cell(row=1, column=2).value</strong></span>
'Apples'
&gt;&gt;&gt; <span class="strong"><strong>for i in range(1, 8, 2):</strong></span>
        <span class="strong"><strong>print(i, sheet.cell(row=i, column=2).value)</strong></span>

1 Apples
3 Pears
5 Apples
7 Strawberries</pre><p>As you can see, using the sheet’s <code class="literal">cell()</code> method and passing it <code class="literal">row=1</code> and <code class="literal">column=2</code> gets you a <code class="literal">Cell</code> object for cell <code class="literal">B1</code>, just like specifying <code class="literal">sheet['B1']</code> did. Then, using the <code class="literal">cell()</code> method and its keyword arguments, you can write a <code class="literal">for</code> loop to print the values of a series of cells.</p><p>Say you want to go down column B and print the value in every cell with an odd row number. By passing <code class="literal">2</code> for the <code class="literal">range()</code> function’s “step” parameter, you can get cells from every second row (in this case, all the odd-numbered rows). The <code class="literal">for</code> loop’s <code class="literal">i</code> variable is passed for the <code class="literal">row</code> keyword argument to the <code class="literal">cell()</code> method, while <code class="literal">2</code> is always passed for the <code class="literal">column</code> keyword argument. Note that the integer <code class="literal">2</code>, not the string <code class="literal">'B'</code>, is passed.</p><p>You can determine the size of the sheet with the <code class="literal">Worksheet</code> object’s <code class="literal">get_highest_row()</code> and <code class="literal">get_highest_column()</code> methods. Enter the following into the interactive shell:</p><a id="pro_id00451"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet1')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.get_highest_row()</strong></span>
7
&gt;&gt;&gt; <span class="strong"><strong>sheet.get_highest_column()</strong></span>
3</pre><p>Note that the <code class="literal">get_highest_column()</code> method returns an integer rather than the letter that appears in Excel.</p></div><div class="sect2" title="Converting Between Column Letters and Numbers"><div class="titlepage"><div><div><h2 class="title"><a id="converting_between_column_letters_and_nu"/>Converting Between Column Letters and Numbers</h2></div></div></div><p><a id="iddle1188" class="indexterm"/><a id="iddle1190" class="indexterm"/><a id="iddle1421" class="indexterm"/><a id="iddle1429" class="indexterm"/><a id="iddle1588" class="indexterm"/><a id="iddle2360" class="indexterm"/>To convert from letters to numbers, call the <code class="literal">openpyxl.cell.column_index_from_string()</code> function. To convert from numbers to letters, call the <code class="literal">openpyxl.cell.get_column_letter()</code> function. Enter the following into the interactive shell:</p><a id="pro_id00452"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>from openpyxl.cell import get_column_letter, column_index_from_string</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>get_column_letter(1)</strong></span>
'A'
&gt;&gt;&gt; <span class="strong"><strong>get_column_letter(2</strong></span>)
'B'
&gt;&gt;&gt; <span class="strong"><strong>get_column_letter(27)</strong></span>
'AA'
&gt;&gt;&gt; <span class="strong"><strong>get_column_letter(900)</strong></span>
'AHP'
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet1')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>get_column_letter(sheet.get_highest_column())</strong></span>
'C'
&gt;&gt;&gt; <span class="strong"><strong>column_index_from_string('A')</strong></span>
1
&gt;&gt;&gt; <span class="strong"><strong>column_index_from_string('AA')</strong></span>
27</pre><p>After you import these two functions from the <code class="literal">openpyxl.cell</code> module, you can call <code class="literal">get_column_letter()</code> and pass it an integer like 27 to figure out what the letter name of the 27th column is. The function <code class="literal">column_index_string()</code> does the reverse: You pass it the letter name of a column, and it tells you what number that column is. You don’t need to have a workbook loaded to use these functions. If you want, you can load a workbook, get a <code class="literal">Worksheet</code> object, and call a <code class="literal">Worksheet</code> object method like <code class="literal">get_highest_column()</code> to get an integer. Then, you can pass that integer to <code class="literal">get_column_letter()</code>.</p></div><div class="sect2" title="Getting Rows and Columns from the Sheets"><div class="titlepage"><div><div><h2 class="title"><a id="getting_rows_and_columns_from_the_sheets"/>Getting Rows and Columns from the Sheets</h2></div></div></div><p>You can slice <code class="literal">Worksheet</code> objects to get all the <code class="literal">Cell</code> objects in a row, column, or rectangular area of the spreadsheet. Then you can loop over all the cells in the slice. Enter the following into the interactive shell:</p><a id="pro_id00453"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet1')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>tuple(sheet['A1':'C3'])</strong></span>
   ((&lt;Cell Sheet1.A1&gt;, &lt;Cell Sheet1.B1&gt;, &lt;Cell Sheet1.C1&gt;), (&lt;Cell Sheet1.A2&gt;,
   &lt;Cell Sheet1.B2&gt;, &lt;Cell Sheet1.C2&gt;), (&lt;Cell Sheet1.A3&gt;, &lt;Cell Sheet1.B3&gt;,
   &lt;Cell Sheet1.C3&gt;))
➊ &gt;&gt;&gt; <span class="strong"><strong>for rowOfCellObjects in sheet['A1':'C3']:</strong></span>
➋         <span class="strong"><strong>for cellObj in rowOfCellObjects:</strong></span>
               <span class="strong"><strong>print(cellObj.coordinate, cellObj.value)</strong></span>
           <span class="strong"><strong>print('--- END OF ROW ---')</strong></span>
   A1 2015-04-05 13:34:02
   B1 Apples
   C1 73
   <span class="strong"><strong>---</strong></span> END OF ROW <span class="strong"><strong>---</strong></span>
   A2 2015-04-05 03:41:23
   B2 Cherries
   C2 85
   <span class="strong"><strong>---</strong></span> END OF ROW <span class="strong"><strong>---</strong></span>
   A3 2015-04-06 12:46:51
   B3 Pears
   C3 14
   <span class="strong"><strong>---</strong></span> END OF ROW <span class="strong"><strong>---</strong></span></pre><p>Here, we specify that we want the <code class="literal">Cell</code> objects in the rectangular area from A1 to C3, and we get a <code class="literal">Generator</code> object containing the <code class="literal">Cell</code> objects in that area. To help us visualize this <code class="literal">Generator</code> object, we can use <code class="literal">tuple()</code> on it to display its <code class="literal">Cell</code> objects in a tuple.</p><p>This tuple contains three tuples: one for each row, from the top of the desired area to the bottom. Each of these three inner tuples contains the <code class="literal">Cell</code> objects in one row of our desired area, from the leftmost cell to the right. So overall, our slice of the sheet contains all the <code class="literal">Cell</code> objects in the area from A1 to C3, starting from the top-left cell and ending with the bottom-right cell.</p><p>To print the values of each cell in the area, we use two <code class="literal">for</code> loops. The outer <code class="literal">for</code> loop goes over each row in the slice ➊. Then, for each row, the nested <code class="literal">for</code> loop goes through each cell in that row ➋.</p><p>To access the values of cells in a particular row or column, you can also use a <code class="literal">Worksheet</code> object’s <code class="literal">rows</code> and <code class="literal">columns</code> attribute. Enter the following into the interactive shell:</p><a id="pro_id00454"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.columns[1]</strong></span>
(&lt;Cell Sheet1.B1&gt;, &lt;Cell Sheet1.B2&gt;, &lt;Cell Sheet1.B3&gt;, &lt;Cell Sheet1.B4&gt;,
&lt;Cell Sheet1.B5&gt;, &lt;Cell Sheet1.B6&gt;, &lt;Cell Sheet1.B7&gt;)
&gt;&gt;&gt; <span class="strong"><strong>for cellObj in sheet.columns[1]:</strong></span>
        <span class="strong"><strong>print(cellObj.value)</strong></span>

Apples
Cherries
Pears
Oranges
Apples
Bananas
Strawberries</pre><p>Using the <code class="literal">rows</code> attribute on a <code class="literal">Worksheet</code> object will give you a tuple of tuples. Each of these inner tuples represents a row, and contains the <code class="literal">Cell</code> objects in that row. The <code class="literal">columns</code> attribute also gives you a tuple of tuples, with each of the inner tuples containing the <code class="literal">Cell</code> objects in a particular <a id="iddle1435" class="indexterm"/><a id="iddle2193" class="indexterm"/>column. For <span class="emphasis"><em>example.xlsx</em></span>, since there are 7 rows and 3 columns, <code class="literal">rows</code> gives us a tuple of 7 tuples (each containing 3 <code class="literal">Cell</code> objects), and <code class="literal">columns</code> gives us a tuple of 3 tuples (each containing 7 <code class="literal">Cell</code> objects).</p><p>To access one particular tuple, you can refer to it by its index in the larger tuple. For example, to get the tuple that represents column B, you use <code class="literal">sheet.columns[1]</code>. To get the tuple containing the <code class="literal">Cell</code> objects in column A, you’d use <code class="literal">sheet.columns[0]</code>. Once you have a tuple representing one row or column, you can loop through its <code class="literal">Cell</code> objects and print their values.</p></div><div class="sect2" title="Workbooks, Sheets, Cells"><div class="titlepage"><div><div><h2 class="title"><a id="workbookscomma_sheetscomma_cells"/>Workbooks, Sheets, Cells</h2></div></div></div><p>As a quick review, here’s a rundown of all the functions, methods, and data types involved in reading a cell out of a spreadsheet file:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Import the <code class="literal">openpyxl</code> module.</p></li><li class="listitem"><p>Call the <code class="literal">openpyxl.load_workbook()</code> function.</p></li><li class="listitem"><p>Get a <code class="literal">Workbook</code> object.</p></li><li class="listitem"><p>Call the <code class="literal">get_active_sheet()</code> or <code class="literal">get_sheet_by_name()</code> workbook method.</p></li><li class="listitem"><p>Get a <code class="literal">Worksheet</code> object.</p></li><li class="listitem"><p>Use indexing or the <code class="literal">cell()</code> sheet method with <code class="literal">row</code> and <code class="literal">column</code> keyword arguments.</p></li><li class="listitem"><p>Get a <code class="literal">Cell</code> object.</p></li><li class="listitem"><p>Read the <code class="literal">Cell</code> object’s <code class="literal">value</code> attribute.</p></li></ol></div></div></div><div class="sect1" title="Project: Reading Data from a Spreadsheet"><div class="titlepage"><div><div><h1 class="title"><a id="project_reading_data_from_a_spreadsheet"/>Project: Reading Data from a Spreadsheet</h1></div></div></div><p>Say you have a spreadsheet of data from the 2010 US Census and you have the boring task of going through its thousands of rows to count both the total population and the number of census tracts for each county. (A census tract is simply a geographic area defined for the purposes of the census.) Each row represents a single census tract. We’ll name the spreadsheet file <span class="emphasis"><em>censuspopdata.xlsx</em></span>, and you can download it from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>. Its contents look like <a class="xref" href="ch12.html#censuspopdatadotxlsx_spreadsheet" title="Figure 12-2. The censuspopdata.xlsx spreadsheet">Figure 12-2</a>.</p><div class="figure"><a id="censuspopdatadotxlsx_spreadsheet"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00053"/><img src="figs/web/12fig02.png" alt="The censuspopdata.xlsx spreadsheet"/></div></div><p class="title">Figure 12-2. The <span class="emphasis"><em>censuspopdata.xlsx</em></span> spreadsheet</p></div><p><a id="iddle1437" class="indexterm"/>Even though Excel can calculate the sum of multiple selected cells, you’d still have to select the cells for each of the 3,000-plus counties. Even if it takes just a few seconds to calculate a county’s population by hand, this would take hours to do for the whole spreadsheet.</p><p>In this project, you’ll write a script that can read from the census spreadsheet file and calculate statistics for each county in a matter of seconds.</p><p>This is what your program does:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Reads the data from the Excel spreadsheet.</p></li><li class="listitem"><p>Counts the number of census tracts in each county.</p></li><li class="listitem"><p>Counts the total population of each county.</p></li><li class="listitem"><p>Prints the results.</p></li></ul></div><p>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open and read the cells of an Excel document with the <code class="literal">openpyxl</code> module.</p></li><li class="listitem"><p>Calculate all the tract and population data and store it in a data structure.</p></li><li class="listitem"><p>Write the data structure to a text file with the <span class="emphasis"><em>.py</em></span> extension using the <code class="literal">pprint</code> module.</p></li></ul></div><div class="sect2" title="Step 1: Read the Spreadsheet Data"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_read_the_spreadsheet_data"/>Step 1: Read the Spreadsheet Data</h2></div></div></div><p>There is just one sheet in the <span class="emphasis"><em>censuspopdata.xlsx</em></span> spreadsheet, named <code class="literal">'Population by Census Tract'</code>, and each row holds the data for a single census tract. The columns are the tract number (A), the state abbreviation (B), the county name (C), and the population of the tract (D).</p><p>Open a new file editor window and enter the following code. Save the file as <span class="emphasis"><em>readCensusExcel.py</em></span>.</p><a id="pro_id00455"/><pre class="programlisting">   #! python3
   # readCensusExcel.py - Tabulates population and number of census tracts for
   # each county.

➊ import openpyxl, pprint
   print('Opening workbook...')
➋ wb = openpyxl.load_workbook('censuspopdata.xlsx')
➌ sheet = wb.get_sheet_by_name('Population by Census Tract')
   countyData = {}

   # TODO: Fill in countyData with each county's population and tracts.
   print('Reading rows...')
➍ for row in range(2, sheet.get_highest_row() + 1):
       # Each row in the spreadsheet has data for one census tract.
       state  = sheet['B' + str(row)].value
       county = sheet['C' + str(row)].value
       pop    = sheet['D' + str(row)].value

   # TODO: Open a new text file and write the contents of countyData to it.</pre><p><a id="iddle1436" class="indexterm"/>This code imports the <code class="literal">openpyxl</code> module, as well as the <code class="literal">pprint</code> module that you’ll use to print the final county data ➊. Then it opens the <span class="emphasis"><em>censuspopdata.xlsx</em></span> file ➋, gets the sheet with the census data ➌, and begins iterating over its rows ➍.</p><p>Note that you’ve also created a variable named <code class="literal">countyData</code>, which will contain the populations and number of tracts you calculate for each county. Before you can store anything in it, though, you should determine exactly how you’ll structure the data inside it.</p></div><div class="sect2" title="Step 2: Populate the Data Structure"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_populate_the_data_structure"/>Step 2: Populate the Data Structure</h2></div></div></div><p>The data structure stored in <code class="literal">countyData</code> will be a dictionary with state abbreviations as its keys. Each state abbreviation will map to another dictionary, whose keys are strings of the county names in that state. Each county name will in turn map to a dictionary with just two keys, <code class="literal">'tracts'</code> and <code class="literal">'pop'</code>. These keys map to the number of census tracts and population for the county. For example, the dictionary will look similar to this:</p><a id="pro_id00456"/><pre class="programlisting">{'AK': {'Aleutians East': {'pop': 3141, 'tracts': 1},
        'Aleutians West': {'pop': 5561, 'tracts': 2},
        'Anchorage': {'pop': 291826, 'tracts': 55},
        'Bethel': {'pop': 17013, 'tracts': 3},
        'Bristol Bay': {'pop': 997, 'tracts': 1},
        --<span class="emphasis"><em>snip</em></span>--</pre><p>If the previous dictionary were stored in <code class="literal">countyData</code>, the following expressions would evaluate like this:</p><a id="pro_id00457"/><pre class="programlisting">&gt;&gt;&gt; countyData['AK']['Anchorage']['pop']
291826
&gt;&gt;&gt; countyData['AK']['Anchorage']['tracts']
55</pre><p>More generally, the <code class="literal">countyData</code> dictionary’s keys will look like this:</p><a id="pro_id00458"/><pre class="programlisting">countyData[<span class="emphasis"><em>state abbrev</em></span>][<span class="emphasis"><em>county</em></span>]['tracts']
countyData[<span class="emphasis"><em>state abbrev</em></span>][<span class="emphasis"><em>county</em></span>]['pop']</pre><p>Now that you know how <code class="literal">countyData</code> will be structured, you can write the code that will fill it with the county data. Add the following code to the bottom of your program:</p><a id="pro_id00459"/><pre class="programlisting">   #! python 3
   # readCensusExcel.py - Tabulates population and number of census tracts for
   # each county.

   --<span class="emphasis"><em>snip</em></span>--
   for row in range(2, sheet.get_highest_row() + 1):
       # Each row in the spreadsheet has data for one census tract.
       state  = sheet['B' + str(row)].value
       county = sheet['C' + str(row)].value
       pop    = sheet['D' + str(row)].value

       <span class="strong"><strong># Make sure the key for this state exists.</strong></span>
➊     <span class="strong"><strong>countyData.setdefault(state, {})</strong></span>
       <span class="strong"><strong># Make sure the key for this county in this state exists.</strong></span>
➋     <span class="strong"><strong>countyData[state].setdefault(county, {'tracts': 0, 'pop': 0})</strong></span>

       <span class="strong"><strong># Each row represents one census tract, so increment by one.</strong></span>
➌     <span class="strong"><strong>countyData[state][county]['tracts'] += 1</strong></span>
       <span class="strong"><strong># Increase the county pop by the pop in this census tract.</strong></span>
➍     <span class="strong"><strong>countyData[state][county]['pop'] += int(pop)</strong></span>

   # TODO: Open a new text file and write the contents of countyData to it.</pre><p><a id="iddle1438" class="indexterm"/>The last two lines of code perform the actual calculation work, incrementing the value for <code class="literal">tracts</code> ➌ and increasing the value for <code class="literal">pop</code> ➍ for the current county on each iteration of the <code class="literal">for</code> loop.</p><p>The other code is there because you cannot add a county dictionary as the value for a state abbreviation key until the key itself exists in <code class="literal">countyData</code>. (That is, <code class="literal">countyData['AK']['Anchorage']['tracts'] += 1</code> will cause an error if the <code class="literal">'AK'</code> key doesn’t exist yet.) To make sure the state abbreviation key exists in your data structure, you need to call the <code class="literal">setdefault()</code> method to set a value if one does not already exist for <code class="literal">state</code> ➊.</p><p>Just as the <code class="literal">countyData</code> dictionary needs a dictionary as the value for each state abbreviation key, each of <span class="emphasis"><em>those</em></span> dictionaries will need its own dictionary as the value for each county key ➋. And each of <span class="emphasis"><em>those</em></span> dictionaries in turn will need keys <code class="literal">'tracts'</code> and <code class="literal">'pop'</code> that start with the integer value <code class="literal">0</code>. (If you ever lose track of the dictionary structure, look back at the example dictionary at the start of this section.)</p><p>Since <code class="literal">setdefault()</code> will do nothing if the key already exists, you can call it on every iteration of the <code class="literal">for</code> loop without a problem.</p></div><div class="sect2" title="Step 3: Write the Results to a File"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_write_the_results_to_a_file"/>Step 3: Write the Results to a File</h2></div></div></div><p>After the <code class="literal">for</code> loop has finished, the <code class="literal">countyData</code> dictionary will contain all of the population and tract information keyed by county and state. At this point, you could program more code to write this to a text file or another Excel spreadsheet. For now, let’s just use the <code class="literal">pprint.pformat()</code> function to write the <code class="literal">countyData</code> dictionary value as a massive string to a file named <span class="emphasis"><em>census2010.py</em></span>. Add the following code to the bottom of your program (making sure to keep it unindented so that it stays outside the <code class="literal">for</code> loop):</p><a id="pro_id00460"/><pre class="programlisting">#! python 3
# readCensusExcel.py - Tabulates population and number of census tracts for
# each county.
--<span class="emphasis"><em>snip</em></span>--

for row in range(2, sheet.get_highest_row() + 1):
--<span class="emphasis"><em>snip</em></span>--

<span class="strong"><strong># Open a new text file and write the contents of countyData to it.</strong></span>
<span class="strong"><strong>print('Writing results...')</strong></span>
<span class="strong"><strong>resultFile = open('census2010.py', 'w')</strong></span>
<span class="strong"><strong>resultFile.write('allData = ' + pprint.pformat(countyData))</strong></span>
<span class="strong"><strong>resultFile.close()</strong></span>
<span class="strong"><strong>print('Done.')</strong></span></pre><p>The <code class="literal">pprint.pformat()</code> function produces a string that itself is formatted as valid Python code. By outputting it to a text file named <span class="emphasis"><em>census2010.py</em></span>, you’ve generated a Python program from your Python program! This may seem complicated, but the advantage is that you can now import <span class="emphasis"><em>census2010.py</em></span> just like any other Python module. In the interactive shell, change the current working directory to the folder with your newly created <span class="emphasis"><em>census2010.py</em></span> file (on my laptop, this is <span class="emphasis"><em>C:\Python34</em></span>), and then import it:</p><a id="pro_id00461"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import os</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>os.chdir('C:\\Python34')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>import census2010</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>census2010.allData['AK']['Anchorage']</strong></span>
{'pop': 291826, 'tracts': 55}
&gt;&gt;&gt; <span class="strong"><strong>anchoragePop = census2010.allData['AK']['Anchorage']['pop']</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>print('The 2010 population of Anchorage was ' + str(anchoragePop))</strong></span>
The 2010 population of Anchorage was 291826</pre><p>The <span class="emphasis"><em>readCensusExcel.py</em></span> program was throwaway code: Once you have its results saved to <span class="emphasis"><em>census2010.py</em></span>, you won’t need to run the program again. Whenever you need the county data, you can just run <code class="literal">import census2010</code>.</p><p>Calculating this data by hand would have taken hours; this program did it in a few seconds. Using OpenPyXL, you will have no trouble extracting information that is saved to an Excel spreadsheet and performing calculations on it. You can download the complete program from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00040"/>Ideas for Similar Programs</h2></div></div></div><p>Many businesses and offices use Excel to store various types of data, and it’s not uncommon for spreadsheets to become large and unwieldy. Any program that parses an Excel spreadsheet has a similar structure: It loads the spreadsheet file, preps some variables or data structures, and then loops through each of the rows in the spreadsheet. Such a program could do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Compare data across multiple rows in a spreadsheet.</p></li><li class="listitem"><p>Open multiple Excel files and compare data between spreadsheets.</p></li><li class="listitem"><p><a id="iddle1422" class="indexterm"/><a id="iddle1441" class="indexterm"/><a id="iddle2718" class="indexterm"/>Check whether a spreadsheet has blank rows or invalid data in any cells and alert the user if it does.</p></li><li class="listitem"><p>Read data from a spreadsheet and use it as the input for your Python programs.</p></li></ul></div></div></div><div class="sect1" title="Writing Excel Documents"><div class="titlepage"><div><div><h1 class="title"><a id="writing_excel_documents"/>Writing Excel Documents</h1></div></div></div><p>OpenPyXL also provides ways of writing data, meaning that your programs can create and edit spreadsheet files. With Python, it’s simple to create spreadsheets with thousands of rows of data.</p><div class="sect2" title="Creating and Saving Excel Documents"><div class="titlepage"><div><div><h2 class="title"><a id="creating_and_saving_excel_documents"/>Creating and Saving Excel Documents</h2></div></div></div><p>Call the <code class="literal">openpyxl.Workbook()</code> function to create a new, blank <code class="literal">Workbook</code> object. Enter the following into the interactive shell:</p><a id="pro_id00462"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['Sheet']
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.title</strong></span>
'Sheet'
&gt;&gt;&gt; <span class="strong"><strong>sheet.title = 'Spam Bacon Eggs Sheet'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['Spam Bacon Eggs Sheet']</pre><p>The workbook will start off with a single sheet named <span class="emphasis"><em>Sheet</em></span>. You can change the name of the sheet by storing a new string in its <code class="literal">title</code> attribute.</p><p>Any time you modify the <code class="literal">Workbook</code> object or its sheets and cells, the spreadsheet file will not be saved until you call the <code class="literal">save()</code> workbook method. Enter the following into the interactive shell (with <span class="emphasis"><em>example.xlsx</em></span> in the current working directory):</p><a id="pro_id00463"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('example.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.title = 'Spam Spam Spam'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('example_copy.xlsx')</strong></span></pre><p>Here, we change the name of our sheet. To save our changes, we pass a filename as a string to the <code class="literal">save()</code> method. Passing a different filename than the original, such as <code class="literal">'example_copy.xlsx'</code>, saves the changes to a copy of the spreadsheet.</p><p>Whenever you edit a spreadsheet you’ve loaded from a file, you should always save the new, edited spreadsheet to a different filename than the original. That way, you’ll still have the original spreadsheet file to work with in case a bug in your code caused the new, saved file to have incorrect or corrupt data.</p></div><div class="sect2" title="Creating and Removing Sheets"><div class="titlepage"><div><div><h2 class="title"><a id="creating_and_removing_sheets"/>Creating and Removing Sheets</h2></div></div></div><p><a id="iddle1163" class="indexterm"/><a id="iddle1230" class="indexterm"/><a id="iddle1423" class="indexterm"/><a id="iddle1424" class="indexterm"/><a id="iddle1446" class="indexterm"/><a id="iddle2332" class="indexterm"/><a id="iddle2715" class="indexterm"/><a id="iddle2716" class="indexterm"/>Sheets can be added to and removed from a workbook with the <code class="literal">create_sheet()</code> and <code class="literal">remove_sheet()</code> methods. Enter the following into the interactive shell:</p><a id="pro_id00464"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['Sheet']
&gt;&gt;&gt; <span class="strong"><strong>wb.create_sheet()</strong></span>
&lt;Worksheet "Sheet1"&gt;
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['Sheet', 'Sheet1']
&gt;&gt;&gt; <span class="strong"><strong>wb.create_sheet(index=0, title='First Sheet')</strong></span>
&lt;Worksheet "First Sheet"&gt;
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['First Sheet', 'Sheet', 'Sheet1']
&gt;&gt;&gt; <span class="strong"><strong>wb.create_sheet(index=2, title='Middle Sheet')</strong></span>
&lt;Worksheet "Middle Sheet"&gt;
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['First Sheet', 'Sheet', 'Middle Sheet', 'Sheet1']</pre><p>The <code class="literal">create_sheet()</code> method returns a new <code class="literal">Worksheet</code> object named <code class="literal">Sheet</code><span class="emphasis"><em><code class="literal">X</code></em></span>, which by default is set to be the last sheet in the workbook. Optionally, the index and name of the new sheet can be specified with the <code class="literal">index</code> and <code class="literal">title</code> keyword arguments.</p><p>Continue the previous example by entering the following:</p><a id="pro_id00465"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['First Sheet', 'Sheet', 'Middle Sheet', 'Sheet1']
&gt;&gt;&gt; <span class="strong"><strong>wb.remove_sheet(wb.get_sheet_by_name('Middle Sheet'))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.remove_sheet(wb.get_sheet_by_name('Sheet1'))</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.get_sheet_names()</strong></span>
['First Sheet', 'Sheet']</pre><p>The <code class="literal">remove_sheet()</code> method takes a <code class="literal">Worksheet</code> object, not a string of the sheet name, as its argument. If you know only the name of a sheet you want to remove, call <code class="literal">get_sheet_by_name()</code> and pass its return value into <code class="literal">remove_sheet()</code>.</p><p>Remember to call the <code class="literal">save()</code> method to save the changes after adding sheets to or removing sheets from the workbook.</p></div><div class="sect2" title="Writing Values to Cells"><div class="titlepage"><div><div><h2 class="title"><a id="writing_values_to_cells"/>Writing Values to Cells</h2></div></div></div><p>Writing values to cells is much like writing values to keys in a dictionary. Enter this into the interactive shell:</p><a id="pro_id00466"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 'Hello world!'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'].value</strong></span>
'Hello world!'</pre><p><a id="iddle1442" class="indexterm"/><a id="iddle1443" class="indexterm"/><a id="iddle2199" class="indexterm"/>If you have the cell’s coordinate as a string, you can use it just like a dictionary key on the <code class="literal">Worksheet</code> object to specify which cell to write to.</p></div></div><div class="sect1" title="Project: Updating a Spreadsheet"><div class="titlepage"><div><div><h1 class="title"><a id="project_updating_a_spreadsheet"/>Project: Updating a Spreadsheet</h1></div></div></div><p>In this project, you’ll write a program to update cells in a spreadsheet of produce sales. Your program will look through the spreadsheet, find specific kinds of produce, and update their prices. Download this spreadsheet from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>. <a class="xref" href="ch12.html#spreadsheet_of_produce_sales" title="Figure 12-3. A spreadsheet of produce sales">Figure 12-3</a> shows what the spreadsheet looks like.</p><div class="figure"><a id="spreadsheet_of_produce_sales"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00054"/><img src="figs/web/12fig03.png.jpg" alt="A spreadsheet of produce sales"/></div></div><p class="title">Figure 12-3. A spreadsheet of produce sales</p></div><p>Each row represents an individual sale. The columns are the type of produce sold (A), the cost per pound of that produce (B), the number of pounds sold (C), and the total revenue from the sale (D). The TOTAL column is set to the Excel formula <span class="emphasis"><em>=ROUND(B3*C3, 2)</em></span>, which multiplies the cost per pound by the number of pounds sold and rounds the result to the nearest cent. With this formula, the cells in the TOTAL column will automatically update themselves if there is a change in column B or C.</p><p>Now imagine that the prices of garlic, celery, and lemons were entered incorrectly, leaving you with the boring task of going through thousands of rows in this spreadsheet to update the cost per pound for any garlic, celery, and lemon rows. You can’t do a simple find-and-replace for the price because there might be other items with the same price that you don’t want to mistakenly “correct.” For thousands of rows, this would take hours to do by hand. But you can write a program that can accomplish this in seconds.</p><p>Your program does the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Loops over all the rows.</p></li><li class="listitem"><p>If the row is for garlic, celery, or lemons, changes the price.</p></li></ul></div><p><a id="iddle1444" class="indexterm"/>This means your code will need to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Open the spreadsheet file.</p></li><li class="listitem"><p>For each row, check whether the value in column A is <code class="literal">Celery</code>, <code class="literal">Garlic</code>, or <code class="literal">Lemon</code>.</p></li><li class="listitem"><p>If it is, update the price in column B.</p></li><li class="listitem"><p>Save the spreadsheet to a new file (so that you don’t lose the old spreadsheet, just in case).</p></li></ul></div><div class="sect2" title="Step 1: Set Up a Data Structure with the Update Information"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_set_up_a_data_structure_with_the"/>Step 1: Set Up a Data Structure with the Update Information</h2></div></div></div><p>The prices that you need to update are as follows:</p><div class="informaltable"><table style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Celery</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>1.19</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Garlic</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>3.07</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p>Lemon</p></td><td style="" valign="top"><p>1.27</p></td></tr></tbody></table></div><p>You could write code like this:</p><a id="pro_id00467"/><pre class="programlisting">if produceName == 'Celery':
    cellObj = 1.19
if produceName == 'Garlic':
    cellObj = 3.07
if produceName == 'Lemon':
    cellObj = 1.27</pre><p>Having the produce and updated price data hardcoded like this is a bit inelegant. If you needed to update the spreadsheet again with different prices or different produce, you would have to change a lot of the code. Every time you change code, you risk introducing bugs.</p><p>A more flexible solution is to store the corrected price information in a dictionary and write your code to use this data structure. In a new file editor window, enter the following code:</p><a id="pro_id00468"/><pre class="programlisting">#! python3
# updateProduce.py - Corrects costs in produce sales spreadsheet.

import openpyxl

wb = openpyxl.load_workbook('produceSales.xlsx')
sheet = wb.get_sheet_by_name('Sheet')

# The produce types and their updated prices
PRICE_UPDATES = {'Garlic': 3.07,
                 'Celery': 1.19,
                 'Lemon': 1.27}

# TODO: Loop through the rows and update the prices.</pre><p>Save this as <span class="emphasis"><em>updateProduce.py</em></span>. If you need to update the spreadsheet again, you’ll need to update only the <code class="literal">PRICE_UPDATES</code> dictionary, not any other code.</p></div><div class="sect2" title="Step 2: Check All Rows and Update Incorrect Prices"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_check_all_rows_and_update_incorre"/>Step 2: Check All Rows and Update Incorrect Prices</h2></div></div></div><p>The next part of the program will loop through all the rows in the spreadsheet. Add the following code to the bottom of <span class="emphasis"><em>updateProduce.py</em></span>:</p><a id="pro_id00469"/><pre class="programlisting">   #! python3
   # updateProduce.py - Corrects costs in produce sales spreadsheet.

   --<span class="emphasis"><em>snip</em></span>--

   <span class="strong"><strong># Loop through the rows and update the prices.</strong></span>
➊ <span class="strong"><strong>for rowNum in range(2, sheet.get_highest_row()):  # skip the first row</strong></span>
➋     <span class="strong"><strong>produceName = sheet.cell(row=rowNum, column=1).value</strong></span>
➌     <span class="strong"><strong>if produceName in PRICE_UPDATES:</strong></span>
           <span class="strong"><strong>sheet.cell(row=rowNum, column=2).value = PRICE_UPDATES[produceName]</strong></span>

➍ <span class="strong"><strong>wb.save('updatedProduceSales.xlsx')</strong></span></pre><p>We loop through the rows starting at row 2, since row 1 is just the header ➊. The cell in column 1 (that is, column A) will be stored in the variable <code class="literal">produceName</code> ➋. If <code class="literal">produceName</code> exists as a key in the <code class="literal">PRICE_UPDATES</code> dictionary ➌, then you know this is a row that must have its price corrected. The correct price will be in <code class="literal">PRICE_UPDATES[produceName]</code>.</p><p>Notice how clean using <code class="literal">PRICE_UPDATES</code> makes the code. Only one <code class="literal">if</code> statement, rather than code like <code class="literal">if produceName == 'Garlic':</code>, is necessary for every type of produce to update. And since the code uses the <code class="literal">PRICE_UPDATES</code> dictionary instead of hardcoding the produce names and updated costs into the <code class="literal">for</code> loop, you modify only the <code class="literal">PRICE_UPDATES</code> dictionary and not the code if the produce sales spreadsheet needs additional changes.</p><p>After going through the entire spreadsheet and making changes, the code saves the <code class="literal">Workbook</code> object to <span class="emphasis"><em>updatedProduceSales.xlsx</em></span> ➍. It doesn’t overwrite the old spreadsheet just in case there’s a bug in your program and the updated spreadsheet is wrong. After checking that the updated spreadsheet looks right, you can delete the old spreadsheet.</p><p>You can download the complete source code for this program from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00041"/>Ideas for Similar Programs</h2></div></div></div><p>Since many office workers use Excel spreadsheets all the time, a program that can automatically edit and write Excel files could be really useful. Such a program could do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Read data from one spreadsheet and write it to parts of other spreadsheets.</p></li><li class="listitem"><p>Read data from websites, text files, or the clipboard and write it to a spreadsheet.</p></li><li class="listitem"><p>Automatically “clean up” data in spreadsheets. For example, it could use regular expressions to read multiple formats of phone numbers and edit them to a single, standard format.</p></li></ul></div></div></div><div class="sect1" title="Setting the Font Style of Cells"><div class="titlepage"><div><div><h1 class="title"><a id="setting_the_font_style_of_cells"/>Setting the Font Style of Cells</h1></div></div></div><p><a id="iddle1425" class="indexterm"/><a id="iddle1549" class="indexterm"/><a id="iddle1550" class="indexterm"/><a id="iddle2528" class="indexterm"/>Styling certain cells, rows, or columns can help you emphasize important areas in your spreadsheet. In the produce spreadsheet, for example, your program could apply bold text to the potato, garlic, and parsnip rows. Or perhaps you want to italicize every row with a cost per pound greater than $5. Styling parts of a large spreadsheet by hand would be tedious, but your programs can do it instantly.</p><p>To customize font styles in cells, important, import the <code class="literal">Font()</code> and <code class="literal">Style()</code> functions from the <code class="literal">openpyxl.styles</code> module.</p><a id="pro_id00470"/><pre class="programlisting">from openpyxl.styles import Font, Style</pre><p>This allows you to type <code class="literal">Font()</code> instead of <code class="literal">openpyxl.styles.Font()</code>. (See <a class="xref" href="ch02.html#importing_modules" title="Importing Modules">Importing Modules</a> to review this style of <code class="literal">import</code> statement.)</p><p>Here’s an example that creates a new workbook and sets cell A1 to have a 24-point, italicized font. Enter the following into the interactive shell:</p><a id="pro_id00471"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>from openpyxl.styles import Font, Style</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet')</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>italic24Font = Font(size=24, italic=True)</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>styleObj = Style(font=italic24Font)</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>sheet['A1'].style = styleObj</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 'Hello world!'</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>wb.save('styled.xlsx')</strong></span></pre><p>OpenPyXL represents the collection of style settings for a cell with a <code class="literal">Style</code> object, which is stored in the <code class="literal">Cell</code> object’s <code class="literal">style</code> attribute. A cell’s style can be set by assigning the <code class="literal">Style</code> object to the <code class="literal">style</code> attribute.</p><p>In this example, <code class="literal">Font(size=24, italic=True)</code> returns a <code class="literal">Font</code> object, which is stored in <code class="literal">italic24Font</code> ➊. The keyword arguments to <code class="literal">Font()</code>, <code class="literal">size</code> and <code class="literal">italic</code>, configure the <code class="literal">Font</code> object’s <code class="literal">style</code> attributes. This <code class="literal">Font</code> object is then passed into the <code class="literal">Style(font=italic24Font)</code> call, which returns the value you stored in <code class="literal">styleObj</code> ➋. And when <code class="literal">styleObj</code> is assigned to the cell’s <code class="literal">style</code> attribute ➌, all that font styling information gets applied to cell A1.</p></div><div class="sect1" title="Font Objects"><div class="titlepage"><div><div><h1 class="title"><a id="font_objects"/>Font Objects</h1></div></div></div><p>The <code class="literal">style</code> attributes in <code class="literal">Font</code> objects affect how the text in cells is displayed. To set font style attributes, you pass keyword arguments to <code class="literal">Font()</code>. <a class="xref" href="ch12.html#keyword_arguments_for_font_style_attribu" title="Table 12-2. Keyword Arguments for Font style Attributes">Table 12-2</a> shows the possible keyword arguments for the <code class="literal">Font()</code> function.</p><div class="table"><a id="keyword_arguments_for_font_style_attribu"/><p class="title">Table 12-2. Keyword Arguments for Font <code class="literal">style</code> Attributes</p><div class="table-contents"><table summary="Keyword Arguments for Font style Attributes" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Keyword argument</p></th><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Data type</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Description</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">name</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>String</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The font name, such as <code class="literal">'Calibri'</code> or <code class="literal">'Times New Roman'</code></p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">size</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Integer</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>The point size</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">bold</code></p></td><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p>Boolean</p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">True</code>, for bold font</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">italic</code></p></td><td style="border-right: 0.5pt solid ; " valign="top"><p>Boolean</p></td><td style="" valign="top"><p><code class="literal">True</code>, for italic font</p></td></tr></tbody></table></div></div><p>You can call <code class="literal">Font()</code> to create a <code class="literal">Font</code> object and store that <code class="literal">Font</code> object in a variable. You then pass that to <code class="literal">Style()</code>, store the resulting <code class="literal">Style</code> object in a variable, and assign that variable to a <code class="literal">Cell</code> object’s <code class="literal">style</code> attribute. For example, this code creates various font styles:</p><a id="pro_id00472"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>from openpyxl.styles import Font, Style</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_sheet_by_name('Sheet')</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>fontObj1 = Font(name='Times New Roman', bold=True)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>styleObj1 = Style(font=fontObj1)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'].style/styleObj</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 'Bold Times New Roman'</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>fontObj2 = Font(size=24, italic=True)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>styleObj2 = Style(font=fontObj2)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['B3'].style/styleObj</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['B3'] = '24 pt Italic'</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>wb.save('styles.xlsx')</strong></span></pre><p>Here, we store a <code class="literal">Font</code> object in <code class="literal">fontObj1</code> and use it to create a <code class="literal">Style</code> object, which we store in <code class="literal">styleObj1</code>, and then set the A1 <code class="literal">Cell</code> object’s <code class="literal">style</code> attribute to <code class="literal">styleObj</code>. We repeat the process with another <code class="literal">Font</code> object and <code class="literal">Style</code> object to set the style of a second cell. After you run this code, the styles of the A1 and B3 cells in the spreadsheet will be set to custom font styles, as shown in <a class="xref" href="ch12.html#spreadsheet_with_custom_font_styles" title="Figure 12-4. A spreadsheet with custom font styles">Figure 12-4</a>.</p><div class="figure"><a id="spreadsheet_with_custom_font_styles"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00055"/><img src="figs/web/12fig04.png" alt="A spreadsheet with custom font styles"/></div></div><p class="title">Figure 12-4. A spreadsheet with custom font styles</p></div><p><a id="iddle1426" class="indexterm"/><a id="iddle1565" class="indexterm"/>For cell A1, we set the font name to <code class="literal">'Times New Roman'</code> and set <code class="literal">bold</code> to <code class="literal">true</code>, so our text appears in bold Times New Roman. We didn’t specify a size, so the <code class="literal">openpyxl</code> default, 11, is used. In cell B3, our text is italic, with a size of 24; we didn’t specify a font name, so the <code class="literal">openpyxl</code> default, Calibri, is used.</p></div><div class="sect1" title="Formulas"><div class="titlepage"><div><div><h1 class="title"><a id="formulas"/>Formulas</h1></div></div></div><p>Formulas, which begin with an equal sign, can configure cells to contain values calculated from other cells. In this section, you’ll use the <code class="literal">openpyxl</code> module to programmatically add formulas to cells, just like any normal value. For example:</p><a id="pro_id00473"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>sheet['B9'] = '=SUM(B1:B8)'</strong></span></pre><p>This will store <span class="emphasis"><em>=SUM(B1:B8)</em></span> as the value in cell B9. This sets the B9 cell to a formula that calculates the sum of values in cells B1 to B8. You can see this in action in <a class="xref" href="ch12.html#cell_b9_contains_the_formula_equalssumle" title="Figure 12-5. Cell B9 contains the formula =SUM(B1:B8), which adds the cells B1 to B8.">Figure 12-5</a>.</p><div class="figure"><a id="cell_b9_contains_the_formula_equalssumle"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00056"/><img src="figs/web/12fig05.png.jpg" alt="Cell B9 contains the formula =SUM(B1:B8), which adds the cells B1 to B8."/></div></div><p class="title">Figure 12-5. Cell B9 contains the formula <span class="emphasis"><em>=SUM(B1:B8)</em></span>, which adds the cells B1 to B8.</p></div><p>A formula is set just like any other text value in a cell. Enter the following into the interactive shell:</p><a id="pro_id00474"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 200</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A2'] = 300</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A3'] = '=SUM(A1:A2)'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('writeFormula.xlsx')</strong></span></pre><p><a id="iddle1189" class="indexterm"/><a id="iddle1420" class="indexterm"/><a id="iddle1440" class="indexterm"/><a id="iddle2359" class="indexterm"/>The cells in A1 and A2 are set to 200 and 300, respectively. The value in cell A3 is set to a formula that sums the values in A1 and A2. When the spreadsheet is opened in Excel, A3 will display its value as 500.</p><p>You can also read the formula in a cell just as you would any value. However, if you want to see the result of the <span class="emphasis"><em>calculation</em></span> for the formula instead of the literal formula, you must pass <code class="literal">True</code> for the <code class="literal">data_only</code> keyword argument to <code class="literal">load_workbook()</code>. This means a <code class="literal">Workbook</code> object can show either the formulas or the result of the formulas but not both. (But you can have multiple <code class="literal">Workbook</code> objects loaded for the same spreadsheet file.) Enter the following into the interactive shell to see the difference between loading a workbook with and without the <code class="literal">data_only</code> keyword argument:</p><a id="pro_id00475"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wbFormulas = openpyxl.load_workbook('writeFormula.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wbFormulas.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A3'].value</strong></span>
'=SUM(A1:A2)'

&gt;&gt;&gt; <span class="strong"><strong>wbDataOnly = openpyxl.load_workbook('writeFormula.xlsx', data_only=True)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wbDataOnly.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A3'].value</strong></span>
500</pre><p>Here, when <code class="literal">load_workbook()</code> is called with <code class="literal">data_only=True</code>, the A3 cell shows 500, the result of the <span class="emphasis"><em>=SUM(A1:A2)</em></span> formula, rather than the text of the formula.</p><p>Excel formulas offer a level of programmability for spreadsheets but can quickly become unmanageable for complicated tasks. For example, even if you’re deeply familiar with Excel formulas, it’s a headache to try to decipher what <span class="emphasis"><em>=IFERROR(TRIM(IF(LEN(VLOOKUP(F7, Sheet2!$A$1:$B$10000, 2, FALSE))&gt;0,SUBSTITUTE(VLOOKUP(F7, Sheet2!$A$1:$B$10000, 2, FALSE), “ ”, “”),“”)), “”)</em></span> actually does. Python code is much more readable.</p></div><div class="sect1" title="Adjusting Rows and Columns"><div class="titlepage"><div><div><h1 class="title"><a id="adjusting_rows_and_columns"/>Adjusting Rows and Columns</h1></div></div></div><p>In Excel, adjusting the sizes of rows and columns is as easy as clicking and dragging the edges of a row or column header. But if you need to set a row or column’s size based on its cells’ contents or if you want to set sizes in a large number of spreadsheet files, it will be much quicker to write a Python program to do it.</p><p>Rows and columns can also be hidden entirely from view. Or they can be “frozen” in place so that they are always visible on the screen and appear on every page when the spreadsheet is printed (which is handy for headers).</p><div class="sect2" title="Setting Row Height and Column Width"><div class="titlepage"><div><div><h2 class="title"><a id="setting_row_height_and_column_width"/>Setting Row Height and Column Width</h2></div></div></div><p><a id="iddle1162" class="indexterm"/><a id="iddle1431" class="indexterm"/><code class="literal">Worksheet</code> objects have <code class="literal">row_dimensions</code> and <code class="literal">column_dimensions</code> attributes that control row heights and column widths. Enter this into the interactive shell:</p><a id="pro_id00476"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 'Tall row'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['B2'] = 'Wide column'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.row_dimensions[1].height = 70</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.column_dimensions['B'].width = 20</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('dimensions.xlsx')</strong></span></pre><p>A sheet’s <code class="literal">row_dimensions</code> and <code class="literal">column_dimensions</code> are dictionary-like values; <code class="literal">row_dimensions</code> contains <code class="literal">RowDimension</code> objects and <code class="literal">column_dimensions</code> contains <code class="literal">ColumnDimension</code> objects. In <code class="literal">row_dimensions</code>, you can access one of the objects using the number of the row (in this case, 1 or 2). In <code class="literal">column_dimensions</code>, you can access one of the objects using the letter of the column (in this case, A or B).</p><p>The <span class="emphasis"><em>dimensions.xlsx</em></span> spreadsheet looks like <a class="xref" href="ch12.html#row_1_and_column_b_set_to_larger_heights" title="Figure 12-6. Row 1 and column B set to larger heights and widths">Figure 12-6</a>.</p><div class="figure"><a id="row_1_and_column_b_set_to_larger_heights"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00057"/><img src="figs/web/12fig06.png.jpg" alt="Row 1 and column B set to larger heights and widths"/></div></div><p class="title">Figure 12-6. Row 1 and column B set to larger heights and widths</p></div><p>Once you have the <code class="literal">RowDimension</code> object, you can set its height. Once you have the <code class="literal">ColumnDimension</code> object, you can set its width. The row height can be set to an integer or float value between <code class="literal">0</code> and <code class="literal">409</code>. This value represents the height measured in <span class="emphasis"><em>points</em></span>, where one point equals 1/72 of an inch. The default row height is 12.75. The column width can be set to an integer or float value between <code class="literal">0</code> and <code class="literal">255</code>. This value represents the number of characters at the default font size (11 point) that can be displayed in the cell. The default column width is 8.43 characters. Columns with widths of <code class="literal">0</code> or rows with heights of <code class="literal">0</code> are hidden from the user.</p></div><div class="sect2" title="Merging and Unmerging Cells"><div class="titlepage"><div><div><h2 class="title"><a id="merging_and_unmerging_cells"/>Merging and Unmerging Cells</h2></div></div></div><p>A rectangular area of cells can be merged into a single cell with the <code class="literal">merge_cells()</code> sheet method. Enter the following into the interactive shell:</p><a id="pro_id00477"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.merge_cells('A1:D3')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['A1'] = 'Twelve cells merged together.'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.merge_cells('C5:D5')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet['C5'] = 'Two merged cells.'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('merged.xlsx')</strong></span></pre><p><a id="iddle1427" class="indexterm"/>The argument to <code class="literal">merge_cells()</code> is a single string of the top-left and bottom-right cells of the rectangular area to be merged: <code class="literal">'A1:D3'</code> merges 12 cells into a single cell. To set the value of these merged cells, simply set the value of the top-left cell of the merged group.</p><p>When you run this code, <span class="emphasis"><em>merged.xlsx</em></span> will look like <a class="xref" href="ch12.html#merged_cells_in_a_spreadsheet" title="Figure 12-7. Merged cells in a spreadsheet">Figure 12-7</a>.</p><div class="figure"><a id="merged_cells_in_a_spreadsheet"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00058"/><img src="figs/web/12fig07.png" alt="Merged cells in a spreadsheet"/></div></div><p class="title">Figure 12-7. Merged cells in a spreadsheet</p></div><p>To unmerge cells, call the <code class="literal">unmerge_cells()</code> sheet method. Enter this into the interactive shell.</p><a id="pro_id00478"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('merged.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.unmerge_cells('A1:D3')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.unmerge_cells('C5:D5')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('merged.xlsx')</strong></span></pre><p>If you save your changes and then take a look at the spreadsheet, you’ll see that the merged cells have gone back to being individual cells.</p></div><div class="sect2" title="Freeze Panes"><div class="titlepage"><div><div><h2 class="title"><a id="freeze_panes"/>Freeze Panes</h2></div></div></div><p>For spreadsheets too large to be displayed all at once, it’s helpful to “freeze” a few of the top rows or leftmost columns onscreen. Frozen column or row headers, for example, are always visible to the user even as they scroll through the spreadsheet. These are known as <span class="emphasis"><em>freeze panes</em></span>. In OpenPyXL, each <code class="literal">Worksheet</code> object has a <code class="literal">freeze_panes</code> attribute that can be set to a <code class="literal">Cell</code> object or a string of a cell’s coordinates. Note that all rows above and all columns to the left of this cell will be frozen, but the row and column of the cell itself will not be frozen.</p><p>To unfreeze all panes, set <code class="literal">freeze_panes</code> to <code class="literal">None</code> or <code class="literal">'A1'</code>. <a class="xref" href="ch12.html#frozen_pane_examples" title="Table 12-3. Frozen Pane Examples">Table 12-3</a> shows which rows and columns will be frozen for some example settings of <code class="literal">freeze_panes</code>.</p><div class="table"><a id="frozen_pane_examples"/><p class="title">Table 12-3. Frozen Pane Examples</p><div class="table-contents"><table summary="Frozen Pane Examples" style="border-collapse: collapse;border-top: 0.5pt solid ; border-bottom: 0.5pt solid ; border-left: 0.5pt solid ; border-right: 0.5pt solid ; "><colgroup><col/><col/></colgroup><thead><tr><th style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><a id="iddle1170" class="indexterm"/><a id="iddle1419" class="indexterm"/><code class="literal">freeze_panes</code> setting</p></th><th style="border-bottom: 0.5pt solid ; " valign="top"><p>Rows and columns frozen</p></th></tr></thead><tbody><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">sheet.freeze_panes = 'A2'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Row 1</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">sheet.freeze_panes = 'B1'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Column A</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">sheet.freeze_panes = 'C1'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Columns A and B</p></td></tr><tr><td style="border-right: 0.5pt solid ; border-bottom: 0.5pt solid ; " valign="top"><p><code class="literal">sheet.freeze_panes = 'C2'</code></p></td><td style="border-bottom: 0.5pt solid ; " valign="top"><p>Row 1 and columns A and B</p></td></tr><tr><td style="border-right: 0.5pt solid ; " valign="top"><p><code class="literal">sheet.freeze_panes = 'A1'</code> or <code class="literal">sheet.freeze_panes = None</code></p></td><td style="" valign="top"><p>No frozen panes</p></td></tr></tbody></table></div></div><p>Make sure you have the produce sales spreadsheet from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>. Then enter the following into the interactive shell:</p><a id="pro_id00479"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.load_workbook('produceSales.xlsx')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet.freeze_panes = 'A2'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('freezeExample.xlsx')</strong></span></pre><p>If you set the <code class="literal">freeze_panes</code> attribute to <code class="literal">'A2'</code>, row 1 will always be viewable, no matter where the user scrolls in the spreadsheet. You can see this in <a class="xref" href="ch12.html#with_freezeunderscorepanes_set_to_apostr" title="Figure 12-8. With freeze_panes set to 'A2', row 1 is always visible even as the user scrolls down.">Figure 12-8</a>.</p><div class="figure"><a id="with_freezeunderscorepanes_set_to_apostr"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00059"/><img src="figs/web/12fig08.png.jpg" alt="With freeze_panes set to 'A2', row 1 is always visible even as the user scrolls down."/></div></div><p class="title">Figure 12-8. With <code class="literal">freeze_panes</code> set to <code class="literal">'A2'</code>, row 1 is always visible even as the user scrolls down.</p></div></div></div><div class="sect1" title="Charts"><div class="titlepage"><div><div><h1 class="title"><a id="charts"/>Charts</h1></div></div></div><p>OpenPyXL supports creating bar, line, scatter, and pie charts using the data in a sheet’s cells. To make a chart, you need to do the following:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>Create a <code class="literal">Reference</code> object from a rectangular selection of cells.</p></li><li class="listitem"><p>Create a <code class="literal">Series</code> object by passing in the <code class="literal">Reference</code> object.</p></li><li class="listitem"><p>Create a <code class="literal">Chart</code> object.</p></li><li class="listitem"><p><a id="iddle2295" class="indexterm"/>Append the <code class="literal">Series</code> object to the <code class="literal">Chart</code> object.</p></li><li class="listitem"><p>Optionally, set the <code class="literal">drawing.top</code>, <code class="literal">drawing.left</code>, <code class="literal">drawing.width</code>, and <code class="literal">drawing.height</code> variables of the <code class="literal">Chart</code> object.</p></li><li class="listitem"><p>Add the <code class="literal">Chart</code> object to the <code class="literal">Worksheet</code> object.</p></li></ol></div><p>The <code class="literal">Reference</code> object requires some explaining. <code class="literal">Reference</code> objects are created by calling the <code class="literal">openpyxl.charts.Reference()</code> function and passing three arguments:</p><div class="orderedlist"><ol class="orderedlist"><li class="listitem"><p>The <code class="literal">Worksheet</code> object containing your chart data.</p></li><li class="listitem"><p>A tuple of two integers, representing the top-left cell of the rectangular selection of cells containing your chart data: The first integer in the tuple is the row, and the second is the column. Note that <code class="literal">1</code> is the first row, not <code class="literal">0</code>.</p></li><li class="listitem"><p>A tuple of two integers, representing the bottom-right cell of the rectangular selection of cells containing your chart data: The first integer in the tuple is the row, and the second is the column.</p></li></ol></div><p><a class="xref" href="ch12.html#from_left_to_right_left_parenthesis1comm" title="Figure 12-9. From left to right: (1, 1), (10, 1); (3, 2), (6, 4); (5, 3), (5, 3)">Figure 12-9</a> shows some sample coordinate arguments.</p><div class="figure"><a id="from_left_to_right_left_parenthesis1comm"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00060"/><img src="figs/web/12fig09.png.jpg" alt="From left to right: (1, 1), (10, 1); (3, 2), (6, 4); (5, 3), (5, 3)"/></div></div><p class="title">Figure 12-9. From left to right: <code class="literal">(1, 1), (10, 1)</code>; <code class="literal">(3, 2), (6, 4)</code>; <code class="literal">(5, 3), (5, 3)</code></p></div><p>Enter this interactive shell example to create a bar chart and add it to the spreadsheet:</p><a id="pro_id00480"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import openpyxl</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb = openpyxl.Workbook()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>sheet = wb.get_active_sheet()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>for i in range(1, 11):         # create some data in column A</strong></span>
        <span class="strong"><strong>sheet['A' + str(i)] = i</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>refObj = openpyxl.charts.Reference(sheet, (1, 1), (10, 1))</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>seriesObj = openpyxl.charts.Series(refObj, title='First series')</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>chartObj = openpyxl.charts.BarChart()</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>chartObj.append(seriesObj)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>chartObj.drawing.top = 50       # set the position</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>chartObj.drawing.left = 100</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>chartObj.drawing.width = 300    # set the size</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>chartObj.drawing.height = 200</strong></span>

&gt;&gt;&gt; <span class="strong"><strong>sheet.add_chart(chartObj)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>wb.save('sampleChart.xlsx')</strong></span></pre><p><a id="iddle1112" class="indexterm"/><a id="iddle1812" class="indexterm"/>This produces a spreadsheet that looks like <a class="xref" href="ch12.html#spreadsheet_with_a_chart_added" title="Figure 12-10. A spreadsheet with a chart added">Figure 12-10</a>.</p><div class="figure"><a id="spreadsheet_with_a_chart_added"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00061"/><img src="figs/web/12fig10.png.jpg" alt="A spreadsheet with a chart added"/></div></div><p class="title">Figure 12-10. A spreadsheet with a chart added</p></div><p>We’ve created a bar chart by calling <code class="literal">openpyxl.charts.BarChart()</code>. You can also create line charts, scatter charts, and pie charts by calling <code class="literal">openpyxl.charts.LineChart()</code>, <code class="literal">openpyxl.charts.ScatterChart()</code>, and <code class="literal">openpyxl.charts.PieChart()</code>.</p><p>Unfortunately, in the current version of OpenPyXL (2.1.4), the <code class="literal">load_workbook()</code> function does not load charts in Excel files. Even if the Excel file has charts, the loaded <code class="literal">Workbook</code> object will not include them. If you load a <code class="literal">Workbook</code> object and immediately save it to the same <span class="emphasis"><em>.xlsx</em></span> filename, you will effectively remove the charts from it.</p></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00042"/>Summary</h1></div></div></div><p>Often the hard part of processing information isn’t the processing itself but simply getting the data in the right format for your program. But once you have your spreadsheet loaded into Python, you can extract and manipulate its data much faster than you could by hand.</p><p>You can also generate spreadsheets as output from your programs. So if colleagues need your text file or PDF of thousands of sales contacts transferred to a spreadsheet file, you won’t have to tediously copy and paste it all into Excel.</p><p>Equipped with the <code class="literal">openpyxl</code> module and some programming knowledge, you’ll find processing even the biggest spreadsheets a piece of cake.</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00043"/>Practice Questions</h1></div></div></div><p>For the following questions, imagine you have a <code class="literal">Workbook</code> object in the variable <code class="literal">wb</code>, a <code class="literal">Worksheet</code> object in <code class="literal">sheet</code>, a <code class="literal">Cell</code> object in <code class="literal">cell</code>, a <code class="literal">Comment</code> object in <code class="literal">comm</code>, and an <code class="literal">Image</code> object in <code class="literal">img</code>.</p><div class="qandaset" title="Frequently Asked Questions"><a id="ch12qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe1"/><a id="ch12qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. What does the <code class="literal">openpyxl.load_workbook()</code> function return?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe2"/><a id="ch12qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. What does the <code class="literal">get_sheet_names()</code> workbook method return?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe3"/><a id="ch12qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. How would you retrieve the <code class="literal">Worksheet</code> object for a sheet named <code class="literal">'Sheet1'</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe4"/><a id="ch12qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. How would you retrieve the <code class="literal">Worksheet</code> object for the workbook’s active sheet?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe5"/><a id="ch12qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. How would you retrieve the value in the cell C5?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe6"/><a id="ch12qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. How would you set the value in the cell C5 to <code class="literal">"Hello"</code>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe7"/><a id="ch12qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. How would you retrieve the cell’s row and column as integers?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe8"/><a id="ch12qa1q8"/><p>Q:</p></td><td align="left" valign="top"><p>8. What do the <code class="literal">get_highest_column()</code> and <code class="literal">get_highest_row()</code> sheet methods return, and what is the data type of these return values?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe9"/><a id="ch12qa1q9"/><p>Q:</p></td><td align="left" valign="top"><p>9. If you needed to get the integer index for column <code class="literal">'M'</code>, what function would you need to call?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe10"/><a id="ch12qa1q10"/><p>Q:</p></td><td align="left" valign="top"><p>10. If you needed to get the string name for column <code class="literal">14</code>, what function would you need to call?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe11"/><a id="ch12qa1q11"/><p>Q:</p></td><td align="left" valign="top"><p>11. How can you retrieve a tuple of all the <code class="literal">Cell</code> objects from A1 to F1?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe12"/><a id="ch12qa1q12"/><p>Q:</p></td><td align="left" valign="top"><p>12. How would you save the workbook to the filename <span class="emphasis"><em>example.xlsx</em></span>?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe13"/><a id="ch12qa1q13"/><p>Q:</p></td><td align="left" valign="top"><p>13. How do you set a formula in a cell?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe14"/><a id="ch12qa1q14"/><p>Q:</p></td><td align="left" valign="top"><p>14. If you want to retrieve the result of a cell’s formula instead of the cell’s formula itself, what must you do first?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe15"/><a id="ch12qa1q15"/><p>Q:</p></td><td align="left" valign="top"><p>15. How would you set the height of row 5 to 100?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe16"/><a id="ch12qa1q16"/><p>Q:</p></td><td align="left" valign="top"><p>16. How would you hide column C?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe17"/><a id="ch12qa1q17"/><p>Q:</p></td><td align="left" valign="top"><p>17. Name a few features that OpenPyXL 2.1.4 does not load from a spreadsheet file.</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe18"/><a id="ch12qa1q18"/><p>Q:</p></td><td align="left" valign="top"><p>18. What is a freeze pane?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch12qa1qe19"/><a id="ch12qa1q19"/><p>Q:</p></td><td align="left" valign="top"><p>19. What five functions and methods do you have to call to create a bar chart?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Projects"><div class="titlepage"><div><div><h1 class="title"><a id="practice_projects-id00044"/>Practice Projects</h1></div></div></div><p>For practice, write programs that perform the following tasks.</p><div class="sect2" title="Multiplication Table Maker"><div class="titlepage"><div><div><h2 class="title"><a id="multiplication_table_maker"/>Multiplication Table Maker</h2></div></div></div><p>Create a program <span class="emphasis"><em>multiplicationTable.py</em></span> that takes a number <span class="emphasis"><em>N</em></span> from the command line and creates an <span class="emphasis"><em>N</em></span>×<span class="emphasis"><em>N</em></span> multiplication table in an Excel spreadsheet. For example, when the program is run like this:</p><a id="pro_id00481"/><pre class="programlisting">py multiplicationTable.py 6</pre><p>... it should create a spreadsheet that looks like <a class="xref" href="ch12.html#multiplication_table_generated_in_a_spre" title="Figure 12-11. A multiplication table generated in a spreadsheet">Figure 12-11</a>.</p><div class="figure"><a id="multiplication_table_generated_in_a_spre"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00062"/><img src="figs/web/12fig11.png.jpg" alt="A multiplication table generated in a spreadsheet"/></div></div><p class="title">Figure 12-11. A multiplication table generated in a spreadsheet</p></div><p>Row 1 and column A should be used for labels and should be in bold.</p></div><div class="sect2" title="Blank Row Inserter"><div class="titlepage"><div><div><h2 class="title"><a id="blank_row_inserter"/>Blank Row Inserter</h2></div></div></div><p>Create a program <span class="emphasis"><em>blankRowInserter.py</em></span> that takes two integers and a filename string as command line arguments. Let’s call the first integer <span class="emphasis"><em>N</em></span> and the second integer <span class="emphasis"><em>M</em></span>. Starting at row <span class="emphasis"><em>N</em></span>, the program should insert <span class="emphasis"><em>M</em></span> blank rows into the spreadsheet. For example, when the program is run like this:</p><a id="pro_id00482"/><pre class="programlisting">python blankRowInserter.py 3 2 myProduce.xlsx</pre><p>... the “before” and “after” spreadsheets should look like <a class="xref" href="ch12.html#before_left_parenthesisleftright_parenth" title="Figure 12-12. Before (left) and after (right) the two blank rows are inserted at row 3">Figure 12-12</a>.</p><div class="figure"><a id="before_left_parenthesisleftright_parenth"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00063"/><img src="figs/web/12fig12.png.jpg" alt="Before (left) and after (right) the two blank rows are inserted at row 3"/></div></div><p class="title">Figure 12-12. Before (left) and after (right) the two blank rows are inserted at row 3</p></div><p>You can write this program by reading in the contents of the spreadsheet. Then, when writing out the new spreadsheet, use a <code class="literal">for</code> loop to copy the first <span class="emphasis"><em>N</em></span> lines. For the remaining lines, add <span class="emphasis"><em>M</em></span> to the row number in the output spreadsheet.</p></div><div class="sect2" title="Spreadsheet Cell Inverter"><div class="titlepage"><div><div><h2 class="title"><a id="spreadsheet_cell_inverter"/>Spreadsheet Cell Inverter</h2></div></div></div><p>Write a program to invert the row and column of the cells in the spreadsheet. For example, the value at row 5, column 3 will be at row 3, column 5 (and vice versa). This should be done for all cells in the spreadsheet. For example, the “before” and “after” spreadsheets would look something like <a class="xref" href="ch12.html#spreadsheet_before_left_parenthesistopri" title="Figure 12-13. The spreadsheet before (top) and after (bottom) inversion">Figure 12-13</a>.</p><div class="figure"><a id="spreadsheet_before_left_parenthesistopri"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00064"/><img src="figs/web/12fig13.png.jpg" alt="The spreadsheet before (top) and after (bottom) inversion"/></div></div><p class="title">Figure 12-13. The spreadsheet before (top) and after (bottom) inversion</p></div><p>You can write this program by using nested <code class="literal">for</code> loops to read in the spreadsheet’s data into a list of lists data structure. This data structure could have <code class="literal">sheetData[x][y]</code> for the cell at column <code class="literal">x</code> and row <code class="literal">y</code>. Then, when writing out the new spreadsheet, use <code class="literal">sheetData[y][x]</code> for the cell at column <code class="literal">x</code> and row <code class="literal">y</code>.</p></div><div class="sect2" title="Text Files to Spreadsheet"><div class="titlepage"><div><div><h2 class="title"><a id="text_files_to_spreadsheet"/>Text Files to Spreadsheet</h2></div></div></div><p>Write a program to read in the contents of several text files (you can make the text files yourself) and insert those contents into a spreadsheet, with one line of text per row. The lines of the first text file will be in the cells of column A, the lines of the second text file will be in the cells of column B, and so on.</p><p>Use the <code class="literal">readlines() File</code> object method to return a list of strings, one string per line in the file. For the first file, output the first line to column 1, row 1. The second line should be written to column 1, row 2, and so on. The next file that is read with <code class="literal">readlines()</code> will be written to column 2, the next file to column 3, and so on.</p></div><div class="sect2" title="Spreadsheet to Text Files"><div class="titlepage"><div><div><h2 class="title"><a id="spreadsheet_to_text_files"/>Spreadsheet to Text Files</h2></div></div></div><p>Write a program that performs the tasks of the previous program in reverse order: The program should open a spreadsheet and write the cells of column A into one text file, the cells of column B into another text file, and so on.</p></div></div></div></body></html>
