<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.1//EN" "http://www.w3.org/TR/xhtml11/DTD/xhtml11.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Chapter 14. Working with CSV Files and JSON Data</title><link rel="stylesheet" href="core.css" type="text/css"/><meta name="generator" content="DocBook XSL Stylesheets V1.74.0"/></head><body><div class="chapter" title="Chapter 14. Working with CSV Files and JSON Data"><div class="titlepage"><div><div><h1 class="title"><a id="working_with_csv_files_and_json_data"/>Chapter 14. Working with CSV Files and JSON Data</h1></div></div></div><p><a id="iddle1236" class="indexterm"/><a id="iddle1770" class="indexterm"/>In <a class="xref" href="ch13.html" title="Chapter 13. Working with PDF and word Documents">Chapter 13</a>, you learned how to extract text from PDF and Word documents. These files were in a binary format, which required special Python modules to access their data. CSV and JSON files, on the other hand, are just plaintext files. You can view them in a text editor, such as IDLE’s file editor. But Python also comes with the special <code class="literal">csv</code> and <code class="literal">json</code> modules, each providing functions to help you work with these file formats.</p><p>CSV stands for “comma-separated values,” and CSV files are simplified spreadsheets stored as plaintext files. Python’s <code class="literal">csv</code> module makes it easy to parse CSV files.</p><p>JSON (pronounced “JAY-sawn” or “Jason”—it doesn’t matter how because either way people will say you’re pronouncing it wrong) is a format that stores information as JavaScript source code in plaintext files.</p><p><a id="iddle1238" class="indexterm"/><a id="iddle2458" class="indexterm"/>(JSON is short for JavaScript Object Notation.) You don’t need to know the JavaScript programming language to use JSON files, but the JSON format is useful to know because it’s used in many web applications.</p><div class="sect1" title="The CSV Module"><div class="titlepage"><div><div><h1 class="title"><a id="csv_module"/>The CSV Module</h1></div></div></div><p>Each line in a CSV file represents a row in the spreadsheet, and commas separate the cells in the row. For example, the spreadsheet <span class="emphasis"><em>example.xlsx</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> would look like this in a CSV file:</p><a id="pro_id00506"/><pre class="programlisting">4/5/2015 13:34,Apples,73
4/5/2015 3:41,Cherries,85
4/6/2015 12:46,Pears,14
4/8/2015 8:59,Oranges,52
4/10/2015 2:07,Apples,152
4/10/2015 18:10,Bananas,23
4/10/2015 2:40,Strawberries,98</pre><p>I will use this file for this chapter’s interactive shell examples. You can download <span class="emphasis"><em>example.csv</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> or enter the text into a text editor and save it as <span class="emphasis"><em>example.csv</em></span>.</p><p>CSV files are simple, lacking many of the features of an Excel spreadsheet. For example, CSV files</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Don’t have types for their values—everything is a string</p></li><li class="listitem"><p>Don’t have settings for font size or color</p></li><li class="listitem"><p>Don’t have multiple worksheets</p></li><li class="listitem"><p>Can’t specify cell widths and heights</p></li><li class="listitem"><p>Can’t have merged cells</p></li><li class="listitem"><p>Can’t have images or charts embedded in them</p></li></ul></div><p>The advantage of CSV files is simplicity. CSV files are widely supported by many types of programs, can be viewed in text editors (including IDLE’s file editor), and are a straightforward way to represent spreadsheet data. The CSV format is exactly as advertised: It’s just a text file of comma-separated values.</p><p>Since CSV files are just text files, you might be tempted to read them in as a string and then process that string using the techniques you learned in <a class="xref" href="ch08.html" title="Chapter 8. Reading and Writing Files">Chapter 8</a>. For example, since each cell in a CSV file is separated by a comma, maybe you could just call the <code class="literal">split()</code> method on each line of text to get the values. But not every comma in a CSV file represents the boundary between two cells. CSV files also have their own set of escape characters to allow commas and other characters to be included <span class="emphasis"><em>as part of the values</em></span>. The <code class="literal">split()</code> method doesn’t handle these escape characters. Because of these potential pitfalls, you should always use the <code class="literal">csv</code> module for reading and writing CSV files.</p><div class="sect2" title="Reader Objects"><div class="titlepage"><div><div><h2 class="title"><a id="reader_objects"/>Reader Objects</h2></div></div></div><p><a id="iddle1240" class="indexterm"/><a id="iddle1830" class="indexterm"/><a id="iddle2288" class="indexterm"/>To read data from a CSV file with the <code class="literal">csv</code> module, you need to create a <code class="literal">Reader</code> object. A <code class="literal">Reader</code> object lets you iterate over lines in the CSV file. Enter the following into the interactive shell, with <span class="emphasis"><em>example.csv</em></span> in the current working directory:</p><a id="pro_id00507"/><pre class="programlisting">➊ &gt;&gt;&gt; <span class="strong"><strong>import csv</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>exampleFile = open('example.csv')</strong></span>
➌ &gt;&gt;&gt; <span class="strong"><strong>exampleReader = csv.reader(exampleFile)</strong></span>
➍ &gt;&gt;&gt; <span class="strong"><strong>exampleData = list(exampleReader)</strong></span>
➍ &gt;&gt;&gt; <span class="strong"><strong>exampleData</strong></span>
   [['4/5/2015 13:34', 'Apples', '73'], ['4/5/2015 3:41', 'Cherries', '85'],
   ['4/6/2015 12:46', 'Pears', '14'], ['4/8/2015 8:59', 'Oranges', '52'],
   ['4/10/2015 2:07', 'Apples', '152'], ['4/10/2015 18:10', 'Bananas', '23'],
   ['4/10/2015 2:40', 'Strawberries', '98']]</pre><p>The <code class="literal">csv</code> module comes with Python, so we can import it ➊ without having to install it first.</p><p>To read a CSV file with the <code class="literal">csv</code> module, first open it using the <code class="literal">open()</code> function ➋, just as you would any other text file. But instead of calling the <code class="literal">read()</code> or <code class="literal">readlines()</code> method on the <code class="literal">File</code> object that <code class="literal">open()</code> returns, pass it to the <code class="literal">csv.reader()</code> function ➌. This will return a <code class="literal">Reader</code> object for you to use. Note that you don’t pass a filename string directly to the <code class="literal">csv.reader()</code> function.</p><p>The most direct way to access the values in the <code class="literal">Reader</code> object is to convert it to a plain Python list by passing it to <code class="literal">list()</code> ➍. Using <code class="literal">list()</code> on this <code class="literal">Reader</code> object returns a list of lists, which you can store in a variable like <code class="literal">exampleData</code>. Entering <code class="literal">exampleData</code> in the shell displays the list of lists ➎.</p><p>Now that you have the CSV file as a list of lists, you can access the value at a particular row and column with the expression <code class="literal">exampleData[row][col]</code>, where <code class="literal">row</code> is the index of one of the lists in <code class="literal">exampleData</code>, and <code class="literal">col</code> is the index of the item you want from that list. Enter the following into the interactive shell:</p><a id="pro_id00508"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>exampleData[0][0]</strong></span>
'4/5/2015 13:34'
&gt;&gt;&gt; <span class="strong"><strong>exampleData[0][1]</strong></span>
'Apples'
&gt;&gt;&gt; <span class="strong"><strong>exampleData[0][2]</strong></span>
'73'
&gt;&gt;&gt; <span class="strong"><strong>exampleData[1][1]</strong></span>
'Cherries'
&gt;&gt;&gt; <span class="strong"><strong>exampleData[6][1]</strong></span>
'Strawberries'</pre><p><code class="literal">exampleData[0][0]</code> goes into the first list and gives us the first string, <code class="literal">exampleData[0][2]</code> goes into the first list and gives us the third string, and so on.</p></div><div class="sect2" title="Reading Data from Reader Objects in a for Loop"><div class="titlepage"><div><div><h2 class="title"><a id="reading_data_from_reader_objects_in_a_fo"/>Reading Data from Reader Objects in a for Loop</h2></div></div></div><p><a id="iddle1241" class="indexterm"/><a id="iddle1247" class="indexterm"/><a id="iddle1887" class="indexterm"/><a id="iddle2005" class="indexterm"/><a id="iddle2721" class="indexterm"/>For large CSV files, you’ll want to use the <code class="literal">Reader</code> object in a <code class="literal">for</code> loop. This avoids loading the entire file into memory at once. For example, enter the following into the interactive shell:</p><a id="pro_id00509"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>import csv</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>exampleFile = open('example.csv')</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>exampleReader = csv.reader(exampleFile)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>for row in exampleReader:</strong></span>
        <span class="strong"><strong>print('Row #' + str(exampleReader.line_num) + ' ' + str(row))</strong></span>

Row #1 ['4/5/2015 13:34', 'Apples', '73']
Row #2 ['4/5/2015 3:41', 'Cherries', '85']
Row #3 ['4/6/2015 12:46', 'Pears', '14']
Row #4 ['4/8/2015 8:59', 'Oranges', '52']
Row #5 ['4/10/2015 2:07', 'Apples', '152']
Row #6 ['4/10/2015 18:10', 'Bananas', '23']
Row #7 ['4/10/2015 2:40', 'Strawberries', '98']</pre><p>After you import the <code class="literal">csv</code> module and make a <code class="literal">Reader</code> object from the CSV file, you can loop through the rows in the <code class="literal">Reader</code> object. Each row is a list of values, with each value representing a cell.</p><p>The <code class="literal">print()</code> function call prints the number of the current row and the contents of the row. To get the row number, use the <code class="literal">Reader</code> object’s <code class="literal">line_num</code> variable, which contains the number of the current line.</p><p>The <code class="literal">Reader</code> object can be looped over only once. To reread the CSV file, you must call <code class="literal">csv.reader</code> to create a <code class="literal">Reader</code> object.</p></div><div class="sect2" title="Writer Objects"><div class="titlepage"><div><div><h2 class="title"><a id="writer_objects"/>Writer Objects</h2></div></div></div><p>A <code class="literal">Writer</code> object lets you write data to a CSV file. To create a <code class="literal">Writer</code> object, you use the <code class="literal">csv.writer()</code> function. Enter the following into the interactive shell:</p><a id="pro_id00510"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import csv</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>outputFile = open('output.csv', 'w', newline='')</strong></span>
➋ &gt;&gt;&gt; <span class="strong"><strong>outputWriter = csv.writer(outputFile)</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>outputWriter.writerow(['spam', 'eggs', 'bacon', 'ham'])</strong></span>
   21
   &gt;&gt;&gt; <span class="strong"><strong>outputWriter.writerow(['Hello, world!', 'eggs', 'bacon', 'ham'])</strong></span>
   32
   &gt;&gt;&gt; <span class="strong"><strong>outputWriter.writerow([1, 2, 3.141592, 4])</strong></span>
   16
   &gt;&gt;&gt; <span class="strong"><strong>outputFile.close()</strong></span></pre><p>First, call <code class="literal">open()</code> and pass it <code class="literal">'w'</code> to open a file in write mode ➊. This will create the object you can then pass to <code class="literal">csv.writer()</code> ➋ to create a <code class="literal">Writer</code> object.</p><p>On Windows, you’ll also need to pass a blank string for the <code class="literal">open()</code> function’s <code class="literal">newline</code> keyword argument. For technical reasons beyond the scope of this book, if you forget to set the <code class="literal">newline</code> argument, the rows in <span class="emphasis"><em>output.csv</em></span> will be double-spaced, as shown in <a class="xref" href="ch14.html#if_you_forget_the_newlineequalsapostroph" title="Figure 14-1. If you forget the newline='' keyword argument in open(), the CSV file will be double-spaced.">Figure 14-1</a>.</p><div class="figure"><a id="if_you_forget_the_newlineequalsapostroph"/><div class="figure-contents"><div class="mediaobject"><a id="med_id00076"/><img src="figs/web/14fig01.png" alt="If you forget the newline='' keyword argument in open(), the CSV file will be double-spaced."/></div></div><p class="title">Figure 14-1. If you forget the <code class="literal">newline=''</code> keyword argument in <code class="literal">open()</code>, the CSV file will be double-spaced.</p></div><p><a id="iddle2722" class="indexterm"/>The <code class="literal">writerow()</code> method for <code class="literal">Writer</code> objects takes a list argument. Each value in the list is placed in its own cell in the output CSV file. The return value of <code class="literal">writerow()</code> is the number of characters written to the file for that row (including newline characters).</p><p>This code produces an <span class="emphasis"><em>output.csv</em></span> file that looks like this:</p><a id="pro_id00511"/><pre class="programlisting">spam,eggs,bacon,ham
"Hello, world!",eggs,bacon,ham
1,2,3.141592,4</pre><p>Notice how the <code class="literal">Writer</code> object automatically escapes the comma in the value <code class="literal">'Hello, world!'</code> with double quotes in the CSV file. The <code class="literal">csv</code> module saves you from having to handle these special cases yourself.</p></div><div class="sect2" title="The delimiter and lineterminator Keyword Arguments"><div class="titlepage"><div><div><h2 class="title"><a id="delimiter_and_lineterminator_keyword_arg"/>The delimiter and lineterminator Keyword Arguments</h2></div></div></div><p>Say you want to separate cells with a tab character instead of a comma and you want the rows to be double-spaced. You could enter something like the following into the interactive shell:</p><a id="pro_id00512"/><pre class="programlisting">   &gt;&gt;&gt; <span class="strong"><strong>import csv</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>csvFile = open('example.tsv', 'w', newline='')</strong></span>
➊ &gt;&gt;&gt; <span class="strong"><strong>csvWriter = csv.writer(csvFile, delimiter='\t', lineterminator='\n\n')</strong></span>
   &gt;&gt;&gt; <span class="strong"><strong>csvWriter.writerow(['apples', 'oranges', 'grapes'])</strong></span>
   24
   &gt;&gt;&gt; <span class="strong"><strong>csvWriter.writerow(['eggs', 'bacon', 'ham'])</strong></span>
   17
   &gt;&gt;&gt; <span class="strong"><strong>csvWriter.writerow(['spam', 'spam', 'spam', 'spam', 'spam', 'spam'])</strong></span>
   32
   &gt;&gt;&gt; <span class="strong"><strong>csvFile.close()</strong></span></pre><p><a id="iddle1237" class="indexterm"/><a id="iddle1239" class="indexterm"/><a id="iddle1242" class="indexterm"/><a id="iddle1244" class="indexterm"/><a id="iddle2194" class="indexterm"/>This changes the delimiter and line terminator characters in your file. The <span class="emphasis"><em>delimiter</em></span> is the character that appears between cells on a row. By default, the delimiter for a CSV file is a comma. The <span class="emphasis"><em>line terminator</em></span> is the character that comes at the end of a row. By default, the line terminator is a newline. You can change characters to different values by using the <code class="literal">delimiter</code> and <code class="literal">lineterminator</code> keyword arguments with <code class="literal">csv.writer()</code>.</p><p>Passing <code class="literal">delimeter='\t'</code> and <code class="literal">lineterminator='\n\n'</code> ➊ changes the character between cells to a tab and the character between rows to two newlines. We then call <code class="literal">writerow()</code> three times to give us three rows.</p><p>This produces a file named <span class="emphasis"><em>example.tsv</em></span> with the following contents:</p><a id="pro_id00513"/><pre class="programlisting">apples  oranges grapes

eggs    bacon   ham
spam    spam    spam    spam    spam    spam</pre><p>Now that our cells are separated by tabs, we’re using the file extension <span class="emphasis"><em>.tsv</em></span>, for tab-separated values.</p></div></div><div class="sect1" title="Project: Removing the Header from CSV Files"><div class="titlepage"><div><div><h1 class="title"><a id="project_removing_the_header_from_csv_fil"/>Project: Removing the Header from CSV Files</h1></div></div></div><p>Say you have the boring job of removing the first line from several hundred CSV files. Maybe you’ll be feeding them into an automated process that requires just the data and not the headers at the top of the columns. You <span class="emphasis"><em>could</em></span> open each file in Excel, delete the first row, and resave the file—but that would take hours. Let’s write a program to do it instead.</p><p>The program will need to open every file with the <span class="emphasis"><em>.csv</em></span> extension in the current working directory, read in the contents of the CSV file, and rewrite the contents without the first row to a file of the same name. This will replace the old contents of the CSV file with the new, headless contents.</p><div class="note" title="Note"><h3 class="title"><a id="ch14note01"/>Note</h3><p><span class="emphasis"><em>As always, whenever you write a program that modifies files, be sure to back up the files, first just in case your program does not work the way you expect it to. You don’t want to accidentally erase your original files.</em></span></p></div><p>At a high level, the program must do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Find all the CSV files in the current working directory.</p></li><li class="listitem"><p>Read in the full contents of each file.</p></li><li class="listitem"><p>Write out the contents, skipping the first line, to a new CSV file.</p><p>At the code level, this means the program will need to do the following:</p></li><li class="listitem"><p>Loop over a list of files from <code class="literal">os.listdir()</code>, skipping the non-CSV files.</p></li><li class="listitem"><p>Create a CSV <code class="literal">Reader</code> object and read in the contents of the file, using the <code class="literal">line_num</code> attribute to figure out which line to skip.</p></li><li class="listitem"><p>Create a CSV <code class="literal">Writer</code> object and write out the read-in data to the new file.</p></li></ul></div><p><a id="iddle1243" class="indexterm"/><a id="iddle1245" class="indexterm"/>For this project, open a new file editor window and save it as <span class="emphasis"><em>removeCsvHeader.py</em></span>.</p><div class="sect2" title="Step 1: Loop Through Each CSV File"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_loop_through_each_csv_file"/>Step 1: Loop Through Each CSV File</h2></div></div></div><p>The first thing your program needs to do is loop over a list of all CSV filenames for the current working directory. Make your <span class="emphasis"><em>removeCsvHeader.py</em></span> look like this:</p><a id="pro_id00514"/><pre class="programlisting">   #! python3
   # removeCsvHeader.py - Removes the header from all CSV files in the current
   # working directory.

   import csv, os

   os.makedirs('headerRemoved', exist_ok=True)

   # Loop through every file in the current working directory.
   for csvFilename in os.listdir('.'):
       if not csvFilename.endswith('.csv'):
➊         continue    # skip non-csv files

       print('Removing header from ' + csvFilename + '...')

       # TODO: Read the CSV file in (skipping first row).

       # TODO: Write out the CSV file.</pre><p>The <code class="literal">os.makedirs()</code> call will create a <code class="literal">headerRemoved</code> folder where all the headless CSV files will be written. A <code class="literal">for</code> loop on <code class="literal">os.listdir('.')</code> gets you partway there, but it will loop over <span class="emphasis"><em>all</em></span> files in the working directory, so you’ll need to add some code at the start of the loop that skips filenames that don’t end with <code class="literal">.csv</code>. The <code class="literal">continue</code> statement ➊ makes the <code class="literal">for</code> loop move on to the next filename when it comes across a non-CSV file.</p><p>Just so there’s <span class="emphasis"><em>some</em></span> output as the program runs, print out a message saying which CSV file the program is working on. Then, add some <code class="literal">TODO</code> comments for what the rest of the program should do.</p></div><div class="sect2" title="Step 2: Read in the CSV File"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_read_in_the_csv_file"/>Step 2: Read in the CSV File</h2></div></div></div><p>The program doesn’t remove the first line from the CSV file. Rather, it creates a new copy of the CSV file without the first line. Since the copy’s filename is the same as the original filename, the copy will overwrite the original.</p><p>The program will need a way to track whether it is currently looping on the first row. Add the following to <span class="emphasis"><em>removeCsvHeader.py</em></span>.</p><a id="pro_id00515"/><pre class="programlisting">#! python3
# removeCsvHeader.py - Removes the header from all CSV files in the current
# working directory.

<span class="emphasis"><em>--snip--</em></span>
<span class="strong"><strong># Read the CSV file in (skipping first row).</strong></span>
<span class="strong"><strong>csvRows = []</strong></span>
<span class="strong"><strong>csvFileObj = open(csvFilename)</strong></span>
<span class="strong"><strong>readerObj = csv.reader(csvFileObj)</strong></span>
<span class="strong"><strong>for row in readerObj:</strong></span>
    <span class="strong"><strong>if readerObj.line_num == 1:</strong></span>
        <span class="strong"><strong>continue    # skip first row</strong></span>
    <span class="strong"><strong>csvRows.append(row)</strong></span>
<span class="strong"><strong>csvFileObj.close()</strong></span>

# TODO: Write out the CSV file.</pre><p><a id="iddle1246" class="indexterm"/>The <code class="literal">Reader</code> object’s <code class="literal">line_num</code> attribute can be used to determine which line in the CSV file it is currently reading. Another <code class="literal">for</code> loop will loop over the rows returned from the CSV <code class="literal">Reader</code> object, and all rows but the first will be appended to <code class="literal">csvRows</code>.</p><p>As the <code class="literal">for</code> loop iterates over each row, the code checks whether <code class="literal">readerObj.line_num</code> is set to <code class="literal">1</code>. If so, it executes a <code class="literal">continue</code> to move on to the next row without appending it to <code class="literal">csvRows</code>. For every row afterward, the condition will be always be <code class="literal">False</code>, and the row will be appended to <code class="literal">csvRows</code>.</p></div><div class="sect2" title="Step 3: Write Out the CSV File Without the First Row"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_write_out_the_csv_file_without_th"/>Step 3: Write Out the CSV File Without the First Row</h2></div></div></div><p>Now that <code class="literal">csvRows</code> contains all rows but the first row, the list needs to be written out to a CSV file in the <span class="emphasis"><em>headerRemoved</em></span> folder. Add the following to <span class="emphasis"><em>removeCsvHeader.py</em></span>:</p><a id="pro_id00516"/><pre class="programlisting">   #! python3
   # removeCsvHeader.py - Removes the header from all CSV files in the current
   # working directory.
   <span class="emphasis"><em>--snip--</em></span>

   # Loop through every file in the current working directory.
➊ for csvFilename in os.listdir('.'):
       if not csvFilename.endswith('.csv'):
           continue    # skip non-CSV files

       <span class="emphasis"><em>--snip--</em></span>

       <span class="strong"><strong># Write out the CSV file.</strong></span>
       <span class="strong"><strong>csvFileObj = open(os.path.join('headerRemoved', csvFilename), 'w',</strong></span>
                    <span class="strong"><strong>newline='')</strong></span>
       <span class="strong"><strong>csvWriter = csv.writer(csvFileObj)</strong></span>
       <span class="strong"><strong>for row in csvRows:</strong></span>
           <span class="strong"><strong>csvWriter.writerow(row)</strong></span>
       <span class="strong"><strong>csvFileObj.close()</strong></span></pre><p>The CSV <code class="literal">Writer</code> object will write the list to a CSV file in <code class="literal">headerRemoved</code> using <code class="literal">csvFilename</code> (which we also used in the CSV reader). This will overwrite the original file.</p><p><a id="iddle1087" class="indexterm"/><a id="iddle1769" class="indexterm"/><a id="iddle1771" class="indexterm"/>Once we create the <code class="literal">Writer</code> object, we loop over the sublists stored in <code class="literal">csvRows</code> and write each sublist to the file.</p><p>After the code is executed, the outer <code class="literal">for</code> loop ➊ will loop to the next filename from <code class="literal">os.listdir('.')</code>. When that loop is finished, the program will be complete.</p><p>To test your program, download <span class="emphasis"><em>removeCsvHeader.zip</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span> and unzip it to a folder. Run the <span class="emphasis"><em>removeCsvHeader.py</em></span> program in that folder. The output will look like this:</p><a id="pro_id00517"/><pre class="programlisting">Removing header from NAICS_data_1048.csv...
Removing header from NAICS_data_1218.csv...
<span class="emphasis"><em>--snip--</em></span>
Removing header from NAICS_data_9834.csv...
Removing header from NAICS_data_9986.csv...</pre><p>This program should print a filename each time it strips the first line from a CSV file.</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00049"/>Ideas for Similar Programs</h2></div></div></div><p>The programs that you could write for CSV files are similar to the kinds you could write for Excel files, since they’re both spreadsheet files. You could write programs to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Compare data between different rows in a CSV file or between multiple CSV files.</p></li><li class="listitem"><p>Copy specific data from a CSV file to an Excel file, or vice versa.</p></li><li class="listitem"><p>Check for invalid data or formatting mistakes in CSV files and alert the user to these errors.</p></li><li class="listitem"><p>Read data from a CSV file as input for your Python programs.</p></li></ul></div></div></div><div class="sect1" title="JSON and APIs"><div class="titlepage"><div><div><h1 class="title"><a id="json_and_apis"/>JSON and APIs</h1></div></div></div><p>JavaScript Object Notation is a popular way to format data as a single human-readable string. JSON is the native way that JavaScript programs write their data structures and usually resembles what Python’s <code class="literal">pprint()</code> function would produce. You don’t need to know JavaScript in order to work with JSON-formatted data.</p><p>Here’s an example of data formatted as JSON:</p><a id="pro_id00518"/><pre class="programlisting">{"name": "Zophie", "isCat": true,
 "miceCaught": 0, "napsTaken": 37.5,
 "felineIQ": null}</pre><p>JSON is useful to know, because many websites offer JSON content as a way for programs to interact with the website. This is known as providing an <span class="emphasis"><em>application programming interface (API)</em></span>. Accessing an API is the same <a id="iddle1772" class="indexterm"/><a id="iddle1861" class="indexterm"/>as accessing any other web page via a URL. The difference is that the data returned by an API is formatted (with JSON, for example) for machines; APIs aren’t easy for people to read.</p><p>Many websites make their data available in JSON format. Facebook, Twitter, Yahoo, Google, Tumblr, Wikipedia, Flickr, Data.gov, Reddit, IMDb, Rotten Tomatoes, LinkedIn, and many other popular sites offer APIs for programs to use. Some of these sites require registration, which is almost always free. You’ll have to find documentation for what URLs your program needs to request in order to get the data you want, as well as the general format of the JSON data structures that are returned. This documentation should be provided by whatever site is offering the API; if they have a “Developers” page, look for the documentation there.</p><p>Using APIs, you could write programs that do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Scrape raw data from websites. (Accessing APIs is often more convenient than downloading web pages and parsing HTML with Beautiful Soup.)</p></li><li class="listitem"><p>Automatically download new posts from one of your social network accounts and post them to another account. For example, you could take your Tumblr posts and post them to Facebook.</p></li><li class="listitem"><p>Create a “movie encyclopedia” for your personal movie collection by pulling data from IMDb, Rotten Tomatoes, and Wikipedia and putting it into a single text file on your computer.</p></li></ul></div><p>You can see some examples of JSON APIs in the resources at <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>.</p></div><div class="sect1" title="The JSON Module"><div class="titlepage"><div><div><h1 class="title"><a id="json_module"/>The JSON Module</h1></div></div></div><p>Python’s <code class="literal">json</code> module handles all the details of translating between a string with JSON data and Python values for the <code class="literal">json.loads()</code> and <code class="literal">json.dumps()</code> functions. JSON can’t store <span class="emphasis"><em>every</em></span> kind of Python value. It can contain values of only the following data types: strings, integers, floats, Booleans, lists, dictionaries, and <code class="literal">NoneType</code>. JSON cannot represent Python-specific objects, such as <code class="literal">File</code> objects, CSV <code class="literal">Reader</code> or <code class="literal">Writer</code> objects, <code class="literal">Regex</code> objects, or Selenium <code class="literal">WebElement</code> objects.</p><div class="sect2" title="Reading JSON with the loads() Function"><div class="titlepage"><div><div><h2 class="title"><a id="reading_json_with_the_loadsleft_parenthe"/>Reading JSON with the loads() Function</h2></div></div></div><p>To translate a string containing JSON data into a Python value, pass it to the <code class="literal">json.loads()</code> function. (The name means “load string,” not “loads.”) Enter the following into the interactive shell:</p><a id="pro_id00519"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>stringOfJsonData = '{"name": "Zophie", "isCat": true, "miceCaught": 0,</strong></span>
<span class="strong"><strong>"felineIQ": null}'</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>import json</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>jsonDataAsPythonValue = json.loads(stringOfJsonData)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>jsonDataAsPythonValue</strong></span>
{'isCat': True, 'miceCaught': 0, 'name': 'Zophie', 'felineIQ': None}</pre><p><a id="iddle1372" class="indexterm"/><a id="iddle1773" class="indexterm"/><a id="iddle1774" class="indexterm"/><a id="iddle2184" class="indexterm"/><a id="iddle2653" class="indexterm"/><a id="iddle2657" class="indexterm"/>After you import the <code class="literal">json</code> module, you can call <code class="literal">loads()</code> and pass it a string of JSON data. Note that JSON strings always use double quotes. It will return that data as a Python dictionary. Python dictionaries are not ordered, so the key-value pairs may appear in a different order when you print <code class="literal">jsonDataAsPythonValue</code>.</p></div><div class="sect2" title="Writing JSON with the dumps() Function"><div class="titlepage"><div><div><h2 class="title"><a id="writing_json_with_the_dumpsleft_parenthe"/>Writing JSON with the dumps() Function</h2></div></div></div><p>The <code class="literal">json.dumps()</code> function (which means “dump string,” not “dumps”) will translate a Python value into a string of JSON-formatted data. Enter the following into the interactive shell:</p><a id="pro_id00520"/><pre class="programlisting">&gt;&gt;&gt; <span class="strong"><strong>pythonValue = {'isCat': True, 'miceCaught': 0, 'name': 'Zophie',</strong></span>
<span class="strong"><strong>'felineIQ': None}</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>import json</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>stringOfJsonData = json.dumps(pythonValue)</strong></span>
&gt;&gt;&gt; <span class="strong"><strong>stringOfJsonData</strong></span>
'{"isCat": true, "felineIQ": null, "miceCaught": 0, "name": "Zophie" }'</pre><p>The value can only be one of the following basic Python data types: dictionary, list, integer, float, string, Boolean, or <code class="literal">None</code>.</p></div></div><div class="sect1" title="Project: Fetching Current Weather Data"><div class="titlepage"><div><div><h1 class="title"><a id="project_fetching_current_weather_data"/>Project: Fetching Current Weather Data</h1></div></div></div><p>Checking the weather seems fairly trivial: Open your web browser, click the address bar, type the URL to a weather website (or search for one and then click the link), wait for the page to load, look past all the ads, and so on.</p><p>Actually, there are a lot of boring steps you could skip if you had a program that downloaded the weather forecast for the next few days and printed it as plaintext. This program uses the <code class="literal">requests</code> module from Chapter 11 to download data from the Web.</p><p>Overall, the program does the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Reads the requested location from the command line.</p></li><li class="listitem"><p>Downloads JSON weather data from OpenWeatherMap.org.</p></li><li class="listitem"><p>Converts the string of JSON data to a Python data structure.</p></li><li class="listitem"><p>Prints the weather for today and the next two days.</p><p>So the code will need to do the following:</p></li><li class="listitem"><p>Join strings in <code class="literal">sys.argv</code> to get the location.</p></li><li class="listitem"><p>Call <code class="literal">requests.get()</code> to download the weather data.</p></li><li class="listitem"><p>Call <code class="literal">json.loads()</code> to convert the JSON data to a Python data structure.</p></li><li class="listitem"><p>Print the weather forecast.</p></li></ul></div><p>For this project, open a new file editor window and save it as <span class="emphasis"><em>quickWeather.py</em></span>.</p><div class="sect2" title="Step 1: Get Location from the Command Line Argument"><div class="titlepage"><div><div><h2 class="title"><a id="step_1_get_location_from_the_command_lin"/>Step 1: Get Location from the Command Line Argument</h2></div></div></div><p><a id="iddle2654" class="indexterm"/><a id="iddle2655" class="indexterm"/>The input for this program will come from the command line. Make <span class="emphasis"><em>quickWeather.py</em></span> look like this:</p><a id="pro_id00521"/><pre class="programlisting">#! python3
# quickWeather.py - Prints the weather for a location from the command line.

import json, requests, sys

# Compute location from command line arguments.
if len(sys.argv) &lt; 2:
    print('Usage: quickWeather.py location')
    sys.exit()
location = ' '.join(sys.argv[1:])

# TODO: Download the JSON data from OpenWeatherMap.org's API.

# TODO: Load JSON data into a Python variable.</pre><p>In Python, command line arguments are stored in the <code class="literal">sys.argv</code> list. After the <code class="literal">#!</code> shebang line and <code class="literal">import</code> statements, the program will check that there is more than one command line argument. (Recall that <code class="literal">sys.argv</code> will always have at least one element, <code class="literal">sys.argv[0]</code>, which contains the Python script’s filename.) If there is only one element in the list, then the user didn’t provide a location on the command line, and a “usage” message will be provided to the user before the program ends.</p><p>Command line arguments are split on spaces. The command line argument <code class="literal">San Francisco, CA</code> would make <code class="literal">sys.argv</code> hold <code class="literal">['quickWeather.py', 'San', 'Francisco,', 'CA']</code>. Therefore, call the <code class="literal">join()</code> method to join all the strings except for the first in <code class="literal">sys.argv</code>. Store this joined string in a variable named <code class="literal">location</code>.</p></div><div class="sect2" title="Step 2: Download the JSON Data"><div class="titlepage"><div><div><h2 class="title"><a id="step_2_download_the_json_data"/>Step 2: Download the JSON Data</h2></div></div></div><p>OpenWeatherMap.org provides real-time weather information in JSON format. Your program simply has to download the page at <span class="emphasis"><em><a class="ulink" href="http://api.openweathermap.org/data/2.5/forecast/daily?q=&lt;Location&gt;&amp;cnt=3">http://api.openweathermap.org/data/2.5/forecast/daily?q=&lt;Location&gt;&amp;cnt=3</a></em></span>, where <span class="emphasis"><em>&lt;Location&gt;</em></span> is the name of the city whose weather you want. Add the following to <span class="emphasis"><em>quickWeather.py</em></span>.</p><a id="pro_id00522"/><pre class="programlisting">#! python3
# quickWeather.py - Prints the weather for a location from the command line.

<span class="emphasis"><em>--snip--</em></span>

<span class="strong"><strong># Download the JSON data from OpenWeatherMap.org's API.</strong></span>
<span class="strong"><strong>url ='http://api.openweathermap.org/data/2.5/forecast/daily?q=%s&amp;cnt=3' % (location)</strong></span>
<span class="strong"><strong>response = requests.get(url)</strong></span>
<span class="strong"><strong>response.raise_for_status()</strong></span>

# TODO: Load JSON data into a Python variable.</pre><p><a id="iddle1862" class="indexterm"/><a id="iddle2656" class="indexterm"/>We have <code class="literal">location</code> from our command line arguments. To make the URL we want to access, we use the <code class="literal">%s</code> placeholder and insert whatever string is stored in <code class="literal">location</code> into that spot in the URL string. We store the result in <code class="literal">url</code> and pass <code class="literal">url</code> to <code class="literal">requests.get()</code>. The <code class="literal">requests.get()</code> call returns a <code class="literal">Response</code> object, which you can check for errors by calling <code class="literal">raise_for_status()</code>. If no exception is raised, the downloaded text will be in <code class="literal">response.text</code>.</p></div><div class="sect2" title="Step 3: Load JSON Data and Print Weather"><div class="titlepage"><div><div><h2 class="title"><a id="step_3_load_json_data_and_print_weather"/>Step 3: Load JSON Data and Print Weather</h2></div></div></div><p>The <code class="literal">response.text</code> member variable holds a large string of JSON-formatted data. To convert this to a Python value, call the <code class="literal">json.loads()</code> function. The JSON data will look something like this:</p><a id="pro_id00523"/><pre class="programlisting">{'city': {'coord': {'lat': 37.7771, 'lon': -122.42},
          'country': 'United States of America',
          'id': '5391959',
          'name': 'San Francisco',
          'population': 0},
'cnt': 3,
'cod': '200',
'list': [{'clouds': 0,
          'deg': 233,
          'dt': 1402344000,
          'humidity': 58,
          'pressure': 1012.23,
          'speed': 1.96,
          'temp': {'day': 302.29,
                   'eve': 296.46,
                   'max': 302.29,
                   'min': 289.77,
                   'morn': 294.59,
                   'night': 289.77},
          'weather': [{'description': 'sky is clear',
                       'icon': '01d',
<span class="emphasis"><em>--snip--</em></span></pre><p>You can see this data by passing <code class="literal">weatherData</code> to <code class="literal">pprint.pprint()</code>. You may want to check <span class="emphasis"><em><a class="ulink" href="http://openweathermap.org/">http://openweathermap.org/</a></em></span> for more documentation on what these fields mean. For example, the online documentation will tell you that the <code class="literal">302.29</code> after <code class="literal">'day'</code> is the daytime temperature in Kelvin, not Celsius or Fahrenheit.</p><p>The weather descriptions you want are after <code class="literal">'main'</code> and <code class="literal">'description'</code>. To neatly print them out, add the following to <span class="emphasis"><em>quickWeather.py</em></span>.</p><a id="pro_id00524"/><pre class="programlisting">   ! python3
   # quickWeather.py - Prints the weather for a location from the command line.

   <span class="emphasis"><em>--snip--</em></span>

   <span class="strong"><strong># Load JSON data into a Python variable.</strong></span>
   <span class="strong"><strong>weatherData = json.loads(response.text)</strong></span>
   <span class="strong"><strong># Print weather descriptions.</strong></span>
➊ <span class="strong"><strong>w = weatherData['list']</strong></span>
   <span class="strong"><strong>print('Current weather in %s:' % (location))</strong></span>
   <span class="strong"><strong>print(w[0]['weather'][0]['main'], '-', w[0]['weather'][0]['description'])</strong></span>
   <span class="strong"><strong>print()</strong></span>
   <span class="strong"><strong>print('Tomorrow:')</strong></span>
   <span class="strong"><strong>print(w[1]['weather'][0]['main'], '-', w[1]['weather'][0]['description'])</strong></span>
   <span class="strong"><strong>print()</strong></span>
   <span class="strong"><strong>print('Day after tomorrow:')</strong></span>
   <span class="strong"><strong>print(w[2]['weather'][0]['main'], '-', w[2]['weather'][0]['description'])</strong></span></pre><p>Notice how the code stores <code class="literal">weatherData['list']</code> in the variable <code class="literal">w</code> to save you some typing ➊. You use <code class="literal">w[0]</code>, <code class="literal">w[1]</code>, and <code class="literal">w[2]</code> to retrieve the dictionaries for today, tomorrow, and the day after tomorrow’s weather, respectively. Each of these dictionaries has a <code class="literal">'weather'</code> key, which contains a list value. You’re interested in the first list item, a nested dictionary with several more keys, at index 0. Here, we print the values stored in the <code class="literal">'main'</code> and <code class="literal">'description'</code> keys, separated by a hyphen.</p><p>When this program is run with the command line argument <code class="literal">quickWeather.py San Francisco, CA</code>, the output looks something like this:</p><a id="pro_id00525"/><pre class="programlisting">Current weather in San Francisco, CA:
Clear - sky is clear

Tomorrow:
Clouds - few clouds

Day after tomorrow:
Clear - sky is clear</pre><p>(The weather is one of the reasons I like living in San Francisco!)</p></div><div class="sect2" title="Ideas for Similar Programs"><div class="titlepage"><div><div><h2 class="title"><a id="ideas_for_similar_programs-id00050"/>Ideas for Similar Programs</h2></div></div></div><p>Accessing weather data can form the basis for many types of programs. You can create similar programs to do the following:</p><div class="itemizedlist"><ul class="itemizedlist"><li class="listitem"><p>Collect weather forecasts for several campsites or hiking trails to see which one will have the best weather.</p></li><li class="listitem"><p>Schedule a program to regularly check the weather and send you a frost alert if you need to move your plants indoors. (<a class="xref" href="ch15.html" title="Chapter 15. Keeping Time, Scheduling Tasks, and Launching Programs">Chapter 15</a> covers scheduling, and <a class="xref" href="ch16.html" title="Chapter 16. Sending Email and Text Messages">Chapter 16</a> explains how to send email.)</p></li><li class="listitem"><p>Pull weather data from multiple sites to show all at once, or calculate and show the average of the multiple weather predictions.</p></li></ul></div></div></div><div class="sect1" title="Summary"><div class="titlepage"><div><div><h1 class="title"><a id="summary-id00051"/>Summary</h1></div></div></div><p>CSV and JSON are common plaintext formats for storing data. They are easy for programs to parse while still being human readable, so they are often used for simple spreadsheets or web app data. The <code class="literal">csv</code> and <code class="literal">json</code> modules greatly simplify the process of reading and writing to CSV and JSON files.</p><p>The last few chapters have taught you how to use Python to parse information from a wide variety of file formats. One common task is taking data from a variety of formats and parsing it for the particular information you need. These tasks are often specific to the point that commercial software is not optimally helpful. By writing your own scripts, you can make the computer handle large amounts of data presented in these formats.</p><p>In <a class="xref" href="ch15.html" title="Chapter 15. Keeping Time, Scheduling Tasks, and Launching Programs">Chapter 15</a>, you’ll break away from data formats and learn how to make your programs communicate with you by sending emails and text messages.</p></div><div class="sect1" title="Practice Questions"><div class="titlepage"><div><div><h1 class="title"><a id="practice_questions-id00052"/>Practice Questions</h1></div></div></div><div class="qandaset" title="Frequently Asked Questions"><a id="ch14qa1"/><table border="0" width="100%" summary="Q and A Set"><col align="left" width="1%"/><col/><tbody><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe1"/><a id="ch14qa1q1"/><p>Q:</p></td><td align="left" valign="top"><p>1. What are some features Excel spreadsheets have that CSV spreadsheets don’t?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe2"/><a id="ch14qa1q2"/><p>Q:</p></td><td align="left" valign="top"><p>2. What do you pass to <code class="literal">csv.reader()</code> and <code class="literal">csv.writer()</code> to create <code class="literal">Reader</code> and <code class="literal">Writer</code> objects?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe3"/><a id="ch14qa1q3"/><p>Q:</p></td><td align="left" valign="top"><p>3. What modes do <code class="literal">File</code> objects for reader and <code class="literal">Writer</code> objects need to be opened in?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe4"/><a id="ch14qa1q4"/><p>Q:</p></td><td align="left" valign="top"><p>4. What method takes a list argument and writes it to a CSV file?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe5"/><a id="ch14qa1q5"/><p>Q:</p></td><td align="left" valign="top"><p>5. What do the <code class="literal">delimiter</code> and <code class="literal">lineterminator</code> keyword arguments do?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe6"/><a id="ch14qa1q6"/><p>Q:</p></td><td align="left" valign="top"><p>6. What function takes a string of JSON data and returns a Python data structure?</p></td></tr><tr class="question" title="Q:"><td align="left" valign="top"><a id="ch14qa1qe7"/><a id="ch14qa1q7"/><p>Q:</p></td><td align="left" valign="top"><p>7. What function takes a Python data structure and returns a string of JSON data?</p></td></tr></tbody></table></div></div><div class="sect1" title="Practice Project"><div class="titlepage"><div><div><h1 class="title"><a id="practice_project-id00053"/>Practice Project</h1></div></div></div><p>For practice, write a program that does the following.</p><div class="sect2" title="Excel-to-CSV Converter"><div class="titlepage"><div><div><h2 class="title"><a id="excel-to-csv_converter"/>Excel-to-CSV Converter</h2></div></div></div><p>Excel can save a spreadsheet to a CSV file with a few mouse clicks, but if you had to convert hundreds of Excel files to CSVs, it would take hours of clicking. Using the <code class="literal">openpyxl</code> module from <a class="xref" href="ch12.html" title="Chapter 12. Working with Excel Spreadsheets">Chapter 12</a>, write a program that reads all the Excel files in the current working directory and outputs them as CSV files.</p><p>A single Excel file might contain multiple sheets; you’ll have to create one CSV file per <span class="emphasis"><em>sheet</em></span>. The filenames of the CSV files should be <span class="emphasis"><em>&lt;excel filename&gt;_&lt;sheet title&gt;.csv</em></span>, where <span class="emphasis"><em>&lt;excel filename&gt;</em></span> is the filename of the Excel file without the file extension (for example, <code class="literal">'spam_data'</code>, not <code class="literal">'spam_data.xlsx'</code>) and <span class="emphasis"><em>&lt;sheet title&gt;</em></span> is the string from the <code class="literal">Worksheet</code> object’s <code class="literal">title</code> variable.</p><p>This program will involve many nested <code class="literal">for</code> loops. The skeleton of the program will look something like this:</p><a id="pro_id00526"/><pre class="programlisting">for excelFile in os.listdir('.'):
    # Skip non-xlsx files, load the workbook object.
    for sheetName in wb.get_sheet_names():
        # Loop through every sheet in the workbook.
        sheet = wb.get_sheet_by_name(sheetName)

        # Create the CSV filename from the Excel filename and sheet title.
        # Create the csv.writer object for this CSV file.

        # Loop through every row in the sheet.
        for rowNum in range(1, sheet.get_highest_row() + 1):
            rowData = []    # append each cell to this list
            # Loop through each cell in the row.
            for colNum in range(1, sheet.get_highest_column() + 1):
                # Append each cell's data to rowData.

            # Write the rowData list to the CSV file.

        csvFile.close()</pre><p>Download the ZIP file <span class="emphasis"><em>excelSpreadsheets.zip</em></span> from <span class="emphasis"><em><a class="ulink" href="http://nostarch.com/automatestuff/">http://nostarch.com/automatestuff/</a></em></span>, and unzip the spreadsheets into the same directory as your program. You can use these as the files to test the program on.</p></div></div></div></body></html>
